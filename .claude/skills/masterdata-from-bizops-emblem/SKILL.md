---
name: masterdata-from-bizops-emblem
description: エンブレムの運営仕様書からマスタデータCSVを作成するスキル。対象テーブル: 2個(MstEmblem, MstEmblemI18n)。イベントエンブレム、降臨バトルランキングエンブレム等のマスタデータを精度高く作成します。
---

# エンブレム マスタデータ作成スキル

## 概要

エンブレムの運営仕様書からマスタデータCSVを作成します。設計書に記載された情報を元に、DB投入可能な形式のマスタデータを自動生成し、推測で決定した値は必ずレポートします。

### 作成対象テーブル

以下の2テーブルを自動生成:

**エンブレム情報**:
- **MstEmblem** - エンブレムの基本情報(タイプ、シリーズID等)
- **MstEmblemI18n** - エンブレム名・説明文(多言語対応)

## 基本的な使い方

### 必須パラメータ

以下のパラメータを指定してください:

| パラメータ名 | 説明 | 例 |
|------------|------|-----|
| **release_key** | リリースキー | `202601010` |
| **mst_series_id** | シリーズID(jig/osh/kai) | `jig` |
| **emblem_id** | エンブレムID | `emblem_event_jig_00001` |
| **emblem_type** | エンブレムタイプ | `Event`(Event/Series) |
| **emblem_name** | エンブレム名 | `神仙郷`(最大255文字) |
| **emblem_description** | エンブレム説明文 | `仙薬探しのため、死罪人と打ち首執行人たちが上陸した秘境の島`(最大255文字) |

### 実行方法

運営仕様書ファイルを添付して、以下のプロンプトを実行してください:

```
エンブレムの運営仕様書からマスタデータを作成してください。

添付ファイル:
- エンブレム設計書_地獄楽_いいジャン祭.xlsx

パラメータ:
- release_key: 202601010
- mst_series_id: jig
- emblem_type: Event
- エンブレム情報:
  1. イベントエンブレム「神仙郷」
     - 説明: 仙薬探しのため、死罪人と打ち首執行人たちが上陸した秘境の島
  2. 降臨バトルエンブレム「罪人」(ランキング報酬)
     - バトル名: まるで 悪夢を見ているようだ
     - 開催: 2026年1月
     - ランキング区分: 1位、2位、3位、4~50位、51~300位、301~1,000位
```

## ワークフロー

### Step 1: 仕様書の読み込み

運営仕様書から以下の情報を抽出します:

**必須情報**:
- エンブレムID(例: `emblem_event_jig_00001`)
- エンブレムタイプ(Event、Series)
- シリーズID(例: `jig`)
- エンブレム名(最大255文字)
- エンブレム説明文(最大255文字)
- 入手条件(イベント参加、降臨バトルランキング等)

**降臨バトルエンブレム特有の情報**:
- バトル名
- 開催年月
- ランキング区分(通常6個: 1位、2位、3位、4~50位、51~300位、301~1,000位)

### Step 2: マスタデータ生成

詳細ルールは [references/manual.md](references/manual.md) を参照し、以下のテーブルを作成します:

1. **MstEmblem** - エンブレムの基本設定
2. **MstEmblemI18n** - エンブレム名・説明文(多言語対応)

#### データ依存関係の自動管理

**重要**: 親テーブルを作成した際は、依存する子テーブルも自動的に生成してください。

**依存関係定義** (`config/table_dependencies.json` 参照):
```json
{
  "MstEmblem": ["MstEmblemI18n"]
}
```

**自動生成ロジック**:
1. **MstEmblem**を作成 → **MstEmblemI18n**を自動生成
   - id: `{parent_id}_{language}` (例: `emblem_event_jig_00001_ja`)
   - mst_emblem_id: `{parent_id}`
   - name、descriptionを運営仕様書から抽出

**実装の流れ**:
```
1. MstEmblem作成
   ↓ (自動)
2. MstEmblemI18n生成
```

この自動生成により、親テーブル未生成による子テーブル欠落を防止できます。

#### ID採番ルール

エンブレムのIDは以下の形式で採番します:

```
MstEmblem.id: emblem_{category}_{series_id}_{連番5桁}
MstEmblemI18n.id: {mst_emblem_id}_{language}

降臨バトルエンブレムの場合:
MstEmblem.id: emblem_adventbattle_{series_id}_{season}_{連番5桁}
```

**例**:
```
emblem_event_jig_00001 (地獄楽イベントエンブレム1)
emblem_adventbattle_jig_season01_00001 (地獄楽降臨バトルシーズン1エンブレム1)
emblem_event_jig_00001_ja (日本語I18n)
```

### Step 3: データ整合性チェック

以下の項目を自動確認し、問題があれば修正します:

- [ ] ヘッダーの列順が正しいか
- [ ] すべてのIDが一意であるか
- [ ] ID採番ルールに従っているか
- [ ] リレーションが正しく設定されているか
- [ ] enum値が正確に一致しているか(emblemType、language等)
- [ ] 降臨バトルエンブレムはランキング順位に応じて複数作成されているか

### Step 4: 推測値レポート

設計書に記載がなく、推測で決定した値を必ずレポートします。

**推測値の例**:
- `MstEmblem.assetKey`: アセットキー(記載がない場合はエンブレムIDから推測)
- `MstEmblemI18n.description`: 降臨バトルエンブレムの説明文(記載がない場合は標準フォーマットで生成)

### Step 5: 出力

以下の形式で出力します:

#### 1. マスタデータ(Markdown表形式)

- スプレッドシートへのエクスポート・コピーボタンが正常に表示される形式
- 以下の2シートを作成:
  1. MstEmblem
  2. MstEmblemI18n

#### 2. 推測値レポート(必須)

作成したデータのうち、以下に該当するものを必ずレポートします:

- **添付ファイルにも手順書にも記載がなく、推測で決定したID値やパラメータ値**
- 手順書通りに作成したID値は対象外

**重要**: このレポートを怠ると、データインポートエラーや本番不具合のリスクが高まります。推測で決定した値は必ず報告してください。

## 出力例

### MstEmblem シート

| ENABLE | id | emblemType | mstSeriesId | assetKey | release_key |
|--------|----|-----------|-----------|---------||
| e | emblem_event_jig_00001 | Event | jig | event_jig_00001 | 202601010 |
| e | emblem_adventbattle_jig_season01_00001 | Event | jig | adventbattle_jig_season01_00001 | 202601010 |

### MstEmblemI18n シート

| ENABLE | release_key | id | mst_emblem_id | language | name | description |
|--------|-------------|----|--------------|---------||------|-------------|
| e | 202601010 | emblem_event_jig_00001_ja | emblem_event_jig_00001 | ja | 神仙郷 | 仙薬探しのため、死罪人と打ち首執行人たちが上陸した秘境の島 |
| e | 202601010 | emblem_adventbattle_jig_season01_00001_ja | emblem_adventbattle_jig_season01_00001 | ja | 罪人(1位) | 2026年1月開催降臨バトル『まるで 悪夢を見ているようだ』1位の証 |

## 注意事項

### 降臨バトルエンブレムについて

降臨バトルエンブレムは通常ランキング順位に応じて複数作成します(通常6個):
- 1位
- 2位
- 3位
- 4~50位
- 51~300位
- 301~1,000位

**説明文のフォーマット**:
```
2026年1月開催降臨バトル『{バトル名}』{順位}の証
```

### 外部キー整合性について

以下のリレーションが正しく設定されていることを必ず確認してください:
- `MstEmblemI18n.mst_emblem_id` → `MstEmblem.id`

## リファレンス

詳細なルールとenum値一覧:

- **[詳細手順書](references/manual.md)** - テーブル定義、カラム設定ルール、ID採番ルール、enum値一覧
- **[サンプル出力](examples/sample-output.md)** - 実際の出力例

## トラブルシューティング

### Q1: 降臨バトルエンブレムの数が分からない

**対処法**:
通常は6個作成します(1位、2位、3位、4~50位、51~300位、301~1,000位)。運営仕様書に明記がある場合はそれに従ってください。

### Q2: enum値のエラーが発生する

**対処法**:
enum値は**大文字小文字を正確に一致**させる。正しいenum値: `Event`、`Series`

## 検証

作成したマスタデータCSVは、`masterdata-csv-validator` スキルで検証できます。
