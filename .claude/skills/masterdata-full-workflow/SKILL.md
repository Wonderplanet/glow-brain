---
name: masterdata-full-workflow
description: 施策のマスタデータ生成フルワークフロー。要件分析→コンテンツタイプ別並列生成→統合を一括実行。マスタデータフル実行、施策のマスタデータを作成で使用。
allowed-tools: Skill, Task, Read, Write, Bash
argument-hint: 施策ディレクトリパス
---

# マスタデータ フル実行ワークフロー

このスキルは、施策のマスタデータ生成フルワークフローを実行します。要件ファイル構成の分析→マスタデータ生成までを1回の実行で完遂します。

## 前提条件

事前に要件フォルダを準備してください:

```
マスタデータ/施策/[施策名]/
└── 要件/    ← ユーザーが仕様書ファイルを事前に配置
```

## 入力

施策ディレクトリパス（例: `マスタデータ/施策/新春ガチャ`）

## 出力

- **要件ファイル構成.md**: 要件フォルダの構造分析結果
- **CSVファイル群**: 全てのマスタデータCSV
- **REPORT.md**: データ生成レポート

## タスク

指定された施策ディレクトリに対して、以下の4つのステップを**順番に実行**してください。

### ステップ1: 要件ファイル構成ドキュメントの生成

`masterdata-requirement-analyzer` スキルを実行:

```
Skill(skill: "masterdata-requirement-analyzer", args: "<施策ディレクトリパス>")
```

これにより、`[施策ディレクトリ]/要件ファイル構成.md` が生成されます。

### ステップ2: コンテンツタイプの識別

**要件ファイル構成.md**を読み、含まれるコンテンツタイプを識別してください。

```
Read(file_path: "<施策ディレクトリ>/要件ファイル構成.md")
```

#### 識別するコンテンツタイプ

| コンテンツタイプ | 識別キーワード | 説明 |
|-----------------|----------------|------|
| **gacha** | ガシャ、ガチャ、ピックアップ、提供割合、天井 | ガチャ関連のマスタデータ |
| **battle** | 降臨バトル、降臨、バトル、ランキング | バトル関連のマスタデータ |
| **mission** | ミッション、特別ミッション、クリアミッション | ミッション関連のマスタデータ |
| **shop** | ショップ、パック、課金、販売期間、購入可能回数 | ショップ/パック関連のマスタデータ |
| **exchange** | 交換所、交換 | 交換所関連のマスタデータ |

#### 識別の指針

1. **ファイル名とファイル構造を総合的に判断**:
   - ファイル名だけでなく、ファイルの役割や内容の記述も考慮
   - 例: 「06_ガシャ基本仕様.html」「ピックアップガシャ_注意事項.html」「幼稚園WARS いいジャン祭ピックアップガシャ_設計書.html」は全て **gacha**

2. **コンテンツの本質を理解**:
   - 「提供割合」「天井」などのキーワードがあれば **gacha**
   - 「降臨バトル」「ランキング」があれば **battle**
   - 「特別ミッション」「クリアミッション」があれば **mission**
   - 「購入可能回数」「販売期間」があれば **shop**
   - 「交換所」「交換」があれば **exchange**

3. **複数のコンテンツタイプが含まれる場合**:
   - 全てのコンテンツタイプをリストアップ
   - 例: ガシャとショップとミッションが含まれる場合 → `["gacha", "shop", "mission"]`

4. **曖昧な場合の判断**:
   - 明確な証拠がない場合は含めない（false positiveよりfalse negativeを優先）
   - 迷った場合は保守的に判断

#### 識別結果の形式

識別結果を以下の形式でまとめてください：

```
識別されたコンテンツタイプ: gacha, battle, mission, shop
```

**注意**: コンテンツタイプが識別できない場合でも警告して継続してください。

### ステップ3: コンテンツ別subagentの並列起動

**重要**: 識別されたコンテンツタイプごとに、`content-masterdata-generator` subagentを並列起動してください。

**並列実行の方法**: 単一メッセージで複数のTask呼び出しを行います。

例:
```
Task(subagent_type: "content-masterdata-generator",
     description: "ガチャ関連マスタデータ生成",
     prompt: "content_type: gacha\n施策ディレクトリ: <施策ディレクトリパス>")

Task(subagent_type: "content-masterdata-generator",
     description: "バトル関連マスタデータ生成",
     prompt: "content_type: battle\n施策ディレクトリ: <施策ディレクトリパス>")
```

各subagent instanceは部分REPORTを返却します。

### ステップ4: 結果の統合とREPORT生成

各subagent instanceから返却された部分REPORTを統合し、施策ディレクトリ直下に最終的な`REPORT.md`を生成してください:

```
Write(file_path: "<施策ディレクトリ>/REPORT.md", content: "...")
```

REPORTテンプレートを参照: `Read(file_path: ".claude/skills/masterdata-full-workflow/assets/REPORT_template.md")`

**REPORTの構成**:
- 施策概要
- 要件概要
- 生成データ一覧（全instanceの結果を統合）
- スキーマ検証と修正（全instanceの結果を統合）
- データ整合性チェック
- 完了状況

## 重要な注意事項

### タスク完遂の原則 ⚠️

- **全ステップを完全に実行**: ステップ1-4を必ず完遂
- **途中で止めない**: 各subagentは要件に含まれる全マスタデータを最後まで生成
- **完了条件**: 統合REPORT.mdに「未作成のマスタデータ」が残らないようにする

### 完了チェックリスト

#### ステップ1
- ✅ `[施策ディレクトリ]/要件ファイル構成.md` が生成されている

#### ステップ2
- ✅ コンテンツタイプが正しく識別されている

#### ステップ3
- ✅ 識別された全コンテンツタイプに対してsubagentが起動
- ✅ 全CSVファイルがテンプレートからコピーして作成
- ✅ 各subagentから部分REPORTが返却

#### ステップ4
- ✅ `REPORT.md` が施策ディレクトリ直下に生成
- ✅ 全コンテンツタイプの結果がREPORTに統合
- ✅ REPORTに「未作成のマスタデータ」セクションが存在しない
- ✅ REPORTに「スキーマ検証と修正」セクションが含まれる

## エラーハンドリング

- **ステップ1でエラー**: ステップ2には進まない
- **ステップ2でコンテンツタイプが識別できない**: 警告して継続
- **ステップ3で一部のsubagentが失敗**: 他のsubagentは継続実行
- **ステップ4で部分的な失敗**: 統合REPORT.mdに記録

## 詳細ガイド

詳細な情報は以下のファイルを参照してください:

- **ワークフロー詳細**: `Read(file_path: ".claude/skills/masterdata-full-workflow/references/workflow-details.md")`
  - 各ステップの詳細説明
  - ベストプラクティス
  - 依存スキルとsubagent
  - 新しいコンテンツタイプの追加方法

- **トラブルシューティング**: `Read(file_path: ".claude/skills/masterdata-full-workflow/references/troubleshooting.md")`
  - よくある問題と解決方法
  - デバッグ方法
  - パフォーマンス最適化

## 使用例

```
Skill(skill: "masterdata-full-workflow", args: "マスタデータ/施策/新春ガチャ")
```

期待される動作:
1. 要件ファイル構成.mdを生成
2. コンテンツタイプ識別（例: ["gacha"]）
3. content-masterdata-generator subagent起動（ガチャ関連）
4. 統合REPORT.mdを生成

期待される出力:
```
マスタデータ/施策/新春ガチャ/
├── 要件/
├── 要件ファイル構成.md       ← 新規生成
├── REPORT.md                ← 新規生成
├── OprGacha.csv             ← 新規生成
└── MstGachaPrizeGroup.csv   ← 新規生成
```
