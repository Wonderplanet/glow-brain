---
name: masterdata-full-workflow
description: GLOW施策のマスタデータ生成フルワークフロー。要件分析→データ生成→検証を一括実行。マスタデータフル実行、施策のマスタデータを作成で使用。
allowed-tools: Skill
argument-hint: 施策ディレクトリパス
---

# GLOW マスタデータ フル実行ワークフロー

このスキルは、GLOW施策のマスタデータ生成フルワークフローを実行します。要件ファイル構成の分析→マスタデータ生成までを1回の実行で完遂します。

マスタデータ-0プロンプトの内容を完全に実装しています。

## 前提条件

このワークフローを実行する前に、以下の準備が必要です:

```
マスタデータ/施策/[施策名]/
└── 要件/    ← ユーザーが仕様書ファイルを事前に配置
```

## 入力

施策ディレクトリパスを受け取ります:
- 例: `マスタデータ/施策/新春ガチャ`

## 出力

以下のファイルを生成します:
- **要件ファイル構成.md**: 要件フォルダの構造分析結果
- **CSVファイル群**: 全てのマスタデータCSV
- **REPORT.md**: データ生成レポート

## タスク

指定された施策ディレクトリに対して、以下の2つのステップを**順番に実行**してください:

### ステップ1: 要件ファイル構成ドキュメントの生成

`masterdata-requirement-analyzer` スキルを実行してください:

```
Skill(skill: "masterdata-requirement-analyzer", args: "<施策ディレクトリパス>")
```

これにより、`[施策ディレクトリ]/要件ファイル構成.md` が生成されます。

**処理内容**:
- `[施策ディレクトリ]/要件/` フォルダ内のファイルを分析
- ファイル構造と関係性をまとめた`要件ファイル構成.md`を生成
- 施策ディレクトリ直下に保存

### ステップ2: マスタデータの生成

ステップ1が完了したら、`masterdata-generator` スキルを実行してください:

```
Skill(skill: "masterdata-generator", args: "要件ファイル構成.mdと要件フォルダの内容から、マスタデータを生成してください。出力先は<施策ディレクトリ>直下。")
```

または、より具体的な要件を指定:

```
Skill(skill: "masterdata-generator", args: "<具体的な要件の説明>")
```

これにより、施策ディレクトリ直下に全てのマスタデータCSVとREPORT.mdが生成されます。

**処理内容**:
- 要件ファイル構成.mdと要件フォルダの内容を参照
- 必要なマスタデータをリストアップ
- 各マスタデータに対して:
  - スキーマ調査（schema-inspector）
  - CSV生成
  - スキーマ検証（validator）
- REPORT.mdを生成

## 重要な注意事項

### タスク完遂の原則 ⚠️

- **両方のステップを完全に実行**: ステップ1だけで終わらず、必ずステップ2まで完遂してください
- **途中で止めない**: ステップ2では、要件に含まれる全てのマスタデータを最後まで生成してください
- **完了条件**: REPORTに「未作成のマスタデータ」が残らないようにしてください

### 完了の確認

以下が全て完了していることを確認してください:

#### ステップ1の成果物
- ✅ `[施策ディレクトリ]/要件ファイル構成.md` が生成されている

#### ステップ2の成果物
- ✅ **全てのCSVファイルがテンプレートファイルからコピーして作成されている**
- ✅ 全てのマスタデータCSVファイルが施策ディレクトリ直下に生成されている
- ✅ `REPORT.md` が施策ディレクトリ直下に生成されている
- ✅ REPORTに「未作成のマスタデータ」セクションが存在しない
- ✅ REPORTに「スキーマ検証と修正」セクションが含まれている

## 出力形式

### 最終的なディレクトリ構造

```
マスタデータ/施策/[施策名]/
├── 要件/                    ← ユーザーが事前に用意
│   ├── 仕様書1.html
│   └── 仕様書2.html
├── 要件ファイル構成.md       ← ステップ1で生成
├── REPORT.md                ← ステップ2で生成
├── [ModelName1].csv         ← ステップ2で生成
├── [ModelName2].csv         ← ステップ2で生成
└── [ModelName3].csv         ← ステップ2で生成
```

## ベストプラクティス

### 順次実行の徹底

ステップ1とステップ2は必ず順番に実行してください:
1. ステップ1が完了するまで待機
2. ステップ1の成果物（要件ファイル構成.md）を確認
3. ステップ2を開始

### エラーハンドリング

- ステップ1でエラーが発生した場合、ステップ2には進まない
- ステップ2でエラーが発生した場合、どのマスタデータで失敗したか記録
- エラー内容を確認して再実行

### データ完成度の確認

ステップ2完了後、以下を確認:
- 要件に記載された全てのマスタデータが生成されている
- REPORTに「未作成のマスタデータ」セクションがない
- REPORTに「スキーマ検証と修正」セクションが含まれている

## 依存スキル

このスキルは以下のスキルに依存します:

- `masterdata-requirement-analyzer`: 要件ファイル構成分析
- `masterdata-generator`: マスタデータ生成

間接的な依存:
- `masterdata-schema-inspector`: スキーマ情報調査（generatorから呼び出し）
- `masterdata-validator`: CSV検証（generatorから呼び出し）

## 使用例

### 基本的な使用方法

スキルを起動:
```
Skill(skill: "masterdata-full-workflow", args: "マスタデータ/施策/新春ガチャ")
```

### 前提条件

事前に要件フォルダが準備されている:
```
マスタデータ/施策/新春ガチャ/
└── 要件/
    ├── 01_概要.html
    ├── 02_ガチャ仕様.html
    └── 03_報酬設定.html
```

### 期待される動作

1. ステップ1: 要件ファイル構成.mdを生成
2. ステップ2: マスタデータCSV + REPORT.mdを生成
3. 全成果物の確認

### 期待される出力

```
マスタデータ/施策/新春ガチャ/
├── 要件/
│   ├── 01_概要.html
│   ├── 02_ガチャ仕様.html
│   └── 03_報酬設定.html
├── 要件ファイル構成.md       ← 新規生成
├── REPORT.md                ← 新規生成
├── OprGacha.csv             ← 新規生成
├── OprGachaI18n.csv         ← 新規生成
└── MstGachaPrizeGroup.csv   ← 新規生成
```

## トラブルシューティング

### ステップ1が失敗する場合

- 要件フォルダが存在するか確認
- 要件フォルダ内にファイルが存在するか確認
- ファイルが読み取り可能か確認

### ステップ2が失敗する場合

- 要件ファイル構成.mdが生成されているか確認
- 要件の内容が具体的か確認（抽象的すぎるとマスタデータを推測できない）
- 施策ディレクトリパスが正しいか確認

### REPORTに「未作成のマスタデータ」がある場合

⚠️ これは**エラー**です。以下を確認:
- generatorスキルが途中で停止していないか
- 要件に含まれる全てのマスタデータがリストアップされているか
- 不明点を推測して実装を続けているか

正しい動作:
- generatorスキルは途中で止めずに最後まで実行
- 不明点は既存データのパターンから推測して実装継続
- REPORTに「未作成のマスタデータ」セクションを作成しない

## 注意事項

- **参照専用リポジトリ**: `projects/` 配下は参照のみ。編集しないでください。
- **両ステップ必須**: ステップ1だけで終わらせないでください。
- **タスク完遂**: ステップ2では全てのマスタデータを完成させてください。
- **並行運用**: 既存のマスタデータ-0プロンプトと並行運用できます。

---

このスキルを使用することで、GLOW施策のマスタデータ生成フルワークフローを効率的に実行できます。
