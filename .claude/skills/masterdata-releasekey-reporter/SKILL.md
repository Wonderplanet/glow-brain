---
name: masterdata-releasekey-reporter
description: GLOWマスタデータのリリースキー別抽出とレポート生成。リリースキーを指定して該当データを全テーブルから抽出し、rawデータとMarkdownレポートを作成します。「リリースキー」「release key」「マスタデータ抽出」「データ投入」「リリース内容」などのキーワードで使用します。
---

# Masterdata Release Key Reporter

## 概要

GLOWプロジェクトのマスタデータから特定のリリースキーに関連するデータを抽出し、包括的なレポートを生成するスキルです。93テーブル以上のマスタデータから該当データを自動抽出し、投入内容の全容を把握できます。

## 使用タイミング

- 特定リリースで投入されたデータの全容を確認したい
- リリース前後の影響範囲を調査したい
- データ投入内容をドキュメント化したい
- 運営施策の実装内容をレビューしたい

## ワークフロー

### 1. リリースキーの確認

ユーザーからリリースキーを取得します。リリースキーは通常9桁の数字（例: 202512020）です。

### 2. データ抽出とレポート生成

`scripts/analyze_release.sh` スクリプトを実行してデータを抽出します:

```bash
.claude/skills/masterdata-releasekey-reporter/scripts/analyze_release.sh <RELEASE_KEY>
```

**例:**
```bash
.claude/skills/masterdata-releasekey-reporter/scripts/analyze_release.sh 202512020
```

スクリプトは以下を実行します:
1. `projects/glow-masterdata/*.csv` から該当リリースキーを含むデータを検索
2. 該当データを抽出して統計情報を集計
3. rawデータファイルとレポートを生成

### 3. 出力ファイルの確認

生成されるファイルは `マスタデータ/リリース/{リリースキー}/` ディレクトリに配置されます:

**rawデータファイル** (`release_{RELEASE_KEY}_raw_data.txt`):
- 全テーブルから抽出された生データ
- テーブルごとにヘッダー付きCSV形式
- 完全なデータセット（検証・分析用）

**レポートファイル** (`release_{RELEASE_KEY}_report.md`):
- Markdown形式の詳細分析レポート
- テーブル別データ数の一覧
- カテゴリ別集計（Mst/Opr分類）
- データ投入量トップ10テーブル
- 抽出日時とファイル情報

### 4. 結果の提示

ユーザーに以下を報告します:
- 抽出されたテーブル数
- 総データ行数
- カテゴリ別の統計
- 生成されたファイルのパス

レポートファイルの主要な内容を簡潔にサマリーとして提示することを推奨します。

## エラーハンドリング

### リリースキーが見つからない場合

```
エラー: リリースキー {RELEASE_KEY} を含むデータが見つかりませんでした
```

このエラーが発生した場合:
1. リリースキーの桁数や形式が正しいか確認
2. マスタデータが最新の状態か確認
3. 類似のリリースキーを検索して提案

### マスタデータディレクトリが見つからない場合

```
エラー: マスタデータディレクトリが見つかりません: projects/glow-masterdata
```

このエラーが発生した場合:
1. glow-brainリポジトリのルートディレクトリで実行しているか確認
2. `projects/glow-masterdata` ディレクトリが存在するか確認

## スクリプト詳細

### analyze_release.sh

**入力:**
- 第1引数: リリースキー（必須）

**処理:**
1. マスタデータディレクトリの存在確認
2. 全CSVファイルから該当リリースキーを含む行を抽出
3. テーブルごとの統計情報を集計
4. rawデータファイルを生成（全データをテーブルごとに整形）
5. Markdownレポートを生成（統計・分析情報）

**出力:**
- `マスタデータ/リリース/{リリースキー}/release_{リリースキー}_raw_data.txt`
- `マスタデータ/リリース/{リリースキー}/release_{リリースキー}_report.md`

## 使用例

### 例1: 基本的な使用

**ユーザー:**
> リリースキー202512020のデータを抽出して

**応答:**
```bash
.claude/skills/masterdata-releasekey-reporter/scripts/analyze_release.sh 202512020
```

### 例2: レポート確認

**ユーザー:**
> リリースキー202512020のマスタデータ投入内容を確認したい

**応答:**
スクリプトを実行してレポートを生成し、主要な統計情報（テーブル数、総行数、主要なテーブル）をサマリーとして提示します。

### 例3: 複数リリースの比較準備

**ユーザー:**
> リリースキー202512010と202512020の差分を見たい

**応答:**
両方のリリースキーに対してスクリプトを実行し、生成されたレポートを比較します。

## 注意事項

- **projects/glow-masterdata** は参照専用です。このスキルは読み取り専用で動作します。
- 大量のデータを抽出する場合、処理に時間がかかることがあります。
- rawデータファイルは数百KBになる可能性があります。
- レポートは自動生成されるため、必要に応じて手動で詳細を追記できます。

## テーブル命名規則

GLOWプロジェクトのマスタデータテーブル:

| プレフィックス | 意味 | 例 |
|--------------|------|-----|
| **Mst** | 固定マスタデータ | MstUnit, MstStage, MstItem |
| **Opr** | 運営施策・期間限定データ | OprGacha, OprCampaign, OprProduct |

レポートではこれらのカテゴリ別に集計されます。
