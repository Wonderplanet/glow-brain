---
name: masterdata-requirement-analyzer
description: 施策の要件フォルダを分析し、要件ファイル構成ドキュメントを生成。要件ファイル構成、要件を分析で使用。
allowed-tools: Read, Write, Glob, Grep
argument-hint: 施策ディレクトリパス
---

# マスタデータ 要件ファイル構成分析スキル

このスキルは、施策ディレクトリ内の「要件/」フォルダを分析し、わかりやすいMarkdownドキュメントを生成します。

マスタデータ-1プロンプトの内容を完全に実装しています。

## 入力

施策ディレクトリパスを受け取ります:
- 例: `マスタデータ/運用仕様書/新春ガチャ`

## 出力

以下のファイルを生成します:
- **ファイル名**: `要件ファイル構成.md`
- **保存先**: 施策ディレクトリ直下（要件フォルダと同階層）

## タスク

以下のステップで要件ファイル構成ドキュメントを生成してください:

### ステップ1: ディレクトリの確認とファイル一覧の取得

```bash
# ディレクトリパスを引数から取得
STRATEGY_DIR="$1"
REQUIREMENT_DIR="${STRATEGY_DIR}/要件"

# Globツールでファイル一覧を取得
glob "${REQUIREMENT_DIR}/**/*"

# ファイル数、拡張子、パターンを確認
```

### ステップ2: 主要ファイルの特定

以下のパターンを自動認識:

- **番号付き**: `01_概要.html`, `02_仕様.html`
- **テンプレート**: `*テンプレ*.html`, `*template*.md`
- **バックアップ**: `*のコピー*.html`, `*backup*.md`
- **未使用**: `使用しない_*.html`, `*_old.*`
- **目次**: `目次.html`, `index.html`, `TOC.md`

優先順位:
1. 目次ファイル（index, 目次, TOCなど）
2. 番号付きファイル（00_, 01_など）
3. その他のファイル

### ステップ3: ファイル内容の分析

主要なファイルを読み込み、以下を抽出:
- タイトル、見出し
- ファイル間のリンクや参照関係
- 命名規則やパターン

**注意事項**:
- 大きなファイル（25000トークン以上）は先頭部分のみ読み込む
- HTMLファイルはタイトルタグ、見出しタグを優先的に抽出
- エンコーディングエラーに注意

### ステップ4: カテゴリ分類

ファイルを論理的なカテゴリに分類:

**カテゴリ分類の基準**:
- **番号順ファイル**: 00_, 01_, 02_などの接頭辞（順序を尊重）
- **役割別**: 目次、仕様書、設計書、テンプレート、補助資料
- **状態別**: 使用中、テンプレート、廃棄予定、バックアップ

### ステップ5: ドキュメント生成

以下の構造でMarkdownドキュメントを生成してください:

```markdown
# [施策名] 要件ファイル構成

## 概要
[要件フォルダの目的と内容の概要]

## ファイル構造

### 1. [カテゴリ1]（例: メイン仕様書）
- **ファイル名1** - [役割の説明]
- **ファイル名2** - [役割の説明]

### 2. [カテゴリ2]（例: 詳細仕様）
- **ファイル名3** - [役割の説明]

### 3. [カテゴリ3]（例: テンプレート・バックアップ）
- **ファイル名4** - [役割の説明]

## ファイル間の関係性

\`\`\`
メインファイル.html (ルート)
├── カテゴリA
│   ├── ファイル1.html ────→ 詳細
│   └── ファイル2.html ────→ 詳細
├── カテゴリB
│   ├── ファイル3.html
│   └── ファイル4.html ────→ カテゴリAを参照
└── その他
    └── テンプレート.html
\`\`\`

## 主要データの流れ

1. **[ステップ1]**: [ファイル名] - [処理内容]
2. **[ステップ2]**: [ファイル名] - [処理内容]

## テンプレートファイル
[テンプレートとして使用可能なファイルのリスト]

## 注意事項
[使用時の注意点、命名規則、ベストプラクティスなど]
```

### ステップ6: ファイルの保存

生成したMarkdownファイルを以下のパスに保存:

```
${STRATEGY_DIR}/要件ファイル構成.md
```

## ベストプラクティス

### 構造化

- 見出しレベルを適切に使用（#、##、###）
- 箇条書きとネストで階層を表現
- コードブロック（```）でファイル構造を図示

### ファイル関係性の表現

テキストベースのツリー構造を使用:
```
メインファイル.html (ルート)
├── カテゴリA
│   ├── ファイル1.html ────→ 詳細
│   └── ファイル2.html ────→ 詳細
├── カテゴリB
│   ├── ファイル3.html
│   └── ファイル4.html ────→ カテゴリAを参照
└── その他
    └── テンプレート.html
```

### 説明の書き方

- 各ファイルの役割を簡潔に説明
- 他のファイルとの関係を明記
- 使用時の注意点があれば記載

## 対応ファイル形式

以下のファイル形式に対応:
- HTML (.html, .htm)
- Markdown (.md)
- テキスト (.txt)
- 設計書・仕様書（任意の形式）
- ドキュメント全般

## 注意事項

### ファイル読み込み時
- 大きなファイル（25000トークン以上）は先頭部分のみ読み込む
- HTMLファイルはタイトルタグ、見出しタグを優先的に抽出
- エンコーディングエラーに注意

### カテゴリ分類時
- 番号順は必ず順序を保つ
- テンプレートと正式版を明確に区別
- 廃棄予定ファイルは別セクションに分離

### ドキュメント生成時
- 日本語ファイル名に対応
- マルチバイト文字を正しく処理
- ファイルパスは相対パスで記載

## トラブルシューティング

### ファイルが多すぎる場合
- 主要ファイル（目次、番号付き）に絞る
- サブディレクトリごとに分けて処理

### ファイル内容が読めない場合
- ファイル名とパターンから推測
- 既に読めたファイルからの参照情報を活用

### 関係性が不明な場合
- 命名規則から推測
- 番号順や日付順でグループ化

## 処理フロー

```
ディレクトリパスを引数から取得
↓
Globツールでファイル一覧を取得
↓
ファイル数、拡張子、パターンを確認
↓
主要ファイルの特定（目次、番号付きなど）
↓
ファイル内容の分析（タイトル、見出し、リンク）
↓
カテゴリ分類
↓
関係図の作成
↓
Markdownファイルとして出力
```

## 使用例

### 基本的な使用方法

スキルを起動:
```
Skill(skill: "masterdata-requirement-analyzer", args: "マスタデータ/運用仕様書/新春ガチャ")
```

この場合、以下のフォルダを分析:
```
マスタデータ/運用仕様書/新春ガチャ/要件/
```

生成されるファイル:
```
マスタデータ/運用仕様書/新春ガチャ/要件ファイル構成.md
```

## 期待される出力

生成されるMarkdownドキュメントには以下が含まれます:

1. **明確な階層構造**: ファイルがカテゴリごとに整理
2. **視覚的な関係図**: テキストベースのツリー構造
3. **データフロー**: 処理の流れが理解できる
4. **実用的な情報**: テンプレート、注意事項、ベストプラクティス
5. **日本語対応**: 日本語ファイル名、日本語説明文

## 出力例

```markdown
# 新春ガチャ 要件ファイル構成

## 概要
新春限定ガチャの実装に関する要件定義ファイル群です。
ガチャ仕様、報酬設定、演出仕様が含まれています。

## ファイル構造

### 1. メイン仕様書
- **01_概要.html** - ガチャ全体の概要と目的
- **02_ガチャ仕様.html** - ガチャのルールと動作仕様
- **03_報酬設定.html** - 報酬内容と排出確率

### 2. 詳細仕様
- **04_演出仕様.html** - ガチャ演出の詳細
- **05_UI仕様.html** - UI配置とデザイン

### 3. テンプレート・バックアップ
- **テンプレート.html** - 今後の施策用テンプレート

## ファイル間の関係性

\`\`\`
01_概要.html (ルート)
├── 02_ガチャ仕様.html ────→ 詳細
│   └── 03_報酬設定.html ────→ 具体的な報酬内容
├── 04_演出仕様.html ────→ ガチャ仕様を参照
└── 05_UI仕様.html ────→ ガチャ仕様とUI配置
\`\`\`

## 主要データの流れ

1. **概要把握**: 01_概要.html で全体像を理解
2. **ガチャ仕様確認**: 02_ガチャ仕様.html でルールを確認
3. **報酬設定**: 03_報酬設定.html で報酬内容を確認
4. **演出とUI**: 04_演出仕様.html と 05_UI仕様.html で実装詳細を確認

## テンプレートファイル
- テンプレート.html

## 注意事項
- 番号順（01_, 02_）に沿って読むことを推奨
- テンプレートファイルは編集しないこと
```

---

このスキルを使用することで、施策の要件フォルダを効率的に分析・ドキュメント化できます。
