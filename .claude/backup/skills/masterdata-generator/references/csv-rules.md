# CSV作成の詳細ルール

## CSVテンプレートファイルの活用

### 最優先ルール ✨

**CSV作成時は必ず対応するテンプレートファイルをコピーして使用する**

```bash
# テンプレートファイルをコピー
cp projects/glow-masterdata/sheet_schema/[ModelName].csv マスタデータ/運用仕様書/[施策名]/[ModelName].csv
```

### テンプレートファイルの構造

CSVテンプレートファイルは3行のヘッダー構造を持ちます：

- **1行目**: `memo`（説明用フィールド）
- **2行目**: `TABLE,モデル名,モデル名,...`（各カラムが所属するテーブル）
- **3行目**: `ENABLE,カラム1,カラム2,...`（実際のヘッダー）

**重要**: テンプレートファイルの3行目（ヘッダー行）に完全に従ってデータを作成してください。

### テンプレート使用時の注意点

- ✅ **ヘッダー厳守**: テンプレートファイルの3行目（ヘッダー行）に完全に従う
- ✅ **構造理解**: 1行目（memo）、2行目（TABLE指定）、3行目（ヘッダー）を把握する
- ❌ **カラム追加禁止**: テンプレートにないカラムを独自に追加しない

## データ形式のルール

### `__NULL__` の使用ルール ⚠️

**最重要**: `__NULL__` を使用できるのは nullable 列のみです。

- ✅ **nullable=true の列**: `__NULL__` を使用可能
- ❌ **nullable=false (NOT NULL) の列**: `__NULL__` は使用禁止
  - 空文字列（何も書かない）を使用
  - またはデフォルト値を使用

**使用前の確認**: スキーマの nullable 制約を必ず確認すること

例:
```csv
ENABLE,id,name,description,optional_field
e,1,テスト,これは説明,__NULL__        # optional_fieldがnullableならOK
e,2,サンプル,,value                # descriptionがNOT NULLなら空文字列
```

### その他のフォーマットルール

- **ID**: 既存データと重複しないこと
- **日時カラム**: `YYYY-MM-DD HH:MM:SS` 形式（例: `2026-01-01 15:00:00`）
- **release_key**: 最新の日付形式（例: `202601010`）

## データ設計の原則

### 整合性の確保

- **IDの重複回避**: 既存データのID範囲を確認し、重複しない値を使用
- **外部キー制約**: 参照先のデータが存在することを確認
- **命名規則**: asset_key や id の命名パターンに従う

### 既存パターンの踏襲

不明確な仕様があっても、以下の方法で対処してください：

1. 既存データのパターンを調査
2. 最も合理的なアプローチを推測
3. 設計を進めて実装を継続

**避けるべき対応**: 「仕様が不明なので作成しない」という判断

## データ品質の基準

- ✅ **DDLスキーマ準拠**: サーバー側のテーブル定義と完全に一致させる
- ✅ **整合性**: 既存データと矛盾しない
- ✅ **完全性**: 必須カラムはすべて埋める
- ✅ **妥当性**: 値の範囲やフォーマットが正しい
- ✅ **一貫性**: 命名規則やパターンを統一
- ✅ **制約遵守**: PRIMARY KEY、UNIQUE、NOT NULL制約を満たす
