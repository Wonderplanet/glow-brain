# Claude Code ガイド相談レポート

**日付**: 2025年12月27日
**トピック**: プラグインマーケットプレイスのプライバシーとセキュリティ

## 相談内容

- プライベートGitHubリポジトリでマーケットプレイスをホストできるか
- 会社外に共有されるリスクはあるか
- GitHubのアクセス制御がそのまま適用されるか
- 社内メンバーのセットアップ方法
- 安全な運用のベストプラクティス

## 重要な結論・学び

### 1. プライベートリポジトリでの運用は完全に可能

> 出典: [Discover and Install Plugins ドキュメント](https://code.claude.com/docs/en/discover-plugins.md)

公式ドキュメントの引用：

> For GitHub sources, ensure repositories are public **or you have access**

**答え: プライベートGitHubリポジトリでマーケットプレイスをホスト可能です。**

重要な前提条件：
- ユーザーが該当リポジトリへのアクセス権限を持つ必要がある
- GitHubの認証情報（SSH キーまたはPAT）が設定されている

### 2. 会社外への共有リスクは完全に制御可能

> 出典: [Security ドキュメント](https://code.claude.com/docs/en/security.md)

**✓ Anthropicや第三者に送信されないもの**：
- プラグインメタデータ（plugin.json、marketplace.json）
- スキルの内容（SKILL.md）
- プラグインのコード

公式ドキュメントの引用：

> We encourage either writing your own MCP servers or using MCP servers from providers that you trust. **You are able to configure Claude Code permissions for MCP servers. Anthropic does not manage or audit any MCP servers.**

**重要**:
- マーケットプレイス定義はリポジトリに保存される
- ユーザーが明示的に追加しない限り、第三者には共有されない
- GitHubのアクセス権限で完全に制御できる

### 3. GitHubのアクセス権限がそのまま適用される

> 出典: [Discover and Install Plugins ドキュメント](https://code.claude.com/docs/en/discover-plugins.md)

Claude Code は以下の認証方式を使用：

1. **SSH キー認証** - `~/.ssh/id_rsa` 等
2. **Git 認証情報キャッシュ** - `git credential` 経由
3. **パーソナルアクセストークン（PAT）** - GitHub の PAT

**実装上の動作**：

```bash
# GitHub認証情報を持つユーザーのみ実行可能
/plugin marketplace add your-org/private-plugins

# GitHub認証なし、または権限なしの場合：
# エラー: "Repository not found" または "Access denied"
```

**重要なポイント**：
- ユーザーの Git 認証情報を使用してアクセス
- GitHub の Organization/Repository レベルの権限が適用
- プライベートリポジトリには Read 権限が必須

### 4. 認証情報の安全な保管

> 出典: [Identity and Access Management](https://code.claude.com/docs/en/iam.md)

公式ドキュメントの引用：

> **Storage location**: On macOS, API keys, OAuth tokens, and other credentials are stored in the encrypted macOS Keychain.

さらに：

> **Credential protection**: Authentication is handled through a secure proxy that uses a scoped credential inside the sandbox, which is then translated to your actual GitHub authentication token

**セキュリティの仕組み**：
- 認証情報は暗号化された Keychain に保存
- サンドボックス内でスコープ制限された認証情報を使用
- 実際の GitHub トークンへの変換はセキュアプロキシ経由

## 会社内メンバーのセットアップ方法

### ステップ1: GitHub認証の設定

```bash
# SSH キーで Git 認証が設定されているか確認
ssh -T git@github.com

# 出力例（認証成功）：
# Hi your-username! You've successfully authenticated, ...
```

### ステップ2: プロジェクトに `.claude/settings.json` を配置

> 出典: [Plugin Marketplaces ドキュメント](https://code.claude.com/docs/en/plugin-marketplaces.md)

```json
{
  "extraKnownMarketplaces": {
    "glow-skills": {
      "source": {
        "source": "github",
        "repo": "your-org/glow-skills-marketplace"
      }
    }
  },
  "enabledPlugins": {
    "glow-masterdata-tools@glow-skills": true,
    "glow-screen-tools@glow-skills": true,
    "glow-game-content-tools@glow-skills": true
  },
  "permissions": {
    "allow": [
      "Bash(find:*)",
      "Bash(grep:*)"
    ]
  }
}
```

**重要**: このファイルをリポジトリにコミットすることで、**チームメンバー全員が自動的にマーケットプレイスを認識します**。

### ステップ3: メンバーがプロジェクトをclone

```bash
# 1. プロジェクトをclone
git clone git@github.com:your-org/glow-brain.git
cd glow-brain

# 2. Claude Codeを起動
# .claude/settings.json が自動的に読み込まれる
# マーケットプレイスが自動的に認識される

# 3. プラグインが自動的に利用可能になる
/plugin list
```

## 安全な運用のベストプラクティス

### 1. GitHubリポジトリのセキュリティ設定

```bash
# GitHub CLI で作成
gh repo create glow-skills-marketplace \
  --private \
  --org your-org \
  --source=. \
  --remote=origin \
  --push
```

**GitHub Settings での設定**：

1. **Visibility**: Private に設定
2. **Branch protection rules**:
   - Require pull request reviews before merging (1承認)
   - Require status checks to pass
   - Require branches to be up to date before merging

3. **Collaborators & teams**:
   - 組織の特定チーム（例：DevTools Team）にのみアクセス権付与
   - Role: Maintain または Admin

### 2. `.claude/settings.json` での安全な設定

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "extraKnownMarketplaces": {
    "glow-skills": {
      "source": {
        "source": "github",
        "repo": "your-org/glow-skills-marketplace"
      }
    }
  },
  "enabledPlugins": {
    "glow-masterdata-tools@glow-skills": true,
    "glow-screen-tools@glow-skills": true
  },
  "permissions": {
    "allow": [
      "Bash(find:*)",
      "Bash(grep:*)",
      "Bash(jq:*)"
    ],
    "deny": [
      "Bash(curl:*)",
      "Bash(wget:*)"
    ]
  }
}
```

**重要なセキュリティ項目**：

1. **不要なプラグインは `false` に設定**
2. **危険なコマンドは deny リストに追加** - curl、wget 等の外部通信
3. **必要最小限の権限のみを allow**

### 3. プラグイン監査・バージョン管理

各プラグインの `plugin.json` に詳細情報を記載：

```json
{
  "name": "glow-masterdata-tools",
  "version": "1.0.0",
  "description": "GLOWマスタデータ調査・参照・生成スキル",
  "author": {
    "name": "GLOW Development Team",
    "email": "glow-dev@company.com"
  },
  "homepage": "https://github.com/your-org/glow-skills-marketplace",
  "repository": "https://github.com/your-org/glow-skills-marketplace",
  "license": "MIT"
}
```

`CHANGELOG.md` を必ず作成：

```markdown
# Changelog

## [1.0.0] - 2025-01-15

### Added
- Initial release of GLOWマスタデータ関連スキル

### Security
- Skills are fully internal-only
- No external API calls
- All data stays within company infrastructure
```

### 4. 機密情報の保護

`.gitignore` で確保：

```bash
# .gitignore に追加

# 認証情報
.env
.env.local
*.key
*.pem

# キャッシュ
.claude/plugins/cache/
node_modules/
```

### 5. 定期的なセキュリティレビュー

```bash
# 月1回の監査コマンド

# 1. プラグイン一覧を確認
/plugin marketplace list

# 2. インストール済みプラグインを確認
/plugin list

# 3. 権限設定を確認
/permissions

# 4. GitHub でアクセス権を確認
gh repo list your-org --json name,isPrivate
```

## セキュリティ保証の一覧表

| 項目 | 対応 | 確実性 |
|------|------|--------|
| **プライベートリポジトリでの運用** | GitHub の Private 設定で実現可能 | ✓ 完全に確保可能 |
| **会社外への共有リスク** | Anthropic/第三者に送信されない | ✓ 完全に確保可能 |
| **アクセス制御** | GitHub のアクセス権限で制御 | ✓ 完全に確保可能 |
| **認証情報の扱い** | Keychain に暗号化保存 | ✓ 安全 |
| **プラグインの検証** | コードレビュープロセスで実施 | △ 手作業が必要 |

## 参照ドキュメント

相談で参照した公式ドキュメントのURL一覧：

- [Discover and Install Plugins ドキュメント](https://code.claude.com/docs/en/discover-plugins.md)
- [Plugin Marketplaces ドキュメント](https://code.claude.com/docs/en/plugin-marketplaces.md)
- [Security ドキュメント](https://code.claude.com/docs/en/security.md)
- [Identity and Access Management](https://code.claude.com/docs/en/iam.md)
- [Monitoring Usage ドキュメント](https://code.claude.com/docs/en/monitoring-usage.md)

## まとめ

### ご質問への回答

**Q: 会社以外に勝手に共有されることはない？**
- **A: ありません。** GitHubのプライベートリポジトリとして管理すれば、完全に社内限定にできます。

**Q: 会社のprivateなgithub repositoryで用意する形式？**
- **A: その通りです。** プライベートリポジトリでマーケットプレイスをホストできます。

**Q: 会社内の人に各自cloneしてsetupしてもらう感じ？**
- **A: ほぼその通りですが、もっと簡単です。** プロジェクトの `.claude/settings.json` にマーケットプレイスを定義してコミットすれば、メンバーがプロジェクトをcloneした時点で自動的にマーケットプレイスが認識されます。メンバーは個別にcloneする必要はありません。

### 推奨される運用フロー

1. **社内用プライベートリポジトリ作成** - `your-org/glow-skills-marketplace`
2. **マーケットプレイス構造を作成** - `.claude-plugin/marketplace.json` + `plugins/`
3. **プロジェクトに設定を追加** - `glow-brain/.claude/settings.json`
4. **設定をコミット** - チーム全員で共有
5. **メンバーは通常通りプロジェクトをclone** - マーケットプレイスが自動認識される

**セキュリティ**: GitHubのアクセス権限で完全に制御され、Anthropicや第三者に情報が送信されることはありません。

---

*このレポートは `/guide-chat` コマンドにより自動生成されました*
