# Claude Code ガイド相談レポート

**日付**: 2025年12月27日
**トピック**: スキルを複数プラグインに分割する詳細ガイド

## 相談内容

- プラグインとスキルリポジトリの違い
- 複数プラグインへの分割方法と具体的な手順
- プラグインの管理方法（有効/無効の切り替え）
- 分割のベストプラクティス
- 40個のスキルを複数プラグインに分割する実装例

## 重要な結論・学び

### 1. プラグインとスキルの関係

> 出典: [Claude Code Plugins ドキュメント](https://code.claude.com/docs/en/plugins.md)

**スキル（Skill）**:
- 単一の専門性を持つもの（例：「PDF処理」「コード品質審査」）
- モデル呼び出し型 - Claude が自動的に使用判断
- ディレクトリ内に `SKILL.md` ファイルを含む
- YAML frontmatter で `name` と `description` を定義

**プラグイン（Plugin）**:
- 複数の機能を統合する容器 - スキル、コマンド、エージェント、フック、MCPサーバーを束ねる
- 共有と配布を目的とした方式 - チーム間やコミュニティで再利用可能
- 複数のスキルを**1つのプラグイン内に含可能**
- `.claude-plugin/plugin.json` マニフェストで定義

公式ドキュメントの引用：

> Plugins let you extend Claude Code with custom functionality that can be shared across projects and teams.

**重要**: プラグインは**配布・共有・バージョン管理の単位**であり、その中に複数のスキルを含められる。

### 2. 1リポジトリに複数プラグインを配置する方法

> 出典: [Plugin Marketplaces ドキュメント](https://code.claude.com/docs/en/plugin-marketplaces.md)

**答え: 1つのGitリポジトリに複数プラグインを配置することが推奨されています**

マーケットプレイス定義ファイル例：

```json
{
  "name": "company-tools",
  "owner": {
    "name": "DevTools Team"
  },
  "plugins": [
    {
      "name": "code-formatter",
      "source": "./plugins/formatter",
      "description": "Automatic code formatting"
    },
    {
      "name": "deployment-tools",
      "source": "./plugins/deployment",
      "description": "Deployment automation"
    },
    {
      "name": "security-scanner",
      "source": "./plugins/security",
      "description": "Security scanning"
    }
  ]
}
```

この方式により、**1つのマーケットプレイスで複数プラグインを管理できる**。

### 3. 推奨されるディレクトリ構造

> 出典: [Plugin Marketplaces ドキュメント](https://code.claude.com/docs/en/plugin-marketplaces.md)

```
my-skill-marketplace/
├── .claude-plugin/
│   └── marketplace.json          # マーケットプレイス定義
│
├── plugins/                       # 複数プラグインを配置
│   ├── plugin-group-1/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json
│   │   ├── skills/
│   │   │   ├── skill-1/
│   │   │   │   └── SKILL.md
│   │   │   └── skill-2/
│   │   │       └── SKILL.md
│   │   ├── commands/
│   │   └── hooks/
│   │       └── hooks.json
│   │
│   ├── plugin-group-2/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json
│   │   ├── skills/
│   │   │   ├── skill-3/
│   │   │   └── skill-4/
│   │   └── commands/
│   │
│   └── plugin-group-3/
│       ├── .claude-plugin/
│       │   └── plugin.json
│       └── skills/
│
├── LICENSE
└── README.md
```

### 4. プラグインの管理方法

> 出典: [Plugins Reference](https://code.claude.com/docs/en/plugins-reference.md)

#### CLI コマンドでの管理

```bash
# マーケットプレイスを追加
/plugin marketplace add owner/glow-skills-marketplace

# 特定プラグインをインストール
claude plugin install glow-masterdata-tools@glow-skills

# プロジェクトスコープでインストール（チーム共有）
claude plugin install glow-masterdata-tools@glow-skills --scope project

# プラグインを無効化（アンインストール不要）
claude plugin disable glow-masterdata-tools@glow-skills

# プラグインを有効化
claude plugin enable glow-masterdata-tools@glow-skills

# プラグインをアンインストール
claude plugin uninstall glow-masterdata-tools@glow-skills
```

#### settings.json での一括管理

> 出典: [Plugin Marketplaces ドキュメント](https://code.claude.com/docs/en/plugin-marketplaces.md)

プロジェクトの `.claude/settings.json` でマーケットプレイスと有効なプラグインを定義：

```json
{
  "extraKnownMarketplaces": {
    "glow-skills": {
      "source": {
        "source": "github",
        "repo": "your-org/glow-skills-marketplace"
      }
    }
  },
  "enabledPlugins": {
    "glow-masterdata-tools@glow-skills": true,
    "glow-screen-tools@glow-skills": true,
    "glow-game-content-tools@glow-skills": false
  },
  "permissions": {
    "allow": [
      "Bash(find:*)",
      "mcp__github__get_pull_request"
    ]
  }
}
```

**利点**: プロジェクトメンバーが新しい環境をセットアップする際に自動的にマーケットプレイスが認識される。

### 5. 分割のベストプラクティス

> 出典: [Claude Code Plugins ドキュメント](https://code.claude.com/docs/en/plugins.md)

**分割の基準**:

1. **機能領域ごとに分割** - 関連スキルをグループ化
   - `glow-masterdata-tools` - マスタデータ関連
   - `glow-screen-tools` - UI/画面関連
   - `glow-game-content-tools` - ゲームコンテンツ関連

2. **チームの役割に基づいて分割** - プランナー、エンジニア、デザイナーで異なるプラグインセット

3. **デバイスリソースを考慮** - 起動時のメタデータ読み込みコストを分散
   - 小規模プラグイン（3-5スキル）の方が起動が速い
   - 大規模プラグイン（10+スキル）は特定の機能を使う時のみインストール

4. **更新頻度に基づいて分割** - 頻繁に変更されるスキルと安定したスキルを分ける

**40個のスキルの推奨分割案**:

```
1. glow-masterdata-tools
   - マスタデータ調査
   - マスタデータ生成
   - テーブル参照
   (5-8個のスキル)

2. glow-screen-tools
   - 画面ドキュメント作成
   - スクリーン機能分析
   - UI要件生成
   (4-6個のスキル)

3. glow-game-content-tools
   - キャラクター関連
   - クエスト関連
   - アイテム関連
   - BGM/イベント関連
   (8-12個のスキル)

4. glow-development-tools
   - コード品質審査
   - Git操作補助
   - テスト支援
   (5-8個のスキル)

5. glow-documentation-tools
   - API ドキュメント生成
   - 仕様書作成
   - README生成
   (4-6個のスキル)
```

### 6. パフォーマンス上の考慮事項

> 出典: [Agent Skills Overview](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/overview)

公式ドキュメントの引用：

> Claude loads only the name and description of each available Skill at startup. This keeps startup fast while giving Claude enough context to know when each Skill might be relevant.

**複数プラグインへの分割による利点**:

1. **選別インストール** - 必要なプラグインだけインストール
   - 全40個：起動時に約4,000トークンコスト
   - 3-4個のプラグイン（10-12スキル）：起動時に約1,000-1,200トークンコスト

2. **メンテナンス性の向上** - 関連スキルをグループ管理

3. **チーム別最適化** - プランナーは `game-content-tools` 中心、エンジニアは `dev-tools` 中心

## 実装手順（40個のスキルを分割する場合）

### ステップ1: マーケットプレイスリポジトリの初期化

```bash
# 新しいマーケットプレイスリポジトリを作成
git init glow-skills-marketplace
cd glow-skills-marketplace

# マーケットプレイス構造を作成
mkdir -p .claude-plugin
mkdir -p plugins/{masterdata-tools,screen-tools,game-content-tools,dev-tools,doc-tools}

# 各プラグイン内部構造
for plugin in masterdata-tools screen-tools game-content-tools dev-tools doc-tools; do
  mkdir -p plugins/$plugin/.claude-plugin
  mkdir -p plugins/$plugin/skills
done
```

### ステップ2: マーケットプレイス定義ファイル作成

`.claude-plugin/marketplace.json`:

```json
{
  "name": "glow-skills",
  "owner": {
    "name": "GLOW Development Team",
    "email": "glow-dev@example.com"
  },
  "metadata": {
    "description": "GLOWプロジェクト向け統合スキルマーケットプレイス",
    "version": "1.0.0"
  },
  "plugins": [
    {
      "name": "glow-masterdata-tools",
      "source": "./plugins/masterdata-tools",
      "description": "マスタデータ調査・参照・生成スキル（5個）",
      "version": "1.0.0",
      "category": "data",
      "keywords": ["masterdata", "database", "schema"]
    },
    {
      "name": "glow-screen-tools",
      "source": "./plugins/screen-tools",
      "description": "Unity画面・スクリーン機能ドキュメント作成スキル（4個）",
      "version": "1.0.0",
      "category": "documentation",
      "keywords": ["screen", "ui", "documentation"]
    },
    {
      "name": "glow-game-content-tools",
      "source": "./plugins/game-content-tools",
      "description": "ゲームコンテンツID採番・検証・生成スキル（12個）",
      "version": "1.0.0",
      "category": "content",
      "keywords": ["character", "quest", "item", "bgm", "event"]
    },
    {
      "name": "glow-development-tools",
      "source": "./plugins/dev-tools",
      "description": "開発支援・コード品質・テストスキル（8個）",
      "version": "1.0.0",
      "category": "development",
      "keywords": ["code-review", "testing", "git"]
    },
    {
      "name": "glow-documentation-tools",
      "source": "./plugins/doc-tools",
      "description": "ドキュメント生成・仕様書作成スキル（6個）",
      "version": "1.0.0",
      "category": "documentation",
      "keywords": ["api", "spec", "guide"]
    }
  ]
}
```

### ステップ3: 各プラグインの plugin.json 作成

`plugins/masterdata-tools/.claude-plugin/plugin.json`:

```json
{
  "name": "glow-masterdata-tools",
  "version": "1.0.0",
  "description": "GLOWマスタデータ調査・参照・生成スキル集",
  "author": {
    "name": "GLOW Development Team"
  },
  "keywords": ["masterdata", "database", "schema"]
}
```

同様に他のプラグインの `plugin.json` も作成。

### ステップ4: スキルの配置

```bash
# マスタデータ関連スキルをコピー
cp -r .claude/skills/masterdata-explorer \
  plugins/masterdata-tools/skills/

# 画面関連スキルをコピー
cp -r .claude/skills/screen-doc-creator \
  plugins/screen-tools/skills/

# ゲームコンテンツ関連スキル
cp -r .claude/skills/glow-id-numbering \
  plugins/game-content-tools/skills/
```

### ステップ5: プロジェクト設定

`.claude/settings.json` に以下を追加：

```json
{
  "extraKnownMarketplaces": {
    "glow-skills": {
      "source": {
        "source": "github",
        "repo": "your-org/glow-skills-marketplace"
      }
    }
  },
  "enabledPlugins": {
    "glow-masterdata-tools@glow-skills": true,
    "glow-screen-tools@glow-skills": true,
    "glow-game-content-tools@glow-skills": true,
    "glow-development-tools@glow-skills": false,
    "glow-documentation-tools@glow-skills": false
  },
  "permissions": {
    "allow": [
      "Bash(ls:*)",
      "Bash(find:*)",
      "mcp__github__get_pull_request"
    ]
  }
}
```

### ステップ6: 最終的なディレクトリ構造

```
glow-skills-marketplace/
├── .claude-plugin/
│   └── marketplace.json
├── plugins/
│   ├── masterdata-tools/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json
│   │   └── skills/
│   │       ├── masterdata-explorer/
│   │       │   ├── SKILL.md
│   │       │   └── references/
│   │       └── ... (他のマスタデータ関連スキル)
│   │
│   ├── screen-tools/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json
│   │   └── skills/
│   │       └── screen-doc-creator/
│   │
│   ├── game-content-tools/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json
│   │   └── skills/
│   │       ├── glow-id-numbering/
│   │       └── ... (他のコンテンツ関連スキル)
│   │
│   ├── dev-tools/
│   │   ├── .claude-plugin/
│   │   │   └── plugin.json
│   │   └── skills/
│   │
│   └── doc-tools/
│       ├── .claude-plugin/
│       │   └── plugin.json
│       └── skills/
│
├── README.md
├── CHANGELOG.md
└── LICENSE
```

## 参照ドキュメント

相談で参照した公式ドキュメントのURL一覧：

- [Claude Code Plugins ドキュメント](https://code.claude.com/docs/en/plugins.md)
- [Plugin Marketplaces ドキュメント](https://code.claude.com/docs/en/plugin-marketplaces.md)
- [Plugins Reference](https://code.claude.com/docs/en/plugins-reference.md)
- [Agent Skills Overview](https://platform.claude.com/docs/en/agents-and-tools/agent-skills/overview)

## まとめ

### 40個のスキル量産の場合の推奨アプローチ

1. **マーケットプレイスリポジトリを作成** - `glow-skills-marketplace`
2. **3-5個の機能別プラグインに分割** - masterdata, screen, content, dev, doc
3. **各プラグインに複数スキルを含める** - 8-12個/プラグイン
4. `.claude/settings.json` で必要なプラグインを選別インストール
5. GitHub でホスト → チーム全体で共有

**効果**:
- 起動パフォーマンスを保ちながら、40個のスキルを効率的に管理
- チームメンバーは必要なプラグインだけ有効化できる
- カテゴリー別に整理されるため、メンテナンス性が向上

## 次のアクション

1. **新しいリポジトリを作成**
   - `glow-skills-marketplace` という名前でGitリポジトリを作成

2. **マーケットプレイス構造をセットアップ**
   - `.claude-plugin/marketplace.json` を作成
   - `plugins/` ディレクトリに5つのプラグインを配置

3. **既存の40スキルを分類**
   - 各スキルがどのカテゴリー（masterdata/screen/content/dev/doc）に属するか整理
   - 各プラグインの `skills/` ディレクトリにコピー

4. **GitHubにプッシュ**
   - チームメンバーと共有

5. **プロジェクトの `.claude/settings.json` を更新**
   - マーケットプレイスを参照
   - 必要なプラグインを有効化

---

*このレポートは `/guide-chat` コマンドにより自動生成されました*
