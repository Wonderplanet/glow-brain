# Claude Code ガイド相談レポート

**日付**: 2026年01月14日
**トピック**: tmuxセッション内のClaude Codeでプロンプトを自動実行する方法

## 相談内容

- tmuxセッション内でclaude codeを起動し、`tmux send-keys`でプロンプトを送信して自動実行したい
- `C-m`（Enter）では改行されるだけでプロンプトが実行されない問題を解決したい
- tmux環境での自動化ワークフローの構築方法

## 重要な結論・学び

### 【重要】tmux環境ではインタラクティブモードが使えない

**結論**: tmux send-keysでClaude Codeのインタラクティブモードにキーを送っても、プロンプトは実行されません。これは**Claude Codeの仕様**です。

> 出典: [Interactive Mode Documentation](https://code.claude.com/docs/en/interactive-mode.md)

**問題の原因**:
- Claude Codeのインタラクティブモードは標準ターミナルからの直接入力を想定
- tmux send-keysによるキー送信は正式対応外
- `S-Enter`、`C-j`、`\\` + Enterなどの特殊キーは、tmux経由では正しく解釈されない

**注意点**:
- `C-m`（Enter）、`S-Enter`、`C-j`のいずれも改行として扱われるだけで実行されない
- インタラクティブモードのキーボードショートカットはtmux環境では動作しない

### 正しい解決策：`-p` フラグによる非インタラクティブ実行

tmux環境でClaude Codeを実行する**唯一の正しい方法**は、`-p`（`--print`）フラグを使用することです。

> 出典: [CLI Reference Documentation](https://code.claude.com/docs/en/cli-reference.md)

**正しいコマンド**:
```bash
# 基本的な実行（これが正解）
tmux send-keys -t tmuxtest 'claude -p "ここにプロンプト"' C-m

# マスタデータCSV検証の例
tmux send-keys -t tmuxtest 'claude -p "MstEvent.csvを検証してください"' C-m

# スキルの実行
tmux send-keys -t tmuxtest 'claude -p "/masterdata-csv-validator"' C-m

# JSON形式で出力を受け取る
tmux send-keys -t tmuxtest 'claude -p "分析して" --output-format json' C-m
```

**ベストプラクティス**:
- tmux環境では必ず `-p` フラグを使用する
- インタラクティブモード（`claude`単体）は使わない
- 自動化スクリプトには `-p` + `--output-format json` が最適

**注意点**:
- `-p` フラグでの実行は1回で終了する（継続するには `--continue` フラグが必要）
- パーミッション確認を避けるには `--allowedTools` または `--dangerously-skip-permissions` を使用

### Claude Code CLIフラグリファレンス（tmux連携時）

tmux環境で有用なCLIフラグの一覧：

| フラグ | 説明 | 使用例 |
|--------|------|--------|
| `-p`, `--print` | 非インタラクティブ実行（**必須**） | `claude -p "プロンプト"` |
| `--output-format json` | JSON形式で出力 | `claude -p "分析" --output-format json` |
| `--continue` | 前回の会話を継続 | `claude -p "続きを実行" --continue` |
| `--allowedTools` | 特定ツールを自動承認 | `claude -p "検証" --allowedTools "Read,Bash"` |
| `--dangerously-skip-permissions` | 全パーミッションを自動承認 | `claude -p "実行" --dangerously-skip-permissions` |
| `--append-system-prompt` | システムプロンプト追加 | `claude -p "分析" --append-system-prompt "JSON形式で出力"` |

> 出典: [CLI Reference Documentation](https://code.claude.com/docs/en/cli-reference.md)

### glow-brainプロジェクトでの実践例

あなたのプロジェクトで利用可能なカスタムスキルをtmux経由で実行する例：

```bash
# マスタデータ検証スキル実行
tmux send-keys -t tmuxtest 'claude -p "/masterdata-csv-validator マスタデータフォルダを全体検証"' C-m

# リリースキーレポート生成
tmux send-keys -t tmuxtest 'claude -p "/masterdata-releasekey-reporter v1.5.0" --output-format json' C-m

# マスタデータ探索スキル実行
tmux send-keys -t tmuxtest 'claude -p "/masterdata-explorer MstEventテーブルを調査"' C-m

# 運営仕様書からマスタデータ作成（サブエージェント起動）
tmux send-keys -t tmuxtest 'claude -p "運営仕様書からMstEventを作成" --allowedTools "Read,Write,Bash"' C-m
```

## 実践的なユースケース

### ケース1: tmuxで簡単なプロンプト実行

```bash
# -pフラグで実行（正しい方法）
tmux send-keys -t claude-session 'claude -p "プロジェクトの概要を説明して"' C-m
```

### ケース2: 複雑なスクリプト自動化

```bash
#!/bin/bash
# -pフラグを使った自動化スクリプト

tmux new-session -d -s auto-claude
tmux send-keys -t auto-claude "cd /path/to/project" C-m
tmux send-keys -t auto-claude 'claude -p "マスタデータCSVを検証して" --allowedTools "Read,Bash"' C-m

# 実行結果をログに保存
tmux send-keys -t auto-claude 'claude -p "分析レポート作成" --output-format json | tee result.json' C-m
```

### ケース3: マルチエージェントワークフロー

```bash
# 複数のtmuxペインで並列実行
tmux split-window -h
tmux split-window -v

# ペイン0: マスタデータ検証
tmux send-keys -t auto-claude.0 'claude -p "/masterdata-csv-validator"' C-m

# ペイン1: スキーマ調査
tmux send-keys -t auto-claude.1 'claude -p "/masterdata-explorer MstEvent"' C-m

# ペイン2: リリースキーレポート生成
tmux send-keys -t auto-claude.2 'claude -p "/masterdata-releasekey-reporter v1.5.0" --output-format json' C-m
```

### ケース4: 継続的な会話セッション

```bash
# 最初のプロンプト実行
tmux send-keys -t claude-session 'claude -p "MstEventテーブルの構造を分析して"' C-m

# 前回の会話を継続
tmux send-keys -t claude-session 'claude -p "次にMstGachaも分析して" --continue' C-m

# さらに継続
tmux send-keys -t claude-session 'claude -p "2つのテーブルの関連性を説明して" --continue' C-m
```

## 参照ドキュメント

各トピックで参照した公式ドキュメントのURL一覧：

- [Interactive Mode Documentation](https://code.claude.com/docs/en/interactive-mode.md) - インタラクティブモードの仕様とキーボードショートカット
- [CLI Reference Documentation](https://code.claude.com/docs/en/cli-reference.md) - `-p` フラグと全CLIオプション
- [Headless Mode Documentation](https://code.claude.com/docs/en/headless.md) - 非インタラクティブ実行の詳細

## 次のアクション

- `claude -p` フラグを使ったtmux自動化スクリプトを作成する
- マスタデータ検証ワークフローをtmux + claude -pで自動化する
- 複数のtmuxペインで並列実行するマルチエージェント環境を構築する
- `--continue` フラグを活用した継続的な会話セッションを試す

## まとめ

**tmux環境でClaude Codeを使う際の重要なポイント**:

1. **インタラクティブモードは使えない** - `tmux send-keys`では`S-Enter`などのキーは動作しない
2. **必ず `-p` フラグを使う** - これがtmux環境での唯一の正しい実行方法
3. **自動化には `--allowedTools` を併用** - パーミッション確認をスキップできる
4. **継続的な会話には `--continue`** - 前回のセッションを引き継げる

---

*このレポートは `/guide-chat` コマンドにより自動生成されました*
