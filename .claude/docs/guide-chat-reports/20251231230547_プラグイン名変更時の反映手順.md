# Claude Code ガイド相談レポート

**日付**: 2025年12月31日
**トピック**: プラグインマーケットプレイスでプラグイン名変更時の反映手順

## 相談内容

- インストール済みのプラグインマーケットプレイスでプラグイン名を変更した場合の反映作業手順
- マーケットプレイスのメタデータ更新方法
- チーム全体への変更の反映方法

## 重要な結論・学び

### 1. マーケットプレイスの更新コマンド

プラグインマーケットプレイスの `marketplace.json` や `plugin.json` を変更した場合、以下のコマンドでマーケットプレイスのメタデータを更新する必要があります：

```bash
/plugin marketplace update marketplace-name
```

これによって、Claude Code はマーケットプレイスから最新のプラグイン情報を再取得します。

> 出典: [Discover Plugins - Claude Code Documentation](https://code.claude.com/docs/en/discover-plugins.md#manage-marketplaces)

### 2. プラグイン名変更時の完全な手順

#### ステップ 1: マーケットプレイスリポジトリを更新

```bash
cd your-marketplace-repo
# marketplace.json と plugin.json を編集
git add .
git commit -m "Update plugin name from old-plugin-name to new-plugin-name"
git push
```

**marketplace.json の例**:
```json
{
  "name": "my-plugins",
  "owner": { "name": "Your Name" },
  "plugins": [
    {
      "name": "new-plugin-name",  // 変更前: "old-plugin-name"
      "source": "./plugins/my-plugin",
      "description": "プラグインの説明"
    }
  ]
}
```

#### ステップ 2: ローカルマーケットプレイスを更新

```bash
/plugin marketplace update marketplace-name
```

> 出典: [Discover Plugins - Claude Code Documentation](https://code.claude.com/docs/en/discover-plugins.md#refresh-plugin-listings-from-a-marketplace)

#### ステップ 3: 古いプラグインをアンインストール

```bash
/plugin uninstall old-plugin-name@marketplace-name
```

#### ステップ 4: 新しいプラグインをインストール

```bash
/plugin install new-plugin-name@marketplace-name
```

### 3. その他のメタデータ変更時の対応

以下の項目を変更した場合も同じ手順で反映可能：

- プラグイン説明 (`description`)
- バージョン (`version`)
- 著者情報 (`author`)
- ホームページURL (`homepage`)
- コマンドパス (`commands`)

変更後は必ず：
```bash
/plugin marketplace update marketplace-name
```

### 4. チーム全体への反映（設定ベース）

`.claude/settings.json` でマーケットプレイスを自動インストールしている場合：

```json
{
  "extraKnownMarketplaces": {
    "company-plugins": {
      "source": {
        "source": "github",
        "repo": "your-org/plugins-repo"
      }
    }
  },
  "enabledPlugins": {
    "old-plugin-name@company-plugins": true
  }
}
```

この場合、`enabledPlugins` の設定も更新が必要：

```json
{
  "enabledPlugins": {
    "new-plugin-name@company-plugins": true
  }
}
```

> 出典: [Plugin Marketplaces - Claude Code Documentation](https://code.claude.com/docs/en/plugin-marketplaces.md#require-marketplaces-for-your-team)

### 5. 確認・テストのベストプラクティス

マーケットプレイスの変更後は必ず検証：

```bash
# マーケットプレイスを検証
/plugin validate ./path/to/marketplace

# または CLI で：
claude plugin validate ./path/to/marketplace
```

> 出典: [Plugin Marketplaces - Claude Code Documentation](https://code.claude.com/docs/en/plugin-marketplaces.md#validation-and-testing)

**ベストプラクティス**:
- プラグイン名変更後は必ず検証コマンドを実行
- チーム共有する場合は `.claude/settings.json` を git にコミット
- マーケットプレイス更新前にバックアップを取得

**注意点**:
- プラグイン名を変更した場合、**古いプラグインは自動的にアンインストールされません**。明示的に `uninstall` コマンドを実行する必要があります
- マーケットプレイスをリモート（GitHub等）でホストしている場合、ローカルに反映されるまで若干の遅延が生じる場合があります
- チーム全体に反映させる場合は、`.claude/settings.json` を git にコミットして共有してください

## コマンド早見表

| 作業内容 | コマンド | 説明 |
|---------|---------|------|
| マーケットプレイスを更新 | `/plugin marketplace update marketplace-name` | リモートの最新メタデータを取得 |
| プラグインをアンインストール | `/plugin uninstall old-name@marketplace-name` | 古いプラグイン版を削除 |
| プラグインをインストール | `/plugin install new-name@marketplace-name` | 新しいプラグイン版をインストール |
| マーケットプレイスを検証 | `/plugin validate .` | JSON構文と整合性を確認 |
| マーケットプレイスリストを表示 | `/plugin marketplace list` | 設定済みマーケットプレイスを確認 |

## 参照ドキュメント

今回の相談で参照した公式ドキュメント：

- [Discover Plugins - Claude Code Documentation](https://code.claude.com/docs/en/discover-plugins.md)
- [Plugin Marketplaces - Claude Code Documentation](https://code.claude.com/docs/en/plugin-marketplaces.md)
- [Plugins - Claude Code Documentation](https://code.claude.com/docs/en/plugins.md)

## 次のアクション

- プラグイン名変更時は必ず上記の4ステップを実行
- チームで共有する場合は `.claude/settings.json` の更新も忘れずに
- マーケットプレイス検証を習慣化

---

*このレポートは `/claude-code:guide-chat` コマンドにより自動生成されました*
