---
description: 運営仕様書からGLOWマスタデータCSVを作成
argument-hint: <運営仕様パス>
---

# 運営仕様からマスタデータ作成

運営仕様書（CSV形式）を読み取り、DBスキーマとテンプレートCSVに基づいて、DB投入可能なマスタデータCSVを作成します。作成後は自動的に検証を実行し、整合性を確認します。

## 引数

- `$ARGUMENTS`: 運営仕様ディレクトリパスまたは特定のCSVファイルパス
  - ディレクトリ例: `マスタデータ/運営仕様/100kanoイベント`
  - ファイル例: `マスタデータ/運営仕様/新規ガチャ/要件/新規ガチャ_仕様書_03_ガチャ設定.csv`

## 使用スキル

このコマンドは以下の2つのスキルを活用します：

- **masterdata-explorer**: テーブル構造・カラム・enum値の調査
- **masterdata-csv-validator**: 作成したマスタデータCSVの検証

詳細な使い方は各スキルの`SKILL.md`を参照してください。

## タスク

### ステップ1: 運営仕様の読み込み

**ディレクトリの場合**:
- `要件/`サブディレクトリ内のCSVファイルをリストアップ
- `*_01_概要.csv`があれば最初に読み込み
- その他の要件CSVを順次読み込み
- `*_05_報酬一覧.csv`があれば、リソース情報として活用

**特定のCSVファイルの場合**:
- そのCSVファイルを直接読み込み
- 同じディレクトリ内に関連ファイル（概要、報酬一覧等）がないか確認

**出力**: 必要なマスタデータテーブルを特定

### ステップ2: テーブル構造の確認

各テーブルについて、以下を確認します：

1. **DBスキーマの確認**（masterdata-explorerスキル使用）
2. **テンプレートCSVの確認**: `projects/glow-masterdata/sheet_schema/<TableName>.csv`
3. **既存マスタデータCSVの確認**（参考用）: `projects/glow-masterdata/<TableName>.csv`

**重要**: テンプレートCSVとDBスキーマが一致しない場合、**テンプレートを優先**します。

### ステップ3: リソースの存在確認

報酬として設定するリソース（キャラクター、アイテム等）のIDを以下の順で検索:

1. 運営仕様の概要ファイル（`*_01_概要.csv`）
2. 報酬一覧ファイル（`*_05_報酬一覧.csv`）
3. その他の要件CSVファイル
4. 既存マスタデータCSV（`projects/glow-masterdata/MstUnit.csv`, `MstItem.csv`等）

### ステップ4: マスタデータ作成

1. **出力ディレクトリの作成**:
   ```bash
   mkdir -p マスタデータ/運営仕様/<運営仕様名>/マスタデータCSV
   ```

2. **テンプレートCSVをベースにデータを作成**:
   - テンプレートの列順・列名は**絶対に変更しない**
   - 運営仕様書の内容を適切にマッピング
   - 既存マスタデータのパターンに従う

3. **CSV形式を厳密に遵守**:
   - 改行は `\n` でエスケープ（実際の改行文字は使用しない）
   - ダブルクォートのエスケープは `""`
   - NULL値は空文字列

4. **出力先**: `マスタデータ/運営仕様/<運営仕様名>/マスタデータCSV/`

### ステップ5: 検証と修正

作成したCSVを**masterdata-csv-validatorスキル**で検証します。

**検証結果の確認**:
- `valid: true` → 成功、次のファイルへ
- `valid: false` → エラー修正が必要

エラーがあれば修正し、再検証して `valid: true` になるまで繰り返します。

### ステップ6: 完了報告

すべてのマスタデータCSVが作成・検証完了したら、以下を報告します：

1. 作成したファイル一覧
2. 各ファイルの検証結果
3. 注意事項（リソースIDの警告等）

## 出力形式

### 作業開始時

```
運営仕様書からマスタデータを作成します。

【運営仕様】
- パス: <パス>
- 概要ファイル: <あり/なし>
- 要件ファイル: <件数>

【作成予定のマスタデータ】
1. MstEvent.csv - イベント基本情報
2. MstEventI18n.csv - イベント多言語データ
...

作業を開始します。
```

### 作業完了時

```
マスタデータの作成が完了しました。

【作成したファイル】
1. ✅ MstEvent.csv (検証: 成功)
   - パス: マスタデータ/運営仕様/<運営仕様名>/マスタデータCSV/MstEvent.csv
   - レコード数: <件数>

2. ✅ MstEventI18n.csv (検証: 成功)
   - パス: マスタデータ/運営仕様/<運営仕様名>/マスタデータCSV/MstEventI18n.csv
   - レコード数: <件数>

【注意事項】
- <注意事項があれば記載>

全ての検証が成功しました。DB投入可能な状態です。
出力先: マスタデータ/運営仕様/<運営仕様名>/マスタデータCSV/
```

## 注意事項

- CSV形式を厳密に遵守（改行は`\n`エスケープ、実際の改行文字は使用禁止）
- テンプレートCSVの列順・列名は**絶対に変更しない**
- 既存マスタデータのパターンに従う
- リソースID（キャラクター、アイテム等）は**必ず存在確認する**
- 検証エラーは自動的に修正を試み、`valid: true` になるまで再検証を繰り返す
- **このコマンドは完全自動化されており、ユーザーへの確認は一切行わず最後まで実行する**

## テーブル命名規則

| 種類 | 命名規則 | 例 |
|------|---------|-----|
| **DBスキーマ** | snake_case + 複数形 | `mst_events`, `opr_gachas` |
| **CSVファイル** | PascalCase + 単数形 | `MstEvent.csv`, `OprGacha.csv` |

**プレフィックス**:
- `mst_*` / `Mst*` - 固定マスタデータ
- `opr_*` / `Opr*` - 運営施策・期間限定データ
