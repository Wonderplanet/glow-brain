# ClickUp タスク対応期間CSV生成スクリプト

## 概要

ClickUpのタスクデータ（raw.json）から、メンバーの専門領域別タスク対応期間をCSV形式で抽出するスクリプトです。

## スクリプト

### `generate_task_duration_csv.sh`（単一リスト処理）

指定されたフォルダ/リストのタスクデータから、以下の情報を含むCSVを生成します：

- 名前
- 専門領域（クライアント、サーバー、UI、アセット、QA等）
- タスクID
- タスク名
- フォルダ名
- リスト名
- 開始日時（ISO 8601形式）
- 終了日時（ISO 8601形式）

### `generate_task_duration_csv_batch.sh`（一括実行）

`domain/raw-data/clickup/GLOW`以下のすべてのリストに対して、自動的に`generate_task_duration_csv.sh`を実行します。

**特徴**:
- リストの動的検出（新しいリストが追加されても自動対応）
- エラーハンドリング（1つのリストが失敗しても他のリストは継続処理）
- プログレス表示と処理結果サマリー
- 色付き出力で視認性向上

## 使い方

### 単一リストを処理する場合

```bash
./generate_task_duration_csv.sh '<フォルダ/リストのパス>'
```

**使用例:**

```bash
# GLOW(開発)/v1.5.0のCSVを生成
./generate_task_duration_csv.sh 'GLOW(開発)/v1.5.0'

# QA/アプリQA_Ver1.5.0のCSVを生成
./generate_task_duration_csv.sh 'QA/アプリQA_Ver1.5.0'
```

### すべてのリストを一括処理する場合（推奨）

```bash
./generate_task_duration_csv_batch.sh
```

**出力例:**

```
============================================
タスク対応期間CSV一括生成
============================================

リストを検出中...
検出されたリスト数: 5

処理対象リスト:
  - GLOW(開発)/v1.5.0
  - GLOW(運営)企画タスク/【202601010】地獄楽いいジャン祭
  - QA/アプリQA_Ver1.4.0
  - QA/アプリQA_Ver1.4.1
  - QA/アプリQA_Ver1.5.0

============================================
[1/5] 処理中: GLOW(開発)/v1.5.0
============================================
タスク対応期間CSV生成
フォルダ: GLOW(開発)
リスト: v1.5.0
============================================
...
✓ 成功

============================================
[2/5] 処理中: GLOW(運営)企画タスク/【202601010】地獄楽いいジャン祭
============================================
...
✓ 成功

...

============================================
処理完了サマリー
============================================
成功: 5
失敗: 0
実行時間: 45秒
============================================
```

## 入力データ

### 必要なファイル

1. **タスクデータ**: `domain/raw-data/clickup/GLOW/<フォルダ名>/<リスト名>/*/raw.json`
   - ClickUpから取得したタスク情報JSONファイル

2. **メンバー一覧**: `domain/knowledge/project-structure/メンバー一覧.csv`
   - メールアドレスと専門領域のマッピング情報

## 出力先

```
domain/knowledge/project-management/clickup/GLOW/<フォルダ名>/<リスト名>/タスク対応期間.csv
```

## 出力フォーマット

```csv
名前,専門領域,タスクID,タスク名,フォルダ名,リスト名,開始日時,終了日時
瀧島 大地,クライアント,86ev9ubu0,[1.5.0]QA期間,GLOW(開発),v1.5.0,2026-01-08 04:00:00,2026-01-23 04:00:00
水谷 純暉,サーバー,86ev9ucg6,データレイク転送テスト,GLOW(開発),v1.5.0,2026-01-21 04:00:00,2026-01-23 04:00:00
```

## 注意事項

- 担当者が設定されていないタスクはCSVに含まれません
- メンバー一覧に存在しないメールアドレスは「不明」として出力されます
- 開始日時/終了日時がnullの場合は空欄として出力されます
- タスク名やフォルダ名にカンマが含まれる場合は自動的にエスケープされます

## 推奨ワークフロー

1. **一括生成を実行**（通常はこちらを使用）
   ```bash
   ./generate_task_duration_csv_batch.sh
   ```
   - すべてのリストのCSVを一度に生成
   - 新しいリストが追加されていても自動検出

2. **特定のリストのみ更新したい場合**
   ```bash
   ./generate_task_duration_csv.sh 'GLOW(開発)/v1.5.0'
   ```
   - 個別のリストだけを再生成

## トラブルシューティング

### メンバーが「不明」として表示される

メンバー一覧CSVにメールアドレスが登録されていない可能性があります。スクリプト実行時に警告メッセージで該当するメールアドレスが表示されます。

### 担当者が設定されているタスクが見つからない

指定したフォルダ/リストのraw.jsonファイルに担当者（assignees）が設定されていない可能性があります。ClickUpのタスクデータを確認してください。

### 一括実行で一部のリストが失敗する

一括実行スクリプトは、1つのリストが失敗しても他のリストの処理を継続します。処理完了後のサマリーで失敗したリストが表示されるので、該当するリストを個別に確認してください。

```bash
# 失敗したリストを個別に実行して詳細を確認
./generate_task_duration_csv.sh 'GLOW(開発)/v1.5.0'
```
