# 機能仕様書: 原画パネルミッション機能

---

## 1. 機能概要・ライフサイクル概要

### 機能概要

- **機能名**: 原画パネルミッション機能
- **機能ID / 管理キー**: `ArtworkPanelMission`
- **この機能でユーザーができること**:
  - イベント期間中、設定されたミッションを達成してパネルを開放
  - パネルを1枚めくるごとに原画のかけら1枚と個別報酬を獲得
  - 全てのパネルを開放(コンプリート)して原画を完成させる
  - 完成した原画を図鑑で閲覧・ゲート設定
  - パネルミッション一覧でミッション進捗と開放状況を確認

- **想定される利用シーン**:
  - イベント期間中のミッション達成時（パネル開放の進行）
  - イベント画面からパネルミッション画面への遷移（進捗確認）
  - ホーム画面のパネルミッションアイコンからの遷移
  - 報酬受け取り時（原画のかけら+アイテム獲得）
  - 全パネル開放時（原画獲得・完成演出）

- **利用開始条件 / 解放条件**:
  - 対象イベント期間中のみ利用可能
  - イベントTOP画面の設定に紐づいてパネルミッションが開放
  - ホーム画面またはイベントTOP画面にパネルミッションアイコンが表示される

### 機能ライフサイクル概要

原画パネルミッション機能は、**「イベント開始 → ミッション達成 → パネル開放 → 原画完成」**という流れを持つ期間限定機能。

#### 1. イベント開始・パネルミッション表示

イベント期間が開始すると、ホーム画面とイベントTOP画面にパネルミッションアイコンが表示される。ユーザーがアイコンをタップすると、パネルミッションTOP画面が開く。

- **初期状態**: パネルは全て未開放（黒〜グレー色のパネル画像）
- **初期開放パネル**: マスタ設定により、最初から1枚のみ開放しておくことが可能（設定しないことも可能）
- **パネル構成**: 3x3、4x4、5x5などのグリッド表示（マスタで可変）

#### 2. ミッション一覧の確認

パネルミッションTOP画面の下部に、ミッション一覧がスクロール表示される。各ミッションには以下が表示される：

- ミッション達成条件（例：「ストーリークエストをX回クリア」）
- 達成進捗（例：「3/5」）
- 報酬内容（原画のかけら1枚+アイテム）
- 「挑戦する」ボタンまたは「受け取り」ボタン

#### 3. ミッションへの挑戦

ユーザーは「挑戦する」ボタンをタップして、ミッション達成に関連する画面（クエスト、育成など）へ遷移する。各コンテンツでの行動により、ミッションの進捗が更新される。

#### 4. ミッション達成

達成条件を満たすと、ミッションは**「達成済み・報酬未受け取り」**状態になる。この時点で以下が発生：

- 「挑戦する」ボタンが「受け取り」ボタンに切り替わる
- パネルミッションアイコンに赤バッジが表示される
- イベントバナーにも赤バッジが表示される

#### 5. 報酬受け取り・パネル開放

ユーザーが「受け取り」ボタンまたは「一括受け取り」ボタンをタップすると：

- 原画のかけら1枚+設定された報酬（強化素材、ガチャチケット等）を獲得
- 該当するパネルが開放される（原画のかけら獲得演出）
- 開放されたパネル部分に原画の一部が表示される
- ミッション項目がグレーアウトし、達成チェックマークが表示され、一番下に移動

**開放順序**: ミッションを達成して報酬を受け取った順に開放。一括受け取りの場合は、番号順に開放される。

#### 6. 原画完成（全パネル開放）

全てのパネルを開放すると、以下が実行される：

- 原画完成演出（ミラー演出：メインクエスト開放時を参考）
- 原画データ（`UsrArtwork`）の生成
- 原画とすべての原画のかけらを自動配布
- 原画完成によるミッショントリガーの発動
- 図鑑の「NEW」バッジ表示
- パネルの上に「Complete!」などの完成UIを表示

#### 7. 原画詳細の閲覧

パネルミッション画面で原画本体または原画のかけらアイコンをタップすると、原画詳細画面へ遷移できる。原画詳細画面では：

- 原画のビジュアル（フル表示）
- 原画の完成効果（ゲートHP+100など）
- 原画のかけら一覧と入手方法
- ゲート原画切り替えボタン（完成済みの場合）

※原画詳細画面のフッターの戻るボタンをタップすると、パネルミッションTOP画面に遷移する。

#### 8. イベント終了・復刻時の対応

- **イベント終了後**: パネルミッション画面は非表示になり、アクセス不可
- **復刻時**: パネルミッションに配置した原画は、交換所で獲得できるようにする

---

## 2. 機能ライフサイクルと状態遷移（詳細）

### 状態一覧

#### パネルミッション全体の状態

| 状態 | 説明 |
|----|-------|
| **未開催** | イベント期間外で、パネルミッション画面が非表示 |
| **開催中・未コンプリート** | イベント期間中で、パネルが全て開放されていない状態 |
| **開催中・コンプリート済み** | イベント期間中で、全パネル開放済み・原画獲得済み |
| **終了** | イベント期間終了後、パネルミッション画面が非表示 |

#### 個別パネルの状態

| 状態 | 説明 |
|----|-------|
| **初期開放** | マスタ設定により、最初から開放されているパネル（1枚のみ設定可能） |
| **未開放・ミッション未達成** | 対応するミッションが未達成で、パネルが閉じている状態（パネル画像表示） |
| **未開放・ミッション達成済み** | ミッションは達成したが、報酬未受け取りでパネルが閉じている状態 |
| **開放済み** | 報酬を受け取り、パネルが開放され、原画の一部が表示されている状態 |

#### 個別ミッションの状態

| 状態 | 説明 |
|----|-------|
| **未達成** | ミッション達成条件を満たしていない（「挑戦する」ボタン表示） |
| **達成済み・報酬未受け取り** | ミッション達成条件を満たしたが、報酬未受け取り（「受け取り」ボタン表示、赤バッジ表示対象） |
| **報酬受け取り済み** | 報酬を受け取り完了（グレーアウト、達成チェックマーク表示、一番下に移動） |

### 状態遷移

#### パネルミッション全体の状態遷移

```text
未開催
  └─(イベント期間開始)→ 開催中・未コンプリート

開催中・未コンプリート
  └─(全パネル開放)→ 開催中・コンプリート済み

開催中・コンプリート済み
  └─(イベント期間終了)→ 終了

開催中・未コンプリート
  └─(イベント期間終了)→ 終了
```

#### 個別パネルの状態遷移

```text
未開放・ミッション未達成
  └─(達成条件を満たす)→ 未開放・ミッション達成済み

未開放・ミッション達成済み
  └─(報酬受け取り実行)→ 開放済み
```

#### 個別ミッションの状態遷移

```text
未達成
  └─(達成条件を満たす)→ 達成済み・報酬未受け取り

達成済み・報酬未受け取り
  └─(報酬受け取り実行)→ 報酬受け取り済み
```

### 状態遷移に関与する要素

- **ユーザー操作（UI）**:
  - パネルミッション画面の表示
  - 「挑戦する」ボタンタップ → 対象コンテンツへ遷移
  - 「受け取り」「一括受け取り」ボタンタップ → 報酬受け取り・パネル開放
  - 原画本体/原画のかけらアイコンタップ → 原画詳細画面へ遷移
  - アイテムアイコンタップ → アイテム詳細ダイアログ表示

- **APIの実行結果**:
  - `POST /api/mission/artwork_panel_fetch` - パネルミッション情報取得
  - `POST /api/mission/artwork_panel_receive_reward` - パネルミッション報酬受け取り
  - `GET /api/game/badge` - バッジ情報取得

- **マスタデータ設定**:
  - パネルミッション定義（パネル構成、ミッション達成条件、報酬、開放順序など）
  - イベント期間設定
  - 原画定義（原画ID、作品ID、ゲートHP増加量など）

- **時間経過 / 回数制限**:
  - イベント期間の開始・終了

---

## 3. 対象画面一覧

| 画面ID | 画面名 | 説明 |
|------|------|------|
| `Home` | ホーム画面 | パネルミッションアイコン（最新イベントのみ）からパネルミッション画面へ遷移 |
| `EventTop` | イベントTOP画面 | パネルミッションアイコンからパネルミッション画面へ遷移 |
| `ContentsList` | コンテンツ一覧画面 | イベントバナーに赤バッジ表示（ミッション達成時） |
| `ArtworkPanelMissionTop` | パネルミッションTOP画面 | パネルグリッド表示、ミッション一覧、進捗確認 |
| `EncyclopediaArtworkDetail` | 原画詳細画面 | 原画のビジュアル、効果、かけら一覧を表示（パネルミッションから遷移時は戻るボタンでパネルミッション画面へ） |
| `ArtworkFragmentAcquisition` | 原画のかけら獲得画面 | パネル開放時、原画のかけら獲得演出を表示 |
| `ItemDetailDialog` | アイテム詳細ダイアログ | アイテムアイコンタップ時に表示 |

---

## 4. 画面・UI仕様

### 4.1 ホーム画面

#### UI要素と挙動

| UI要素 | 操作 | 挙動 | 備考 |
|------|------|------|------|
| パネルミッションアイコン | タップ | パネルミッションTOP画面へ遷移 | パネルミッションが設定されている場合のみ表示。達成済み・未受け取りのミッションがある場合、赤バッジ表示 |

**アイコン表示条件**:
- パネルミッションが設定されているイベント期間中のみ表示
- 複数のイベントでパネルミッションが設定されている場合、最新のイベントに紐づくパネルミッションのみホーム画面から遷移可能（既存のイベントミッションと同様の挙動）

### 4.2 イベントTOP画面

#### UI要素と挙動

| UI要素 | 操作 | 挙動 | 備考 |
|------|------|------|------|
| パネルミッションアイコン | タップ | パネルミッションTOP画面へ遷移 | パネルミッションが設定されている場合のみ表示。達成済み・未受け取りのミッションがある場合、赤バッジ表示 |
| イベント一覧 | - | 開催中のイベントを表示 | パネルミッションが設定されているイベントは、赤バッジ表示（ミッション達成時） |

### 4.3 パネルミッションTOP画面

#### UI要素と挙動

| UI要素 | 操作 | 挙動 | 備考 |
|------|------|------|------|
| **パネルグリッド** | - | 縦×横のグリッド表示（3x3、4x4、5x5などマスタで可変） | 各パネルに番号が表示される |
| 未開放パネル | - | 黒〜グレー色のパネル画像を表示 | 番号のみ表示 |
| 開放済みパネル | - | 原画の一部が表示される | 開放された部分が徐々に原画を形成 |
| 初期開放パネル | - | 最初から原画の一部が表示される | マスタ設定により1枚のみ固定で設定可能（設定しないことも可能） |
| 完成時UI | - | 全パネル開放時、原画の上に「Complete!」などの完成UIを表示 | - |
| 原画本体 | タップ | 原画詳細画面へ遷移 | 完成前でもタップ可能。戻るボタンでパネルミッションTOP画面へ戻る |
| 原画のかけらアイコン | タップ | 原画詳細画面へ遷移 | ミッション報酬欄に表示。戻るボタンでパネルミッションTOP画面へ戻る |
| アイテムアイコン | タップ | アイテム詳細ダイアログ表示 | ミッション報酬欄に表示 |
| **ミッション累計表示** | - | 「パネルミッション一覧 1/10」などの進捗表示 | 達成済み/全体の累計数を表示 |
| **ミッション一覧** | スクロール | ミッション項目がスクロール可能 | 画面下部に配置 |
| ミッション項目（未達成） | - | ミッション名、達成条件、進捗ゲージ、報酬アイコン、「挑戦する」ボタンを表示 | - |
| ミッション項目（達成済み） | - | ミッション名、達成条件、進捗ゲージ（達成）、報酬アイコン、「受け取り」ボタンを表示 | - |
| ミッション項目（受け取り済み） | - | グレーアウト、達成チェックマーク表示、一番下に移動 | - |
| 挑戦するボタン | タップ | ミッション達成に関連する画面へ遷移 | 遷移先はマスタデータ設定（QuestSelect, UnitList, Gacha等） |
| 受け取りボタン | タップ | 達成済みミッションの報酬を個別に受け取る | 報酬受け取り → パネル開放演出 → バッジとボタン状態が自動更新 |
| 一括受け取りボタン | タップ | 達成済みミッションをまとめて受け取る | 報酬受け取り → パネル開放演出（番号順） → バッジとボタン状態が自動更新 |
| イベント終了までの残り時間 | - | リアルタイムカウントダウン表示（例：「終了まで 99日24時間」） | - |
| 戻るボタン | タップ | イベントTOP画面またはホーム画面へ戻る | 遷移元に応じて戻り先が変わる |

### 4.4 パネル開放演出

報酬受け取り時、原画のかけら獲得演出が表示される。

#### UI要素と挙動

| UI要素 | 操作 | 挙動 | 備考 |
|------|------|------|------|
| 原画のかけらビジュアル | - | 獲得した原画のかけらを表示 | アニメーション演出あり（簡素化して調整） |
| 原画パズル | - | 原画の完成状況をパズル形式で表示 | 獲得したかけらがハイライト |
| タップして続ける | タップ | パネルミッションTOP画面へ戻る | - |

### 4.5 原画完成演出

全パネル開放時、原画完成演出が表示される。

#### UI要素と挙動

| UI要素 | 操作 | 挙動 | 備考 |
|------|------|------|------|
| ミラー演出 | - | メインクエスト開放時を参考にした演出 | 原画のビジュアルを大きく表示 |
| 原画名 | - | 原画の名前を表示 | - |
| 完成メッセージ | - | 「原画を獲得しました！」などのメッセージ | - |
| タップして続ける | タップ | パネルミッションTOP画面へ戻る | 画面上に「Complete!」UIが表示される |

### 4.6 原画詳細画面（パネルミッションから遷移）

既存の原画詳細画面を利用するが、パネルミッションから遷移した場合は以下の違いがある：

- **戻るボタンの遷移先**: パネルミッションTOP画面へ戻る（通常は図鑑コレクション画面へ戻る）
- **表示内容**: 完成前でも遷移可能（未完成の原画として表示）

---

## 5. 画面遷移

### ホーム画面からの遷移

```text
ホーム画面
  └─ パネルミッションアイコン → パネルミッションTOP画面
```

### イベントTOP画面からの遷移

```text
イベントTOP画面
  └─ パネルミッションアイコン → パネルミッションTOP画面
```

### コンテンツ一覧画面からの遷移

```text
コンテンツ一覧画面
  └─ イベントバナー（パネルミッション設定あり） → イベントTOP画面 → パネルミッションTOP画面
```

### パネルミッションTOP画面からの遷移

```text
パネルミッションTOP画面
  ├─ 原画本体タップ → 原画詳細画面
  ├─ 原画のかけらアイコンタップ → 原画詳細画面
  ├─ アイテムアイコンタップ → アイテム詳細ダイアログ
  ├─ 挑戦するボタン → 対象コンテンツ画面（クエスト、育成、ガチャなど）
  ├─ 受け取りボタン → パネル開放演出（原画のかけら獲得画面） → パネルミッションTOP画面
  ├─ 一括受け取りボタン → パネル開放演出（原画のかけら獲得画面・複数回） → パネルミッションTOP画面
  └─ 全パネル開放時 → 原画完成演出 → パネルミッションTOP画面（「Complete!」UI表示）
```

### 原画詳細画面からの遷移

```text
原画詳細画面（パネルミッションから遷移）
  └─ 戻るボタン → パネルミッションTOP画面
```

| From | 操作 | To | 条件 |
|------|------|----|------|
| ホーム画面 | パネルミッションアイコンタップ | パネルミッションTOP画面 | 最新イベントでパネルミッション設定あり |
| イベントTOP画面 | パネルミッションアイコンタップ | パネルミッションTOP画面 | パネルミッション設定あり |
| コンテンツ一覧画面 | イベントバナータップ | イベントTOP画面 | パネルミッション設定あり（赤バッジ表示） |
| パネルミッションTOP画面 | 原画本体タップ | 原画詳細画面 | - |
| パネルミッションTOP画面 | 原画のかけらアイコンタップ | 原画詳細画面 | - |
| パネルミッションTOP画面 | アイテムアイコンタップ | アイテム詳細ダイアログ | - |
| パネルミッションTOP画面 | 挑戦するボタンタップ | 対象コンテンツ画面 | 遷移先設定に応じて（QuestSelect, UnitList, Gacha等） |
| パネルミッションTOP画面 | 受け取りボタンタップ | 原画のかけら獲得画面 | ミッション達成済み |
| パネルミッションTOP画面 | 一括受け取りボタンタップ | 原画のかけら獲得画面（複数回） | 達成済みミッション複数 |
| 原画のかけら獲得画面 | タップして続ける | パネルミッションTOP画面 | - |
| パネルミッションTOP画面 | 全パネル開放 | 原画完成演出 | 最後のパネル開放時 |
| 原画完成演出 | タップして続ける | パネルミッションTOP画面 | 「Complete!」UI表示 |
| 原画詳細画面 | 戻るボタンタップ | パネルミッションTOP画面 | パネルミッションから遷移した場合 |

---

## 6. API仕様（利用概要）

※ APIの詳細仕様はAPI仕様書に委譲する

| API | メソッド | 用途 | 呼び出し元画面 |
|-----|--------|------|--------------|
| `/api/mission/artwork_panel_fetch` | POST | パネルミッション情報取得。パネル構成、各パネルのミッション進捗・達成状態・報酬受け取り状態、開放状況、原画情報を取得。 | パネルミッションTOP画面表示時 |
| `/api/mission/artwork_panel_receive_reward` | POST | パネルミッション報酬受け取り。指定したミッションID（単一または複数）の報酬を受け取り、対応するパネルを開放。レスポンスに報酬内容、原画のかけら、開放されたパネル番号、原画完成情報を含む。 | 報酬受け取り時（個別・一括） |
| `/api/game/badge` | GET | 各種ミッションの未受け取り報酬数を取得。パネルミッションの未受け取り報酬数も含む。 | バッジ情報更新時 |
| `/api/game/update_and_fetch` | POST | ゲーム起動時・日跨ぎ時にユーザーデータを更新して取得。`gameFetchOther.usrArtworks`と`gameFetchOther.usrArtworkFragments`にユーザーの原画・原画のかけら所持情報を含む。 | ホーム画面表示時 |
| `/api/encyclopedia/receive_first_collection_reward` | POST | 原画の初回コレクション報酬（無償プリズム）を受け取る。 | 原画詳細画面（初回閲覧時） |

### API呼び出しフロー

#### パネルミッション画面表示フロー

```text
ユーザーがパネルミッション画面を開く
  ↓
API: POST /api/mission/artwork_panel_fetch
  リクエスト: イベントID、パネルミッションID
  ↓
取得する情報：
  - パネル構成情報（グリッドサイズ、パネル総数）
  - 各パネルの開放状態（未開放/開放済み）
  - 初期開放パネルの位置
  - 各ミッションの達成状態（未達成/達成済み/受け取り済み）
  - 各ミッションの進捗状況（現在値/目標値）
  - 各ミッションの報酬内容（原画のかけら、アイテムなど）
  - 対象原画情報（原画ID、作品ID、原画名、完成状態）
  - イベント終了時刻
  ↓
画面描画
  - パネルグリッド表示（未開放パネル、開放済みパネル）
  - ミッション一覧表示（進捗ゲージ、ボタン状態）
  - バッジ表示更新
  - 原画のかけら表示
  - イベント終了までの残り時間表示
```

#### 報酬受け取り・パネル開放フロー

```text
ユーザーが「受け取り」または「一括受け取り」ボタンをタップ
  ↓
API: POST /api/mission/artwork_panel_receive_reward
  リクエスト: パネルミッションID、受け取るミッションIDのリスト
  ↓
サーバー処理:
  1. ミッション達成状態の確認
  2. 報酬配布処理
     - 原画のかけらを配布（`UsrArtworkFragment`に保存）
     - 設定された報酬を配布（アイテム、ガチャチケットなど）
  3. パネル開放処理
     - 対応するパネルを開放状態に更新
     - 開放順序を記録（報酬受け取り順、一括の場合は番号順）
  4. 原画完成判定
     - 全パネルが開放された場合:
       a. 対象原画の全ての原画のかけらを配布
       b. 原画を配布（`UsrArtwork`に保存）
       c. ミッショントリガー発動（「原画を〇個獲得」など）
  5. ログ保存
  ↓
レスポンス:
  - 受け取り結果（成功/失敗、失敗理由）
  - 獲得した報酬の詳細（原画のかけら、アイテムなど）
  - 開放されたパネル番号のリスト
  - 原画完成情報（完成した場合）
  - 更新後のユーザーステータス
  ↓
クライアント処理:
  1. 原画のかけら獲得演出表示（パネル開放ごと）
  2. パネル開放アニメーション（開放されたパネルに原画の一部を表示）
  3. 全パネル開放の場合:
     a. 原画完成演出（ミラー演出）
     b. 「Complete!」UI表示
     c. 図鑑にNEWバッジ表示
  4. ミッション一覧更新（グレーアウト、チェックマーク、並び替え）
  5. バッジ表示更新
```

#### バッジ情報更新フロー

```text
ホーム画面表示時 / イベントTOP画面表示時 / 10秒ごとの定期更新
  ↓
API: GET /api/game/badge
  ↓
取得する情報：
  - 通常ミッション（デイリー/ウィークリー/アチーブメント）の未受け取り報酬数
  - 初心者ミッションの未受け取り報酬数
  - イベントミッションの未受け取り報酬数（イベントごと）
  - パネルミッションの未受け取り報酬数（イベントごと）
  - 降臨バトルミッションの未受け取り報酬数
  ↓
バッジ情報をキャッシュに保存
  ↓
各画面のバッジ表示を更新
  - ホーム画面：パネルミッションアイコンのバッジ（最新イベントのみ）
  - イベントTOP画面：パネルミッションアイコンのバッジ
  - コンテンツ一覧画面：イベントバナーのバッジ
```

---

## 7. データ設定概要（マスタデータ）

### パネルミッション用マスタテーブル

| テーブル名 | 役割 | 主な利用箇所 |
|-----------|------|-------------|
| `MstMissionArtworkPanel` | パネルミッション定義（ID、イベントID、パネル構成、対象原画ID、初期開放パネル位置） | パネルミッションTOP画面 |
| `MstMissionArtworkPanelI18n` | パネルミッションの多言語テキスト（タイトル、説明文） | パネルミッションTOP画面 |
| `MstMissionArtworkPanelDetail` | パネルミッション詳細（ミッションID、パネル番号、達成条件、報酬グループID、ソート順） | パネルミッションTOP画面、ミッション一覧 |
| `MstMissionArtworkPanelDetailI18n` | パネルミッション詳細の多言語テキスト（ミッション名、説明文） | パネルミッションTOP画面、ミッション一覧 |

### 原画関連マスタテーブル

| テーブル名 | 役割 | 主な利用箇所 |
|-----------|------|-------------|
| `MstArtwork` | 原画定義（ID、作品ID、ゲートHP増加量、アセットキー、ソート順） | パネルミッション完成時、原画詳細画面 |
| `MstArtworkI18n` | 原画の多言語テキスト（名前、説明文） | パネルミッション画面、原画詳細画面 |
| `MstArtworkFragment` | 原画のかけら定義（ID、原画ID、ドロップグループID、ドロップ率、レアリティ） | パネル開放時の報酬配布 |
| `MstArtworkFragmentI18n` | 原画のかけらの多言語テキスト（名前） | パネルミッション画面、原画詳細画面 |
| `MstArtworkFragmentPosition` | 原画のかけらの表示位置（ID、原画のかけらID、位置番号） | 原画詳細画面のパズル表示 |

### 報酬関連マスタテーブル

| テーブル名 | 役割 | 主な利用箇所 |
|-----------|------|-------------|
| `MstMissionReward` | ミッション報酬定義（報酬グループID、リソースタイプ、リソースID、数量） | パネルミッション報酬受け取り時 |

### イベント関連マスタテーブル

| テーブル名 | 役割 | 主な利用箇所 |
|-----------|------|-------------|
| `MstEvent` | イベント定義（ID、開始・終了日時、イベントタイプ） | パネルミッション期間判定 |
| `MstEventI18n` | イベントの多言語テキスト（名前、説明文） | イベントTOP画面、パネルミッション画面 |

### ユーザーデータテーブル

| テーブル名 | 役割 | 主な利用箇所 |
|-----------|------|-------------|
| `UsrMissionArtworkPanel` | ユーザーのパネルミッション進捗（パネルミッションID、ミッションID、達成状態、報酬受け取り状態、パネル開放状態、開放順序） | パネルミッション画面、報酬受け取り処理 |
| `UsrArtwork` | ユーザーが所有する原画（原画ID、初回閲覧フラグ） | 原画完成時、図鑑画面 |
| `UsrArtworkFragment` | ユーザーが所有する原画のかけら（原画ID、原画のかけらID） | パネル開放時、原画完成判定 |

### ログテーブル

| テーブル名 | 役割 | 主な利用箇所 |
|-----------|------|-------------|
| `LogMissionArtworkPanel` | パネルミッション報酬受け取りログ（ユーザーID、パネルミッションID、ミッションID、受け取り日時、獲得報酬） | 運営分析 |
| `LogArtworkFragment` | 原画のかけら獲得ログ（ユーザーID、原画のかけらID、獲得元コンテンツタイプ、獲得元ID、原画完成フラグ） | 運営分析 |

---

## 8. 補足・注意事項

### 仕様上の注意点

- **パネル構成はマスタで可変**: 3x3、4x4、5x5などのグリッドサイズをマスタデータで自由に設定可能。イベントごとに異なるパネル構成を採用できる。
- **初期開放パネルは1枚のみ**: マスタ設定により、最初から開放しておくパネルを1枚のみ固定で設定できる。設定しない場合は全パネルが未開放状態で開始。
- **開放順序**: ミッションを達成して報酬を受け取った順に開放。一括受け取りの場合は、番号順に開放される。
- **パネル開放時の演出**: 既存の原画のかけら獲得演出を簡素化して調整する。
- **原画完成時の演出**: ミラー演出（メインクエスト開放時を参考）を使用。完成後はパネルの上に「Complete!」などの完成UIを表示。
- **原画詳細画面の戻るボタン**: パネルミッションから遷移した場合、戻るボタンでパネルミッションTOP画面へ戻る（通常は図鑑コレクション画面へ戻る）。
- **カラー原画を使用**: イベントのゴールとして相応しい、希少性の高いカラー原画を使用する。
- **復刻時の対応**: パネルミッションに配置した原画は、イベント復刻時に交換所で獲得できるようにする。
- **複数イベント開催時**: 複数のイベントでパネルミッションが設定されている場合、ホーム画面のアイコンから遷移できるのは最新イベントに紐づくパネルミッションのみ。他のイベントのパネルミッションは、各イベントTOP画面からアクセス可能。
- **バッジ表示**: 達成済み・未受け取りのミッションがある場合、ホーム画面・イベントTOP画面のパネルミッションアイコン、コンテンツ一覧画面のイベントバナーに赤バッジが表示される。全報酬受け取りでバッジが消える。
- **ミッション一覧のスクロール**: ミッション項目が多い場合、画面下部のミッション一覧がスクロール可能。

### 例外ケース

- **イベント期間終了後**: パネルミッション画面は非表示になり、アクセス不可。未完成のパネルミッションがあった場合、次回の復刻または交換所で原画を獲得する必要がある。
- **ミッション達成条件が満たせない場合**: 達成条件に関連するコンテンツが利用不可（メンテナンス、期間外など）の場合、ミッション達成が不可能になる。この場合、サポート対応が必要。

### 将来的な拡張予定

- **パネル構成の多様化**: 現在は正方形グリッド（3x3、4x4、5x5など）だが、将来的には長方形グリッド（3x4、4x5など）やカスタム形状のパネル配置が可能になる可能性がある。
- **報酬の多様化**: 現在は原画のかけら1枚+アイテムだが、将来的にはパネルごとに異なる報酬数量や特別報酬（限定キャラ、限定アイテムなど）が設定できる可能性がある。
- **パネル開放の多様化**: 現在は報酬受け取り順に開放されるが、将来的には特定のパネルを開放するための前提パネル（依存関係）が設定できる可能性がある。

---

## 参考資料

- [ゲーム体験仕様書](../../raw-data/game-experience-specs/v1.6.0/artwork_panel_mission/game_experience_spec.pdf)
- [ミッション機能仕様書](./ミッション機能.md)
- [原画・原画のかけら機能仕様書](./原画・原画のかけら機能.md)
