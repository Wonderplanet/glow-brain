# スタミナブーストでバトルに挑戦時、スタミナ回復アイテムを使用するとバトル準備ダイアログが表示されたままの状態で進行不能になる - Activity

**コメント #1** by Kazuya Adachi 
(2026-01-16 15:13:07)

1/16 福元
スタミナブーストでバトルに挑戦時、スタミナ回復アイテムを使用後に問題なく動作していることを確認いたしました。
 
確認ビルド：iOS #20(556)、AOS #20(559)
確認環境：develop
検証端末：iPhone13(iOS:17.0.3)
　　　　　Pixel9(AOS:14.0.0)



**コメント #2** by Keisuke Isayama 
(2026-01-15 18:02:55)

スタミナブースト時にスタミナ回復アイテムを使用した際に、進行不能にならずクエストに挑戦できるよう修正いたしました。
ご確認のほどよろしくお願いいたします。
ビルド番号
android:#557
ios:#554



**コメント #3** by Toshikazu Takahashi 
(2026-01-15 14:10:29)

### 調査方針・解決策の提案

本件について、下記の通り調査・対応を進めるのが適切です。

---

#### 類似事例の有無
過去チケットを確認したところ、ダイアログの進行不能、および類似の進行不能系不具合には以下の事例がありました。

- **インゲームで特定手順を行うと、小ローディングアニメーションが表示されたまま進行不能になる**  
  [ClickUp: 86eurc9nj](https://app.clickup.com/t/86eurc9nj)  
  担当: daichi_takishima
- **ゲート強化で詳細強化ボタンダイアログを表示させたまま他画面に遷移して戻ると遷移前と同じ状態となっている**  
  [ClickUp: 86eur0g3p](https://app.clickup.com/t/86eur0g3p)  
  担当: Keisuke Isayama

これらの対応内容および実際の解決アプローチとして「状態遷移時にダイアログや内部ステータスを正しくリセットする不具合修正」や、「ステータス再取得・再描画処理の強化」が行われていました。

---

#### 本件の初期調査観点
- スタミナ回復アイテム使用後に、バトル準備ダイアログ内の所持スタミナ値が更新されていないことから、「回復後のスタミナ値の表示更新の非同期/失敗」「ダイアログ内要素と内部状態の同期ズレ」が想定されます
- ボタンが操作不能となる現象から、「回復処理後にバトル準備ダイアログのボタンエリアがロック状態のままになっている」「UIイベントリスナーが適切に再アタッチされていない」なども考えられます
- 底層でイベントがスタックしている場合などに、進行不能が発生している可能性があるので、アイテム消費処理/進行処理/画面再描画の一連のフローの見直しとログ取得が必要です

---

#### 推奨対応策
1. **復旧手順の洗い出し**  
　スタミナ回復直後のダイアログ内各ステータス（スタミナ値/ブースト回数/ボタン有効化状態）更新処理の見直し  
2. **イベントリスナー/ボタンハンドラの状態確認**  
　回復処理完了後、バトル準備ダイアログの全ボタンイベントリスナーが生きているか調査
3. **サーバ通信/非同期処理フローの確認**  
　スタミナ回復アイテム利用後の再描画タイミング・サーバ応答待ち/失敗時のUI待ち状態などをログで確認
4. **同様パターンの他ダイアログ進行不能事例の再発確認と共通ロジック化**

---

#### アサイン推奨
上記観点から、進行不能/ダイアログ系の類似バグ解決経験がある下記メンバーへのアサインが妥当です。

- **daichi_takishima**  
  →過去に進行不能系インゲームバグ（86eurc9nj, 86eure48b等）で原因特定・修正経験あり
- **Keisuke Isayama**  
  →ダイアログ状態同期の不具合修正経験および同系統のタスク担当経験あり

---

#### 関連タスク
- インゲームで特定手順を行うと、小ローディングアニメーションが表示されたまま進行不能になる  
  https://app.clickup.com/t/86eurc9nj
- ゲート強化で詳細強化ボタンダイアログを表示させたまま他画面に遷移して戻ると遷移前と同じ状態となっている  
  https://app.clickup.com/t/86eur0g3p

---

#### 初回対応提案
- ログ・再現動画より、アイテム消費直後の状態確認
- エラー時のUI要素の状態ダンプ取得（スタミナ値・ボタン状態・イベントリスナーマッピング）
- 仕様通りの正常系時系列と比較し、どこで同期ズレや状態ロックが発生しているか特定

---

**アサイン案：daichi_takishima（メイン）、サブレビュアーとしてKeisuke Isayamaをセットし、調査・実装案のレビューも依頼することを推奨します。**

---

何か追加で知見必要な場合や、関連ソースコード範囲の特定に人手が必要な場合はコメントください。


