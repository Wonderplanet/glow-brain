# 指定日時でアイテムBOXから表示が消えるアイテムを指定日時経過後に使用するとエラーが発生する - Activity

**コメント #1** by Kazuya Adachi 
(2025-12-12 14:54:03)

12/12 安達
アイテムの非表示設定については、交換所で使用するアイテム用となるため、
他アイテムは期限設定がある場合でも非表示とならない旨、承知いたしました。

エラーについても問題無いとのことから、本件はクローズさせて頂きます。



**コメント #2** by Keisuke Isayama 
(2025-12-11 18:26:11)

こちら確認したところ、交換所収集用のアイテムを非表示にする実装のため、それ以外は期限設定があっても永久表示設定になる想定のようです。
そのため、今回のエラーに関しては問題ありません。



**コメント #3** by Kazuya Adachi 
(2025-12-11 17:12:42)

12/11 安達
アイテムBOXにおいて、「2026/1/1 00:00」を過ぎた状態で「ランダムRキャラのかけらBOX」を使用した際、
『このアイテムは現在使用できません』とのダイアログが表示され、エラーが発生しないことを確認しました。

しかしながら、「カラーメモリー・グレー」については「2026/1/1 00:00」を過ぎた状態でも
ランクアップで使用ができ、サーバーエラーが発生する状況となっています。

確認ビルド：iOS#2538、AOS#2538
確認環境：develop
確認端末：iPhoneSE3(iOS:18.6)
　　　　　ZenFone6(AOS:9.0)



**コメント #4** by Keisuke Isayama 
(2025-12-11 16:06:49)

期間外のアイテムを使用しようとすると、ダイアログを表示させるよう対応いたしました。
ご確認のほどよろしくお願いいたします。
ビルド番号:#2538



**コメント #5** by Toshikazu Takahashi 
(2025-12-10 17:02:52)

【調査方針・解決策の提案】

■概要  
指定日時でアイテムBOXから非表示となるアイテムについて、非表示後にアイテムを使用することでエラーが発生する事象です。添付の再現手順から「ランダムRキャラのかけらBOX」「カラーメモリー・グレー」など消滅タイミングや非表示切替タイミングと実際の消費挙動で正しくアイテムの排他や使用可否制御が行えていない可能性が高いと推測されます。

■関連/類似タスク調査  
過去の「消費系アイテムの挙動」「期限切れ後のアイテムやメール挙動」「期限で非表示となるリソース利用時のエラー」等について、下記のような関連事例があります。

- 「ギフトありメールが期限切れで受け取れなかった後、メール一覧に期限切れメールが残る」  
  https://app.clickup.com/t/86euu56r4  
  → アイテムやメールの有効期限管理・表示タイミングの整合性不備の例。  
  対応では「期限チェック処理」の見直しや「UI上の状態更新」の修正が行われています。

その他、今回のような「日付や期限跨ぎ時のエラー」を直接扱っているチケットは見当たりませんが、期限で消える系UI/DB状態の遷移不備対応の多くは、「状態更新タイミング」「再取得/リフレッシュ漏れ」「排他処理」見直しがメインです。

■対応方針  
1. **根本原因調査**  
　- 指定日付でアイテムが「非表示」になる処理ロジックと、「使用」可能なロジックが正しく連動しているかを確認します。
　- 対象アイテムの「使用可否判定」がUI側・サーバー側双方でどのタイミング/条件で行われているか詳細に調査します。

2. **再現パターン洗い出し**  
　- 他の消費型アイテムでも同様の現象が起こらないか（例えば、異なる消費方法や他の日付パターンでも発生しうるか）を検証します。

3. **想定対応策**  
　- アイテムの「有効期限」や「非表示」状態を、利用直前のチェックにもかけることで、不正な利用を事前にブロックする
　- 期限切れ時の「非表示」ではなく「使用不可（グレーアウトor利用ボタン非活性等）」へ遷移させる等のUI仕様見直し
　- 使用時に「期限切れ」や「対象外状態」を検知した際のエラーハンドリング追加（サーバー／クライアント両面）

4. **再発防止・関連範囲テストの実施**  
　- アイテムBOXや関連機能全般で「時限要素付きアイテム」の扱いに対し、網羅的な状態遷移の試験設計も必要です。

■担当者アサイン案  
- 本件は「アイテムBOXや消費アイテム利用ロジック」「有効期限管理周り」「状態リフレッシュ・非表示制御」等、領域横断的な知見が必要なため、過去に近い対応およびアイテム/メールまわり実装実績のある**Keisuke Isayama**さんにメイン担当をお願いします。UI/サーバー双方のロジックを確認できる場合は協力メンバーアサインも検討してください。

■参考・類似タスク
- ギフトありメールが期限切れで受け取れなかった後、メール一覧に期限切れメールが残る  
  https://app.clickup.com/t/86euu56r4
- アイテムBOXにて、タブ「消費」にあるアイテムをタップ時にエラーが表示される（タブ・期限管理が関連するUIパターン例）
  https://app.clickup.com/t/86evqm337

---

上記をもとにまずは「非表示制御」「使用可否判定」「DB状態/キャッシュ整合性」の現状把握・調査→不備点の暫定案の創出まで一段深掘り検討をよろしくお願いします。


