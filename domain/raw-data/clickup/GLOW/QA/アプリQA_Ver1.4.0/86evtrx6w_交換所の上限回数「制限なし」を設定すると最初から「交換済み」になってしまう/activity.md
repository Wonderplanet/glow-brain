# 交換所の上限回数「制限なし」を設定すると最初から「交換済み」になってしまう - Activity

**コメント #1** by hiroki fujita 
(2025-12-12 18:27:57)

======================================
12/12　藤田
最新ビルドにて、交換上限数が無制限となっているアイテムにおいて
正しく交換できることを確認しました。
※「+1」「+10」「最大」それぞれで確認

確認ビルド：iOS2540
確認環境：develop
確認端末：iPhone 17 Pro(26)
======================================



**コメント #2** by Keisuke Isayama 
(2025-12-11 19:51:32)

ビルド番号:#2540
交換上限が無制限のものを交換できるよう修正いたしました。
ご確認のほどよろしくお願いいたします。



**コメント #3** by hiroki fujita 
(2025-12-11 12:09:30)

@Keisuke Isayama 
確認ビルド：#2536
最新ビルドで確認したところ、該当アイテムが交換済みになっていないことを確認しましたが、交換しようとすると「交換上限に達しています」と表示され、交換できません。
こちら改めて確認をお願いします。
IMG_0644.HEIC



**コメント #4** by Keisuke Isayama 
(2025-12-09 11:22:19)

「制限無し」に設定された商品を正しく交換できるように修正いたしました。
ご確認のほどよろしくお願いいたします。
ビルド番号:2524
環境:develop,dev-ld
(dev-ldの場合、推しの子交換所の最後のコインが上限回数が無制限に設定されています)



**コメント #5** by Toshikazu Takahashi 
(2025-12-08 19:23:55)

以下、交換所の上限回数「制限なし」設定時に、未交換状態でも「交換済み」と表示されてしまう不具合に対する調査方針・解決策案をコメントいたします。

---

### 調査方針・解決策案

本件については、過去に交換所や交換上限周りで類似した不具合報告・対応履歴が見当たらないため、下記の一般的なマスターデータ・交換所ロジック周辺のトラブルシューティング方針にて進行いたします。

#### 想定される原因
- `MstExchangeLineup.tradable_count`に「NULL（__NULL__）」を設定した際、交換回数「制限なし」の判定ロジックに不備がある可能性が高いです。
- マスター反映後の値変換処理や、交換済み判定時のnull値ハンドリングにバグが存在している可能性があります。

#### 調査・対応方針
1. **交換所の交換済み判定ロジックの確認**  
　- 「tradable_count = NULL」を受け取った場合の初期化処理/比較処理を確認し、0や未初期化値として処理されていないか確認します。
2. **フロント/バック双方の仕様確認**  
　- フロント側は「交換上限＝制限なし」の時に「交換済み」表示を出さない仕様となっているか確認します。
　- サーバー・APIでの交換回数カウント値返却時のNULLハンドリングについて確認します。
3. **想定仕様との差異確認**  
　- 「交換上限＝制限なし」のデータ条件時、期待される挙動・比較用バリュー（例えば「-1」や「NULL」等）がどのように扱われるべきかドキュメントまたは仕様書を確認します。

#### 仮対応案
- `tradable_count`が「NULL」の時、「交換済み」判定ロジックを必ずスルーするようガードを追加
- 「NULL」を「無制限」の意味でUI・ロジック双方で統一的に解釈するよう変換処理を見直し

---

#### 担当アサイン案

交換所のマスター値およびロジック確認・サーバーAPI・フロントの全方位調査が必要となるため、  
**板垣チーム（サーバー&フロント）へ一括アサイン**を推奨します。

過去、類似する「ショップ／交換所系」の不具合では滝島さん、山下さん、古澤さんなどが対応実績あり。（例：「Pixel10でインゲームをプレイ中、ゲートおよびキャラが描画されていない」では滝島さん他が調査担当）

- メイン担当：**daichi_takishimaさん**（交換所／ショップ系で実績多数）
- 仕様確認・資料確認サポート：**Junki Furusawaさん**（仕様・資料チェックの実績あり）

---

以上の方針・体制にて調査進行を提案します。ご確認・追加要望あればご指摘ください。


