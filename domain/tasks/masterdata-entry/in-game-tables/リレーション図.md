# ã‚¤ãƒ³ã‚²ãƒ¼ãƒ  ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›³

> å‚ç…§ãƒªãƒªãƒ¼ã‚¹ã‚­ãƒ¼: 202602015

---

## 1. å…¨ä½“æ§‹é€ ï¼ˆ4å±¤ã®æ¦‚è¦ï¼‰

```mermaid
flowchart TD
    subgraph QUEST["ğŸ—‚ï¸ ã‚¯ã‚¨ã‚¹ãƒˆå±¤ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¥å£ï¼‰"]
        MstEvent["MstEvent<br/>ã‚¤ãƒ™ãƒ³ãƒˆ"]
        MstQuest["MstQuest<br/>ã‚¯ã‚¨ã‚¹ãƒˆ"]
        MstQuestI18n["MstQuestI18n<br/>åç§°ãƒ»ãƒ†ã‚­ã‚¹ãƒˆ"]
        MstQuestBonusUnit["MstQuestBonusUnit<br/>ãƒ¦ãƒ‹ãƒƒãƒˆãƒœãƒ¼ãƒŠã‚¹"]
        MstQuestEventBonusSchedule["MstQuestEventBonusSchedule<br/>ã‚¤ãƒ™ãƒ³ãƒˆãƒœãƒ¼ãƒŠã‚¹"]
    end

    subgraph STAGE["âš”ï¸ ã‚¹ãƒ†ãƒ¼ã‚¸å±¤ï¼ˆå€‹åˆ¥ãƒãƒˆãƒ«è¨­å®šï¼‰"]
        MstStage["MstStage<br/>ã‚¹ãƒ†ãƒ¼ã‚¸"]
        MstStageI18n["MstStageI18n<br/>åç§°"]
        MstStageEventSetting["MstStageEventSetting<br/>æœŸé–“ãƒ»åˆ¶é™è¨­å®š"]
        MstStageEventReward["MstStageEventReward<br/>ãƒ‰ãƒ­ãƒƒãƒ—å ±é…¬"]
        MstStageClearTimeReward["MstStageClearTimeReward<br/>ã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯å ±é…¬"]
        MstStageEndCondition["MstStageEndCondition<br/>çµ‚äº†æ¡ä»¶"]
        MstInGameSpecialRule["MstInGameSpecialRule<br/>ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«"]
    end

    subgraph INGAME["ğŸŸï¸ ã‚¤ãƒ³ã‚²ãƒ¼ãƒ å±¤ï¼ˆãƒãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®šï¼‰"]
        MstInGame["MstInGame<br/>ã‚¤ãƒ³ã‚²ãƒ¼ãƒ "]
        MstInGameI18n["MstInGameI18n<br/>èª¬æ˜æ–‡ãƒ»ãƒ†ã‚£ãƒƒãƒ—ã‚¹"]
    end

    subgraph FIELD["ğŸ—ºï¸ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å±¤ï¼ˆåœ°å½¢ï¼‰"]
        MstPage["MstPage<br/>ãƒšãƒ¼ã‚¸"]
        MstKomaLine["MstKomaLine<br/>ã‚³ãƒé…ç½®ãƒ»åŠ¹æœ"]
    end

    subgraph ENEMY["ğŸ‘¾ æ•µå±¤"]
        MstAutoPlayerSequence["MstAutoPlayerSequence<br/>æ•µå‡ºç¾ã‚·ãƒ¼ã‚±ãƒ³ã‚¹"]
        MstEnemyStageParameter["MstEnemyStageParameter<br/>æ•µãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿"]
        MstEnemyCharacter["MstEnemyCharacter<br/>æ•µã‚­ãƒ£ãƒ©"]
        MstEnemyCharacterI18n["MstEnemyCharacterI18n<br/>åç§°"]
        MstEnemyOutpost["MstEnemyOutpost<br/>æ•µç ¦"]
        MstInGameGimmickObject["MstInGameGimmickObject<br/>ã‚®ãƒŸãƒƒã‚¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ"]
    end

    MstEvent --> MstQuest
    MstQuest --> MstQuestI18n
    MstQuest --> MstQuestBonusUnit
    MstQuest --> MstQuestEventBonusSchedule
    MstQuest --> MstStage

    MstStage --> MstStageI18n
    MstStage --> MstStageEventSetting
    MstStage --> MstStageEventReward
    MstStage --> MstStageClearTimeReward
    MstStage --> MstStageEndCondition
    MstStage -->|target_id| MstInGameSpecialRule
    MstStage --> MstInGame

    MstInGame --> MstInGameI18n
    MstInGame --> MstPage
    MstInGame --> MstEnemyOutpost
    MstInGame -->|boss_mst_enemy_stage_parameter_id| MstEnemyStageParameter
    MstInGame -->|sequence_set_id| MstAutoPlayerSequence

    MstPage --> MstKomaLine

    MstAutoPlayerSequence -->|action_value| MstEnemyStageParameter
    MstAutoPlayerSequence -->|action_value| MstInGameGimmickObject
    MstEnemyStageParameter --> MstEnemyCharacter
    MstEnemyCharacter --> MstEnemyCharacterI18n
```

---

## 2. ã‚¯ã‚¨ã‚¹ãƒˆã€œã‚¹ãƒ†ãƒ¼ã‚¸å±¤ ERå›³

```mermaid
erDiagram
    MstEvent {
        string id PK
        string asset_key
        datetime start_date
        datetime end_date
    }

    MstQuest {
        string id PK
        string quest_type "Normal/Event/Enhance/Tutorial"
        string mst_event_id FK
        int sort_order
        string asset_key
        string quest_group
        string difficulty
        datetime start_date
        datetime end_date
    }

    MstQuestI18n {
        string id PK
        string mst_quest_id FK
        string language
        string name
        string category_name
        string flavor_text
    }

    MstQuestBonusUnit {
        int id PK
        string mst_quest_id FK
        string mst_unit_id FK
        float coin_bonus_rate
        datetime start_at
        datetime end_at
    }

    MstQuestEventBonusSchedule {
        int id PK
        string mst_quest_id FK
        string event_bonus_group_id
        datetime start_at
        datetime end_at
    }

    MstStage {
        string id PK
        string mst_quest_id FK
        string mst_in_game_id FK
        int stage_number
        int recommended_level
        int cost_stamina
        int exp
        int coin
        string prev_mst_stage_id FK
        string auto_lap_type "NULL/AfterClear"
        int max_auto_lap_count
        int sort_order
        string asset_key
        datetime start_at
        datetime end_at
    }

    MstStageI18n {
        string id PK
        string mst_stage_id FK
        string language
        string name
        string category_name
    }

    MstStageEventSetting {
        int id PK
        string mst_stage_id FK
        string reset_type "NULL/Daily"
        int clearable_count
        int ad_challenge_count
        datetime start_at
        datetime end_at
        string background_asset_key
    }

    MstStageEventReward {
        int id PK
        string mst_stage_id FK
        string reward_category "FirstClear/Random"
        string resource_type
        string resource_id
        int resource_amount
        int percentage
        int sort_order
    }

    MstStageClearTimeReward {
        string id PK
        string mst_stage_id FK
        int upper_clear_time_ms
        string resource_type
        string resource_id
        int resource_amount
    }

    MstStageEndCondition {
        string id PK
        string mst_stage_id FK
        string stage_end_type "Victory/Defeat/Finish"
        string condition_type
        string condition_value1
        string condition_value2
    }

    MstInGameSpecialRule {
        string id PK
        string content_type "Stage/AdventBattle/Pvp"
        string target_id FK
        string rule_type
        string rule_value
        datetime start_at
        datetime end_at
    }

    MstEvent ||--o{ MstQuest : "mst_event_id"
    MstQuest ||--o{ MstQuestI18n : "mst_quest_id"
    MstQuest ||--o{ MstQuestBonusUnit : "mst_quest_id"
    MstQuest ||--o{ MstQuestEventBonusSchedule : "mst_quest_id"
    MstQuest ||--o{ MstStage : "mst_quest_id"
    MstStage ||--o{ MstStageI18n : "mst_stage_id"
    MstStage ||--o{ MstStageEventSetting : "mst_stage_id"
    MstStage ||--o{ MstStageEventReward : "mst_stage_id"
    MstStage ||--o{ MstStageClearTimeReward : "mst_stage_id"
    MstStage |o--o{ MstStageEndCondition : "mst_stage_id"
    MstStage |o--o{ MstInGameSpecialRule : "target_id"
    MstStage |o--o| MstStage : "prev_mst_stage_id(è‡ªå·±å‚ç…§)"
```

---

## 3. ã‚¤ãƒ³ã‚²ãƒ¼ãƒ ã€œæ•µè¨­å®šå±¤ ERå›³

```mermaid
erDiagram
    MstStage {
        string id PK
        string mst_in_game_id FK
    }

    MstInGame {
        string id PK
        string mst_auto_player_sequence_set_id FK
        string mst_page_id FK
        string mst_enemy_outpost_id FK
        string boss_mst_enemy_stage_parameter_id FK
        string bgm_asset_key
        string boss_bgm_asset_key
        int boss_count
        float normal_enemy_hp_coef
        float normal_enemy_attack_coef
        float normal_enemy_speed_coef
        float boss_enemy_hp_coef
        float boss_enemy_attack_coef
        float boss_enemy_speed_coef
    }

    MstInGameI18n {
        string id PK
        string mst_in_game_id FK
        string language
        string result_tips
        string description
    }

    MstPage {
        string id PK
    }

    MstKomaLine {
        string id PK
        string mst_page_id FK
        int row
        float height
        string koma_line_layout_asset_key
        string koma1_asset_key
        float koma1_width
        string koma1_effect_type
        string koma1_effect_target_side "All/Player/Enemy"
        string koma1_effect_target_colors
        string koma1_effect_target_roles
        string koma2_asset_key
        string koma3_asset_key
        string koma4_asset_key
    }

    MstAutoPlayerSequence {
        string id PK
        string sequence_set_id FK
        string sequence_group_id
        string sequence_element_id
        string priority_sequence_element_id FK
        string condition_type
        string condition_value
        string action_type
        string action_value FK
        int summon_count
        int summon_interval
        string summon_animation_type
        float summon_position
        string move_start_condition_type
        string move_stop_condition_type
        string aura_type "Default/Boss/AdventBoss1-3"
        string death_type "Normal/Escape"
        float enemy_hp_coef
        float enemy_attack_coef
        float enemy_speed_coef
        int override_drop_battle_point
        int defeated_score
    }

    MstEnemyStageParameter {
        string id PK
        string mst_enemy_character_id FK
        string character_unit_kind "Normal/Boss/AdventBattleBoss"
        string role_type
        string color "Colorless/Red/Blue/Yellow/Green"
        int sort_order
        int hp
        int damage_knock_back_count
        int move_speed
        float well_distance
        int attack_power
        int attack_combo_cycle
        string mst_unit_ability_id1 FK
        int drop_battle_point
        string mst_transformation_enemy_stage_parameter_id FK
        string transformation_condition_type "None/HpPercentage/StageTime"
        string transformation_condition_value
    }

    MstEnemyCharacter {
        string id PK
        string mst_series_id FK
        string asset_key
        bool is_phantomized
        bool is_displayed_encyclopedia
    }

    MstEnemyCharacterI18n {
        string id PK
        string mst_enemy_character_id FK
        string language
        string name
    }

    MstEnemyOutpost {
        string id PK
        int hp
        bool is_damage_invalidation
        string artwork_asset_key
    }

    MstInGameGimmickObject {
        string id PK
        string asset_key
    }

    MstSeries {
        string id PK
    }

    MstStage ||--|| MstInGame : "mst_in_game_id"
    MstInGame ||--o{ MstAutoPlayerSequence : "sequence_set_id"
    MstInGame ||--|| MstPage : "mst_page_id"
    MstInGame ||--|| MstEnemyOutpost : "mst_enemy_outpost_id"
    MstInGame |o--|| MstEnemyStageParameter : "boss_mst_enemy_stage_parameter_id"
    MstInGame ||--o{ MstInGameI18n : "mst_in_game_id"
    MstPage ||--o{ MstKomaLine : "mst_page_id"
    MstAutoPlayerSequence |o--|| MstEnemyStageParameter : "action_value(SummonEnemy)"
    MstAutoPlayerSequence |o--|| MstInGameGimmickObject : "action_value(SummonGimmickObject)"
    MstAutoPlayerSequence |o--|| MstAutoPlayerSequence : "priority_sequence_element_id"
    MstEnemyStageParameter ||--|| MstEnemyCharacter : "mst_enemy_character_id"
    MstEnemyStageParameter |o--|| MstEnemyStageParameter : "mst_transformation_enemy_stage_parameter_id"
    MstEnemyCharacter ||--o{ MstEnemyCharacterI18n : "mst_enemy_character_id"
    MstEnemyCharacter }o--|| MstSeries : "mst_series_id"
```

---

## 4. IDã®å‘½åãƒ‘ã‚¿ãƒ¼ãƒ³ã¨IDé€£é–

```mermaid
flowchart LR
    subgraph CONVENTION["åŒä¸€IDã‚’å…±æœ‰ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ç¾¤"]
        A["MstInGame.id<br/>= event_you1_charaget01_00001"]
        B["MstAutoPlayerSequence<br/>.sequence_set_id<br/>= event_you1_charaget01_00001"]
        C["MstStage.mst_in_game_id<br/>= event_you1_charaget01_00001"]
        D["MstPage.id<br/>= event_you1_charaget01_00001"]
        E["MstEnemyOutpost.id<br/>= event_you1_charaget01_00001"]
        F["MstInGameI18n.mst_in_game_id<br/>= event_you1_charaget01_00001"]

        A -.->|åŒä¸€ID| B
        A -.->|åŒä¸€ID| D
        A -.->|åŒä¸€ID| E
        C -->|FKå‚ç…§| A
        F -->|FKå‚ç…§| A
    end
```

---

## 5. æ•µå‡ºç¾ã‚·ãƒ¼ã‚±ãƒ³ã‚¹æ§‹é€ 

```mermaid
flowchart TD
    SET["sequence_set_id<br/>= MstInGame.id<br/>ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸å˜ä½ã®ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰"]

    SET --> GROUP_DEFAULT["sequence_group_id = ç©º<br/>ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚°ãƒ«ãƒ¼ãƒ—ï¼‰"]
    SET --> GROUP_NEXT["sequence_group_id = 'phase2'<br/>ï¼ˆãƒ•ã‚§ãƒ¼ã‚ºåˆ‡ã‚Šæ›¿ãˆå¾Œï¼‰"]

    GROUP_DEFAULT --> E1["element_id=1<br/>æ¡ä»¶: InitialSummon<br/>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: SummonEnemy(ãƒœã‚¹)"]
    GROUP_DEFAULT --> E2["element_id=2<br/>æ¡ä»¶: ElapsedTime(500ms)<br/>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: SummonEnemy(é›‘é­šÃ—5)"]
    GROUP_DEFAULT --> E3["element_id=3<br/>æ¡ä»¶: ElapsedTime(3000ms)<br/>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: SummonEnemy(åˆ¥é›‘é­šÃ—11)"]
    GROUP_DEFAULT --> E4["...<br/>æ¡ä»¶: OutpostHpPercentage<br/>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: SwitchSequenceGroup(phase2)"]

    GROUP_NEXT --> E5["element_id=1<br/>æ¡ä»¶: InitialSummon<br/>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: SummonEnemy(å¼·åŒ–ãƒœã‚¹)"]

    style SET fill:#4a9eff,color:#fff
    style GROUP_DEFAULT fill:#22c55e,color:#fff
    style GROUP_NEXT fill:#f97316,color:#fff
```

---

## 6. ç‰¹åˆ¥ãƒ«ãƒ¼ãƒ«ï¼ˆMstInGameSpecialRuleï¼‰ã®è¨­å®šãƒ‘ã‚¿ãƒ¼ãƒ³

```mermaid
flowchart LR
    STAGE["MstStage.id<br/>ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸/ã‚µãƒ™ãƒ¼ã‚¸ç³»ï¼‰"]

    STAGE --> R1["SpeedAttack<br/>rule_value=1000<br/>ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¿ãƒƒã‚¯ï¼‰"]
    STAGE --> R2["NoContinue<br/>rule_value=1<br/>ï¼ˆã‚³ãƒ³ãƒ†ã‚£ãƒ‹ãƒ¥ãƒ¼ç¦æ­¢ï¼‰"]
    STAGE --> R3["PartySeries<br/>rule_value=spy<br/>ï¼ˆä½¿ç”¨å¯èƒ½ã‚·ãƒªãƒ¼ã‚ºåˆ¶é™ï¼‰"]
    STAGE --> R4["PartySeries<br/>rule_value=mag<br/>ï¼ˆè¤‡æ•°è¨­å®š=è¤‡æ•°ã‚·ãƒªãƒ¼ã‚ºå¯ï¼‰"]

    style STAGE fill:#8b5cf6,color:#fff
    style R1 fill:#ef4444,color:#fff
    style R2 fill:#ef4444,color:#fff
    style R3 fill:#f59e0b,color:#fff
    style R4 fill:#f59e0b,color:#fff
```

---

## 7. ã‚³ãƒãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ§‹é€ ï¼ˆMstPage â†’ MstKomaLineï¼‰

```mermaid
flowchart TD
    PAGE["MstPage<br/>ï¼ˆãƒãƒˆãƒ«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰1é¢åˆ†ï¼‰"]

    PAGE --> ROW1["MstKomaLine row=1<br/>ä¸Šæ®µ"]
    PAGE --> ROW2["MstKomaLine row=2<br/>ä¸‹æ®µ"]

    ROW1 --> K1["koma1<br/>asset: you_00004<br/>width: 0.4<br/>effect: None"]
    ROW1 --> K2["koma2<br/>asset: you_00004<br/>width: 0.6<br/>effect: None"]
    ROW2 --> K3["koma3<br/>asset: you_00004<br/>width: 1.0<br/>effect: AttackPowerDown<br/>target: Enemy,All"]

    style PAGE fill:#0ea5e9,color:#fff
    style ROW1 fill:#10b981,color:#fff
    style ROW2 fill:#10b981,color:#fff
```

---

## ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨˜å·ã®å‡¡ä¾‹

| è¨˜å· | æ„å‘³ |
|------|------|
| `\|\|` | å¿…é ˆï¼ˆ1ä»¶ï¼‰ |
| `\|o` | ä»»æ„ï¼ˆ0ã¾ãŸã¯1ä»¶ï¼‰ |
| `o{` | 0ä»¥ä¸Šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ |
| `\|{` | 1ä»¥ä¸Šï¼ˆå¿…é ˆï¼‰ |
| `â†’` | å‚ç…§æ–¹å‘ï¼ˆFKå´ã‹ã‚‰å‚ç…§å…ˆï¼‰ |
| `â†` | è¢«å‚ç…§ï¼ˆå‚ç…§ã•ã‚Œã‚‹å´ï¼‰ |
