# 降臨バトルミッション マスタデータ設定手順書

## 概要

降臨バトルミッションのマスタデータ作成手順を記載します。
本手順書に従うことで、ゲーム内でエラーが発生しない正確なマスタデータを作成できます。

## この手順を始める前に必要な情報

### 入力情報

以下の情報を事前に準備してください。

| 項目 | 説明 | 例 |
|------|------|-----|
| **リリースキー** | マスタデータのリリースキー | `202512020` |
| **イベントID** | 対象イベントのマスタID | `event_osh_00001` |

### 必要な運営仕様書・設計書

以下のファイルを参照します。

| ファイル | 説明 | パス例 |
|---------|------|--------|
| **降臨バトル** | 降臨バトルミッションの達成条件・報酬内容 | `domain/raw-data/google-drive/spread-sheet/GLOW/080_運営/いいジャン祭（施策）/運営_仕様書/<施策名>/03_降臨バトル.csv` |
| **概要** | 新規リソースID情報 | `domain/raw-data/google-drive/spread-sheet/GLOW/080_運営/いいジャン祭（施策）/運営_仕様書/<施策名>/01_概要.csv` |

### 参照する技術資料

| 資料 | 説明 | 場所 |
|------|------|------|
| **DBスキーマ** | テーブル定義 | `projects/glow-server/api/database/schema/exports/master_tables_schema.json` |

---

## 対象テーブル

降臨バトルミッションでは、以下の3ファイルでマスタデータを作成します。

| ファイル名 | 説明 |
|-----------|------|
| **MstMissionLimitedTerm.csv** | 期間限定ミッションの基本情報 |
| **MstMissionLimitedTermI18n.csv** | 期間限定ミッションの説明文（多言語対応） |
| **MstMissionReward.csv** | ミッション報酬 |

---

## 作成フロー

### 1. 仕様書の確認

運営仕様書から以下の情報を抽出します。

**必要情報**:
- ミッションの達成条件（何を何回実行するか）
- ミッションの報酬内容
- ミッションの開催期間
- ミッションの表示順序
- ミッション説明文（日本語）

---

### 2. MstMissionLimitedTerm.csv の作成

#### 2.1 CSVヘッダー

```csv
ENABLE,id,release_key,progress_group_key,criterion_type,criterion_value,criterion_count,mission_category,mst_mission_reward_group_id,sort_order,destination_scene,start_at,end_at
```

#### 2.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | ミッションの一意識別子。命名規則: `mission_limited_term_{progress_group_key}_{連番}` |
| **release_key** | リリースキー。例: `202512020` |
| **progress_group_key** | ミッションデータのグルーピングの識別用データ。進捗共有はされません。例: `group_event_osh_00001` |
| **criterion_type** | 達成条件タイプ。下記の「criterion_type設定一覧」を参照 |
| **criterion_value** | 条件の指定値。降臨バトルミッションでは通常空欄 |
| **criterion_count** | 条件の回数。例: `5`(5回挑戦) |
| **mission_category** | ミッションカテゴリ。降臨バトルの場合: `AdventBattle` |
| **mst_mission_reward_group_id** | 報酬グループID。MstMissionRewardのgroup_idと対応。命名規則: `{作品ID}_{イベント連番5桁}_limited_term_{連番}` |
| **sort_order** | 表示順序。小さい数字ほど上位に表示。例: `1`, `2`, `3`... |
| **destination_scene** | タップ時の遷移先シーン。降臨バトルミッションの場合: `AdventBattle` |
| **start_at** | 開始日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **end_at** | 終了日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |

#### 2.3 criterion_type設定一覧

降臨バトルミッション（mission_category=`AdventBattle`）で使用可能なcriterion_typeは以下の3種類のみです。**大文字小文字を正確に一致**させてください。

| criterion_type | 説明 | criterion_value | criterion_count | 使用例 |
|---------------|------|-----------------|-----------------|--------|
| **AdventBattleChallengeCount** | 挑戦回数 | 空欄 | 必要な挑戦回数 | 5回挑戦、10回挑戦、20回挑戦 |
| **AdventBattleTotalScore** | 累計スコア | 空欄 | 必要な累計スコア | 累計スコア10000達成、累計スコア50000達成 |
| **AdventBattleScore** | ハイスコア | 空欄 | 必要なハイスコア | ハイスコア5000達成、ハイスコア10000達成 |

#### 2.4 降臨バトルミッション固有の設定

降臨バトルミッションでは、以下のように設定します。

- **mission_category**: `AdventBattle`（固定）
- **destination_scene**: `AdventBattle`（降臨バトル画面へ遷移）
- **criterion_type**: 上記の3種類から選択
- **criterion_value**: 空欄
- **criterion_count**: 達成に必要な回数またはスコア

#### 2.5 progress_group_key採番ルール

降臨バトルミッションのprogress_group_keyは、以下の形式で採番します。

```
group_{イベントID}
```

**パラメータ:**
- `イベントID`: MstEventテーブルのid（例: `event_osh_00001`, `event_kai_00001`, `event_glo_00001`）

**採番例:**
```
group_event_osh_00001   (推しの子 イベント1)
group_event_kai_00001   (怪獣8号 イベント1)
group_event_glo_00001   (GLOW全体 イベント1)
```

#### 2.6 mst_mission_reward_group_id採番ルール

降臨バトルミッションの報酬グループIDは、以下の形式で採番します。

```
{イベントID}_limited_term_{連番}
```

**パラメータ:**
- `イベントID`: MstEventテーブルのid（例: `event_osh_00001`）
- `連番`: 同一イベント内での連番

**採番例:**
```
event_osh_00001_limited_term_1   (推しの子 イベント1 ミッション1)
event_osh_00001_limited_term_2   (推しの子 イベント1 ミッション2)
event_kai_00001_limited_term_1   (怪獣8号 イベント1 ミッション1)
```

#### 2.7 作成例

```csv
ENABLE,id,release_key,progress_group_key,criterion_type,criterion_value,criterion_count,mission_category,mst_mission_reward_group_id,sort_order,destination_scene,start_at,end_at
e,mission_limited_term_group_event_osh_00001_1,202512020,group_event_osh_00001,AdventBattleChallengeCount,,5,AdventBattle,event_osh_00001_limited_term_1,1,AdventBattle,2026-01-09 15:00:00,2026-01-13 14:59:59
e,mission_limited_term_group_event_osh_00001_2,202512020,group_event_osh_00001,AdventBattleChallengeCount,,10,AdventBattle,event_osh_00001_limited_term_2,2,AdventBattle,2026-01-09 15:00:00,2026-01-13 14:59:59
e,mission_limited_term_group_event_osh_00001_3,202512020,group_event_osh_00001,AdventBattleChallengeCount,,20,AdventBattle,event_osh_00001_limited_term_3,3,AdventBattle,2026-01-09 15:00:00,2026-01-13 14:59:59
```

---

### 3. MstMissionLimitedTermI18n.csv の作成

#### 3.1 CSVヘッダー

```csv
ENABLE,release_key,id,mst_mission_limited_term_id,language,description
```

#### 3.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **release_key** | リリースキー。MstMissionLimitedTermと同じ値 |
| **id** | I18nレコードの一意識別子。命名規則: `{mst_mission_limited_term_id}_{language}` |
| **mst_mission_limited_term_id** | ミッションID。MstMissionLimitedTerm.idと対応 |
| **language** | 言語コード。例: `ja`（日本語） |
| **description** | ミッション説明文。ユーザーに表示される文言 |

#### 3.3 説明文作成のポイント

- イベント名を明記する（例: 「ファーストライブ」）
- 達成条件を明確に記載する（例: 「5回挑戦」）
- ユーザーフレンドリーな表現にする
- 文末は「〜しよう！」形式が推奨

#### 3.4 作成例

```csv
ENABLE,release_key,id,mst_mission_limited_term_id,language,description
e,202512020,mission_limited_term_group_event_osh_00001_1_ja,mission_limited_term_group_event_osh_00001_1,ja,降臨バトル「ファーストライブ」に5回挑戦しよう！
e,202512020,mission_limited_term_group_event_osh_00001_2_ja,mission_limited_term_group_event_osh_00001_2,ja,降臨バトル「ファーストライブ」に10回挑戦しよう！
e,202512020,mission_limited_term_group_event_osh_00001_3_ja,mission_limited_term_group_event_osh_00001_3,ja,降臨バトル「ファーストライブ」に20回挑戦しよう！
```

---

### 4. MstMissionReward.csv の作成

#### 4.1 CSVヘッダー

```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
```

#### 4.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | 報酬の一意識別子。命名規則: `mission_reward_{group_id}_{連番}` |
| **release_key** | リリースキー。MstMissionLimitedTermと同じ値 |
| **group_id** | 報酬グループID。MstMissionLimitedTerm.mst_mission_reward_group_idと対応 |
| **resource_type** | 報酬のリソースタイプ。下記の「resource_type設定一覧」を参照 |
| **resource_id** | リソースID。resource_typeに応じて設定。不要な場合は空欄 |
| **resource_amount** | 報酬の数量 |
| **sort_order** | 表示順序。複数報酬がある場合の並び順 |
| **備考** | 空欄にする |

#### 4.3 resource_type設定一覧

ミッション報酬（MstMissionReward）で使用可能なresource_typeは以下の通りです。**大文字小文字を正確に一致**させてください。

| resource_type | 説明 | resource_id | 参照先テーブル | 主な用途 |
|--------------|------|------------|--------------|---------|
| **Coin** | コイン（ゲーム内通貨） | 不要（空欄） | - | ミッション報酬の定番 |
| **FreeDiamond** | 無償プリズム | 不要（空欄） | - | 重要なミッション報酬 |
| **Exp** | 経験値（プレイヤー経験値） | 不要（空欄） | - | クエストクリア報酬 |
| **Item** | アイテム（チケット、素材など） | **必要** | **MstItem** | ガシャチケット、育成素材 |
| **Emblem** | エンブレム（称号） | **必要** | **MstEmblem** | イベント達成報酬 |
| **Unit** | ユニット（キャラクター） | **必要** | **MstUnit** | ガシャ報酬、特別報酬 |

#### 4.4 作成例

```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_event_osh_00001_limited_term_1_1,202512020,event_osh_00001_limited_term_1,Coin,,2000,1,
e,mission_reward_event_osh_00001_limited_term_2_1,202512020,event_osh_00001_limited_term_2,FreeDiamond,,20,1,
e,mission_reward_event_osh_00001_limited_term_3_1,202512020,event_osh_00001_limited_term_3,Coin,,3000,1,
e,mission_reward_event_osh_00001_limited_term_4_1,202512020,event_osh_00001_limited_term_4,FreeDiamond,,30,1,
e,mission_reward_event_osh_00001_limited_term_5_1,202512020,event_osh_00001_limited_term_5,Item,ticket_glo_00002,1,1,
```

---

## データ整合性のチェック

マスタデータ作成後、以下の項目を確認してください。

### 必須チェック項目

- [ ] **ヘッダーの列順が正しいか**
  - 上記のCSVヘッダーと完全一致している

- [ ] **IDの一意性**
  - すべてのidが一意である
  - 他のリリースのidと重複していない

- [ ] **ID採番ルール**
  - MstMissionLimitedTerm.progress_group_key: `group_{イベントID}`
  - MstMissionLimitedTerm.id: `mission_limited_term_{progress_group_key}_{連番}`
  - MstMissionLimitedTerm.mst_mission_reward_group_id: `{イベントID}_limited_term_{同一イベント内連番}`
  - MstMissionLimitedTermI18n.id: `{mst_mission_limited_term_id}_{language}`
  - MstMissionReward.id: `mission_reward_{group_id}_{連番}`
  - MstMissionReward.group_id: MstMissionLimitedTerm.mst_mission_reward_group_idと同じ値

- [ ] **リレーションの整合性**
  - `MstMissionLimitedTerm.mst_mission_reward_group_id` = `MstMissionReward.group_id`
  - `MstMissionLimitedTermI18n.mst_mission_limited_term_id` がMstMissionLimitedTerm.idに存在する
  - すべてのミッションにdescription（説明文）が設定されている

- [ ] **criterion_typeの正確性**
  - 「criterion_type設定一覧」に記載された3種類のいずれかを使用している
  - 大文字小文字が正確に一致している
  - criterion_valueが空欄である

- [ ] **resource_typeの正確性**
  - 「resource_type設定一覧」に記載された値を使用している
  - 大文字小文字が正確に一致している
  - resource_idの設定有無が正しい（必要なタイプには設定、不要なタイプは空欄）

- [ ] **日時フォーマット**
  - `YYYY-MM-DD HH:MM:SS`形式である
  - start_at < end_at である

- [ ] **数値の妥当性**
  - criterion_count, resource_amount, sort_orderが正の整数である

- [ ] **仕様書、設計書の内容との整合性**
  - 運営仕様書のミッション内容が正確に漏れなくマスタデータに反映されているか

### 推奨チェック項目

- [ ] **命名規則の統一**
  - idのプレフィックスが統一されている

- [ ] **説明文の品質**
  - 誤字脱字がない
  - ユーザーが理解しやすい表現である

---

## 出力形式

最終的な出力は以下の3ファイル構成で行います。

### 1. MstMissionLimitedTerm.csv

```csv
ENABLE,id,release_key,progress_group_key,criterion_type,criterion_value,criterion_count,mission_category,mst_mission_reward_group_id,sort_order,destination_scene,start_at,end_at
e,mission_limited_term_group_event_osh_00001_1,202512020,group_event_osh_00001,AdventBattleChallengeCount,,5,AdventBattle,event_osh_00001_limited_term_1,1,AdventBattle,2026-01-09 15:00:00,2026-01-13 14:59:59
e,mission_limited_term_group_event_osh_00001_2,202512020,group_event_osh_00001,AdventBattleChallengeCount,,10,AdventBattle,event_osh_00001_limited_term_2,2,AdventBattle,2026-01-09 15:00:00,2026-01-13 14:59:59
```

### 2. MstMissionLimitedTermI18n.csv

```csv
ENABLE,release_key,id,mst_mission_limited_term_id,language,description
e,202512020,mission_limited_term_group_event_osh_00001_1_ja,mission_limited_term_group_event_osh_00001_1,ja,降臨バトル「ファーストライブ」に5回挑戦しよう！
e,202512020,mission_limited_term_group_event_osh_00001_2_ja,mission_limited_term_group_event_osh_00001_2,ja,降臨バトル「ファーストライブ」に10回挑戦しよう！
```

### 3. MstMissionReward.csv

```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_event_osh_00001_limited_term_1_1,202512020,event_osh_00001_limited_term_1,Coin,,2000,1,
e,mission_reward_event_osh_00001_limited_term_2_1,202512020,event_osh_00001_limited_term_2,FreeDiamond,,20,1,
```

---

## 重要なポイント

- **3ファイル構成**: MstMissionLimitedTerm、MstMissionLimitedTermI18n、MstMissionRewardの3ファイル
- **I18nは別ファイル**: description（説明文）はMstMissionLimitedTermI18nで管理
- **運営仕様書との整合性**: 仕様書、設計書の内容で、正確に漏れなく、マスタデータを作成できているかを必ず確認する

---

## 参考資料

- **DBスキーマ**: `projects/glow-server/api/database/schema/exports/master_tables_schema.json`
- **既存マスタデータ**: `projects/glow-masterdata/MstMissionLimitedTerm*.csv`
