# イベントログインボーナス マスタデータ設定手順書

## 概要

イベントログインボーナスのマスタデータ作成手順を記載します。
本手順書に従うことで、ゲーム内でエラーが発生しない正確なマスタデータを作成できます。

## この手順を始める前に必要な情報

### 入力情報

以下の情報を事前に準備してください。

| 項目 | 説明 | 例 |
|------|------|-----|
| **リリースキー** | マスタデータのリリースキー | `202512020` |
| **イベントID** | 対象イベントのマスタID | `event_osh_00001` |

### 必要な運営仕様書・設計書

以下のファイルを参照します。

| ファイル | 説明 | パス例 |
|---------|------|--------|
| **施策** | イベントログインボーナスの開催期間・報酬内容 | `domain/raw-data/google-drive/spread-sheet/GLOW/080_運営/いいジャン祭（施策）/運営_仕様書/<施策名>/02_施策.csv` |
| **概要** | 新規リソースID情報 | `domain/raw-data/google-drive/spread-sheet/GLOW/080_運営/いいジャン祭（施策）/運営_仕様書/<施策名>/01_概要.csv` |

### 参照する技術資料

| 資料 | 説明 | 場所 |
|------|------|------|
| **DBスキーマ** | テーブル定義 | `projects/glow-server/api/database/schema/exports/master_tables_schema.json` |
| **ID割り振りルール** | リソースIDの採番規則 | `domain/raw-data/google-drive/spread-sheet/GLOW/040_エンジニアリング/共通/ID割り振りルール.csv` |

---

## 対象テーブル

イベントログインボーナスでは、以下の3ファイルでマスタデータを作成します。

| ファイル名 | 説明 |
|-----------|------|
| **MstMissionEventDailyBonusSchedule.csv** | イベントログインボーナスの開催期間 |
| **MstMissionEventDailyBonus.csv** | 各ログイン日のボーナス設定 |
| **MstMissionReward.csv** | ログインボーナスの報酬内容 |

---

## 作成フロー

### 1. 仕様書の確認

運営仕様書から以下の情報を抽出します。

**必要情報**:
- イベントID（mst_event_id）
- ログインボーナスの開催期間
- 各ログイン日の報酬内容（プリズム、コイン、アイテムなど）
- ログイン日数（何日目まで設定するか）

---

### 2. MstMissionEventDailyBonusSchedule.csv の作成

#### 2.1 CSVヘッダー

```csv
ENABLE,id,release_key,mst_event_id,start_at,end_at
```

#### 2.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | スケジュールの一意識別子。命名規則: `{イベントID}_daily_bonus` |
| **release_key** | リリースキー。例: `202512020` |
| **mst_event_id** | イベントID。MstEventテーブルのidと対応。例: `event_osh_00001`, `event_glo_00001` |
| **start_at** | 開始日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **end_at** | 終了日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |

#### 2.3 id採番ルール

MstMissionEventDailyBonusScheduleのidは、以下の形式で採番します。

```
{イベントID}_daily_bonus
```

**パラメータ:**
- `イベントID`: MstEventテーブルのid（例: `event_osh_00001`, `event_kai_00001`, `event_glo_00001`）

**採番例:**
```
event_osh_00001_daily_bonus   (推しの子 イベント1)
event_kai_00001_daily_bonus   (怪獣8号 イベント1)
event_glo_00001_daily_bonus   (GLOW全体 イベント1)
```

#### 2.4 作成例

```csv
ENABLE,id,release_key,mst_event_id,start_at,end_at
e,event_osh_00001_daily_bonus,202512020,event_osh_00001,2026-01-01 00:00:00,2026-01-16 03:59:59
```

---

### 3. MstMissionEventDailyBonus.csv の作成

#### 3.1 CSVヘッダー

```csv
ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day_count,mst_mission_reward_group_id,sort_order,備考
```

#### 3.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | ログインボーナスの一意識別子。命名規則: `{MstMissionEventDailyBonusSchedule.id}_{login_day_count(2桁ゼロパディング)}` |
| **release_key** | リリースキー。MstMissionEventDailyBonusScheduleと同じ値 |
| **mst_mission_event_daily_bonus_schedule_id** | スケジュールID。MstMissionEventDailyBonusSchedule.idと対応 |
| **login_day_count** | ログイン日数。1日目は`1`, 2日目は`2`... |
| **mst_mission_reward_group_id** | 報酬グループID。MstMissionRewardのgroup_idと対応。通常はidと同じ値を設定 |
| **sort_order** | 表示順序。通常は`1`（複数報酬を同時表示する場合に使用） |
| **備考** | 空欄にする |

#### 3.3 id採番ルール

MstMissionEventDailyBonusのidは、以下の形式で採番します。

```
{MstMissionEventDailyBonusSchedule.id}_{login_day_count(2桁ゼロパディング)}
```

**採番例:**
```
event_osh_00001_daily_bonus_01   (推しの子 イベント1 1日目)
event_osh_00001_daily_bonus_02   (推しの子 イベント1 2日目)
event_osh_00001_daily_bonus_15   (推しの子 イベント1 15日目)
event_kai_00001_daily_bonus_01   (怪獣8号 イベント1 1日目)
```

#### 3.4 mst_mission_reward_group_id設定ルール

**重要**: `mst_mission_reward_group_id`は、通常**idと同じ値**を設定します。

**理由**: 各ログイン日のボーナスは独立した報酬グループとして管理されるため、idをそのまま報酬グループIDとして使用します。

**例:**
```
id: event_osh_00001_daily_bonus_01
mst_mission_reward_group_id: event_osh_00001_daily_bonus_01  (idと同じ)
```

#### 3.5 作成例

```csv
ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day_count,mst_mission_reward_group_id,sort_order,備考
e,event_osh_00001_daily_bonus_01,202512020,event_osh_00001_daily_bonus,1,event_osh_00001_daily_bonus_01,1,
e,event_osh_00001_daily_bonus_02,202512020,event_osh_00001_daily_bonus,2,event_osh_00001_daily_bonus_02,1,
e,event_osh_00001_daily_bonus_03,202512020,event_osh_00001_daily_bonus,3,event_osh_00001_daily_bonus_03,1,
e,event_osh_00001_daily_bonus_04,202512020,event_osh_00001_daily_bonus,4,event_osh_00001_daily_bonus_04,1,
e,event_osh_00001_daily_bonus_05,202512020,event_osh_00001_daily_bonus,5,event_osh_00001_daily_bonus_05,1,
```

---

### 4. MstMissionReward.csv の作成

#### 4.1 CSVヘッダー

```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
```

#### 4.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | 報酬の一意識別子。命名規則: `mission_reward_{group_id}_{連番}` |
| **release_key** | リリースキー。MstMissionEventDailyBonusと同じ値 |
| **group_id** | 報酬グループID。MstMissionEventDailyBonus.mst_mission_reward_group_idと対応 |
| **resource_type** | 報酬のリソースタイプ。下記の「resource_type設定一覧」を参照 |
| **resource_id** | リソースID。resource_typeに応じて設定。不要な場合は空欄 |
| **resource_amount** | 報酬の数量 |
| **sort_order** | 表示順序。複数報酬がある場合の並び順 |
| **備考** | 空欄にする |

#### 4.3 resource_type設定一覧

イベントログインボーナス（MstMissionReward）で使用可能なresource_typeは以下の通りです。**大文字小文字を正確に一致**させてください。

| resource_type | 説明 | resource_id | 参照先テーブル | 主な用途 |
|--------------|------|------------|--------------|------------|
| **Coin** | コイン（ゲーム内通貨） | 不要（空欄） | - | ログインボーナスの定番 |
| **FreeDiamond** | 無償プリズム | 不要（空欄） | - | 重要なログインボーナス |
| **Exp** | 経験値（プレイヤー経験値） | 不要（空欄） | - | プレイヤーレベルアップ用 |
| **Item** | アイテム（チケット、素材など） | **必要** | **MstItem** | ガシャチケット、育成素材、メモリーフラグメント |
| **Emblem** | エンブレム（称号） | **必要** | **MstEmblem** | イベント達成報酬 |
| **Unit** | ユニット（キャラクター） | **必要** | **MstUnit** | ガシャ報酬、特別報酬 |

#### 4.4 作成例

```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_event_osh_00001_daily_bonus_01_1,202512020,event_osh_00001_daily_bonus_01,Item,ticket_osh_10000,1,1,
e,mission_reward_event_osh_00001_daily_bonus_02_1,202512020,event_osh_00001_daily_bonus_02,FreeDiamond,,150,1,
e,mission_reward_event_osh_00001_daily_bonus_03_1,202512020,event_osh_00001_daily_bonus_03,Item,item_glo_00001,200,1,
e,mission_reward_event_osh_00001_daily_bonus_04_1,202512020,event_osh_00001_daily_bonus_04,Item,ticket_glo_00003,1,1,
e,mission_reward_event_osh_00001_daily_bonus_05_1,202512020,event_osh_00001_daily_bonus_05,FreeDiamond,,150,1,
e,mission_reward_event_osh_00001_daily_bonus_06_1,202512020,event_osh_00001_daily_bonus_06,Item,memoryfragment_glo_00001,5,1,
e,mission_reward_event_osh_00001_daily_bonus_07_1,202512020,event_osh_00001_daily_bonus_07,Item,ticket_glo_00003,1,1,
e,mission_reward_event_osh_00001_daily_bonus_08_1,202512020,event_osh_00001_daily_bonus_08,FreeDiamond,,100,1,
e,mission_reward_event_osh_00001_daily_bonus_09_1,202512020,event_osh_00001_daily_bonus_09,Coin,,5000,1,
e,mission_reward_event_osh_00001_daily_bonus_10_1,202512020,event_osh_00001_daily_bonus_10,Item,ticket_glo_00002,1,1,
```

#### 4.5 複数報酬がある場合の設定

1日のログインボーナスで複数の報酬を同時に付与する場合は、同じ`group_id`で複数の報酬レコードを作成し、`sort_order`で並び順を指定します。

**例: 1日目にプリズム50とコイン10000を同時に付与**

```csv
e,mission_reward_event_osh_00001_daily_bonus_01_1,202512020,event_osh_00001_daily_bonus_01,FreeDiamond,,50,1,
e,mission_reward_event_osh_00001_daily_bonus_01_2,202512020,event_osh_00001_daily_bonus_01,Coin,,10000,2,
```

#### 4.6 報酬リソース情報の取得方法

リソースIDが不明な場合は、以下の方法で確認してください：

1. **ID割り振りルール.csv**を参照
   - パス: `domain/raw-data/google-drive/spread-sheet/GLOW/040_エンジニアリング/共通/ID割り振りルール.csv`
2. **既存のマスタデータCSV**を参照
   - MstItem.csv, MstEmblem.csv, MstUnit.csv など
3. **運営仕様書の「概要」ファイル**を参照
   - 新規リソース情報が記載されている場合があります

---

## データ整合性のチェック

マスタデータ作成後、以下の項目を確認してください。

### 必須チェック項目

- [ ] **ヘッダーの列順が正しいか**
  - 上記のCSVヘッダーと完全一致している

- [ ] **IDの一意性**
  - すべてのidが一意である
  - 他のリリースのidと重複していない

- [ ] **ID採番ルール**
  - MstMissionEventDailyBonusSchedule.id: `{イベントID}_daily_bonus`
  - MstMissionEventDailyBonus.id: `{MstMissionEventDailyBonusSchedule.id}_{login_day_count(2桁ゼロパディング)}`
  - MstMissionEventDailyBonus.mst_mission_reward_group_id: idと同じ値
  - MstMissionReward.id: `mission_reward_{group_id}_{連番}`
  - MstMissionReward.group_id: MstMissionEventDailyBonus.mst_mission_reward_group_idと同じ値

- [ ] **リレーションの整合性**
  - `MstMissionEventDailyBonus.mst_mission_event_daily_bonus_schedule_id` = `MstMissionEventDailyBonusSchedule.id`
  - `MstMissionEventDailyBonus.mst_mission_reward_group_id` = `MstMissionReward.group_id`
  - すべてのログイン日に報酬が設定されている

- [ ] **login_day_countの連続性**
  - login_day_countが1から連番で設定されている
  - 欠番がない（1, 2, 3, 4, 5...と連続している）
  - 同じschedule_id内でlogin_day_countが重複していない

- [ ] **resource_typeの正確性**
  - 「resource_type設定一覧」に記載された値を使用している
  - 大文字小文字が正確に一致している
  - resource_idの設定有無が正しい（必要なタイプには設定、不要なタイプは空欄）

- [ ] **日時フォーマット**
  - `YYYY-MM-DD HH:MM:SS`形式である
  - start_at < end_at である

- [ ] **数値の妥当性**
  - login_day_count, resource_amount, sort_orderが正の整数である

- [ ] **仕様書、設計書の内容との整合性**
  - 報酬リソース情報の内容が、仕様書・設計書と比較して、間違いがないか必ず確認する
  - 過去に、誤ったリソース情報でデータ作成してしまったケースがあるため、注意してください

### 推奨チェック項目

- [ ] **命名規則の統一**
  - idのプレフィックスが統一されている

---

## 出力形式

最終的な出力は以下の3ファイル構成で行います。

### 1. MstMissionEventDailyBonusSchedule.csv

```csv
ENABLE,id,release_key,mst_event_id,start_at,end_at
e,event_osh_00001_daily_bonus,202512020,event_osh_00001,2026-01-01 00:00:00,2026-01-16 03:59:59
```

### 2. MstMissionEventDailyBonus.csv

```csv
ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day_count,mst_mission_reward_group_id,sort_order,備考
e,event_osh_00001_daily_bonus_01,202512020,event_osh_00001_daily_bonus,1,event_osh_00001_daily_bonus_01,1,
e,event_osh_00001_daily_bonus_02,202512020,event_osh_00001_daily_bonus,2,event_osh_00001_daily_bonus_02,1,
e,event_osh_00001_daily_bonus_03,202512020,event_osh_00001_daily_bonus,3,event_osh_00001_daily_bonus_03,1,
```

### 3. MstMissionReward.csv

```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_event_osh_00001_daily_bonus_01_1,202512020,event_osh_00001_daily_bonus_01,Item,ticket_osh_10000,1,1,
e,mission_reward_event_osh_00001_daily_bonus_02_1,202512020,event_osh_00001_daily_bonus_02,FreeDiamond,,150,1,
e,mission_reward_event_osh_00001_daily_bonus_03_1,202512020,event_osh_00001_daily_bonus_03,Item,item_glo_00001,200,1,
```

---

## 重要なポイント

- **3ファイル構成**: MstMissionEventDailyBonusSchedule、MstMissionEventDailyBonus、MstMissionRewardの3ファイル
- **login_day_countの連続性**: 1から連番で設定し、欠番がないようにする
- **運営仕様書との整合性**: 仕様書、設計書の内容で、正確に漏れなく、マスタデータを作成できているかを必ず確認する

---

## 参考資料

- **DBスキーマ**: `projects/glow-server/api/database/schema/exports/master_tables_schema.json`
- **ID割り振りルール**: `domain/raw-data/google-drive/spread-sheet/GLOW/040_エンジニアリング/共通/ID割り振りルール.csv`
- **既存マスタデータ**: `projects/glow-masterdata/MstMissionEventDailyBonusSchedule.csv`, `MstMissionEventDailyBonus.csv`, `MstMissionReward.csv`
