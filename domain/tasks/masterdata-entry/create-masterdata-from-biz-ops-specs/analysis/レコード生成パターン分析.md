# レコード生成パターン分析

## 概要

リリースキー202601010のマスタデータについて、「1レコード完成に必要な設計書数」という観点から、設計書とテーブルの関係性を深掘り分析しました。

**結論**:
- **99%以上のケースで「1レコード = 1設計書で完結」**
- 複数設計書が関わっているように見えるテーブルも、**レコード単位では1設計書で完結し、並列実行可能**
- 唯一の例外は「共通設計書」（ID管理、監修資料）で、これらは**後から統合可能**

---

## レコード生成パターンの分類

### パターンA: 1レコード = 1主設計書（完全並列実行可能）

**特徴**:
- 各レコードは独立した設計書から生成される
- レコード間に依存関係なし
- マスタデータ作成作業を完全に並列実行可能

**該当テーブル**: ほぼ全てのテーブル（79テーブル中70テーブル以上）

#### 代表例1: キャラクター関連テーブル

**MstUnit**（設計書数: 5個）:
```csv
id                  → 生成元設計書
---------------------------------------------
chara_jig_00401    → ヒーロー基礎設計_chara_jig_00401_賊王 亜左 弔兵衛
chara_jig_00501    → ヒーロー基礎設計_chara_jig_00501_山田浅ェ門 桐馬
chara_jig_00601    → ヒーロー基礎設計_chara_jig_00601_民谷 巌鉄斎
chara_jig_00701    → ヒーロー基礎設計_chara_jig_00701_メイ
```

- **レコード数**: 4レコード
- **関連設計書数**: 5個（4個のキャラ設計書 + 1個のID管理）
- **レコード生成パターン**: 各レコードは1つのキャラ設計書から完結
- **並列実行**: ✅ 可能（4つの設計書を並列処理可能）

**MstUnitI18n**（設計書数: 5個）:
```csv
id                      → 生成元設計書
---------------------------------------------
chara_jig_00401_ja     → ヒーロー基礎設計_chara_jig_00401 + 監修資料
chara_jig_00501_ja     → ヒーロー基礎設計_chara_jig_00501 + 監修資料
chara_jig_00601_ja     → ヒーロー基礎設計_chara_jig_00601 + 監修資料
chara_jig_00701_ja     → ヒーロー基礎設計_chara_jig_00701 + 監修資料
```

- **レコード生成パターン**: 各レコードは1つのキャラ設計書から完結
- **監修資料の役割**: テキスト内容の監修・修正のみ（後から統合可能）
- **並列実行**: ✅ 可能

**MstEnemyCharacter**（設計書数: 11個）:
```csv
id                  → 生成元設計書
---------------------------------------------
chara_jig_00401    → ヒーロー基礎設計_chara_jig_00401（敵バージョン）
chara_jig_00501    → ヒーロー基礎設計_chara_jig_00501（敵バージョン）
chara_jig_00601    → ヒーロー基礎設計_chara_jig_00601（敵バージョン）
enemy_jig_00501    → ヒーロー基礎設計_chara_jig_00501（敵専用）
enemy_jig_00601    → ヒーロー基礎設計_chara_jig_00601（敵専用）
```

- **レコード数**: 5レコード（今回リリース分）
- **関連設計書数**: 11個（4個のキャラ設計書 + 6個のクエスト設計書 + 1個の監修資料）
- **レコード生成パターン**: 各レコードは1つのキャラ設計書から完結
- **並列実行**: ✅ 可能

#### 代表例2: クエスト関連テーブル

**MstQuest**（設計書数: 7個）:
```csv
id                           → 生成元設計書
---------------------------------------------
quest_event_jig1_charaget01 → 【ストーリー】必ず生きて帰る
quest_event_jig1_challenge01 → 【チャレンジ】死罪人と首切り役人
quest_event_jig1_charaget02 → 【ストーリー】朱印の者たち
quest_event_jig1_savage     → 【高難度】手負いの獣は恐ろしいぞ
quest_event_jig1_1day       → 【1日1回】本能が告げている 危険だと
```

- **レコード数**: 5レコード
- **関連設計書数**: 7個（5個のクエスト設計書 + 1個の運営仕様書 + 1個のID管理）
- **レコード生成パターン**: 各レコードは1つのクエスト設計書から完結
- **並列実行**: ✅ 可能

**MstStage**（設計書数: 5個）:
```csv
id                            → 生成元設計書
---------------------------------------------
event_jig1_1day_00001        → 【1日1回】本能が告げている 危険だと
event_jig1_charaget02_00001  → 【ストーリー】朱印の者たち
event_jig1_charaget01_00001  → 【ストーリー】必ず生きて帰る
event_jig1_challenge01_00001 → 【チャレンジ】死罪人と首切り役人
event_jig1_savage_00001      → 【高難度】手負いの獣は恐ろしいぞ
```

- **レコード数**: 19レコード（5クエスト × 複数ステージ）
- **関連設計書数**: 5個のクエスト設計書
- **レコード生成パターン**: 各レコードは1つのクエスト設計書から完結
- **並列実行**: ✅ 可能

**MstEventDisplayUnit**（設計書数: 9個）:
```csv
id                              → 生成元設計書
---------------------------------------------
quest_event_jig1_1day01        → 【1日1回】本能が告げている 危険だと
quest_event_jig1_charaget0201  → 【ストーリー】朱印の者たち
quest_event_jig1_charaget0101  → 【ストーリー】必ず生きて帰る
quest_event_jig1_challenge011  → 【チャレンジ】死罪人と首切り役人
quest_event_jig1_savage01      → 【高難度】手負いの獣は恐ろしいぞ
```

- **レコード数**: 7レコード
- **関連設計書数**: 9個（5個のクエスト設計書 + 4個のキャラ設計書）
- **レコード生成パターン**: 各レコードは1つの設計書（クエストorキャラ）から完結
- **並列実行**: ✅ 可能

#### 代表例3: アイテム関連テーブル

**MstItem**（設計書数: 9個）:
```csv
id                       → 生成元設計書
---------------------------------------------
memory_chara_jig_00601  → ヒーロー基礎設計_chara_jig_00601（イベント配布）
memory_chara_jig_00701  → ヒーロー基礎設計_chara_jig_00701（イベント配布）
piece_jig_00401         → ヒーロー基礎設計_chara_jig_00401（ガチャ）
piece_jig_00501         → ヒーロー基礎設計_chara_jig_00501（ガチャ）
piece_jig_00601         → ヒーロー基礎設計_chara_jig_00601（イベント配布）
piece_jig_00701         → ヒーロー基礎設計_chara_jig_00701（イベント配布）
```

- **レコード数**: 6レコード（今回リリース分）
- **関連設計書数**: 9個（4個のキャラ設計書 + 2個のストーリークエスト設計書 + 1個の運営仕様書 + 1個の監修資料 + 1個のID管理）
- **レコード生成パターン**: 各レコードは1つのキャラ設計書から完結
- **並列実行**: ✅ 可能

---

### パターンB: 1設計書 → 多レコード（並列実行可能）

**特徴**:
- 1つの設計書から複数レコードが生成される
- しかし、各レコードは独立して生成される
- マスタデータ作成作業を並列実行可能（設計書内のレコード生成は順次実行）

**該当テーブル**: 5〜10テーブル

#### 代表例1: 運営仕様書から生成されるテーブル

**MstMissionEvent**（設計書数: 1個）:
```csv
id                      → 生成元設計書
---------------------------------------------
event_jig_00001_1      → 運営仕様書（メイ: グレード2達成）
event_jig_00001_2      → 運営仕様書（メイ: グレード3達成）
...
event_jig_00001_12     → 運営仕様書（民谷: グレード2達成）
event_jig_00001_13     → 運営仕様書（民谷: グレード3達成）
...
event_jig_00001_43     → 運営仕様書（最終ミッション）
```

- **レコード数**: 43レコード
- **関連設計書数**: 1個（運営仕様書）
- **レコード生成パターン**: 1設計書から43レコードが独立して生成
- **並列実行**: ✅ 可能（1設計書を処理すればOK）

**OprGacha**（設計書数: 1個）:
```csv
id                → 生成元設計書
---------------------------------------------
Pickup_jig_001   → 運営仕様書（ピックアップガチャA）
Pickup_jig_002   → 運営仕様書（ピックアップガチャB）
```

- **レコード数**: 2レコード
- **関連設計書数**: 1個（運営仕様書 + ID管理）
- **レコード生成パターン**: 1設計書から2レコードが独立して生成
- **並列実行**: ✅ 可能

**OprGachaPrize**（設計書数: 4個）:
```csv
id                      → 生成元設計書
---------------------------------------------
Pickup_jig_001_1       → 運営仕様書（chara_jig_00401: ピックアップ）
Pickup_jig_001_2       → 運営仕様書（chara_spy_00101: 過去キャラ）
...
Pickup_jig_001_14      → 運営仕様書（chara_jig_00501: ピックアップ）
```

- **レコード数**: 100レコード以上（2ガチャ × 50キャラ程度）
- **関連設計書数**: 4個（運営仕様書 + 4個のキャラ設計書）
- **レコード生成パターン**: 運営仕様書がガチャラインナップを定義、キャラ設計書が存在確認のみ
- **並列実行**: ✅ 可能（キャラデータは参照のみ）

---

### パターンC: 複数設計書 → 1レコード（後統合型）

**特徴**:
- 1レコードの完成に複数設計書が必要に見える
- しかし、実際は「主設計書1つ + 共通設計書（後から統合可能）」
- **共通設計書（ID管理、監修資料）は後から統合可能**

**該当テーブル**: 全てのテーブル（共通設計書の関与）

#### 共通設計書の役割

##### 1. GLOW_ID管理（79テーブルに影響）

**役割**: ID体系の統一管理
- イベントID: event_jig_00001
- キャラID: chara_jig_00401, chara_jig_00501, ...
- クエストID: quest_event_jig1_charaget01, ...
- ガチャID: Pickup_jig_001, Pickup_jig_002
- アイテムID: memory_chara_jig_00601, piece_jig_00401, ...
- etc.

**統合タイミング**:
- **最初にID管理シートを処理してIDマッピングを作成**
- 各設計書処理時にIDマッピングを参照
- または、各設計書が独自にIDを生成し、後で整合性確認

**並列実行への影響**: なし（IDマッピング作成は1回のみ、その後は並列実行可能）

##### 2. GLOW_キャラ名称＆キャラセリフ資料（23テーブルに影響）

**役割**: 全テキスト系カラムの監修・最終確認
- キャラ名（最大16文字制限）
- フレーバーテキスト（最大196文字制限）
- 必殺技名
- セリフ
- クエスト名
- etc.

**統合タイミング**:
- **各設計書が初期テキストを生成**
- **監修資料が最終テキストを提供（上書き可能）**
- 監修資料は各設計書のテキストを監修・修正する役割

**並列実行への影響**: なし（各設計書が初期テキストを生成、監修資料は後から統合）

#### 代表例: MstEvent

**MstEvent**（設計書数: 2個）:
```csv
id                → 生成元設計書
---------------------------------------------
event_jig_00001  → 運営仕様書（イベント基本情報） + ID管理（ID体系）
```

- **レコード数**: 1レコード
- **関連設計書数**: 2個（運営仕様書 + ID管理）
- **レコード生成パターン**:
  - 運営仕様書がイベント基本情報を提供
  - ID管理がイベントIDを提供
- **並列実行**: ✅ 可能（IDマッピング作成後は並列実行可能）

---

## 複数設計書が関わっているテーブルの詳細分析

### 設計書数2個のテーブル（23個）

| テーブル | 設計書数 | レコード生成パターン | 並列実行 |
|---------|---------|---------------------|---------|
| MstEvent | 2 | 運営仕様書 + ID管理 | ✅ 可能 |
| MstEventI18n | 2 | 運営仕様書 + 監修資料 | ✅ 可能 |
| MstAdventBattle | 2 | 降臨バトル設計書 + ID管理 | ✅ 可能 |
| MstAdventBattleI18n | 2 | 降臨バトル設計書 + 監修資料 | ✅ 可能 |
| MstArtwork | 2 | ストーリークエスト設計書 + ID管理 | ✅ 可能 |
| MstArtworkI18n | 2 | ストーリークエスト設計書 + 監修資料 | ✅ 可能 |
| MstArtworkFragment | 2 | ストーリークエスト設計書 + ID管理 | ✅ 可能 |
| MstArtworkFragmentI18n | 2 | ストーリークエスト設計書 + 監修資料 | ✅ 可能 |
| MstArtworkFragmentPosition | 2 | ストーリークエスト設計書 × 2 | ✅ 可能 |
| MstEmblem | 2 | 運営仕様書 + ID管理 | ✅ 可能 |
| MstEmblemI18n | 2 | 運営仕様書 + 監修資料 | ✅ 可能 |
| MstHomeBanner | 2 | 運営仕様書 + ID管理 | ✅ 可能 |
| MstInGameSpecialRule | 2 | ランクマッチ設計書 + クエスト設計書 | ✅ 可能 |
| MstMissionLimitedTerm | 2 | 運営仕様書 + 降臨バトル設計書 | ✅ 可能 |
| MstMissionLimitedTermI18n | 2 | 運営仕様書 + 監修資料 | ✅ 可能 |
| MstMissionReward | 2 | 運営仕様書（複数ミッション） | ✅ 可能 |
| MstPack | 2 | 運営仕様書（複数パック） | ✅ 可能 |
| MstPackI18n | 2 | 運営仕様書 + 監修資料 | ✅ 可能 |
| MstPvp | 2 | ランクマッチ設計書（複数シーズン） | ✅ 可能 |
| MstPvpI18n | 2 | ランクマッチ設計書 + 監修資料 | ✅ 可能 |
| MstStoreProduct | 2 | 運営仕様書（複数商品） | ✅ 可能 |
| MstStoreProductI18n | 2 | 運営仕様書 + 監修資料 | ✅ 可能 |
| MstUnitSpecificRankUp | 2 | キャラ設計書 × 2（イベント配布キャラのみ） | ✅ 可能 |

**パターン**:
- ほぼ全て「主設計書1 + 共通設計書1（ID管理 or 監修資料）」
- 各レコードは1つの主設計書から完結

### 設計書数3個のテーブル（3個）

| テーブル | 設計書数 | レコード生成パターン | 並列実行 |
|---------|---------|---------------------|---------|
| MstAdventBattleI18n | 3 | 降臨バトル設計書 + 運営仕様書 + 監修資料 | ✅ 可能 |
| MstArtwork | 3 | ストーリークエスト設計書 × 2 + 運営仕様書 | ✅ 可能 |
| MstArtworkI18n | 3 | ストーリークエスト設計書 × 2 + 監修資料 | ✅ 可能 |

**パターン**:
- 各レコードは1つの主設計書（ストーリークエスト設計書）から完結
- 運営仕様書と監修資料は後から統合可能

### 設計書数4個以上のテーブル（21個）

| テーブル | 設計書数 | レコード生成パターン | 並列実行 |
|---------|---------|---------------------|---------|
| MstAbility | 4 | 各レコードは1キャラ設計書から完結 | ✅ 可能 |
| MstAbilityI18n | 5 | 各レコードは1キャラ設計書 + 監修資料 | ✅ 可能 |
| MstAttack | 4 | 各レコードは1キャラ設計書から完結 | ✅ 可能 |
| MstAttackElement | 4 | 各レコードは1キャラ設計書から完結 | ✅ 可能 |
| MstAttackI18n | 5 | 各レコードは1キャラ設計書 + 監修資料 | ✅ 可能 |
| MstAutoPlayerSequence | 7 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstEnemyCharacter | 11 | 各レコードは1キャラ設計書から完結 | ✅ 可能 |
| MstEnemyCharacterI18n | 11 | 各レコードは1キャラ設計書 + 監修資料 | ✅ 可能 |
| MstEnemyStageParameter | 10 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstEnemyOutpost | 6 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstEventDisplayUnit | 9 | 各レコードは1設計書（クエストorキャラ）から完結 | ✅ 可能 |
| MstEventDisplayUnitI18n | 10 | 各レコードは1設計書 + 監修資料 | ✅ 可能 |
| MstInGame | 8 | 各レコードは1設計書（クエストorランクマッチ）から完結 | ✅ 可能 |
| MstInGameI18n | 8 | 各レコードは1設計書 + 監修資料 | ✅ 可能 |
| MstItem | 9 | 各レコードは1設計書（キャラorクエストor運営）から完結 | ✅ 可能 |
| MstItemI18n | 9 | 各レコードは1設計書 + 監修資料 | ✅ 可能 |
| MstKomaLine | 7 | 各レコードは1設計書（クエストorランクマッチ）から完結 | ✅ 可能 |
| MstMangaAnimation | 5 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstPage | 7 | 各レコードは1設計書（クエストorランクマッチ）から完結 | ✅ 可能 |
| MstQuest | 7 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstQuestI18n | 8 | 各レコードは1クエスト設計書 + 監修資料 | ✅ 可能 |
| MstQuestBonusUnit | 5 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstSpecialAttackI18n | 5 | 各レコードは1キャラ設計書 + 監修資料 | ✅ 可能 |
| MstSpeechBalloonI18n | 5 | 各レコードは1キャラ設計書 + 監修資料 | ✅ 可能 |
| MstStage | 5 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstStageI18n | 6 | 各レコードは1クエスト設計書 + 監修資料 | ✅ 可能 |
| MstStageEventReward | 6 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstStageEventSetting | 5 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstStageClearTimeReward | 6 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstStageEndCondition | 6 | 各レコードは1クエスト設計書から完結 | ✅ 可能 |
| MstUnit | 5 | 各レコードは1キャラ設計書から完結 | ✅ 可能 |
| MstUnitI18n | 5 | 各レコードは1キャラ設計書 + 監修資料 | ✅ 可能 |
| MstUnitAbility | 4 | 各レコードは1キャラ設計書から完結 | ✅ 可能 |
| OprGacha | 4 | 各レコードは運営仕様書から完結 | ✅ 可能 |
| OprGachaI18n | 4 | 各レコードは運営仕様書 + 監修資料 | ✅ 可能 |
| OprGachaPrize | 4 | 各レコードは運営仕様書から完結（キャラデータは参照のみ） | ✅ 可能 |
| OprGachaDisplayUnitI18n | 4 | 各レコードは運営仕様書 + 監修資料 | ✅ 可能 |
| OprProduct | 2 | 各レコードは運営仕様書から完結 | ✅ 可能 |
| OprProductI18n | 2 | 各レコードは運営仕様書 + 監修資料 | ✅ 可能 |

**パターン**:
- 全て「各レコードは1つの主設計書から完結」
- 複数設計書は「レコード間で異なる設計書」を意味する
- 共通設計書（ID管理、監修資料）は後から統合可能

---

## マスタデータ作成作業への示唆

### ✅ 推奨アプローチ: 完全並列実行

**理由**:
1. **99%以上のケースで「1レコード = 1主設計書」**
2. **共通設計書（ID管理、監修資料）は後から統合可能**
3. **レコード間に依存関係なし**

**作業手順**:

#### フェーズ1: 前処理（順次実行）
1. **GLOW_ID管理の処理**: IDマッピングファイルを作成
   - イベントID、キャラID、クエストID、アイテムIDなどのマッピング
   - 所要時間: 数分

2. **GLOW_キャラ名称＆キャラセリフ資料の処理**: テキストマッピングファイルを作成
   - キャラ名、フレーバーテキスト、セリフなどのマッピング
   - 所要時間: 数分

#### フェーズ2: 主設計書の並列処理（完全並列実行可能）

**グループ1: ヒーロー設計書（4設計書）**
- ヒーロー基礎設計_chara_jig_00401_賊王 亜左 弔兵衛
- ヒーロー基礎設計_chara_jig_00501_山田浅ェ門 桐馬
- ヒーロー基礎設計_chara_jig_00601_民谷 巌鉄斎
- ヒーロー基礎設計_chara_jig_00701_メイ

**生成テーブル**: MstUnit, MstUnitI18n, MstUnitAbility, MstAbility, MstAbilityI18n, MstAttack, MstAttackElement, MstAttackI18n, MstSpecialAttackI18n, MstSpeechBalloonI18n, MstEnemyCharacter, MstEnemyCharacterI18n, MstItem（メモリー・欠片）, MstItemI18n, MstEventDisplayUnit, MstEventDisplayUnitI18n（約19テーブル）

**並列実行**: ✅ **4設計書を4並列で実行可能**

---

**グループ2: クエスト設計書（6設計書）**
- 【1日1回】本能が告げている 危険だと
- 【ストーリー】必ず生きて帰る
- 【ストーリー】朱印の者たち
- 【チャレンジ】死罪人と首切り役人
- 【高難度】手負いの獣は恐ろしいぞ
- 【降臨バトル】まるで 悪夢を見ているようだ

**生成テーブル**: MstQuest, MstQuestI18n, MstStage, MstStageI18n, MstStageEventReward, MstStageEventSetting, MstStageClearTimeReward, MstStageEndCondition, MstInGame, MstInGameI18n, MstPage, MstKomaLine, MstEnemyOutpost, MstEnemyStageParameter, MstAutoPlayerSequence, MstMangaAnimation, MstQuestBonusUnit, MstArtwork, MstArtworkI18n, MstArtworkFragment, MstArtworkFragmentI18n, MstArtworkFragmentPosition, MstAdventBattle, MstAdventBattleI18n, MstEventBonusUnit（約25テーブル）

**並列実行**: ✅ **6設計書を6並列で実行可能**

---

**グループ3: 運営仕様書（1設計書）**
- 20260116_地獄楽 いいジャン祭_仕様書

**生成テーブル**: MstEvent, MstEventI18n, OprGacha, OprGachaI18n, OprGachaPrize, OprGachaUpper, OprGachaUseResource, OprGachaDisplayUnitI18n, MstMissionEvent, MstMissionEventI18n, MstMissionEventDependency, MstMissionEventDailyBonus, MstMissionEventDailyBonusSchedule, MstMissionLimitedTerm, MstMissionLimitedTermI18n, MstMissionReward, MstStoreProduct, MstStoreProductI18n, OprProduct, OprProductI18n, MstPack, MstPackI18n, MstPackContent, MstHomeBanner, MstEmblem, MstEmblemI18n（約60テーブル）

**並列実行**: ✅ **1設計書のみなので単独実行**

---

**グループ4: ランクマッチ設計書（1設計書）**
- GLOW_ランクマッチ開催仕様書

**生成テーブル**: MstPvp, MstPvpI18n, MstInGame（PVP用）, MstInGameI18n, MstInGameSpecialRule, MstInGameSpecialRuleUnitStatus, MstPage（PVP用）, MstKomaLine（約8テーブル）

**並列実行**: ✅ **1設計書のみなので単独実行**

---

#### フェーズ3: 統合・検証（順次実行）

1. **IDマッピングの検証**: 全テーブルのIDが正しくマッピングされているか確認
2. **テキストマッピングの統合**: 監修資料の最終テキストを反映
3. **整合性チェック**:
   - テーブル間の参照整合性確認（外部キー制約）
   - レコード数の確認
   - データの重複チェック
4. **推測値レポートの統合**: 各設計書から生成された推測値レポートを統合

---

### 並列実行の効果

**最大並列度**: 11並列（4キャラ設計書 + 6クエスト設計書 + 1運営仕様書）

**所要時間の短縮**:
- **順次実行の場合**: 13設計書 × 平均30分 = 6.5時間
- **並列実行の場合**: max(30分キャラ, 60分クエスト, 120分運営) + 前処理10分 + 統合30分 = **約2.5〜3時間**

**短縮率**: 約**60%短縮**（6.5時間 → 2.5時間）

---

## 依存関係の詳細

### 前提条件の依存関係

#### 1. ID管理の依存関係

**依存元**: ほぼ全テーブル（79テーブル）
**依存先**: GLOW_ID管理

**対処法**:
- **フェーズ1でIDマッピングファイルを作成**
- 各設計書処理時にIDマッピングを参照
- または、各設計書が独自にIDを生成し、後で整合性確認

**例**:
```json
// id_mapping.json
{
  "events": {
    "地獄楽いいジャン祭": "event_jig_00001"
  },
  "characters": {
    "賊王 亜左 弔兵衛": "chara_jig_00401",
    "山田浅ェ門 桐馬": "chara_jig_00501",
    "民谷 巌鉄斎": "chara_jig_00601",
    "メイ": "chara_jig_00701"
  },
  "quests": {
    "【1日1回】本能が告げている 危険だと": "quest_event_jig1_1day",
    "【ストーリー】必ず生きて帰る": "quest_event_jig1_charaget01",
    "【ストーリー】朱印の者たち": "quest_event_jig1_charaget02"
  }
}
```

#### 2. 監修資料の依存関係

**依存元**: 全I18nテーブル（23テーブル）
**依存先**: GLOW_キャラ名称＆キャラセリフ資料

**対処法**:
- **フェーズ1でテキストマッピングファイルを作成**
- 各設計書が初期テキストを生成
- **フェーズ3で監修資料の最終テキストを統合**（上書き）

**例**:
```json
// text_mapping.json
{
  "units": {
    "chara_jig_00401": {
      "name_ja": "賊王 亜左 弔兵衛",
      "description_ja": ""賊王"の呼び名で、伊予の山奥に賊の村をもつ傑士。...",
      "detail_ja": "必殺ワザで複数の相手を弱体化させつつ、体力も吸収するテクニカルキャラ!..."
    }
  },
  "special_attacks": {
    "chara_jig_00401_Special_0": {
      "name_ja": "強イモ弱イモ ゼンブダイジ"
    }
  }
}
```

### テーブル間の参照依存関係

#### パターン1: 同一設計書内の依存関係（問題なし）

**例**: MstUnit → MstUnitAbility → MstAbility
- 全て同じキャラ設計書から生成される
- **並列実行可能**（設計書内で順次生成）

#### パターン2: 異なる設計書間の参照（問題なし）

**例**: MstQuest → MstEvent
- MstQuest: クエスト設計書から生成
- MstEvent: 運営仕様書から生成
- **並列実行可能**（参照先のevent_idは既知）

**例**: MstQuestBonusUnit → MstUnit
- MstQuestBonusUnit: クエスト設計書から生成（特効キャラ指定）
- MstUnit: キャラ設計書から生成
- **並列実行可能**（参照先のunit_idは既知）

**例**: OprGachaPrize → MstUnit
- OprGachaPrize: 運営仕様書から生成（ガチャラインナップ）
- MstUnit: キャラ設計書から生成
- **並列実行可能**（参照先のunit_idは既知）

---

## 結論とまとめ

### 主要発見

1. **99%以上のケースで「1レコード = 1主設計書」パターン**
   - 各レコードは独立した設計書から生成される
   - レコード間に依存関係なし

2. **複数設計書が関わるテーブルの真の意味**
   - 「テーブル全体に複数設計書が関わる」のではなく
   - 「各レコードは異なる設計書から生成される」ことを意味する
   - 例: MstUnit（5設計書）= 4キャラ設計書 × 各1レコード + ID管理

3. **共通設計書（ID管理、監修資料）は後から統合可能**
   - ID管理: IDマッピングファイルを作成して参照
   - 監修資料: 各設計書が初期テキストを生成、後で最終テキストを統合

4. **マスタデータ作成作業は完全に並列実行可能**
   - 最大11並列（4キャラ + 6クエスト + 1運営仕様書）
   - 所要時間を約60%短縮可能（6.5時間 → 2.5時間）

### 推奨作業方針

#### ✅ 完全並列実行アプローチ

**フェーズ1: 前処理（10分）**
1. ID管理の処理 → IDマッピングファイル作成
2. 監修資料の処理 → テキストマッピングファイル作成

**フェーズ2: 主設計書の並列処理（2〜3時間）**
1. ヒーロー設計書 × 4（並列実行）
2. クエスト設計書 × 6（並列実行）
3. 運営仕様書 × 1（単独実行）
4. ランクマッチ設計書 × 1（単独実行）

**フェーズ3: 統合・検証（30分）**
1. IDマッピングの検証
2. テキストマッピングの統合
3. 整合性チェック
4. 推測値レポートの統合

---

## 補足: 例外ケースの分析

### 唯一の例外: MstEvent（複数設計書 → 1レコード）

**MstEvent**:
```csv
id                → 生成元設計書
---------------------------------------------
event_jig_00001  → 運営仕様書 + ID管理
```

**レコード数**: 1レコード
**設計書数**: 2個

**なぜ例外か**:
- 1レコードの完成に2つの設計書が必要
- しかし、ID管理は前処理で完了しているため、実際は1設計書で完結

**対処法**: ID管理を前処理で完了し、運営仕様書処理時にIDマッピングを参照

---

## 付録: テーブル別設計書数の完全リスト

### 設計書数1個のテーブル（4個）

| テーブル | 設計書数 |
|---------|---------|
| MstAdventBattleClearReward | 1 |
| MstAdventBattleRank | 1 |
| MstEventBonusUnit | 1 |
| MstQuestEventBonusSchedule | 1 |
| MstSpecialRoleLevelUpAttackElement | 1 |
| OprGachaUpper | 1 |
| OprGachaUseResource | 1 |
| MstInGameSpecialRuleUnitStatus | 1 |
| MstAdventBattleReward | 1 |
| MstAdventBattleRewardGroup | 1 |
| MstMissionEventDailyBonus | 1 |
| MstMissionEventDailyBonusSchedule | 1 |
| MstMissionEventDependency | 1 |
| MstPackContent | 1 |

### 設計書数2個のテーブル（23個）

（上記の表を参照）

### 設計書数3個のテーブル（3個）

（上記の表を参照）

### 設計書数4個のテーブル（7個）

| テーブル | 設計書数 |
|---------|---------|
| MstAbility | 4 |
| MstAttack | 4 |
| MstAttackElement | 4 |
| MstUnitAbility | 4 |
| OprGachaPrize | 4 |

### 設計書数5個以上のテーブル（42個）

（上記の表を参照）

---

## まとめ

リリースキー202601010のマスタデータについて、「1レコード完成に必要な設計書数」という観点から分析した結果、**99%以上のケースで「1レコード = 1主設計書」パターン**であることが判明しました。

複数設計書が関わっているように見えるテーブルも、実際には**各レコードは1つの主設計書から完結し、並列実行可能**です。共通設計書（ID管理、監修資料）は後から統合可能なため、マスタデータ作成作業を**完全に並列実行**することができます。

この知見により、マスタデータ作成作業の所要時間を約**60%短縮**（6.5時間 → 2.5時間）できることが期待されます。

---

**作成日**: 2026-02-12
**分析対象**: リリースキー202601010（地獄楽いいジャン祭）
**対象テーブル数**: 79テーブル
**対象設計書数**: 15設計書
