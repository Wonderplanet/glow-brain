# スキルテンプレート（SKILL.md）

## テンプレート構造

以下のテンプレートを使用して、各機能グループのSKILL.mdを作成します。

---

```markdown
---
name: masterdata-from-bizops-{機能名ケバブケース}
description: {機能名}の運営仕様書からマスタデータCSVを作成するスキル。対象テーブル: {テーブル数}個（{主要テーブル名1}, {主要テーブル名2}, {主要テーブル名3}等）。{機能の簡潔な説明1文}。
---

# {機能名表示名} マスタデータ作成スキル

## 概要

{機能名表示名}の運営仕様書からマスタデータCSVを作成します。設計書に記載された情報を元に、DB投入可能な形式のマスタデータを自動生成し、推測で決定した値は必ずレポートします。

### 作成対象テーブル

以下の{テーブル数}テーブルを自動生成:

**{グループ1名}**:
- **{テーブル1}** - {役割説明}
- **{テーブル2}** - {役割説明}

**{グループ2名}**:
- **{テーブル3}** - {役割説明}
- **{テーブル4}** - {役割説明}

（条件付きテーブルがある場合）
**条件付き**:
- **{テーブルN}** - {条件説明}（{条件}の場合のみ作成）

## 基本的な使い方

### 必須パラメータ

以下のパラメータを指定してください:

| パラメータ名 | 説明 | 例 |
|------------|------|-----|
| **release_key** | リリースキー | `202601010` |
| **mst_series_id** | シリーズID（jig/osh/kai/glo） | `jig` |
| **{パラメータ1}** | {説明} | `{例}` |
| **{パラメータ2}** | {説明} | `{例}` |

### 実行方法

運営仕様書ファイルを添付して、以下のプロンプトを実行してください:

```
{機能名表示名}の運営仕様書からマスタデータを作成してください。

添付ファイル:
- {設計書ファイル名例}

パラメータ:
- release_key: 202601010
- mst_series_id: jig
- {パラメータ1}: {値1}
- {パラメータ2}: {値2}
```

## ワークフロー

### Step 1: 仕様書の読み込み

運営仕様書から以下の情報を抽出します:

**必須情報**:
- {抽出情報1}
- {抽出情報2}
- {抽出情報3}

**任意情報**:
- {抽出情報4}（記載がない場合は推測）
- {抽出情報5}（記載がない場合はデフォルト値）

### Step 2: マスタデータ生成

詳細ルールは [references/manual.md](references/manual.md) を参照し、以下のテーブルを作成します:

1. **{テーブル1}** - {簡潔な役割}
2. **{テーブル2}** - {簡潔な役割}
3. **{テーブル3}** - {簡潔な役割}
...

#### ID採番ルール

{機能名}のIDは以下の形式で採番します:

```
{ID形式1}: {ルール説明}
{ID形式2}: {ルール説明}
```

**例**:
```
{ID例1}
{ID例2}
```

### Step 3: データ整合性チェック

以下の項目を自動確認し、問題があれば修正します:

- [ ] ヘッダーの列順が正しいか
- [ ] すべてのIDが一意であるか
- [ ] ID採番ルールに従っているか
- [ ] リレーションが正しく設定されているか
- [ ] enum値が正確に一致しているか
- [ ] {機能特有のチェック項目1}
- [ ] {機能特有のチェック項目2}

### Step 4: 推測値レポート

設計書に記載がなく、推測で決定した値を必ずレポートします。

**推測値の例**:
- `{テーブル名}.{カラム名}`: {推測理由}
- `{テーブル名}.{カラム名}`: {推測理由}

### Step 5: 出力

以下の形式で出力します:

#### 1. マスタデータ（Markdown表形式）

- スプレッドシートへのエクスポート・コピーボタンが正常に表示される形式
- 以下の{テーブル数}シートを作成:
  1. {テーブル1}
  2. {テーブル2}
  3. {テーブル3}
  ...

#### 2. 推測値レポート（必須）

作成したデータのうち、以下に該当するものを必ずレポートします:

- **添付ファイルにも手順書にも記載がなく、推測で決定したID値やパラメータ値**
- 手順書通りに作成したID値は対象外

**レポート形式:**
```
## 推測値レポート

### {テーブル名}.{カラム名}
- 値: {設定した値}
- 理由: {推測した根拠}
- 確認事項: {ユーザーが確認すべき内容}
```

**重要**: このレポートを怠ると、データインポートエラーや本番不具合のリスクが高まります。推測で決定した値は必ず報告してください。

## 出力例

### {テーブル1} シート

| ENABLE | {カラム1} | {カラム2} | {カラム3} | ... |
|--------|---------|---------|---------|-----|
| e | {値1} | {値2} | {値3} | ... |
| e | {値1} | {値2} | {値3} | ... |

### {テーブル2} シート

| ENABLE | {カラム1} | {カラム2} | {カラム3} | ... |
|--------|---------|---------|---------|-----|
| e | {値1} | {値2} | {値3} | ... |

### 推測値レポート

#### {テーブル名}.{カラム名}
- **値**: {設定した値}
- **理由**: {推測した根拠}
- **確認事項**: {ユーザーが確認すべき内容}

## 注意事項

### {注意事項カテゴリ1}について

{詳細説明}

**ポイント**:
- {ポイント1}
- {ポイント2}

### {注意事項カテゴリ2}について

{詳細説明}

**例**:
```
{例示コード・データ}
```

### {注意事項カテゴリ3}について

{詳細説明}

### 外部キー整合性について

以下のリレーションが正しく設定されていることを必ず確認してください:
- `{親テーブル}.{カラム}` → `{子テーブル}.{カラム}`
- `{親テーブル}.{カラム}` → `{子テーブル}.{カラム}`

## リファレンス

詳細なルールとenum値一覧:

- **[詳細手順書](references/manual.md)** - テーブル定義、カラム設定ルール、ID採番ルール、enum値一覧
- **[サンプル出力](examples/sample-output.md)** - 実際の出力例

## トラブルシューティング

### Q1: {よくある問題1のタイトル}

**エラー**:
```
{エラーメッセージ例}
```

**対処法**:
1. {対処ステップ1}
2. {対処ステップ2}

### Q2: {よくある問題2のタイトル}

**原因**: {原因説明}

**対処法**:
{対処方法}

### Q3: {よくある問題3のタイトル}

**対処法**:
- {対処方法1}
- {対処方法2}

## 検証

作成したマスタデータCSVは、`masterdata-csv-validator` スキルで検証できます:

```bash
python .claude/skills/masterdata-csv-validator/scripts/validate_all.py \
  --csv {作成したCSVファイルパス}
```

詳細は [masterdata-csv-validator](../../masterdata-csv-validator/SKILL.md) を参照してください。
```

---

## テンプレート使用例（ガチャ）

以下は、ガチャ機能グループでテンプレートを具体化した例です:

```markdown
---
name: masterdata-from-bizops-gacha
description: ガチャの運営仕様書からマスタデータCSVを作成するスキル。対象テーブル: 6個（OprGacha, OprGachaI18n, OprGachaPrize, OprGachaUpper, OprGachaUseResource, OprGachaDisplayUnitI18n）。ピックアップガチャ、プレミアムガチャ等のマスタデータを精度高く作成します。
---

# ガチャ マスタデータ作成スキル

## 概要

ガチャの運営仕様書からマスタデータCSVを作成します。設計書に記載された情報を元に、DB投入可能な形式のマスタデータを自動生成し、推測で決定した値は必ずレポートします。

### 作成対象テーブル

以下の6テーブルを自動生成:

**ガチャ基本情報**:
- **OprGacha** - ガチャの基本設定（タイプ、天井、期間、10連設定等）
- **OprGachaI18n** - ガチャ名・説明文（多言語対応）

**ガチャ排出内容**:
- **OprGachaPrize** - ガチャ排出内容（排出キャラ、重み、ピックアップ設定）
- **OprGachaUpper** - ガチャ天井設定（回数、タイプ）

**ガチャコスト**:
- **OprGachaUseResource** - ガチャ実行コスト（ダイヤ、チケット等）

**ガチャ表示**:
- **OprGachaDisplayUnitI18n** - ガチャ画面表示キャラの説明文（多言語対応）

## 基本的な使い方

### 必須パラメータ

以下のパラメータを指定してください:

| パラメータ名 | 説明 | 例 |
|------------|------|-----|
| **release_key** | リリースキー | `202601010` |
| **mst_series_id** | シリーズID（jig/osh/kai/glo） | `jig` |
| **opr_gacha_id** | ガチャID | `Pickup_jig_001` |
| **gacha_name** | ガチャ名 | `地獄楽 いいジャン祭ピックアップガシャ A` |
| **gacha_type** | ガチャタイプ | `Pickup`（Pickup/Premium/Free等） |
| **start_at** | 開催開始日時 | `2026-01-16 12:00:00` |
| **end_at** | 開催終了日時 | `2026-02-16 10:59:59` |
| **upper_count** | 天井回数 | `100` |
| **multi_draw_count** | N連数 | `10` |
| **multi_fixed_prize_count** | N連確定枠数 | `1` |
| **pickup_unit_ids** | ピックアップキャラID（カンマ区切り） | `chara_jig_00401,chara_jig_00501` |

### 実行方法

運営仕様書ファイルを添付して、以下のプロンプトを実行してください:

```
ガチャの運営仕様書からマスタデータを作成してください。

添付ファイル:
- ガチャ設計書_地獄楽_いいジャン祭.xlsx

パラメータ:
- release_key: 202601010
- mst_series_id: jig
- opr_gacha_id: Pickup_jig_001
- gacha_name: 地獄楽 いいジャン祭ピックアップガシャ A
- gacha_type: Pickup
- start_at: 2026-01-16 12:00:00
- end_at: 2026-02-16 10:59:59
- upper_count: 100
- multi_draw_count: 10
- multi_fixed_prize_count: 1
- pickup_unit_ids: chara_jig_00401,chara_jig_00501
```

（以下、ワークフロー、出力例、注意事項等が続く）
```

---

## テンプレートのカスタマイズポイント

### 機能別に変更が必要な箇所

| セクション | 変更内容 |
|-----------|---------|
| **YAMLフロントマター** | name, descriptionを機能に応じて変更 |
| **作成対象テーブル** | 対象テーブル一覧を列挙 |
| **必須パラメータ** | 機能特有のパラメータを追加 |
| **ワークフロー → 抽出情報** | 設計書から抽出する情報を列挙 |
| **ワークフロー → ID採番ルール** | 機能特有のID採番ルールを記載 |
| **ワークフロー → チェック項目** | 機能特有のチェック項目を追加 |
| **推測値の例** | 機能特有の推測値を列挙 |
| **注意事項** | 機能特有の注意事項を記載 |
| **トラブルシューティング** | 機能特有のよくある問題を記載 |

### 共通で維持すべき構造

以下の構造は全スキルで共通です:

- YAMLフロントマター形式
- 概要 → 基本的な使い方 → ワークフロー → 出力例 → 注意事項 → リファレンス → トラブルシューティング の階層
- 推測値レポートの必須化
- データ整合性チェックの実施
- references/manual.md への参照
- masterdata-csv-validator スキルとの連携

## 変換スクリプト（参考）

既存の手順書からSKILL.mdを自動生成するスクリプトの疑似コード:

```python
def convert_manual_to_skill(manual_path, prompt_path, output_dir):
    """
    既存の手順書とプロンプトをスキル形式に変換
    """
    # 1. プロンプト.mdから情報を抽出
    prompt = parse_markdown(prompt_path)
    params = extract_parameters(prompt)
    output_format = extract_output_format(prompt)
    notes = extract_notes(prompt)

    # 2. マスタデータ設定手順書.mdをreferences/manual.mdにコピー
    copy_file(manual_path, f"{output_dir}/references/manual.md")

    # 3. テンプレートを読み込み
    template = load_template("skill-template.md")

    # 4. テンプレートに情報を埋め込み
    skill_md = template.format(
        name=extract_name(manual_path),
        description=generate_description(manual_path),
        tables=extract_tables(manual_path),
        params=params,
        output_format=output_format,
        notes=notes,
        # ... 他のプレースホルダー
    )

    # 5. SKILL.mdを出力
    write_file(f"{output_dir}/SKILL.md", skill_md)
```

## まとめ

このテンプレートを使用することで、既存の手順書を効率的にClaude Codeスキル形式に変換できます。

**重要なポイント**:
1. 既存の手順書（`{機能名}_マスタデータ設定手順書.md`）は `references/manual.md` にほぼそのまま移植
2. 既存のプロンプト（`{機能名}_プロンプト.md`）の内容をSKILL.mdの各セクションに分割統合
3. 推測値レポートの必須化により、データ品質リスクを明確化
4. masterdata-csv-validatorスキルとの連携により、2ステップで高品質なマスタデータを作成
