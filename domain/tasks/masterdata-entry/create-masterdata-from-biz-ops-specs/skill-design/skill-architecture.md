# マスタデータ作成スキルの設計アーキテクチャ

## 概要

既存の手順書（`{機能名}_マスタデータ設定手順書.md` + `{機能名}_プロンプト.md`）をClaude Code スキル形式に統合し、ユーザーが運営仕様書を渡すだけで高精度なマスタデータCSVを作成できる仕組みを構築します。

## 現状分析

### 既存の手順書構成

現在、12グループの機能別手順書が完成しており、各グループには以下の2ファイルが存在します:

```
manuals/{機能名}/
├── {機能名}_マスタデータ設定手順書.md  # 詳細な作成ルール（15KB～45KB）
└── {機能名}_プロンプト.md              # ユーザー向け入力仕様（6KB～16KB）
```

#### マスタデータ設定手順書.mdの特徴

- **目的**: マスタデータ作成の詳細ルールを記載
- **内容**:
  - 対象テーブル一覧
  - テーブルごとのシートスキーマ（カラム定義）
  - 各カラムの設定ルール
  - ID採番ルール
  - enum値一覧
  - データ整合性チェックリスト
  - 作成例
- **サイズ**: 15KB～45KB（詳細度が高い）

#### プロンプト.mdの特徴

- **目的**: ユーザーがマスタデータ作成を依頼する際の入力仕様
- **内容**:
  - 作業内容（手順書への参照）
  - 入力パラメータ一覧
  - 出力形式の指示
  - 推測値レポートの要求
  - 注意事項（簡潔版）
- **サイズ**: 6KB～16KB（簡潔）

### 既存のスキル例（masterdata-csv-validator）

`masterdata-csv-validator` スキルの構造を参考にします:

```markdown
---
name: masterdata-csv-validator
description: GLOWマスタデータCSVの検証スキル...
---

# GLOWマスタデータCSV検証スキル

## 概要
（スキルの目的・機能）

## 基本的な使い方
（コマンド例）

## ワークフロー
（ステップバイステップの手順）

## トラブルシューティング
（よくある問題と解決方法）

## 注意事項
（重要な制約・前提条件）
```

**ポイント**:
- YAMLフロントマター（name, description）
- 階層的な構造（概要→使い方→ワークフロー→トラブルシューティング）
- コマンド例とサンプル出力
- 実行可能なスクリプトへの参照（`scripts/`ディレクトリ）

## スキル設計方針

### 基本アプローチ

既存の手順書を**そのまま活用**しつつ、Claude Code スキルとして**ユーザビリティを向上**させる方針を採用します。

#### 採用する構造

```
.claude/skills/masterdata-from-bizops-{機能名}/
├── SKILL.md                     # スキルファイル（統合版）
├── references/
│   └── manual.md                # 詳細手順書（既存の手順書を移植）
└── examples/
    └── sample-output.md         # サンプル出力
```

#### SKILL.mdの役割

- ユーザーが実行する際の**エントリーポイント**
- 簡潔な使い方とワークフローを記載
- 詳細ルールは `references/manual.md` に委譲

#### references/manual.mdの役割

- 既存の `{機能名}_マスタデータ設定手順書.md` をほぼそのまま移植
- Claude Codeが実際にデータを作成する際に参照する**詳細なルールブック**

### 既存プロンプト.mdの統合方針

既存の `{機能名}_プロンプト.md` の内容を以下のように分割して統合します:

| プロンプト.mdの要素 | 統合先 | 理由 |
|------------------|-------|------|
| **作業内容** | SKILL.md「概要」 | スキルの目的として記載 |
| **入力パラメータ** | SKILL.md「基本的な使い方」 | ユーザーが指定する項目 |
| **出力形式** | SKILL.md「ワークフロー」 | 期待される出力内容 |
| **推測値レポート** | SKILL.md「ワークフロー」 | データ品質管理の一環 |
| **注意事項** | SKILL.md「注意事項」 | ユーザーへの重要な伝達事項 |
| **詳細ルール** | references/manual.md | Claude Codeが参照する詳細ルール |

### YAMLフロントマターの設計

各スキルのYAMLフロントマターは以下の形式を採用します:

```yaml
---
name: masterdata-from-bizops-{機能名}
description: {機能名}の運営仕様書からマスタデータCSVを作成するスキル。対象テーブル: {テーブル数}個（{テーブル名1}, {テーブル名2}等）。
---
```

**ポイント**:
- name: `masterdata-from-bizops-{機能名}` の形式で統一
- description: 対象テーブル数とテーブル名を明記（検索性向上）

## スキルテンプレート構造

### SKILL.mdの構成

```markdown
---
name: masterdata-from-bizops-{機能名}
description: {機能名}の運営仕様書からマスタデータCSVを作成するスキル...
---

# {機能名} マスタデータ作成スキル

## 概要

{機能名}の運営仕様書からマスタデータCSVを作成します。
以下のテーブルを自動生成:
- {テーブル1}
- {テーブル2}
- ...

## 基本的な使い方

### 必須パラメータ

- `release_key`: リリースキー（例: 202601010）
- `mst_series_id`: シリーズID（例: jig、osh、kai）
- {機能特有のパラメータ1}
- {機能特有のパラメータ2}

### 実行方法

```bash
# スキルを実行
/{機能名}-masterdata {仕様書ファイルパス} \
  --release-key 202601010 \
  --series-id jig \
  --{パラメータ1} {値1} \
  --{パラメータ2} {値2}
```

または、運営仕様書を添付して以下のプロンプトを実行:

```
{機能名}の運営仕様書からマスタデータを作成してください。

- release_key: 202601010
- mst_series_id: jig
- {パラメータ1}: {値1}
- {パラメータ2}: {値2}
```

## ワークフロー

### Step 1: 仕様書の読み込み

運営仕様書から以下の情報を抽出します:
- {抽出情報1}
- {抽出情報2}
- ...

### Step 2: マスタデータ生成

詳細ルールは `references/manual.md` を参照し、以下のテーブルを作成します:
- {テーブル1}: {役割}
- {テーブル2}: {役割}
- ...

### Step 3: データ整合性チェック

以下の項目を自動確認:
- [ ] ヘッダーの列順が正しいか
- [ ] IDの一意性
- [ ] リレーションの整合性
- [ ] enum値の正確性

### Step 4: 推測値レポート

設計書に記載がなく推測で決定した値を報告します:
- {推測値の例1}
- {推測値の例2}

### Step 5: 出力

以下の形式で出力します:
1. **マスタデータ（Markdown表形式）** - スプレッドシートにコピー可能
2. **推測値レポート** - ユーザーが確認すべき推測値のリスト

## 出力例

### マスタデータ（Markdown表形式）

（サンプル表を記載）

### 推測値レポート

（サンプルレポートを記載）

## 注意事項

- {注意事項1}
- {注意事項2}
- ...

## リファレンス

詳細なルールとenum値一覧:
- [詳細手順書](references/manual.md)
- [サンプル出力](examples/sample-output.md)

## トラブルシューティング

### Q1: {よくある問題1}

**対処法**: {解決方法1}

### Q2: {よくある問題2}

**対処法**: {解決方法2}
```

### references/manual.mdの構成

既存の `{機能名}_マスタデータ設定手順書.md` をほぼそのまま移植します。

```markdown
# {機能名} マスタデータ設定手順書

## 概要

（既存の手順書の「概要」をそのまま移植）

## 対象テーブル

（既存の手順書の「対象テーブル」をそのまま移植）

## 作成フロー

（既存の手順書の「作成フロー」をそのまま移植）

### 1. 仕様書の確認

（既存の手順書をそのまま移植）

### 2. {テーブル1} シートの作成

#### 2.1 シートスキーマ

（既存の手順書をそのまま移植）

#### 2.2 各カラムの設定ルール

（既存の手順書をそのまま移植）

...

## データ整合性のチェック

（既存の手順書をそのまま移植）
```

**ポイント**:
- 既存の手順書の構造を維持
- Claude Codeが参照する際に必要な詳細情報を保持
- ユーザーには直接見せず、スキル実行時に内部で参照

## 推測値レポートの設計

### 推測値レポートの目的

- 設計書に明記されていない値を推測で決定した場合、必ずユーザーに報告
- データ品質リスクを明確化
- ユーザーが確認・修正すべき箇所を明示

### レポート形式

```markdown
## 推測値レポート

### {テーブル名}.{カラム名}
- **値**: {設定した値}
- **理由**: {推測した根拠}
- **確認事項**: {ユーザーが確認すべき内容}

（例）

### OprGacha.display_information_id
- **値**: 84b93bca-1b92-42df-9d6e-3a593fa76a69（仮UUID）
- **理由**: 設計書にStrapi管理IDの記載がなかったため、仮のUUIDを生成
- **確認事項**: Strapiで該当のガチャ情報を作成し、正しいUUIDに差し替えてください
```

### 推測値の例（機能別）

#### ガチャ

- `OprGacha.display_information_id`: Strapi管理UUID（仮設定）
- `OprGacha.gacha_priority`: 表示優先度（推測値）
- `OprGachaPrize.weight`: 排出重み（レアリティから計算）
- `OprGachaI18n.description`: ガチャ説明文（推測値）

#### ヒーロー

- `MstUnit.summon_cost`: レアリティからの推測値
- `MstUnit.special_attack_initial_cool_time`: 設計書に記載なく推測
- `MstAttack.action_frames`: 設計書に記載なく推測
- `MstUnitAbility.ability_parameter1/2/3`: 設計書に記載なく推測

## スキル命名規則

各機能グループに対して、以下の命名規則でスキルを作成します:

| 機能グループ | スキル名 | 対象テーブル数 |
|------------|---------|--------------|
| ヒーロー（ユニット） | `masterdata-from-bizops-hero` | 13 |
| クエスト・ステージ | `masterdata-from-bizops-quest-stage` | 10 |
| 降臨バトル | `masterdata-from-bizops-advent-battle` | 7 |
| ミッション | `masterdata-from-bizops-mission` | 8 |
| ガチャ | `masterdata-from-bizops-gacha` | 6 |
| アイテム・報酬 | `masterdata-from-bizops-item-reward` | 3 |
| PVP | `masterdata-from-bizops-pvp` | 2 |
| イベント基本設定 | `masterdata-from-bizops-event-basic` | 3 |
| ショップ・パック | `masterdata-from-bizops-shop-pack` | 7 |
| 原画・エンブレム | `masterdata-from-bizops-artwork-emblem` | 7 |
| 敵・自動行動 | `masterdata-from-bizops-enemy-autoplayer` | 5 |
| インゲーム | `masterdata-from-bizops-ingame` | 7 |

**命名パターン**: `masterdata-from-bizops-{機能名ケバブケース}`

## 検証スキルとの連携

作成したマスタデータは、既存の `masterdata-csv-validator` スキルで検証できます:

```bash
# マスタデータ作成
/gacha-masterdata gacha_spec.xlsx --release-key 202601010 --series-id jig

# 検証
/masterdata-csv-validator OprGacha.csv
```

この2ステップのワークフローで、高品質なマスタデータを確実に作成できます。

## スキル作成の優先順位

12グループすべてのスキルを一度に作成するのではなく、以下の優先順位で段階的に作成します:

### フェーズ1: 高頻度グループ（優先度高）

1. **ガチャ** - 最も使用頻度が高い
2. **ヒーロー（ユニット）** - 新規キャラ追加で頻繁に使用
3. **ミッション** - イベントごとに作成

### フェーズ2: 中頻度グループ（優先度中）

4. **クエスト・ステージ** - イベントごとに作成
5. **アイテム・報酬** - 新規アイテム追加時
6. **イベント基本設定** - イベントごとに作成

### フェーズ3: 低頻度グループ（優先度低）

7. **降臨バトル** - 特定イベントのみ
8. **PVP** - シーズンごと
9. **ショップ・パック** - 施策ごと
10. **原画・エンブレム** - 新規コンテンツ追加時
11. **敵・自動行動** - 新規敵キャラ追加時
12. **インゲーム** - 新規マンガアニメーション追加時

## 変換手順の概要

既存の手順書をスキル形式に変換する手順は以下の通りです:

### ステップ1: ディレクトリ作成

```bash
mkdir -p .claude/skills/masterdata-from-bizops-{機能名}/references
mkdir -p .claude/skills/masterdata-from-bizops-{機能名}/examples
```

### ステップ2: references/manual.md作成

既存の `{機能名}_マスタデータ設定手順書.md` をコピー:

```bash
cp manuals/{機能名}/{機能名}_マスタデータ設定手順書.md \
   .claude/skills/masterdata-from-bizops-{機能名}/references/manual.md
```

### ステップ3: SKILL.md作成

テンプレートを使用してSKILL.mdを作成:
- 既存の `{機能名}_プロンプト.md` の内容を統合
- YAMLフロントマターを追加
- ワークフローセクションを整備
- references/manual.mdへの参照を追加

### ステップ4: examples/sample-output.md作成

実際の出力例を記載:
- サンプルのMarkdown表
- 推測値レポートのサンプル

### ステップ5: 検証

作成したスキルを実際に実行して動作確認:
1. 既存の設計書を使用してマスタデータを生成
2. 出力内容が期待通りか確認
3. 推測値レポートが適切に生成されているか確認

## まとめ

### 設計の要点

1. **既存の手順書を最大限活用** - `references/manual.md` にほぼそのまま移植
2. **ユーザビリティを向上** - SKILL.md で簡潔な使い方を提供
3. **段階的な展開** - 優先度の高いグループから順次スキル化
4. **推測値レポートの徹底** - データ品質リスクを明確化
5. **検証スキルとの連携** - 2ステップワークフローで品質保証

### 次のステップ

1. **スキルテンプレートの作成** - `skill-template.md` で具体的なテンプレートを提供
2. **ガチャスキルの開発** - 最優先グループのスキル実装
3. **全機能スキル作成ロードマップの策定** - 12グループすべてのスキル作成計画
