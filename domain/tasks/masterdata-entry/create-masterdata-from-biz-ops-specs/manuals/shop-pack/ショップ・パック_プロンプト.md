# ショップ・パックマスタデータ作成プロンプト

## 作業内容

手順書（ショップ・パック_マスタデータ設定手順書.md）に従って、
添付した運営仕様書からショップ・パックのマスタデータを作成してください。
運営仕様書: {ファイル名を指定}

新規リソース情報など、データ作成に必要な追加情報があれば、追加情報ファイルとして追加します。
追加情報ファイル:
- {追加ファイル1}
- {追加ファイル2}

## 入力パラメータ

- release_key: {release_keyを指定}
- event_name: {イベント名を指定（例: 地獄楽 いいジャン祭）}
- sale_period_start: {販売開始日時（例: 2026-01-16 15:00:00）}
- sale_period_end: {販売終了日時（例: 2026-02-02 10:59:59）}

## 出力形式

### 1. マスタデータ

- 手順書の「データ整合性のチェック」を満たしたデータになっていることを必ずチェックし、問題があれば修正完了してから出力する
- Markdown表形式で出力（スプレッドシートへのエクスポート・コピーボタンが正常に表示される形式）
- 以下の7シート構成で作成:
  1. MstStoreProduct
  2. MstStoreProductI18n
  3. OprProduct
  4. OprProductI18n
  5. MstPack（product_type=Packの場合のみ）
  6. MstPackI18n（product_type=Packの場合のみ）
  7. MstPackContent（product_type=Packの場合のみ）

### 2. 推測値レポート（必須）

作成したデータのうち、以下に該当するものを必ずレポートしてください：

- **添付ファイルにも手順書にも記載がなく、推測で決定したID値やパラメータ値**
- 手順書通りに作成したID値は対象外

**レポート形式:**
```
## 推測値レポート

### [テーブル名].[カラム名]
- 値: [設定した値]
- 理由: [推測した根拠]
- 確認事項: [ユーザーが確認すべき内容]
```

**推測値の例**:
- MstStoreProduct.id: 連番採番の推測値
- MstStoreProduct.product_id_ios: プロダクトIDの推測値
- MstStoreProduct.product_id_android: プロダクトIDの推測値
- MstPack.id: パックIDの推測値
- MstPack.asset_key: アセットキーの推測値
- MstPackContent.id: 連番採番の推測値
- MstPackContent.display_order: 表示順序の推測値
- OprProduct.display_priority: 表示優先度の推測値

**重要:** このレポートを怠ると、データインポートエラーや本番不具合のリスクが高まります。推測で決定した値は必ず報告してください。

## 注意事項

### プラットフォームプロダクトIDについて

MstStoreProductのプロダクトID（product_id_ios、product_id_android）は、**一度定義したら変更できません**（リストア機能のため）。

**命名規則**:
- iOS: `BNEI0434_XXXX`（XXXXは4桁の連番）
- Android: `com.bandainamcoent.jumble_XXXX`（XXXXは4桁の連番）

既存のプロダクトIDを確認し、重複しない番号を採番してください。

### 商品タイプによる分岐

OprProduct.product_typeの値によって、作成するテーブルが異なります：

- **Pack**: MstPack、MstPackI18n、MstPackContentを作成
- **Diamond**: MstPackは作成不要（ダイヤ購入のみ）
- **Pass**: MstPackは作成不要（MstShopPassを使用）

### 価格管理の分離

- **課金商品（cost_type=Cash）の価格**: MstStoreProductI18nで管理
  - MstPack.cost_amount = 0
- **ダイヤ商品（cost_type=Diamond）のコスト**: MstPackで管理
  - MstPack.cost_amount = ダイヤ数量

### パック内容物の設定

MstPackContentは、パックに含まれるアイテムを設定します。

**resource_typeとresource_idの対応**:
- `FreeDiamond`: resource_id不要（空欄）
- `Coin`: resource_id不要（空欄）
- `Item`: resource_id = MstItem.id（例: `memoryfragment_glo_00001`、`ticket_glo_00003`）
- `Unit`: resource_id = MstUnit.id（例: `chara_jig_00401`）

**display_order**:
- 数字が大きいほど上に表示される
- 重要なアイテムほど大きい数字を設定

### 販売期間の設定

OprProduct.start_dateとend_dateは、以下の点に注意してください：

- 形式: `YYYY-MM-DD HH:MM:SS`
- start_date < end_date
- イベント期間と整合性がとれているか確認

### I18n設定について

各I18nテーブルは、最低でも日本語（ja）を設定してください。

**MstPackI18n.name**:
- パック名を設定
- 改行が必要な場合は`\n`を使用
- 例: `【お一人様1回まで購入可】\nいいジャン祭 開催記念パック`

### 外部キー整合性について

以下のリレーションが正しく設定されていることを必ず確認してください：
- MstStoreProductI18n.mst_store_product_id → MstStoreProduct.id
- OprProduct.mst_store_product_id → MstStoreProduct.id
- OprProductI18n.opr_product_id → OprProduct.id
- MstPack.product_sub_id → OprProduct.id
- MstPackI18n.mst_pack_id → MstPack.id
- MstPackContent.mst_pack_id → MstPack.id
- MstPackContent.resource_id → MstItem.id（resource_type=Itemの場合）

### 割引率の計算

MstPack.discount_rateは、以下のように計算します：

```
割引率(%) = (通常価格 - 割引後価格) / 通常価格 × 100
```

例:
- 通常価格: 5000円相当、割引後価格: 3000円
- 割引率 = (5000 - 3000) / 5000 × 100 = 40%

### 購入制限について

- **OprProduct.purchasable_count**: 購入可能回数
  - `1`: 1回限り
  - `0`または空欄: 無制限
- **MstPack.tradable_count**: 交換可能個数
  - `0`: 無制限
  - `1`以上: 制限あり

### 表示優先度について

OprProduct.display_priorityは、ショップ画面での表示順序を決定します：

- 数字が大きいほど上に表示される
- 通常は100番台、10番台などに分類される
- 例: 18（パック商品）、106（ダイヤ商品・最上位）

## データ作成の流れ

1. **MstStoreProduct作成**: プラットフォームプロダクトIDを決定
2. **MstStoreProductI18n作成**: 価格情報を設定
3. **OprProduct作成**: 販売期間・優先度を設定
4. **OprProductI18n作成**: アセットキーを設定
5. **MstPack作成**（product_type=Packの場合）: パック基本設定
6. **MstPackI18n作成**（product_type=Packの場合）: パック名を設定
7. **MstPackContent作成**（product_type=Packの場合）: パック内容物を設定

## チェックリスト

データ作成後、以下を必ず確認してください：

- [ ] 全テーブルのENABLEが`e`になっている
- [ ] IDが一意である
- [ ] 外部キー整合性が保たれている
- [ ] enum値が正確に一致している（大文字小文字も）
- [ ] 販売期間の形式が正しい
- [ ] price_ios、price_androidが正の数値である
- [ ] product_type=Packの場合、MstPack系テーブルが存在する
- [ ] product_type=Diamondの場合、MstPack系テーブルが存在しない
- [ ] cost_type=Cashの場合、cost_amount=0である
- [ ] resource_type=Itemの場合、resource_idが設定されている
- [ ] display_orderが適切に設定されている
- [ ] 推測値レポートが完全である
