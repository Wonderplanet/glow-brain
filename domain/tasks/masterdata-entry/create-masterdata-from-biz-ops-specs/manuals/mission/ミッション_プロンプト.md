# ミッション マスタデータ作成プロンプト

以下の手順に従って、イベントミッションのマスタデータを作成してください。

---

## タスク概要

運営仕様書からイベントミッションのマスタデータを作成します。
以下の8つのCSVファイルを生成します。

**出力ファイル**:
1. `MstMissionEvent.csv` - イベントミッション基本情報
2. `MstMissionEventI18n.csv` - ミッション説明文（多言語対応）
3. `MstMissionEventDependency.csv` - ミッション間の解放順序の依存関係
4. `MstMissionReward.csv` - ミッション報酬
5. `MstMissionEventDailyBonus.csv` - ログインボーナス（任意）
6. `MstMissionEventDailyBonusSchedule.csv` - ログインボーナススケジュール（任意）
7. `MstMissionLimitedTerm.csv` - 期間限定ミッション（任意）
8. `MstMissionLimitedTermI18n.csv` - 期間限定ミッション説明文（任意）

---

## インプット資料

以下の資料を参照してください。

1. **運営仕様書**（必須）
   - イベントミッション設計シート
   - ログインボーナス設計シート（ある場合）
   - 期間限定ミッション設計シート（ある場合）

2. **手順書**（必須）
   - `ミッション_マスタデータ設定手順書.md`

3. **DBスキーマ**（参照）
   - `projects/glow-server/api/database/schema/exports/master_tables_schema.json`

4. **既存マスタデータ**（参考）
   - 過去リリースのミッションマスタデータ

---

## 作成手順

### ステップ1: 仕様書の確認

運営仕様書から以下の情報を抽出してください。

**必要情報**:
- [ ] イベントID（mst_event_id）
- [ ] 作品ID（例: jig、osh、kai）
- [ ] リリースキー（例: 202601010）
- [ ] ミッション一覧（達成条件、報酬、表示順序）
- [ ] ミッション間の依存関係（順序解放の有無）
- [ ] ログインボーナスの有無と期間
- [ ] 期間限定ミッションの有無と期間

### ステップ2: MstMissionEvent.csv の作成

1. **ヘッダー行を作成**
   ```
   ENABLE,id,release_key,mst_event_id,criterion_type,criterion_value,criterion_count,unlock_criterion_type,unlock_criterion_value,unlock_criterion_count,group_key,mst_mission_reward_group_id,sort_order,destination_scene
   ```

2. **各ミッションのデータ行を作成**
   - **id**: `event_{作品ID}_{イベント連番5桁}_{ミッション連番}`
     - 例: `event_jig_00001_1`
   - **mst_event_id**: イベントID（例: `event_jig_00001`）
   - **criterion_type**: 手順書の「criterion_type設定一覧」から選択
   - **criterion_value**: criterion_typeに応じて設定（不要な場合は空欄）
   - **criterion_count**: 達成に必要な回数・レベル・数量
   - **unlock_criterion_type**: 常に `__NULL__`
   - **unlock_criterion_value**: 常に空欄
   - **unlock_criterion_count**: 常に `0`
   - **group_key**: 常に空欄
   - **mst_mission_reward_group_id**: `{作品ID}_{イベント連番5桁}_event_reward_{報酬段階}`
     - 通常: 2桁ゼロパディング（例: `jig_00001_event_reward_01`）
     - 例外（osh）: ゼロパディングなし（例: `osh_00001_event_reward_1`）
   - **sort_order**: 表示順序（1から順番）
   - **destination_scene**: criterion_typeに応じて設定（手順書の一覧表を参照）

3. **チェックポイント**
   - [ ] すべてのidが一意である
   - [ ] criterion_typeの大文字小文字が正確に一致している
   - [ ] criterion_valueの設定有無が正しい
   - [ ] destination_sceneがcriterion_typeに対応している
   - [ ] group_keyが常に空欄である
   - [ ] unlock_criterion_typeが常に `__NULL__` である

### ステップ3: MstMissionEventI18n.csv の作成

1. **ヘッダー行を作成**
   ```
   ENABLE,release_key,id,mst_mission_event_id,language,description
   ```

2. **各ミッションのI18nデータ行を作成**
   - **id**: `{mst_mission_event_id}_{language}`
     - 例: `event_jig_00001_1_ja`
   - **mst_mission_event_id**: MstMissionEvent.idと対応
   - **language**: `ja`（日本語）
   - **description**: ミッション説明文
     - 例: "メイ をグレード2まで強化しよう"

3. **チェックポイント**
   - [ ] すべてのMstMissionEvent.idに対応するI18nが存在する
   - [ ] 説明文が分かりやすい表現である
   - [ ] 誤字脱字がない

### ステップ4: MstMissionEventDependency.csv の作成

1. **依存関係グループを特定**
   - グレードアップミッション（グレード2→3→4→5）
   - レベルアップミッション（Lv.20→30→40→50→60→70→80）
   - 敵撃破数ミッション（10体→20体→...→1000体）
   - など、順序解放が必要なミッショングループを特定

2. **ヘッダー行を作成**
   ```
   ENABLE,id,release_key,group_id,mst_mission_event_id,unlock_order,備考
   ```

3. **各依存関係グループのデータ行を作成**
   - **id**: 連番（例: 151から順番）
   - **group_id**: グループの最初のミッションIDと同じ
     - 例: `event_jig_00001_1`（グレードアップミッショングループの最初）
   - **mst_mission_event_id**: ミッションID
   - **unlock_order**: 1から順番に採番
   - **備考**: 空欄

4. **チェックポイント**
   - [ ] group_idがグループの最初のミッションIDと一致している
   - [ ] unlock_orderが1から連番で設定されている
   - [ ] 同じgroup_id内で欠番がない
   - [ ] 依存関係が不要なミッションは含まれていない

### ステップ5: MstMissionReward.csv の作成

1. **ヘッダー行を作成**
   ```
   ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
   ```

2. **各ミッションの報酬データ行を作成**
   - **id**: `mission_reward_{連番}`
     - 例: `mission_reward_480`（既存の最大値+1から開始）
   - **group_id**: MstMissionEvent.mst_mission_reward_group_idと同じ値
   - **resource_type**: `Coin`, `FreeDiamond`, `Item`, `Emblem`, `Unit` のいずれか
   - **resource_id**: resource_typeに応じて設定
     - `Coin`, `FreeDiamond`: 空欄
     - `Item`: アイテムID（例: `memory_chara_jig_00701`）
     - `Emblem`: エンブレムID
     - `Unit`: ユニットID
   - **resource_amount**: 報酬の数量
   - **sort_order**: 通常は `1`（複数報酬がある場合は順番に設定）
   - **備考**: 任意（ミッション説明文などを記載すると管理しやすい）

3. **チェックポイント**
   - [ ] すべてのgroup_idがMstMissionEvent.mst_mission_reward_group_idに存在する
   - [ ] resource_typeの大文字小文字が正確に一致している
   - [ ] resource_idの設定有無が正しい

### ステップ6: MstMissionEventDailyBonus.csv の作成（任意）

**注意**: ログインボーナスがある場合のみ作成してください。

1. **ヘッダー行を作成**
   ```
   ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day,mst_mission_reward_group_id
   ```

2. **各ログイン日のデータ行を作成**
   - **id**: `{mst_event_id}_daily_bonus_{login_day:02d}`
     - 例: `event_jig_00001_daily_bonus_01`
   - **mst_mission_event_daily_bonus_schedule_id**: `{mst_event_id}_daily_bonus_schedule`
   - **login_day**: 1から順番に採番
   - **mst_mission_reward_group_id**: `{作品ID}_{イベント連番5桁}_daily_bonus_{login_day:02d}`
     - 例: `event_jig_00001_daily_bonus_01`

3. **ログインボーナス報酬をMstMissionRewardに追加**
   - group_idにログインボーナス報酬グループIDを設定

4. **チェックポイント**
   - [ ] login_dayが1から連番で設定されている
   - [ ] 欠番がない
   - [ ] 対応する報酬がMstMissionRewardに存在する

### ステップ7: MstMissionEventDailyBonusSchedule.csv の作成（任意）

**注意**: ログインボーナスがある場合のみ作成してください。

1. **ヘッダー行を作成**
   ```
   ENABLE,id,release_key,mst_event_id,start_at,end_at
   ```

2. **スケジュールデータ行を作成**
   - **id**: `{mst_event_id}_daily_bonus_schedule`
     - 例: `event_jig_00001_daily_bonus_schedule`
   - **mst_event_id**: イベントID
   - **start_at**: ログインボーナス開始日時（形式: `YYYY-MM-DD HH:MM:SS`）
   - **end_at**: ログインボーナス終了日時（形式: `YYYY-MM-DD HH:MM:SS`）

3. **チェックポイント**
   - [ ] start_at、end_atがイベント期間内である
   - [ ] 日時形式が `YYYY-MM-DD HH:MM:SS` である

### ステップ8: MstMissionLimitedTerm.csv の作成（任意）

**注意**: 期間限定ミッション（降臨バトル等）がある場合のみ作成してください。

1. **ヘッダー行を作成**
   ```
   ENABLE,id,release_key,mst_event_id,criterion_type,criterion_value,criterion_count,mst_mission_reward_group_id,sort_order,start_at,end_at,destination_scene
   ```

2. **各期間限定ミッションのデータ行を作成**
   - **id**: `{作品ID}_{イベント連番5桁}_limited_term_{連番}`
     - 例: `jig_00001_limited_term_1`
   - **criterion_type**: MstMissionEventと同じcriterion_typeを使用
   - **criterion_value**: criterion_typeに応じて設定
   - **criterion_count**: 達成に必要な回数
   - **mst_mission_reward_group_id**: `{作品ID}_{イベント連番5桁}_limited_term_{連番}`
   - **start_at**: 期間限定ミッション開始日時
   - **end_at**: 期間限定ミッション終了日時
   - **destination_scene**: criterion_typeに応じて設定

3. **期間限定ミッション報酬をMstMissionRewardに追加**
   - group_idに期間限定ミッション報酬グループIDを設定

4. **チェックポイント**
   - [ ] start_at、end_atがイベント期間内である
   - [ ] 日時形式が `YYYY-MM-DD HH:MM:SS` である
   - [ ] 対応する報酬がMstMissionRewardに存在する

### ステップ9: MstMissionLimitedTermI18n.csv の作成（任意）

**注意**: 期間限定ミッションがある場合のみ作成してください。

1. **ヘッダー行を作成**
   ```
   ENABLE,release_key,id,mst_mission_limited_term_id,language,description
   ```

2. **各期間限定ミッションのI18nデータ行を作成**
   - **id**: `{mst_mission_limited_term_id}_{language}`
     - 例: `jig_00001_limited_term_1_ja`
   - **mst_mission_limited_term_id**: MstMissionLimitedTerm.idと対応
   - **language**: `ja`（日本語）
   - **description**: ミッション説明文
     - 例: "降臨バトル「まるで 悪夢を見ているようだ」に5回挑戦しよう!"

3. **チェックポイント**
   - [ ] すべてのMstMissionLimitedTerm.idに対応するI18nが存在する
   - [ ] 説明文が分かりやすい表現である

---

## 最終チェックリスト

すべてのCSVファイルを作成したら、以下の項目を確認してください。

### 必須チェック項目

- [ ] **ヘッダーの列順が正しいか**
  - 手順書のスキーマと完全一致している

- [ ] **IDの一意性**
  - すべてのidが一意である
  - 他のリリースのidと重複していない

- [ ] **ID採番ルールの遵守**
  - MstMissionEvent.id: `event_{作品ID}_{イベント連番5桁}_{ミッション連番}`
  - MstMissionEvent.mst_mission_reward_group_id: `{作品ID}_{イベント連番5桁}_event_reward_{報酬段階}`
  - MstMissionEventDependency.group_id: 依存関係グループの最初のミッションIDと同じ
  - MstMissionReward.id: `mission_reward_{連番}`
  - MstMissionEventDailyBonus.id: `{mst_event_id}_daily_bonus_{login_day:02d}`
  - MstMissionLimitedTerm.id: `{作品ID}_{イベント連番5桁}_limited_term_{連番}`

- [ ] **リレーションの整合性**
  - すべての外部キーが参照先テーブルに存在する
  - MstMissionEvent.mst_mission_reward_group_id = MstMissionReward.group_id
  - MstMissionEventDependency.mst_mission_event_id がMstMissionEvent.idに存在する

- [ ] **enum値の正確性**
  - criterion_type、resource_type、destination_sceneが手順書の一覧表と一致している
  - 大文字小文字が正確に一致している

- [ ] **数値の妥当性**
  - criterion_count、resource_amount、sort_orderが正の整数である

- [ ] **group_keyの設定**
  - MstMissionEvent.group_keyが常に空欄である

- [ ] **unlock設定の統一性**
  - unlock_criterion_typeが常に `__NULL__` である
  - unlock_criterion_valueが常に空欄である
  - unlock_criterion_countが常に `0` である

### 推奨チェック項目

- [ ] **説明文の品質**
  - 誤字脱字がない
  - ユーザーが理解しやすい表現である

- [ ] **依存関係の妥当性**
  - unlock_orderが1から連番で設定されている
  - 同じgroup_id内で欠番がない

- [ ] **開催期間の妥当性**
  - ログインボーナス期間がイベント期間内である
  - 期間限定ミッション期間がイベント期間内である
  - 日時形式が `YYYY-MM-DD HH:MM:SS` である

---

## 出力ファイル形式

すべてのCSVファイルは以下の形式で出力してください。

- **文字コード**: UTF-8
- **改行コード**: LF
- **区切り文字**: カンマ（,）
- **引用符**: ダブルクォーテーション（"）で囲む（必要な場合のみ）
- **ヘッダー行**: 必須
- **ENABLE列**: すべての行で `e`（有効化）

---

## 参考資料

- 手順書: `ミッション_マスタデータ設定手順書.md`
- DBスキーマ: `projects/glow-server/api/database/schema/exports/master_tables_schema.json`
- 既存マスタデータ: 過去リリースのミッションマスタデータ

---

## よくある質問

### Q1: 依存関係が不要なミッションの場合はどうすればいいですか?

A1: MstMissionEventDependencyには含めません。依存関係が必要なミッショングループのみ設定してください。

### Q2: 報酬段階の番号とミッション連番が一致しない場合はどうすればいいですか?

A2: 問題ありません。報酬段階とミッション連番は独立しています。1ミッション = 1報酬グループとなるように設定してください。

### Q3: ログインボーナスがない場合はどうすればいいですか?

A3: MstMissionEventDailyBonus.csvとMstMissionEventDailyBonusSchedule.csvは作成不要です。

### Q4: 期間限定ミッションがない場合はどうすればいいですか?

A4: MstMissionLimitedTerm.csvとMstMissionLimitedTermI18n.csvは作成不要です。

### Q5: criterion_valueが不要なcriterion_typeの場合はどうすればいいですか?

A5: 空欄にしてください。例えば、`DefeatEnemyCount`の場合、criterion_valueは空欄です。

### Q6: destination_sceneの選び方が分からない場合はどうすればいいですか?

A6: 手順書の「criterion_type設定一覧」表の「destination_scene候補」列を参照してください。83%のcriterion_typeは1つのdestination_sceneに固定されています。

---

## 完了報告

すべてのCSVファイルを作成し、チェックリストを確認したら、以下の情報を報告してください。

- [ ] 作成したCSVファイル数（8ファイル中X個）
- [ ] 作成したミッション数
- [ ] 作成した依存関係グループ数
- [ ] ログインボーナスの有無と日数
- [ ] 期間限定ミッションの有無と件数
- [ ] チェックリストの確認結果

---

以上でミッションマスタデータの作成は完了です。
