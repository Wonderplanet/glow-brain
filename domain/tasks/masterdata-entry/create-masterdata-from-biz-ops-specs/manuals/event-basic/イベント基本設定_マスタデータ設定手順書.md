# イベント基本設定 マスタデータ設定手順書

## 概要

イベント基本設定のマスタデータ作成手順を記載します。
本手順書に従うことで、ゲーム内でエラーが発生しない正確なマスタデータを作成できます。

## 対象テーブル

イベント基本設定のマスタデータは、以下の3テーブル構成で作成します。

**イベント基本情報**:
- **MstEvent** - イベントの基本情報(ID、シリーズ、開催期間等)
- **MstEventI18n** - イベント名・吹き出しテキスト(多言語対応)
- **MstHomeBanner** - ホーム画面のバナー設定

**重要**: 各I18nテーブルは独立したシートとして作成します。

## 作成フロー

### 1. 仕様書の確認

運営仕様書から以下の情報を抽出します。

**必要情報**:
- イベント名称(例: 「地獄楽いいジャン祭」)
- イベントID(例: `event_jig_00001`)
- シリーズID(例: `jig`)
- 開催期間(開始日時・終了日時)
- 作品ロゴ表示有無
- 作品を読むボタン表示有無
- バナー情報(遷移先、表示期間、表示順序)
- リリースキー(例: `202601010`)

### 2. MstEvent シートの作成

#### 2.1 シートスキーマ

このシートには、ENABLE行とデータ行が含まれます。

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,mst_series_id,is_displayed_series_logo,is_displayed_jump_plus,start_at,end_at,asset_key,release_key
```

#### 2.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | イベントの一意識別子。命名規則: `event_{series_id}_{連番5桁}` |
| **mst_series_id** | シリーズID。例: `jig`(地獄楽)、`osh`(推しの子)、`kai`(怪獣8号) |
| **is_displayed_series_logo** | 作品ロゴの表示有無。`0`: 非表示、`1`: 表示 |
| **is_displayed_jump_plus** | 作品を読むボタンの表示有無。`0`: 非表示、`1`: 表示 |
| **start_at** | 開始日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **end_at** | 終了日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **asset_key** | アセットキー。通常はMstEvent.idと同じ値 |
| **release_key** | リリースキー。例: `202601010` |

#### 2.3 ID採番ルール

イベントのIDは、以下の形式で採番します。

```
event_{series_id}_{連番5桁}
```

**パラメータ**:
- `series_id`: 3文字のシリーズ識別子
  - jig = 地獄楽
  - osh = 推しの子
  - kai = 怪獣8号
  - glo = GLOW全体
- `連番5桁`: シリーズ内で00001からゼロパディング

**採番例**:
```
event_jig_00001   (地獄楽 イベント1)
event_osh_00001   (推しの子 イベント1)
event_kai_00001   (怪獣8号 イベント1)
```

#### 2.4 作成例

```
ENABLE,id,mst_series_id,is_displayed_series_logo,is_displayed_jump_plus,start_at,end_at,asset_key,release_key
e,event_jig_00001,jig,1,1,"2026-01-16 15:00:00","2026-02-16 10:59:59",event_jig_00001,202601010
```

#### 2.5 設定のポイント

- **is_displayed_series_logo**: イベント画面で作品ロゴを表示する場合は`1`
- **is_displayed_jump_plus**: イベント画面でジャンプ+へのリンクボタンを表示する場合は`1`
- **start_at / end_at**: 日時指定は必ずダブルクォートで囲む
- **開催期間の確認**: イベント全体の開催期間を正確に設定(個別コンテンツの開催期間とは異なる場合がある)

### 3. MstEventI18n シートの作成

#### 3.1 シートスキーマ

```
ENABLE,release_key,id,mst_event_id,language,name,balloon
```

#### 3.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **release_key** | リリースキー。MstEventと同じ値 |
| **id** | I18nの一意識別子。命名規則: `{mst_event_id}_{language}` |
| **mst_event_id** | イベントID。MstEvent.idと対応 |
| **language** | 言語コード。`ja`: 日本語 |
| **name** | イベント名 |
| **balloon** | 吹き出し内テキスト(改行可能) |

**注**: 現在のシステムでは`language`は`ja`(日本語)のみサポート。将来的に他言語対応の可能性あり。

#### 3.3 作成例

```
ENABLE,release_key,id,mst_event_id,language,name,balloon
e,202601010,event_jig_00001_ja,event_jig_00001,ja,地獄楽いいジャン祭,"地獄楽いいジャン祭\n開催中!"
```

#### 3.4 設定のポイント

- **balloon**: 改行する場合は`\n`を使用
- **balloon**: ダブルクォートで囲むことで改行やカンマを含めることができる
- **name**: イベント名は簡潔かつ魅力的に

### 4. MstHomeBanner シートの作成

#### 4.1 シートスキーマ

```
ENABLE,id,destination,destination_path,asset_key,start_at,end_at,sort_order,release_key
```

#### 4.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | バナーの一意識別子。通常は数値の連番 |
| **destination** | タップ時の遷移先タイプ。下記の「destination設定一覧」を参照 |
| **destination_path** | 遷移先における情報。destinationに応じたIDを指定 |
| **asset_key** | 表示するバナーのパス。アセット名を指定 |
| **start_at** | 掲載開始日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **end_at** | 掲載終了日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **sort_order** | ホームで出す表示順番。数値が小さいほど上位表示 |
| **release_key** | リリースキー。例: `202601010` |

#### 4.3 destination設定一覧

ホームバナーで使用可能なdestinationは以下の通りです。**大文字小文字を正確に一致**させてください。

| destination | 説明 | destination_pathの指定内容 | 使用例 |
|------------|------|--------------------------|--------|
| **Event** | イベント画面 | イベントID | `event_jig_00001` |
| **Gacha** | ガチャ画面 | ガチャID | `Pickup_jig_001` |
| **CreditShop** | 有償ショップ | 空文字または商品ID | |
| **BasicShop** | 通常ショップ | 空文字または商品ID | |
| **Pack** | パック購入画面 | パックID | |
| **Pass** | パス購入画面 | パスID | |
| **BeginnerMission** | 初心者ミッション | 空文字 | |
| **AdventBattle** | 降臨バトル | 降臨バトルID | |
| **Pvp** | ランクマッチ | PVP ID | |
| **Web** | 外部Webページ | URL | |
| **None** | 遷移なし | 空文字 | |

**頻繁に使用されるdestination**:
- Event(イベント告知バナー)
- Gacha(ガチャ告知バナー)
- AdventBattle(降臨バトル告知バナー)

#### 4.4 ID採番ルール

MstHomeBannerのIDは、**数値の連番**で採番します。

```
23, 24, 25, ...
```

**重要**: 既存のMstHomeBannerで使用されているIDと重複しないように注意してください。

#### 4.5 asset_key命名規則

バナーのアセットキーは、以下の命名規則を推奨します。

```
hometop_{type}_{series_id}_{連番5桁}
```

**パラメータ**:
- `type`: バナーのタイプ
  - `event`: イベントバナー
  - `gacha`: ガチャバナー
  - `advent`: 降臨バトルバナー
- `series_id`: シリーズID(jig、osh、kai等)
- `連番5桁`: 連番(00001から)

**命名例**:
```
hometop_event_jig_00001   (地獄楽イベントバナー)
hometop_gacha_jig_00001   (地獄楽ガチャAバナー)
hometop_gacha_jig_00002   (地獄楽ガチャBバナー)
```

#### 4.6 作成例

```
ENABLE,id,destination,destination_path,asset_key,start_at,end_at,sort_order,release_key
e,23,Event,event_jig_00001,hometop_event_jig_00001,"2026-01-16 15:00:00","2026-02-02 14:59:59",7,202601010
e,24,Gacha,Pickup_jig_001,hometop_gacha_jig_00001,"2026-01-16 15:00:00","2026-02-02 14:59:59",6,202601010
e,25,Gacha,Pickup_jig_002,hometop_gacha_jig_00002,"2026-01-16 15:00:00","2026-02-02 14:59:59",6,202601010
```

#### 4.7 設定のポイント

- **sort_order**: 数値が小さいほど上位に表示される。重要度の高いバナーには小さい数値を設定
- **開催期間**: バナーの表示期間はイベント全体の開催期間と同じか、それより短い期間を設定
- **複数バナーの表示順**: 同時に複数バナーを表示する場合、sort_orderで優先順位を調整
- **destination_path**: destinationに応じて正しいIDを指定(Event→イベントID、Gacha→ガチャID等)

## データ整合性のチェック

マスタデータ作成後、以下の項目を確認してください。

### 必須チェック項目

- [ ] **ヘッダーの列順が正しいか**
  - スキーマファイルと完全一致している

- [ ] **IDの一意性**
  - すべてのidが一意である
  - 他のリリースのidと重複していない

- [ ] **ID採番ルール**
  - MstEvent.id: `event_{series_id}_{連番5桁}`
  - MstEventI18n.id: `{mst_event_id}_{language}`
  - MstHomeBanner.id: 数値の連番

- [ ] **リレーションの整合性**
  - `MstEventI18n.mst_event_id` が `MstEvent.id` に存在する
  - `MstHomeBanner.destination_path` が指定先のテーブルに存在する(Event→MstEvent、Gacha→OprGacha等)

- [ ] **enum値の正確性**
  - destination: None、Gacha、CreditShop、BasicShop、Event、Web、Pack、Pass、BeginnerMission、AdventBattle、Pvp
  - language: ja
  - 大文字小文字が正確に一致している

- [ ] **日時の妥当性**
  - start_atがend_atより前である
  - 日時フォーマットが正しい(`YYYY-MM-DD HH:MM:SS`)
  - ダブルクォートで囲まれている

- [ ] **開催期間の整合性**
  - MstEventの開催期間内にMstHomeBannerの表示期間が収まっている
  - 関連するコンテンツ(クエスト、ガチャ等)の開催期間と矛盾していない

### 推奨チェック項目

- [ ] **命名規則の統一**
  - idのプレフィックスがシリーズIDと一致している
  - asset_keyの命名規則が統一されている

- [ ] **バナー表示順の妥当性**
  - sort_orderが適切に設定されている
  - 重要度の高いコンテンツが上位に表示される

- [ ] **テキストの品質**
  - イベント名が魅力的で分かりやすい
  - 吹き出しテキストが簡潔で訴求力がある
  - 誤字脱字がない

- [ ] **開催期間の確認**
  - イベント全体の開催期間が正しい
  - バナー表示期間が適切(イベント終了前に非表示にする等)

## 出力フォーマット

最終的な出力は以下の3シート構成で行います。

### MstEvent シート

| ENABLE | id | mst_series_id | is_displayed_series_logo | is_displayed_jump_plus | start_at | end_at | asset_key | release_key |
|--------|----|--------------|-----------------------|----------------------|----------|--------|----------|-------------|
| e | event_jig_00001 | jig | 1 | 1 | 2026-01-16 15:00:00 | 2026-02-16 10:59:59 | event_jig_00001 | 202601010 |

### MstEventI18n シート

| ENABLE | release_key | id | mst_event_id | language | name | balloon |
|--------|------------|----|--------------|----|------|---------|
| e | 202601010 | event_jig_00001_ja | event_jig_00001 | ja | 地獄楽いいジャン祭 | 地獄楽いいジャン祭\n開催中! |

### MstHomeBanner シート

| ENABLE | id | destination | destination_path | asset_key | start_at | end_at | sort_order | release_key |
|--------|----|------------|----------------|----------|----------|--------|-----------|-------------|
| e | 23 | Event | event_jig_00001 | hometop_event_jig_00001 | 2026-01-16 15:00:00 | 2026-02-02 14:59:59 | 7 | 202601010 |
| e | 24 | Gacha | Pickup_jig_001 | hometop_gacha_jig_00001 | 2026-01-16 15:00:00 | 2026-02-02 14:59:59 | 6 | 202601010 |
| e | 25 | Gacha | Pickup_jig_002 | hometop_gacha_jig_00002 | 2026-01-16 15:00:00 | 2026-02-02 14:59:59 | 6 | 202601010 |

## 運営仕様書との対応関係

### MstEvent・MstEventI18nの情報源

運営仕様書の以下のシートから情報を取得します。

**主要シート**:
- **01_概要.csv**: イベント名、開催期間、シリーズID
- **いいジャン祭ID.csv**(ID管理シート): イベントID、リリースキー
- **キャラ名称＆キャラセリフ資料**: イベント名・吹き出しテキスト(監修済み)

**取得項目**:
```
運営仕様書「01_概要.csv」:
- イベント名称 → MstEventI18n.name
- 開催期間(開始) → MstEvent.start_at
- 開催期間(終了) → MstEvent.end_at
- シリーズ → MstEvent.mst_series_id

運営仕様書「いいジャン祭ID.csv」:
- イベントID → MstEvent.id
- リリースキー → MstEvent.release_key

運営仕様書「バナーテキスト設計.csv」(もしあれば):
- 吹き出しテキスト → MstEventI18n.balloon
```

### MstHomeBannerの情報源

運営仕様書の以下のシートから情報を取得します。

**主要シート**:
- **バナー一覧.csv**: バナーの遷移先、表示期間、表示順序
- **いいジャン祭ID.csv**(ID管理シート): バナーアセットキー

**取得項目**:
```
運営仕様書「バナー一覧.csv」:
- バナーID → MstHomeBanner.id
- 遷移先タイプ → MstHomeBanner.destination
- 遷移先ID → MstHomeBanner.destination_path
- 表示期間(開始) → MstHomeBanner.start_at
- 表示期間(終了) → MstHomeBanner.end_at
- 表示順序 → MstHomeBanner.sort_order

運営仕様書「いいジャン祭ID.csv」:
- バナーアセットキー → MstHomeBanner.asset_key
- リリースキー → MstHomeBanner.release_key
```

## 実際のマスタデータ例(地獄楽いいジャン祭)

### MstEvent

```csv
ENABLE,id,mst_series_id,is_displayed_series_logo,is_displayed_jump_plus,start_at,end_at,asset_key,release_key
e,event_jig_00001,jig,1,1,"2026-01-16 15:00:00","2026-02-16 10:59:59",event_jig_00001,202601010
```

**設定のポイント**:
- シリーズID: `jig`(地獄楽)
- 作品ロゴ表示: `1`(表示)
- ジャンプ+リンク: `1`(表示)
- 開催期間: 2026-01-16 15:00 ~ 2026-02-16 10:59(約1ヶ月)

### MstEventI18n

```csv
ENABLE,release_key,id,mst_event_id,language,name,balloon
e,202601010,event_jig_00001_ja,event_jig_00001,ja,地獄楽いいジャン祭,"地獄楽いいジャン祭\n開催中!"
```

**設定のポイント**:
- イベント名: 「地獄楽いいジャン祭」
- 吹き出し: 改行(\n)を使用してシンプルな訴求

### MstHomeBanner

```csv
ENABLE,id,destination,destination_path,asset_key,start_at,end_at,sort_order,release_key
e,23,Event,event_jig_00001,hometop_event_jig_00001,"2026-01-16 15:00:00","2026-02-02 14:59:59",7,202601010
e,24,Gacha,Pickup_jig_001,hometop_gacha_jig_00001,"2026-01-16 15:00:00","2026-02-02 14:59:59",6,202601010
e,25,Gacha,Pickup_jig_002,hometop_gacha_jig_00002,"2026-01-16 15:00:00","2026-02-02 14:59:59",6,202601010
```

**設定のポイント**:
- バナー3つを同時表示
- イベントバナー(id=23): sort_order=7
- ガチャAバナー(id=24): sort_order=6(イベントバナーより優先)
- ガチャBバナー(id=25): sort_order=6(ガチャAと同優先度)
- バナー表示期間: イベント開催期間より短い(2026-02-02まで)

## 重要なポイント

- **3テーブル構成**: イベント基本設定は少ないテーブルで構成されるが、システム全体に影響を与える
- **I18nは独立したシート**: MstEventI18nは独立したシートとして作成
- **バナー設定の重要性**: MstHomeBannerはユーザーの最初の接点となるため、表示順序と訴求力が重要
- **開催期間の整合性**: イベント全体の開催期間と各コンテンツ・バナーの開催期間の整合性に注意
- **外部キー整合性の徹底**: MstHomeBanner.destination_pathが指定先のテーブルに存在することを確認
- **シンプルさの維持**: イベント基本設定は複雑にせず、シンプルに保つことが重要
