# ガチャマスタデータ作成プロンプト

## 作業内容

手順書（ガチャ_マスタデータ設定手順書.md）に従って、
添付したガチャ設計書からマスタデータを作成してください。
ガチャ設計書: {ファイル名を指定}

新規リソース情報など、データ作成に必要な追加情報があれば、追加情報ファイルとして追加します。
追加情報ファイル:
- {追加ファイル1}
- {追加ファイル2}

## 入力パラメータ

- release_key: {release_keyを指定（例: 202601010）}
- mst_series_id: {シリーズIDを指定（例: jig、osh、kai）}
- opr_gacha_id: {ガチャIDを指定（例: Pickup_jig_001）}
- gacha_name: {ガチャ名を指定（例: 地獄楽 いいジャン祭ピックアップガシャ A）}
- gacha_type: {ガチャタイプを指定（例: Pickup、Premium、Free）}
- start_at: {開催開始日時（例: 2026-01-16 12:00:00）}
- end_at: {開催終了日時（例: 2026-02-16 10:59:59）}
- upper_count: {天井回数（例: 100）}
- multi_draw_count: {N連数（例: 10）}
- multi_fixed_prize_count: {N連確定枠数（例: 1）}
- pickup_unit_ids: {ピックアップキャラID（カンマ区切り、例: chara_jig_00401,chara_jig_00501）}

## 出力形式

### 1. マスタデータ

- 手順書の「データ整合性のチェック」を満たしたデータになっていることを必ずチェックし、問題があれば修正完了してから出力する
- Markdown表形式で出力（スプレッドシートへのエクスポート・コピーボタンが正常に表示される形式）
- 以下の6シートを作成:
  1. OprGacha
  2. OprGachaI18n
  3. OprGachaPrize（通常排出: prize_group_id）
  4. OprGachaPrize（確定枠排出: fixed_prize_group_id）
  5. OprGachaUpper
  6. OprGachaUseResource
  7. OprGachaDisplayUnitI18n（ピックアップキャラのみ）

### 2. 推測値レポート（必須）

作成したデータのうち、以下に該当するものを必ずレポートしてください：

- **添付ファイルにも手順書にも記載がなく、推測で決定したID値やパラメータ値**
- 手順書通りに作成したID値は対象外

**レポート形式:**
```
## 推測値レポート

### [テーブル名].[カラム名]
- 値: [設定した値]
- 理由: [推測した根拠]
- 確認事項: [ユーザーが確認すべき内容]
```

**推測値の例**:
- OprGacha.display_information_id: Strapi管理のUUID（仮設定）
- OprGacha.display_gacha_caution_id: Strapi管理のUUID（仮設定）
- OprGacha.gacha_priority: 表示優先度（推測値）
- OprGachaPrize.weight: 排出重み（レアリティから計算）
- OprGachaI18n.logo_asset_key: ロゴアセットキー（推測値）
- OprGachaI18n.description: ガチャ説明文（推測値）
- OprGachaDisplayUnitI18n.description: キャラ説明文（推測値）

**重要:** このレポートを怠ると、データインポートエラーや本番不具合のリスクが高まります。推測で決定した値は必ず報告してください。

## 注意事項

### 排出内容の設定について

OprGachaPrizeは、以下の2種類のgroup_idで作成してください：

**通常排出（prize_group_id）**:
- group_id: `{opr_gacha_id}`（例: `Pickup_jig_001`）
- 単発・10連の通常排出枠
- 重み合計: 約1,000,000

**確定枠排出（fixed_prize_group_id）**:
- group_id: `fixd_{opr_gacha_id}`（例: `fixd_Pickup_jig_001`）
- 10連の確定枠専用排出（R/N排出を除外）
- 重み合計: 約25,000,000（通常排出の約25倍）

### 排出重みの計算について

排出重みは、レアリティと排出率から計算します。

**基本的な排出率**:
- UR: 3%（合計重み: 30,000）
- SSR: 8%（合計重み: 80,000）
- SR: 15%（合計重み: 150,000）
- R: 27%（合計重み: 270,000）
- N: 47%（合計重み: 470,000）

**ピックアップ時の排出率UP**:
- ピックアップURキャラ: 約2%（重み: 7,020）
- 通常URキャラ: 残りの1%を均等分散（重み: 1,755）
- ピックアップSSRキャラ: 約5%（重み: 14,040）
- 通常SSRキャラ: 残りの3%を均等分散（重み: 8,840）

**確定枠排出の重み**:
- 通常排出の重みに対して約25倍の値を設定
- 例: 通常排出のピックアップURキャラ（7,020）→ 確定枠排出（175,500）

### 天井設定について

OprGachaUpperは、以下の形式で作成してください：

- upper_group: OprGacha.upper_groupと同じ値
- upper_type: `Pickup`（ピックアップ天井）または `MaxRarity`（最高レアリティ天井）
- count: 天井回数（通常100回）

例:
```
ENABLE,id,upper_group,upper_type,count,release_key
e,17,Pickup_jig_001,Pickup,100,202601010
```

**注意**: idは既存のテーブルと重複しないように連番で採番します。

### コスト設定について

OprGachaUseResourceは、以下の3種類のコストを設定してください：

1. **チケット単発**:
   - cost_type: `Item`
   - cost_id: `ticket_glo_00003`（レアガチャチケット）
   - cost_num: `1`
   - draw_count: `1`
   - cost_priority: `2`

2. **ダイヤ単発**:
   - cost_type: `Diamond`
   - cost_id: 空欄
   - cost_num: `150`
   - draw_count: `1`
   - cost_priority: `3`

3. **ダイヤ10連**:
   - cost_type: `Diamond`
   - cost_id: 空欄
   - cost_num: `1500`
   - draw_count: `10`
   - cost_priority: `3`

**注意**: cost_priorityは、数値が小さいほど優先（チケット優先）。

### UUID管理について

以下のカラムは、Strapiで管理されているUUIDです：

- OprGacha.display_information_id
- OprGacha.dev-qa_display_information_id
- OprGacha.display_gacha_caution_id

**設定方法**:
1. Strapiで該当のガチャ情報を作成
2. 発行されたUUIDをコピー
3. マスタデータに設定

**注意**: Strapi連携が完了していない場合は、仮のUUIDを設定しておき、後で差し替えます。

### 開催期間について

開催期間は、以下の形式で設定してください：

```
start_at: YYYY-MM-DD HH:MM:SS
end_at:   YYYY-MM-DD HH:MM:SS
```

**注意点**:
- ガチャはイベント開始時刻より早く開始することが多い（例: イベント15:00開始、ガチャ12:00開始）
- 終了時刻は、イベント終了時刻と同じかそれより前

### I18n設定について

以下のI18nテーブルを作成してください：

**OprGachaI18n**:
- 最低でも日本語（ja）を設定
- ガチャ名、説明文、天井説明、確定枠説明、ロゴアセットキー、背景色、バナーサイズ等

**OprGachaDisplayUnitI18n**:
- ピックアップキャラのみ設定（通常排出キャラは不要）
- 最低でも日本語（ja）を設定
- キャラの特徴や魅力を記載

### 外部キー整合性について

以下のリレーションが正しく設定されていることを必ず確認してください：
- OprGacha.upper_group → OprGachaUpper.upper_group
- OprGacha.prize_group_id → OprGachaPrize.group_id
- OprGacha.fixed_prize_group_id → OprGachaPrize.group_id
- OprGachaI18n.opr_gacha_id → OprGacha.id
- OprGachaUseResource.opr_gacha_id → OprGacha.id
- OprGachaDisplayUnitI18n.opr_gacha_id → OprGacha.id
- OprGachaDisplayUnitI18n.mst_unit_id → MstUnit.id

### データ整合性のチェック

出力前に、以下の項目を必ず確認してください：

- [ ] ヘッダーの列順が正しいか
- [ ] すべてのIDが一意であるか
- [ ] ID採番ルールに従っているか
- [ ] リレーションが正しく設定されているか
- [ ] enum値が正確に一致しているか
- [ ] 開催期間が妥当か（start_at < end_at）
- [ ] 排出重みの合計が適切か
- [ ] ピックアップフラグが正しく設定されているか
- [ ] 確定枠の設定が正しいか
