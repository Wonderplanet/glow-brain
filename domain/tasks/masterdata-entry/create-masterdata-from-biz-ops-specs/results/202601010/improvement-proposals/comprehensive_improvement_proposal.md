# マスタデータ生成精度 包括的改善提案レポート

**リリースキー**: 202601010
**分析日**: 2026-02-11
**対象スキル**: masterdata-from-bizops-all

---

## エグゼクティブサマリー

masterdata-from-bizops-allスキルを使用して運営仕様書からマスタデータを生成した結果、**生成率32.1%（25/78ファイル）**という低い精度となりました。本レポートは、4つの観点から包括的に分析し、**生成率100%、差分率0%を達成するための改善提案**をまとめています。

### 🎯 目標

| 指標 | 現状 | 目標 | ギャップ |
|------|------|------|---------|
| **ファイル生成率** | 32.1% (25/78) | 100% (78/78) | +53ファイル |
| **完全一致率** | 32.0% (8/25) | 100% (78/78) | +70ファイル |
| **スキル実行率** | 43% (6/14) | 100% (14/14) | +8スキル |

### 🔍 根本原因の特定

4つの分析タスクにより、問題の核心が明らかになりました：

**❌ 誤った仮説**：
- 運営仕様書の網羅性が低い → **実際は90%カバー**
- スキルの実装が不足している → **実際は78%カバー**

**✅ 真の根本原因**：
1. **スキル実行率43%** - 14個のスキル中6個しか実行されていない（タスク#2）
2. **生成ロジックの精度不足** - 7つの根本的な課題（タスク#3）
3. **運営仕様書の認識ロジック不備** - スキル呼び出しトリガーの問題（タスク#2）

---

## 1. 現状分析

### 1.1 データ概要

| 項目 | 値 |
|------|------|
| 正解データのファイル数 | 78 |
| 生成結果のファイル数 | 25 |
| 生成されていないファイル数 | 53 |
| ファイル生成率 | 32.1% |
| 完全一致ファイル | 8/25 (32.0%) |
| 差分ありファイル | 17/25 (68.0%) |
| 総差分行数 | 569 (追加: 282, 削除: 247, 変更: 40) |

### 1.2 運営仕様書のカバレッジ（タスク#1の結果）

**重要な発見**: 運営仕様書は**90%のテーブル（70/78ファイル）をカバー**しています。

| カテゴリ | カバレッジ | 備考 |
|---------|-----------|------|
| 新規施策関連 | ほぼ100% | イベント、クエスト、キャラ、ガチャ、ミッション等 |
| システム系 | 0% | MstPage, MstAutoPlayerSequence等（変更不要） |
| 定常コンテンツ | 部分的 | ランクマッチ等 |

**結論**: 運営仕様書の網羅性は問題ではない。

### 1.3 スキル実装カバレッジ（タスク#4の結果）

masterdata-from-bizops-allスキルは**14個の子スキル**で構成され、**74個/95個のテーブル（78%）**に対応しています。

| 子スキル | 対応テーブル数 | 主な機能 |
|---------|--------------|---------|
| gacha | 6 | ガチャ機能 |
| hero | 13 | ヒーロー・アビリティ・攻撃 |
| mission | 8 | ミッション機能 |
| quest-stage | 10 | クエスト・ステージ機能 |
| advent-battle | 7 | 降臨バトル機能 |
| pvp | 2 | PVP機能 |
| item | 2 | アイテム機能 |
| reward | 17 | 報酬汎用 |
| emblem | 2 | エンブレム機能 |
| artwork | 5 | 原画機能 |
| event-basic | 3 | イベント基本設定 |
| shop-pack | 7 | ショップ・パック機能 |
| enemy-autoplayer | 5 | 敵・自動行動機能 |
| ingame | 7 | インゲーム設定 |

**結論**: スキルの実装カバレッジも問題ではない。

### 1.4 スキル実行率（タスク#2の結果）

**これが根本原因**: 14個のスキル中、**わずか6個（43%）しか実行されていません**。

#### 実行されたスキル（6個）

| スキル | カバレッジ | 生成/総数 | ステータス |
|--------|-----------|----------|-----------|
| item | 100% | 2/2 | ✓ 完全実行 |
| emblem | 100% | 2/2 | ✓ 完全実行 |
| event-basic | 100% | 3/3 | ✓ 完全実行 |
| advent-battle | 85.7% | 6/7 | △ 部分実行 |
| quest-stage | 70.0% | 7/10 | △ 部分実行 |
| shop-pack | 71.4% | 5/7 | △ 部分実行 |

#### 実行されなかったスキル（7個 → 47ファイル未生成）

| スキル | 対応テーブル数 | 未生成ファイル数 | 影響度 |
|--------|--------------|----------------|--------|
| hero | 13 | 13 | 🔴 極大 |
| ingame | 8 | 8 | 🔴 大 |
| mission | 8 | 8 | 🔴 大 |
| gacha | 6 | 6 | 🟡 中 |
| enemy-autoplayer | 5 | 5 | 🟡 中 |
| artwork | 5 | 5 | 🟡 中 |
| pvp | 2 | 2 | 🟢 小 |

#### 部分実行されたスキル（3個 → 6ファイル未生成）

| スキル | 未生成テーブル | 原因推定 |
|--------|--------------|---------|
| quest-stage | MstQuestBonusUnit, MstQuestEventBonusSchedule, MstStageEndCondition | 運営仕様書の記載が認識されなかった |
| advent-battle | MstEventBonusUnit | 運営仕様書の記載が認識されなかった |
| shop-pack | OprProduct, OprProductI18n | 運営仕様書の記載が認識されなかった |

### 1.5 差分の根本原因（タスク#3の結果）

生成された25ファイル中、17ファイル（68%）に差分が発生しました。7つの根本原因が特定されています。

| 根本原因 | 影響ファイル数 | 主な事例 |
|---------|--------------|---------|
| **1. ID命名規則・採番の理解不足** | 5 | 報酬IDの末尾が`_01, _02`ではなく`_1, _2`形式 |
| **2. アセットキーの推測誤り** | 4 | 他イベント（`event_sur1_*`）のアセットキーを使用 |
| **3. データ依存関係の考慮漏れ** | 6 | 親テーブル未生成による子テーブルの連鎖的欠落 |
| **4. 運営仕様書の記載不足・解釈誤り** | 7 | ランキング報酬 vs 累計スコア報酬の混同、ステージ数過剰生成 |
| **5. 推測値の精度不足** | 3 | スタミナ消費、コイン、経験値、推奨レベルなどの計算誤差 |
| **6. NULL値表現の不統一** | 4 | 空文字列 vs `__NULL__`の使い分けが不明確 |
| **7. テキスト表記の揺れ** | 3 | スペース有無、漢字表記の推測誤り |

---

## 2. 原因の体系的分類

### 2.1 原因マトリクス

| カテゴリ | 問題 | 影響 | 優先度 |
|---------|------|------|-------|
| **A. スキル実行制御** | 7個のスキルが実行されず | 47ファイル未生成（88.7%） | 🔴 最優先 |
| **B. スキル部分実行** | 3個のスキルで一部テーブル未生成 | 6ファイル未生成（11.3%） | 🟡 高 |
| **C. ID生成ロジック** | 命名規則・採番位置の誤り | 5ファイルで大規模差分 | 🟡 高 |
| **D. アセット推測** | アセットキー生成ロジック不備 | 4ファイルで差分 | 🟢 中 |
| **E. データ依存関係** | 親テーブル未生成の連鎖 | 6ファイルで追加漏れ | 🟢 中 |
| **F. 仕様書解釈** | 記載内容の誤解・推測誤り | 7ファイルで差分 | 🟡 高 |
| **G. 推測値精度** | パラメータ計算の不正確 | 3ファイルで微小差分 | 🟢 中 |
| **H. データ表現** | NULL値・テキスト表記の不統一 | 7ファイルで微小差分 | 🟢 低 |

---

## 3. 改善提案

### 3.1 フェーズ1: クイックウィン（1-2週間）

**目標**: スキル実行率を100%に改善し、ファイル生成率を85%以上に向上

#### 提案1-1: スキル呼び出しトリガーロジックの改善【最優先】

**問題**: masterdata-from-bizops-allが運営仕様書から各スキルを呼び出す際の認識ロジックに問題があり、7個のスキルが実行されていない。

**具体的な改善案**:

1. **運営仕様書の解析ロジック強化**
   - 現状: ファイル名やシート名から機能カテゴリを推定
   - 改善: 以下の情報源を複合的に活用
     - ファイル名パターン（例: `ヒーロー基礎設計_*` → hero）
     - シート名パターン（例: `ガチャ設計書_*` → gacha）
     - ファイル内容のキーワード（例: `ミッション名`, `ミッション達成条件` → mission）
     - specs.csvのメタデータ（ファイルタイプ、カテゴリ情報）

2. **スキル呼び出しルールの明確化**
   ```javascript
   // 現状（推定）
   if (ファイル名.includes("降臨")) {
     call("advent-battle")
   }

   // 改善案
   const SKILL_TRIGGERS = {
     "hero": [
       {type: "filename", pattern: /ヒーロー基礎設計_/},
       {type: "sheet", pattern: /キャラクター|ユニット|Hero/},
       {type: "content", keywords: ["unit_id", "attack_id", "ability_id"]}
     ],
     "gacha": [
       {type: "filename", pattern: /ガチャ設計書_|ガシャ/},
       {type: "sheet", pattern: /ガチャ|Gacha/},
       {type: "content", keywords: ["prize_id", "gacha_upper"]}
     ],
     "mission": [
       {type: "filename", pattern: /ミッション/},
       {type: "sheet", pattern: /ミッション|Mission/},
       {type: "content", keywords: ["mission_id", "達成条件", "報酬"]}
     ],
     // ... 他のスキルも同様
   }
   ```

3. **フォールバック機構の追加**
   - トリガーマッチしなかったファイルは全スキルに通知
   - 各スキルが自己判定で処理可否を判断
   - 処理されなかったファイルは警告レポートに記録

**期待効果**:
- スキル実行率: 43% → 100%
- ファイル生成率: 32.1% → 85%以上
- 未生成ファイル: 53個 → 6個以下（部分実行の改善も含む）

**実装工数**: 3-5日

---

#### 提案1-2: 部分実行スキルの改善

**問題**: quest-stage, advent-battle, shop-packで一部テーブルが生成されていない。

**具体的な改善案**:

1. **quest-stage（3テーブル未生成）**
   - `MstQuestBonusUnit`: 運営仕様書の「ボーナスキャラ設定」セクションを認識
   - `MstQuestEventBonusSchedule`: 運営仕様書の「ボーナス期間」セクションを認識
   - `MstStageEndCondition`: クエスト設計シートの「クリア条件」カラムを認識

2. **advent-battle（1テーブル未生成）**
   - `MstEventBonusUnit`: 運営仕様書の「コイン獲得ボーナスキャラ」セクションを認識

3. **shop-pack（2テーブル未生成）**
   - `OprProduct`, `OprProductI18n`: パック作成時に対応するストア商品も自動生成

**期待効果**:
- ファイル生成率: 85% → 92%以上（6ファイル追加）

**実装工数**: 2-3日

---

#### 提案1-3: ID生成ロジックの統一

**問題**: ID命名規則・採番位置の誤りにより、大規模な差分が発生。

**具体的な改善案**:

1. **ID採番の自動化**
   ```javascript
   // 既存データから最大IDを取得
   function getNextId(tableName, idColumn) {
     const existingData = readCSV(`past_tables/${tableName}.csv`)
     const maxId = Math.max(...existingData.map(row => extractNumber(row[idColumn])))
     return maxId + 1
   }
   ```

2. **ID命名規則の明確化**
   - 報酬系テーブルの末尾番号: ゼロ埋めなし（`_1`, `_2`, ...）
   - イベント系テーブル: リリースキーベース（`event_jig_00001`）
   - アセットキー: イベントIDから生成（`event_jig_00001` → `jig_00001`）

3. **ID生成ルールのドキュメント化**
   - `references/id_naming_rules.md`を作成
   - 各テーブルのID形式を明記

**期待効果**:
- 差分率: 68% → 40%以下（ID関連の差分を解消）

**実装工数**: 2-3日

---

### 3.2 フェーズ2: 中期改善（1-2ヶ月）

**目標**: 差分率を10%以下に削減し、ほぼ手動修正不要の精度を達成

#### 提案2-1: データ依存関係の自動管理

**問題**: 親テーブル未生成により子テーブルが連鎖的に欠落。

**具体的な改善案**:

1. **テーブル依存関係の定義**
   ```javascript
   const TABLE_DEPENDENCIES = {
     "MstPack": ["MstPackContent", "MstPackI18n"],
     "MstStoreProduct": ["MstStoreProductI18n"],
     "MstUnit": ["MstUnitI18n", "MstUnitAbility"],
     // ...
   }
   ```

2. **親テーブル作成時の自動連携**
   - 親テーブル生成時、子テーブルも自動生成
   - 子テーブルのデータは親テーブルから導出
   - I18nテーブルは自動生成（name, descriptionなどを継承）

3. **整合性チェックの強化**
   - 親テーブル存在チェック
   - 外部キー整合性チェック
   - 孤立レコードの検出

**期待効果**:
- 差分率: 40% → 25%以下（依存関係の差分を解消）

**実装工数**: 5-7日

---

#### 提案2-2: アセットキー・パラメータ推測精度の向上

**問題**: アセットキーの推測誤り、パラメータ計算の不正確。

**具体的な改善案**:

1. **アセットキー生成ルールの明確化**
   - イベントID → アセットキープレフィックス（`event_jig_00001` → `jig_`）
   - クエストタイプ → 背景アセットキー（`charaget01` → `jig_00003`）
   - ルールのドキュメント化

2. **パラメータ推測の高度化**
   - 過去データのパターン分析（ステージ進行に応じたパラメータ増加率）
   - 類似イベントからの推測（同じIPのイベントは類似パラメータ）
   - 推測値の信頼度スコア付与

3. **推測値レポートの詳細化**
   - 推測根拠の明記
   - 信頼度スコア（High/Medium/Low）
   - 手動確認推奨箇所の明示

**期待効果**:
- 差分率: 25% → 10%以下（推測誤差を削減）

**実装工数**: 7-10日

---

#### 提案2-3: 運営仕様書テンプレートの整備

**問題**: 運営仕様書の記載内容が不足・不明確で、スキルが正しく解釈できない。

**具体的な改善案**:

1. **必須項目の明確化**
   - 各機能カテゴリで必須の情報を定義
   - テンプレートシートの作成
   - 記入例の提供

2. **チェックリストの作成**
   - ヒーロー追加時のチェックリスト（基礎設計、アビリティ、攻撃、セリフ等）
   - ガチャ追加時のチェックリスト（景品、天井、消費リソース等）
   - ミッション追加時のチェックリスト（条件、報酬、依存関係等）

3. **運営仕様書検証ツールの作成**
   - 必須項目の存在チェック
   - データ型・範囲の妥当性チェック
   - 参照整合性チェック

**期待効果**:
- 運営仕様書の品質向上
- スキルの解釈精度向上
- 差分率: 10% → 5%以下

**実装工数**: 10-14日

---

### 3.3 フェーズ3: 長期改善（3-6ヶ月）

**目標**: 完全自動化、ファイル生成率100%、差分率0%を達成

#### 提案3-1: 過去データ自動継承機能

**問題**: 運営仕様書に記載がないテーブルは過去データをそのまま使う必要があるが、現状は未実装。

**具体的な改善案**:

1. **差分検出ロジック**
   - 過去データと正解データの差分を検出
   - 差分がないテーブルは自動継承
   - 差分があるテーブルのみ運営仕様書で指定

2. **選択的生成モード**
   - 全生成モード: 運営仕様書から全テーブルを生成（現状）
   - 差分生成モード: 変更があるテーブルのみ生成、他は継承

3. **バージョン管理の強化**
   - 各テーブルの変更履歴管理
   - リリースキーごとの差分レポート

**期待効果**:
- ファイル生成率: 100%達成
- 運営負荷の軽減（変更箇所のみ記載）

**実装工数**: 14-21日

---

#### 提案3-2: 機械学習による推測精度向上

**問題**: 推測値の精度が低く、手動修正が必要。

**具体的な改善案**:

1. **過去データからのパターン学習**
   - 類似イベントのパラメータ分析
   - ステージ進行、キャラクターグレードに応じた増加率学習
   - 異常値検出

2. **LLM活用の高度化**
   - 運営仕様書の自然言語処理精度向上
   - コンテキスト理解による推測
   - 曖昧な記載の自動補完

3. **推測精度のフィードバックループ**
   - 正解データとの差分を学習データとして活用
   - 推測ロジックの継続的改善

**期待効果**:
- 差分率: 5% → 0%達成
- 手動修正不要

**実装工数**: 30-60日（継続的改善）

---

#### 提案3-3: 並列実行による高速化

**問題**: 14個のスキルを順次実行するため、時間がかかる。

**具体的な改善案**:

1. **依存関係のない スキルの並列化**
   - Level 0スキル（item, hero, emblem, event-basic）は並列実行可能
   - 並列度: 4並列実行で約4倍高速化

2. **段階的並列実行**
   - Level 0完了後、Level 1を並列実行
   - 各Levelごとに並列化

**期待効果**:
- 実行時間: 約1/3に短縮

**実装工数**: 5-7日

---

## 4. 実装優先順位とロードマップ

### 4.1 優先順位マトリクス

| 提案 | 影響度 | 実装難易度 | 優先度 | 工数 |
|------|--------|----------|-------|------|
| **1-1. スキル呼び出しトリガー改善** | 極大 | 中 | 🔴 最優先 | 3-5日 |
| **1-2. 部分実行スキル改善** | 大 | 低 | 🔴 最優先 | 2-3日 |
| **1-3. ID生成ロジック統一** | 大 | 中 | 🟡 高 | 2-3日 |
| **2-1. データ依存関係自動管理** | 中 | 中 | 🟡 高 | 5-7日 |
| **2-2. アセット・パラメータ推測向上** | 中 | 中 | 🟢 中 | 7-10日 |
| **2-3. 運営仕様書テンプレート整備** | 大 | 低 | 🟡 高 | 10-14日 |
| **3-1. 過去データ自動継承** | 大 | 高 | 🟢 中 | 14-21日 |
| **3-2. 機械学習活用** | 中 | 高 | 🟢 低 | 30-60日 |
| **3-3. 並列実行高速化** | 小 | 中 | 🟢 低 | 5-7日 |

### 4.2 実装ロードマップ

```
Week 1-2 (フェーズ1開始)
├─ 提案1-1: スキル呼び出しトリガー改善 ✓ (3-5日)
├─ 提案1-2: 部分実行スキル改善 ✓ (2-3日)
└─ 提案1-3: ID生成ロジック統一 ✓ (2-3日)
   ⇒ ファイル生成率: 32% → 92%
   ⇒ 差分率: 68% → 40%

Week 3-4 (フェーズ1完了検証)
└─ 検証・調整

Week 5-8 (フェーズ2開始)
├─ 提案2-1: データ依存関係自動管理 ✓ (5-7日)
├─ 提案2-2: アセット・パラメータ推測向上 ✓ (7-10日)
└─ 提案2-3: 運営仕様書テンプレート整備 ✓ (10-14日)
   ⇒ ファイル生成率: 92% → 98%
   ⇒ 差分率: 40% → 5%

Week 9-12 (フェーズ2完了検証)
└─ 検証・調整

Month 4-6 (フェーズ3開始)
├─ 提案3-1: 過去データ自動継承 ✓ (14-21日)
├─ 提案3-2: 機械学習活用 ✓ (継続的改善)
└─ 提案3-3: 並列実行高速化 ✓ (5-7日)
   ⇒ ファイル生成率: 98% → 100%
   ⇒ 差分率: 5% → 0%
```

---

## 5. 期待効果

### 5.1 定量的効果

| 指標 | 現状 | フェーズ1後 | フェーズ2後 | フェーズ3後（目標） |
|------|------|-----------|-----------|----------------|
| **ファイル生成率** | 32.1% | 92% | 98% | **100%** |
| **完全一致率** | 32.0% | 60% | 90% | **100%** |
| **スキル実行率** | 43% | 100% | 100% | **100%** |
| **差分率** | 68% | 40% | 5% | **0%** |
| **手動修正工数** | 8時間/回 | 3時間/回 | 0.5時間/回 | **0時間/回** |
| **実行時間** | 20分 | 20分 | 15分 | **7分** |

### 5.2 定性的効果

**運営チームへの効果**:
- 運営仕様書作成の負荷軽減（テンプレート、チェックリスト提供）
- マスタデータ投入前の確認工数削減（自動検証）
- リリース準備期間の短縮

**開発チームへの効果**:
- 手動修正作業の削減
- 品質向上（人為的ミス削減）
- ナレッジの体系化（ドキュメント整備）

**プロジェクト全体への効果**:
- リリースサイクルの高速化
- 開発効率の向上
- 属人化の解消

---

## 6. リスクと対策

### 6.1 実装リスク

| リスク | 発生確率 | 影響度 | 対策 |
|--------|---------|-------|------|
| スキル呼び出しロジック改善時の既存機能破壊 | 中 | 高 | テストケース整備、段階的リリース |
| 運営仕様書テンプレート変更への抵抗 | 中 | 中 | 運営チームとの事前調整、移行期間設定 |
| 過去データ継承ロジックのバグ | 低 | 高 | 十分なテスト、ドライラン実施 |
| 機械学習モデルの精度不足 | 中 | 低 | 段階的導入、人間による最終確認 |

### 6.2 運用リスク

| リスク | 発生確率 | 影響度 | 対策 |
|--------|---------|-------|------|
| 新しいテーブル追加時の対応漏れ | 高 | 中 | 定期的なDBスキーマ確認、未対応テーブル検出機能 |
| 運営仕様書フォーマット変更 | 中 | 中 | フォーマットバージョン管理、後方互換性確保 |
| 推測ロジックの陳腐化 | 中 | 低 | 定期的な精度モニタリング、再学習 |

---

## 7. 次のステップ

### 7.1 即座に実施すべきアクション

1. **フェーズ1の開発開始**（Week 1-2）
   - 提案1-1: スキル呼び出しトリガー改善の実装
   - 提案1-2: 部分実行スキル改善の実装
   - 提案1-3: ID生成ロジック統一の実装

2. **テストデータセットの準備**
   - リリースキー202601010での検証
   - 他のリリースキーでの汎用性確認

3. **ステークホルダーへの共有**
   - 本レポートを運営チーム、開発チームに共有
   - 改善提案への合意形成
   - 実装スケジュールの確定

### 7.2 中長期的な取り組み

1. **継続的改善サイクルの確立**
   - リリースごとの精度モニタリング
   - 差分レポートの定期的な分析
   - 改善ポイントの抽出と実装

2. **ナレッジベースの構築**
   - ID命名規則、アセットキー生成ルール等のドキュメント化
   - 過去の差分事例のデータベース化
   - ベストプラクティスの共有

3. **ツールチェーンの整備**
   - 運営仕様書検証ツール
   - マスタデータ差分可視化ツール
   - 自動テストスイート

---

## 8. まとめ

### 8.1 重要な発見

1. **運営仕様書の網羅性は問題ではない**（90%カバー）
2. **スキルの実装カバレッジも問題ではない**（78%カバー）
3. **真の問題は「スキル実行率43%」**（7個のスキルが実行されず）

### 8.2 改善の核心

**ファイル生成率32.1%の根本原因は、運営仕様書からスキルを呼び出す認識ロジックの不備です。**

この1点を改善すれば、ファイル生成率は劇的に向上します（32% → 92%）。その上で、データ依存関係、推測精度、運営仕様書テンプレート等の改善を積み重ねることで、**最終的に100%の精度を達成できます**。

### 8.3 実現可能性

本提案は、以下の理由から**実現可能**です：

1. **段階的アプローチ**: フェーズ1で大きな成果を出し、段階的に精度を高める
2. **具体的な改善案**: 抽象的な提案ではなく、実装レベルの具体案
3. **合理的な工数**: フェーズ1は1-2週間、フェーズ2は1-2ヶ月と現実的
4. **検証済みの分析**: 4つの詳細分析タスクに基づく根拠ある提案

### 8.4 最後に

本改善提案の実施により、**マスタデータ作成の完全自動化**が実現し、運営チーム・開発チームの負荷が大幅に軽減されます。これにより、リリースサイクルの高速化、品質向上、属人化の解消が達成され、プロジェクト全体の生産性が向上します。

---

**End of Report**
