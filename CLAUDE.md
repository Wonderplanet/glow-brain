# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

---

## プロジェクト概要

glow-brainは、**GLOWゲームプロジェクト全体の開発支援のための統合コンテキストリポジトリ**です。

### 目的

- GLOWプロジェクトに関する**あらゆる相談**に対応
- GLOWプロジェクトで**何かを作る**際の支援
- server/client/masterdataのコードベースを1箇所に集約し、横断的な理解と開発を可能にする

### ユースケース例

- マスタデータCSVの作成・検証
- サーバーAPIとクライアント実装の整合性確認
- 新機能の設計と実装相談
- バグ調査とトラブルシューティング
- コードベース横断的な調査
- 運営施策の技術的実現可能性の検討

---

## リポジトリ構造

```
glow-brain/
├── projects/              # GLOWプロジェクトの4リポジトリを集約
│   ├── glow-server/      # サーバー実装（API、DB）
│   ├── glow-client/      # クライアント実装（Unity/C#）
│   ├── glow-masterdata/  # マスタデータ（CSV）
│   └── glow-schema/      # API通信・マスタデータ配信スキーマ定義
├── マスタデータ/           # 運営仕様書と生成データ
├── .claude/              # Claude Code拡張機能
│   ├── skills/          # カスタムスキル
│   ├── commands/        # カスタムコマンド
│   ├── agents/          # サブエージェント
│   └── docs/            # 内部ドキュメント
├── scripts/              # セットアップスクリプト
├── docs/                 # プロジェクトドキュメント
└── config/               # 設定ファイル
```

### projects/配下の4リポジトリ

このリポジトリの最も重要な特徴は、**4つの独立したリポジトリを1箇所に集約**していることです。

| リポジトリ | 役割 | 主要技術 |
|-----------|------|---------|
| **glow-server** | バックエンドAPI、DB定義 | TypeScript, PostgreSQL |
| **glow-client** | ゲームクライアント | Unity, C# |
| **glow-masterdata** | マスタデータ管理 | CSV |
| **glow-schema** | API通信・マスタデータ配信スキーマ定義 | JSON, Ruby |

**重要な注意点**:
- これらは**参照専用**です（`.git`ディレクトリは削除済み）
- Git submoduleではなく、通常のディレクトリとして管理
- 実際の変更は各リポジトリで行う
- `config/versions.json`で管理されたバージョン・ブランチ状態

---

## バージョン管理

`config/versions.json`で複数バージョンのコードベースを管理しています。

```json
{
  "current_version": "v1.5.0-devld",
  "versions": {
    "v1.5.0-devld": {
      "glow-server": "develop/v1.5.0",
      "glow-client": "release/v1.5.0",
      "glow-masterdata": "release/dev-ld"
    }
  }
}
```

各バージョンごとに専用ブランチを作成し、異なるバージョンのコードベースを並行管理できます。

---

## 主要なデータソース

### 1. DBスキーマ

**パス**: `projects/glow-server/api/database/schema/exports/master_tables_schema.json`

テーブル定義、カラムの型、制約、enum値などが定義されています。

### 2. マスタデータCSV

**パス**: `projects/glow-masterdata/*.csv`

ゲームで使用される実際のマスタデータ。

### 3. サーバーAPI実装

**パス**: `projects/glow-server/`

TypeScriptで実装されたバックエンドAPI。

### 4. クライアント実装

**パス**: `projects/glow-client/`

Unity/C#で実装されたゲームクライアント。主要な場所:
- `Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated/` - マスタデータクラス（自動生成）
- `Assets/GLOW/Scripts/Runtime/Core/Domain/` - ドメイン層
- `Assets/GLOW/Scripts/Runtime/Core/Data/Translators/` - Data→Model変換

### 5. API通信・マスタデータ配信スキーマ

**パス**: `projects/glow-schema/`

サーバー・クライアント間の通信仕様を定義するリポジトリ:
- **APIリクエスト/レスポンススキーマ** - サーバーAPIのリクエスト・レスポンス構造定義
- **マスタデータ配信スキーマ** - サーバーからクライアントへ配信するマスタデータの構造定義

主要な内容:
- `Schema/` - スキーマ定義ファイル（JSON形式）
- `SchemaBuilder/` - スキーマからコード生成を行うツール

---

## 利用可能なスキルとエージェント

このリポジトリには、GLOW開発を支援するカスタムスキルとエージェントが用意されています。

### スキル

- **masterdata-explorer** - マスタデータのスキーマ調査とSQL分析
- **masterdata-csv-validator** - マスタデータCSVの検証
- **plugin-marketplace-creator** - プラグインマーケットプレイス作成

詳細は各スキルの`SKILL.md`を参照してください。

### サブエージェント

- **pln-masterdata-creator** - 運営仕様書からマスタデータCSVを作成

詳細は`.github/agents/`を参照してください。

---

## 主要なワークフロー例

### マスタデータ作成

運営仕様書（`マスタデータ/運営仕様/<名前>/要件/`）からマスタデータCSVを作成するワークフローが整備されています。

詳細は以下を参照:
- `.ai-context/prompts/運営仕様書からマスタデータ作成の手順書.md`
- `.claude/skills/masterdata-csv-validator/SKILL.md`
- `.github/agents/pln-masterdata-creator.agent.md`

### コードベース調査

4つのリポジトリを横断的に調査できます。

例:
- 特定のマスタデータテーブルがどこで使われているかを調査
- サーバーAPIとクライアント実装の対応関係を確認
- 新機能に必要なマスタデータテーブルを特定

---

## テーブル命名規則

GLOWプロジェクトでは、DBスキーマとCSVファイルで異なる命名規則を使用しています。

| 種類 | 命名規則 | 例 |
|------|---------|-----|
| **DBスキーマ** | snake_case + 複数形 | `mst_events`, `opr_gachas` |
| **CSVファイル** | PascalCase + 単数形 | `MstEvent.csv`, `OprGacha.csv` |

**プレフィックス**:
- `mst_*` / `Mst*` - 固定マスタデータ
- `opr_*` / `Opr*` - 運営施策・期間限定データ

---

## 参考ドキュメント

このリポジトリには詳細なドキュメントが用意されています。

### プロジェクト運用

- `docs/glow-brain運用/glow-brainプロジェクト管理のGit化手順.md` - Git管理化手順
- `.claude/docs/skills-best-practices.md` - スキル作成ガイド
- `.claude/docs/subagent-best-practices.md` - サブエージェント作成ガイド

### マスタデータ関連

- `.ai-context/prompts/運営仕様書からマスタデータ作成の手順書.md` - マスタデータ作成の詳細手順
- `マスタデータ/docs/マスターテーブル一覧調査方法.md` - テーブル調査方法
- `.claude/skills/masterdata-explorer/SKILL.md` - スキーマ調査とSQL分析
- `.claude/skills/masterdata-csv-validator/SKILL.md` - CSV検証

### その他

- `.claude/skills/plugin-marketplace-creator/SKILL.md` - プラグイン作成ガイド
