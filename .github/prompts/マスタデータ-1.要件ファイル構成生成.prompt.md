---
description: 施策ディレクトリ内の要件フォルダを分析して要件ファイル構成Markdownを生成
argument-hint: strategy-directory-path
agent: 'agent'
---

# 要件ファイル構成ドキュメント生成

指定された施策ディレクトリ内の「要件/」フォルダを分析し、わかりやすいMarkdownドキュメントを生成します。

## コンテキスト

- **対象**: 施策ディレクトリ内の「要件/」フォルダ（HTMLファイル、仕様書、設計書など）
- **言語**: 言語非依存
- **範囲**: `[施策ディレクトリ]/要件/`
- **出力**: `[施策ディレクトリ]/要件ファイル構成.md`

## タスク

指定された施策ディレクトリ（引数で受け取る）内の「要件/」フォルダを分析し、以下の手順でドキュメントを生成してください：

1. **ファイル一覧の取得**
   - Globツールを使用して「要件/」フォルダ内の全ファイルをリストアップ
   - ファイルの拡張子、名前、パターンを把握
   - ファイル数が多い場合は主要なファイルに絞る

2. **ファイル内容の分析**
   - 主要なファイル（目次、インデックス、READMEなど）を優先的に読み込み
   - ファイル名の命名規則やパターンを識別
   - ファイル間のリンクや参照関係を把握

3. **カテゴリ分類**
   - ファイルを論理的なカテゴリに分類
   - 番号付きファイル（01_, 02_など）は順序を尊重
   - テンプレート、バックアップ、未使用ファイルを区別

4. **関係性の図示**
   - ファイル間の依存関係や階層構造を明確化
   - 親子関係、参照関係をテキストベースの図で表現
   - データフローや処理順序を示す

5. **ドキュメント生成**
   - Markdownファイルとして出力
   - ファイル名: `要件ファイル構成.md`
   - 保存先: 施策ディレクトリ直下（要件フォルダと同階層）

## ベストプラクティス

### 構造化

- 見出しレベルを適切に使用（#、##、###）
- 箇条書きとネストで階層を表現
- コードブロック（\`\`\`）でファイル構造を図示

### カテゴリ分類の基準

- **番号順ファイル**: 00_, 01_, 02_などの接頭辞
- **役割別**: 目次、仕様書、設計書、テンプレート、補助資料
- **状態別**: 使用中、テンプレート、廃棄予定、バックアップ

### ファイル関係性の表現

テキストベースのツリー構造を使用：
\`\`\`
メインファイル.html (ルート)
├── カテゴリA
│   ├── ファイル1.html ────→ 詳細
│   └── ファイル2.html ────→ 詳細
├── カテゴリB
│   ├── ファイル3.html
│   └── ファイル4.html ────→ カテゴリAを参照
└── その他
    └── テンプレート.html
\`\`\`

### 説明の書き方

- 各ファイルの役割を簡潔に説明
- 他のファイルとの関係を明記
- 使用時の注意点があれば記載

## 出力形式

以下の構造でMarkdownドキュメントを生成してください：

\`\`\`markdown
# [ディレクトリ名] ファイル構造

## 概要
[ディレクトリの目的と内容の概要]

## ファイル構造

### 1. [カテゴリ1]
- **ファイル名1** - [役割の説明]
- **ファイル名2** - [役割の説明]

### 2. [カテゴリ2]
- **ファイル名3** - [役割の説明]

## ファイル間の関係性

\`\`\`
[テキストベースの関係図]
\`\`\`

## 主要データの流れ

1. **[ステップ1]**: [ファイル名] - [処理内容]
2. **[ステップ2]**: [ファイル名] - [処理内容]

## テンプレートファイル
[テンプレートとして使用可能なファイルのリスト]

## 注意事項
[使用時の注意点、命名規則、ベストプラクティスなど]
\`\`\`

## 処理フロー

### ステップ1: ディレクトリの確認
\`\`\`
ディレクトリパスを引数から取得
↓
Globツールでファイル一覧を取得
↓
ファイル数、拡張子、パターンを確認
\`\`\`

### ステップ2: 主要ファイルの特定
\`\`\`
目次ファイルを検索（index, 目次, TOCなど）
↓
番号付きファイル（00_, 01_など）を抽出
↓
テンプレート、バックアップを識別
\`\`\`

### ステップ3: 内容分析
\`\`\`
主要ファイルを読み込み
↓
タイトル、見出し、リンクを抽出
↓
ファイル間の参照関係を把握
\`\`\`

### ステップ4: ドキュメント生成
\`\`\`
カテゴリ分類
↓
関係図の作成
↓
Markdownファイルとして出力
\`\`\`

## 対応ファイル形式

以下のファイル形式に対応：
- HTML (.html, .htm)
- Markdown (.md)
- テキスト (.txt)
- 設計書・仕様書（任意の形式）
- ドキュメント全般

## 命名規則の認識

以下のパターンを自動認識：
- **番号付き**: `01_概要.html`, `02_仕様.html`
- **テンプレート**: `*テンプレ*.html`, `*template*.md`
- **バックアップ**: `*のコピー*.html`, `*backup*.md`
- **未使用**: `使用しない_*.html`, `*_old.*`
- **目次**: `目次.html`, `index.html`, `TOC.md`

## 注意事項

### ファイル読み込み時
- 大きなファイル（25000トークン以上）は先頭部分のみ読み込む
- HTMLファイルはタイトルタグ、見出しタグを優先的に抽出
- エンコーディングエラーに注意

### カテゴリ分類時
- 番号順は必ず順序を保つ
- テンプレートと正式版を明確に区別
- 廃棄予定ファイルは別セクションに分離

### ドキュメント生成時
- 日本語ファイル名に対応
- マルチバイト文字を正しく処理
- ファイルパスは相対パスで記載

## 使用例

### 基本的な使用方法
\`\`\`
/マスタデータ-1.要件ファイル構成生成 マスタデータ/施策/新春ガチャ
\`\`\`

この場合、以下のフォルダを分析：
\`\`\`
マスタデータ/施策/新春ガチャ/要件/
\`\`\`

生成されるファイル:
\`\`\`
マスタデータ/施策/新春ガチャ/要件ファイル構成.md
\`\`\`

## 期待される出力

生成されるMarkdownドキュメントには以下が含まれます：

1. **明確な階層構造**: ファイルがカテゴリごとに整理
2. **視覚的な関係図**: テキストベースのツリー構造
3. **データフロー**: 処理の流れが理解できる
4. **実用的な情報**: テンプレート、注意事項、ベストプラクティス
5. **日本語対応**: 日本語ファイル名、日本語説明文

## トラブルシューティング

### ファイルが多すぎる場合
- 主要ファイル（目次、番号付き）に絞る
- サブディレクトリごとに分けて処理

### ファイル内容が読めない場合
- ファイル名とパターンから推測
- 既に読めたファイルからの参照情報を活用

### 関係性が不明な場合
- 命名規則から推測
- 番号順や日付順でグループ化
