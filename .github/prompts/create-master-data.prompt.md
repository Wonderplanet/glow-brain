---
description: GLOWプロジェクトの施策マスタデータCSVを生成
agent: 'agent'
argument-hint: 施策名 追加パラメータ...
---

# GLOW施策マスタデータ生成

GLOWプロジェクトにおいて、施策マスタデータCSVファイルを自動生成します。
要件CSVファイルを読み込み、既存マスタデータを参照しながら、適切なマスタデータを作成します。

## コンテキスト

- **プロジェクト**: GLOW（スマートフォンゲーム）
- **言語**: PHP/Laravel（サーバー）、C#/Unity（クライアント）
- **データ形式**: CSV
- **参照先**: `.ai-context/prompts/施策マスタデータ作成ガイド.md`

## 施策名の指定

施策名を入力してください: ${input:campaign_name:施策名を入力（例: 20251222_クリスマスフェス限_イベント＋ガシャ＋パック）}

追加パラメータ（オプション）: ${input:additional_params:追加パラメータがあれば入力}

## タスク

以下の手順に従って、施策マスタデータCSVを作成してください：

### Step 1: 既存リソースの確認徹底

報酬として設定するキャラクター、アイテム、通貨などのリソースは、**必ず以下の順序で存在を確認**してください：

1. **01_概要ファイルを確認**
   - 施策全体の概要と主要リソースの定義を確認
   - キャラクターID、アイテムID、通貨IDなどの基本情報を把握

2. **報酬一覧ファイルを確認**（存在する場合）
   - 施策で使用される報酬の定義リストを確認
   - 各報酬のタイプ、ID、数量などを把握

3. **他の要件CSVファイルを検索**
   - 関連する要件ファイル内でリソースIDが定義されているか検索
   - ファイル横断的にリソースの一貫性を確認

4. **既存マスタデータを検索**
   - `projects/glow-masterdata/` 配下のマスタデータCSVを検索
   - リソースIDが既に登録されているか確認
   - 登録されていない場合は、類似するリソースの命名規則を確認

詳細は `@.ai-context/prompts/施策マスタデータ作成ガイド.md` の「報酬設定時の既存リソース確認」セクションを参照してください。

### Step 2: コンテンツタイプ判定とグルーピング

要件ファイルの内容から、**類似する機能を持つCSVファイルを同じグループにまとめて処理**してください。

#### 判定基準の例：

| ファイル名パターン | マスタデータタイプ |
|------------------|------------------|
| ガシャ、ガチャ | OprGacha系 |
| ミッション | MstMissionEvent系 |
| 降臨、バトル | MstAdventBattle系 |
| ショップ、パック | MstPack系 |
| 交換 | MstExchange系 |

#### グルーピング後の処理：

- グループごとに**1つのサブタスク（subagent）**を割り当て
- 可能な限り**並列処理**を行う
- 各グループ内で関連するCSVファイルをまとめて生成

### Step 3: マスタデータ生成

以下の原則に従ってマスタデータCSVを生成してください：

1. **既存フォーマットの踏襲**
   - 既存マスタデータのCSVフォーマットを確認
   - カラム名、データ型、記述ルールを踏襲

2. **ID採番ルールの遵守**
   - 既存のID採番パターンを分析
   - 施策固有のIDレンジを確認
   - 重複しないIDを割り当て

3. **関連データの整合性**
   - 複数のマスタデータ間で参照されるIDの整合性を確保
   - 親子関係があるデータは適切に紐付け

4. **バリデーション**
   - 必須カラムの欠損がないか確認
   - データ型の妥当性を確認
   - 日付フォーマットの統一

## ベストプラクティス

### masterdata-explorerスキルの活用

本プロンプトの実行には、`masterdata-explorer`スキル（Claude Codeプラグイン）を併用することを想定しています。
このスキルは以下の機能を提供します：

- **マスタデータ検索**: 既存マスタデータCSVの検索と分析
- **リソースID検証**: リソースIDの存在確認
- **フォーマット分析**: CSVフォーマットの自動解析
- **命名規則抽出**: ID採番パターンの推定

GitHub Copilotでは、これらの機能を直接使用できないため、以下の代替アプローチを推奨します：

1. `search/codebase`ツールを使用して既存マスタデータを検索
2. `githubRepo`ツールを使用してファイル構造を把握
3. 必要に応じてカスタムスクリプトを作成してCSV分析

### データの安全性

- **存在しないリソースIDは絶対に設定しない**
  - 後続のデータ投入時にエラーが発生します
  - 必ず既存マスタデータまたは要件ファイルで確認

- **リソースが見つからない場合の対応**
  - 検索範囲を拡大（他の施策のマスタデータも確認）
  - ユーザーに確認を求める
  - 仮のIDを使用する場合は明記し、後で置換が必要であることを伝える

### 施策マスタデータ作成ガイドの参照

**必ず** `@.ai-context/prompts/施策マスタデータ作成ガイド.md` の内容に従ってください。
このガイドには以下の情報が含まれています：

- 詳細なマスタデータ作成手順
- コンテンツタイプごとの設定例
- よくある問題とその解決策
- 命名規則とID採番ルール

## 出力形式

### 生成されるファイル

施策マスタデータは以下のディレクトリ構造で出力してください：

```
projects/glow-masterdata/
└── campaigns/
    └── [施策名]/
        ├── OprGacha_[施策ID].csv
        ├── MstMissionEvent_[施策ID].csv
        ├── MstAdventBattle_[施策ID].csv
        ├── MstPack_[施策ID].csv
        └── ...
```

### CSVフォーマット

各CSVファイルは以下の形式で出力：

```csv
"カラム1","カラム2","カラム3",...
"値1","値2","値3",...
```

- **エンコーディング**: UTF-8
- **改行コード**: LF
- **引用符**: ダブルクォートで囲む
- **区切り文字**: カンマ

### 実行結果サマリー

生成完了後、以下の情報を含むサマリーを出力：

```markdown
## マスタデータ生成完了

### 生成ファイル一覧
- [x] OprGacha_[施策ID].csv (10レコード)
- [x] MstMissionEvent_[施策ID].csv (25レコード)
- [x] MstPack_[施策ID].csv (5レコード)

### 使用したリソースID
- キャラクター: 1001, 1002, 1003
- アイテム: 2001, 2002
- 通貨: 3001

### 確認が必要な項目
- [ ] キャラクターID 1004は要件に記載があるが既存マスタに存在しません
- [ ] イベント期間の終了日時を確認してください

### 次のステップ
1. 生成されたCSVファイルを確認
2. データ投入用のスクリプトを実行
3. テスト環境での動作確認
```

## 注意事項

### 重要な制約

- ❌ **存在しないリソースIDを設定しない**
  - データ投入時にエラーが発生します
  - 必ず既存マスタデータで確認してください

- ❌ **IDの重複を避ける**
  - 既存のマスタデータと重複しないIDを採番
  - 施策固有のIDレンジを使用

- ❌ **フォーマットを変更しない**
  - 既存マスタデータのCSVフォーマットを厳守
  - カラム順序、データ型、命名規則を踏襲

### トラブルシューティング

**リソースが見つからない場合**:
1. 検索範囲を拡大（関連施策のマスタデータも確認）
2. 要件ファイルの記載ミスの可能性を考慮
3. ユーザーに確認を求める
4. 仮IDを使用する場合は明記し、TODO化

**CSVフォーマットが不明な場合**:
1. 既存の類似マスタデータを参照
2. サーバーコード（Laravel）のモデル定義を確認
3. データベーススキーマを確認

**ID採番ルールが不明な場合**:
1. 既存マスタデータの採番パターンを分析
2. 施策ID・イベントIDのレンジを確認
3. 安全なIDレンジを使用（例: 900000番台をテスト用に確保）

## 参考リソース

- `.ai-context/prompts/施策マスタデータ作成ガイド.md`: 詳細な作成ガイド
- `projects/glow-masterdata/`: 既存マスタデータの参照
- `projects/glow-server/app/Models/`: Laravelモデル定義
- 要件CSVファイル: 施策固有の仕様定義

---

**GitHub Copilot使用上の注意**:
このプロンプトはClaude Codeの`create-master-data`コマンドを元に作成されています。
Claude Code特有の機能（`masterdata-explorer`スキルなど）は、GitHub Copilotでは利用できないため、
代替手段としてcodebase検索やカスタムスクリプトを活用してください。
