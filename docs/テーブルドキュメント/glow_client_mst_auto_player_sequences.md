# mst_auto_player_sequences テーブル使用方法詳細調査レポート

## 1. データ構造

### 1.1 テーブル列定義

**マスターデータCSVファイル**: `projects/glow-masterdata/MstAutoPlayerSequence.csv`

主要な列:
- `id`: レコードの一意識別子
- `sequence_set_id`: シーケンスセットID(ステージごとに設定)
- `sequence_group_id`: グループID(シーケンスをグループ化して切り替え可能に)
- `sequence_element_id`: 各シーケンス要素の識別子
- `priority_sequence_element_id`: 優先シーケンス要素ID(同時活性化時の非活性判定用)
- `condition_type`: 活性化条件タイプ(ElapsedTime, OutpostDamage等)
- `condition_value`: 活性化条件値
- `action_type`: アクションタイプ(SummonEnemy, SummonGimmickObject等)
- `action_value`: アクション値(召喚する敵IDなど)
- `action_value2`: 第2アクション値(変換系で使用)
- `summon_count`: 召喚回数(-1で無限)
- `summon_interval`: 召喚間隔(Tick)
- `summon_animation_type`: 召喚アニメーションタイプ
- `summon_position`: 召喚位置
- `move_start_condition_type`: 移動開始条件タイプ
- `move_start_condition_value`: 移動開始条件値
- `move_stop_condition_type`: 移動停止条件タイプ
- `move_stop_condition_value`: 移動停止条件値
- `move_restart_condition_type`: 移動再開条件タイプ
- `move_restart_condition_value`: 移動再開条件値
- `move_loop_count`: 移動ループ回数
- `aura_type`: オーラタイプ
- `death_type`: 死亡タイプ
- `override_drop_battle_point`: ドロップバトルポイント上書き
- `defeated_score`: 撃破時スコア
- `enemy_hp_coef`: 敵HP係数
- `enemy_attack_coef`: 敵攻撃力係数
- `enemy_speed_coef`: 敵速度係数
- `action_delay`: アクション遅延(Tick)
- `deactivation_condition_type`: 非活性化条件タイプ
- `deactivation_condition_value`: 非活性化条件値
- `is_summon_unit_outpost_damage_invalidation`: 召喚ユニットの拠点ダメージ無効化フラグ

### 1.2 データクラスの構造

**MstAutoPlayerSequenceData**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated/MstAutoPlayerSequenceData.cs`

```csharp
public class MstAutoPlayerSequenceData
{
    public string Id { get; set; }
    public string SequenceSetId { get; set; }
    public string SequenceElementId { get; set; }
    public string SequenceGroupId { get; set; }
    public string? PrioritySequenceElementId { get; set; }
    public AutoPlayerSequenceConditionType ConditionType { get; set; }
    public string ConditionValue { get; set; }
    public AutoPlayerSequenceActionType ActionType { get; set; }
    public string ActionValue { get; set; }
    public string ActionValue2 { get; set; }
    public SummonAnimationType SummonAnimationType { get; set; }
    public int SummonCount { get; set; }
    public int SummonInterval { get; set; }
    public int ActionDelay { get; set; }
    public float SummonPosition { get; set; }
    public MoveStartConditionType MoveStartConditionType { get; set; }
    public long MoveStartConditionValue { get; set; }
    public MoveStopConditionType MoveStopConditionType { get; set; }
    public long MoveStopConditionValue { get; set; }
    public MoveStartConditionType MoveRestartConditionType { get; set; }
    public long MoveRestartConditionValue { get; set; }
    public int MoveLoopCount { get; set; }
    public UnitAuraType AuraType { get; set; }
    public UnitDeathType DeathType { get; set; }
    public int? OverrideDropBattlePoint { get; set; }
    public int DefeatedScore { get; set; }
    public float EnemyHpCoef { get; set; }
    public float EnemyAttackCoef { get; set; }
    public float EnemySpeedCoef { get; set; }
    public AutoPlayerSequenceConditionType DeactivationConditionType { get; set; }
    public string DeactivationConditionValue { get; set; }
    public bool IsSummonUnitOutpostDamageInvalidation { get; set; }

    // ObscuredTypes: チート対策のため全フィールドが難読化型で保持
}
```

### 1.3 ドメインモデルへの変換

**MstAutoPlayerSequenceElementModel**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Models/MasterData/MstAutoPlayerSequenceElementModel.cs`

```csharp
public record MstAutoPlayerSequenceElementModel(
    AutoPlayerSequenceSetId SequenceSetId,
    AutoPlayerSequenceElementId SequenceElementId,
    AutoPlayerSequenceGroupId SequenceGroupId,
    AutoPlayerSequenceElementId PrioritySequenceElementId,
    SequenceCondition ActivationCondition,          // 活性化条件
    SequenceCondition DeactivationCondition,        // 非活性化条件
    AutoPlayerSequenceAction Action,                // 実行アクション
    SummonAnimationType SummonAnimationType,
    AutoPlayerSequenceSummonCount SummonCount,
    TickCount SummonInterval,
    TickCount ActionDelay,
    FieldCoordV2 SummonPosition,
    MoveStartConditionType MoveStartConditionType,
    MoveStartConditionValue MoveStartConditionValue,
    MoveStopConditionType MoveStopConditionType,
    MoveStopConditionValue MoveStopConditionValue,
    MoveStartConditionType MoveRestartConditionType,
    MoveStartConditionValue MoveRestartConditionValue,
    MoveLoopCount MoveLoopCount,
    UnitAuraType AuraType,
    UnitDeathType DeathType,
    DropBattlePoint OverrideDropBattlePoint,
    InGameScore DefeatedScore,
    AutoPlayerSequenceCoefficient EnemyHpCoef,
    AutoPlayerSequenceCoefficient EnemyAttackCoef,
    AutoPlayerSequenceCoefficient EnemySpeedCoef,
    OutpostDamageInvalidationFlag IsSummonUnitOutpostDamageInvalidation)
```

**変換処理**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Translators/MstAutoPlayerSequenceDataTranslator.cs`

```csharp
public static MstAutoPlayerSequenceElementModel TranslateToElement(MstAutoPlayerSequenceData data)
{
    // GroupIdの変換(空文字列をEmpty値オブジェクトに)
    var groupId = string.IsNullOrEmpty(data.SequenceGroupId)
        ? AutoPlayerSequenceGroupId.Empty
        : new AutoPlayerSequenceGroupId(data.SequenceGroupId);

    // Condition生成
    var condition = CreateSequenceCondition(data.ConditionType, data.ConditionValue);
    var deactivationCondition = CreateSequenceCondition(data.DeactivationConditionType, data.DeactivationConditionValue);

    // Action生成
    var action = new AutoPlayerSequenceAction(
        data.ActionType,
        new AutoPlayerSequenceActionValue(data.ActionValue),
        new AutoPlayerSequenceActionValue(data.ActionValue2));

    // 召喚回数(-1で無限)
    var summonCount = data.SummonCount < 0
        ? AutoPlayerSequenceSummonCount.Infinity
        : new AutoPlayerSequenceSummonCount(data.SummonCount);

    // 召喚位置(0以下ならEmpty)
    var summonPosition = data.SummonPosition <= 0f
        ? FieldCoordV2.Empty
        : new FieldCoordV2(data.SummonPosition, 0f);

    return new MstAutoPlayerSequenceElementModel(...);
}
```

## 2. 読み込みと参照

### 2.1 データ取得フロー

```
MasterDataRepository (GetMstAutoPlayerSequence)
    ↓
DataStore.Get<MstAutoPlayerSequenceData>() (全データ取得)
    ↓
MstAutoPlayerSequenceDataTranslator.TranslateToElement() (各要素を変換)
    ↓
sequence_set_idでフィルタ
    ↓
MstAutoPlayerSequenceModel生成
```

**Repository実装**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Repositories/MasterData/MasterDataRepository.cs:3026-3042`

```csharp
MstAutoPlayerSequenceModel GetMstAutoPlayerSequence(AutoPlayerSequenceSetId mstAutoPlayerSequenceSetId)
{
    // キャッシュから全要素取得
    var elements = GetOrCreateModelCache(CreateMstAutoPlayerSequenceElementModels)
        .Where(m => m.SequenceSetId == mstAutoPlayerSequenceSetId)
        .ToList();

    return MstAutoPlayerSequenceDataTranslator.Translate(mstAutoPlayerSequenceSetId, elements);
}

IReadOnlyList<MstAutoPlayerSequenceElementModel> CreateMstAutoPlayerSequenceElementModels()
{
    return DataStore.Get<MstAutoPlayerSequenceData>()
        .Select(MstAutoPlayerSequenceDataTranslator.TranslateToElement)
        .ToList();
}
```

### 2.2 参照元クラス

**AutoPlayerSequenceModelFactory**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/ModelFactories/AutoPlayerSequenceModelFactory.cs`

```csharp
public AutoPlayerSequenceModel Create(AutoPlayerSequenceSetId mstAutoPlayerSequenceSetId)
{
    // Repositoryからマスターデータ取得
    var mstModel = MstAutoPlayerSequenceRepository.GetMstAutoPlayerSequence(mstAutoPlayerSequenceSetId);

    // 敵召喚要素をグループ化してボスカウント計算
    var enemySummonElementGroup = mstModel.EnemySummonElements
        .GroupBy(element => element.Action.Value)
        .Select(group => new
        {
            MstEnemyStageParameterModel = MstEnemyCharacterDataRepository.GetEnemyStageParameter(group.Key.ToMasterDataId()),
            MstAutoPlayerSequenceElementModels = group
        })
        .ToList();

    var summonEnemies = enemySummonElementGroup
        .Select(group => group.MstEnemyStageParameterModel)
        .ToList();

    // ボスの合計召喚数を計算
    var bossCount = enemySummonElementGroup
        .Where(group => group.MstEnemyStageParameterModel.IsBoss)
        .SelectMany(group => group.MstAutoPlayerSequenceElementModels)
        .Aggregate(
            AutoPlayerSequenceSummonCount.Empty,
            (current, element) => current + element.SummonCount
        );

    return new AutoPlayerSequenceModel(mstModel, summonEnemies, bossCount);
}
```

### 2.3 実行時の変換・拡張

**AutoPlayerSequenceElementStateModel**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Models/AutoPlayerSequenceElementStateModel.cs`

マスターデータから実行時状態を持つモデルへ変換:

```csharp
public record AutoPlayerSequenceElementStateModel(
    MstAutoPlayerSequenceElementModel ElementModel,        // マスターデータ
    ICommonConditionModel ActivationCondition,             // 実行可能な条件モデル
    ICommonConditionModel DeactivationCondition,           // 非活性条件モデル
    AutoPlayerSequenceElementActivatedFlag IsActivated,    // 活性化済みフラグ
    AutoPlayerSequenceElementDeactivatedFlag IsDeactivated,// 非活性化済みフラグ
    TickCount RemainingSummonInterval,                     // 残り召喚間隔
    TickCount RemainingActionDelay,                        // 残り遅延時間
    AutoPlayerSequenceSummonCount RemainingSummonCount)    // 残り召喚回数
```

**Factory**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/ModelFactories/AutoPlayerSequenceElementStateModelFactory.cs`

```csharp
public AutoPlayerSequenceElementStateModel Create(MstAutoPlayerSequenceElementModel elementModel, BattleSide battleSide)
{
    // ConditionTypeをCommonConditionTypeに変換(Enemy/Player側で異なる条件に変換)
    var activationConditionType = ToCommonConditionType(elementModel.ActivationCondition.Type, battleSide);
    var activationCondition = CommonConditionModelFactory.Create(
        activationConditionType,
        elementModel.ActivationCondition.Value.ToCommonConditionValue());

    var deactivationConditionType = ToCommonConditionType(elementModel.DeactivationCondition.Type, battleSide);
    var deactivationCondition = CommonConditionModelFactory.Create(
        deactivationConditionType,
        elementModel.DeactivationCondition.Value.ToCommonConditionValue());

    return new AutoPlayerSequenceElementStateModel(
        elementModel,
        activationCondition,
        deactivationCondition,
        AutoPlayerSequenceElementActivatedFlag.False,    // 初期は非活性
        AutoPlayerSequenceElementDeactivatedFlag.False,
        new TickCount(0),                                // 召喚間隔は0から開始
        elementModel.ActionDelay,                        // 遅延時間設定
        elementModel.SummonCount);                       // 召喚回数設定
}
```

## 3. 他テーブルとの関連

### 3.1 関連マスターデータテーブル

```
mst_auto_player_sequences
    ↓ sequence_set_id
mst_stages (MstAutoPlayerSequenceSetId列)
mst_in_game (MstAutoPlayerSequenceSetId列)
mst_pvp_battle (MstAutoPlayerSequenceSetId列)
mst_advent_battle (MstAutoPlayerSequenceSetId列)

    ↓ action_value (when action_type = SummonEnemy)
mst_enemy_stage_parameter
    ↓
mst_enemy_character

    ↓ action_value (when action_type = SummonGimmickObject)
mst_in_game_gimmick_object

    ↓ mst_page_id (from mst_in_game)
mst_page
    ↓
mst_koma
```

### 3.2 データフロー図

```
[ゲーム起動]
    ↓
[ステージ選択] → MstStage取得 → MstAutoPlayerSequenceSetId取得
    ↓
[InGame初期化] → InitializeInGameUseCase
    ↓
[EnemyAutoPlayerInitializer.Initialize]
    ├→ AutoPlayerSequenceModelFactory.Create
    │   ├→ MstAutoPlayerSequenceRepository.GetMstAutoPlayerSequence
    │   │   └→ MstAutoPlayerSequenceData読み込み → MstAutoPlayerSequenceElementModel変換
    │   ├→ 敵召喚要素からMstEnemyStageParameter取得
    │   └→ ボス数カウント
    │
    ├→ SequenceAutoPlayerProcessor生成
    │   └→ AutoPlayerSequenceElementStateModelFactory.Create
    │       └→ 各要素を実行時状態モデルに変換
    │
    └→ EnemyAutoPlayer.SetAutoPlayerProcessor

[ゲームループ]
    ↓
[AutoPlayerUpdateProcess.UpdateAutoPlayer] (毎フレーム)
    ├→ CommonConditionContext生成(現在状態)
    ├→ EnemyAutoPlayer.Tick
    │   └→ SequenceAutoPlayerProcessor.Tick
    │       ├→ UpdateActivationFlags (条件チェック・活性化)
    │       ├→ UpdateActionDelay (遅延処理)
    │       ├→ UpdateSummonStatus (召喚処理)
    │       │   └→ CreateAction → AutoPlayerSummonEnemyAction等生成
    │       └→ UpdateTransformStatus (変換処理)
    │
    └→ Actionに応じてユニット召喚/変換実行
```

## 4. ゲーム内での使用フロー

### 4.1 初期化処理の呼び出しフロー

**InitializeInGameUseCase**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/UseCases/InitializeInGameUseCase.cs:222-227`

```csharp
// 敵AIの初期化
var enemySequenceModel = EnemyAutoPlayerInitializer.Initialize(
    mstInGameModel.MstAutoPlayerSequenceSetId,  // ステージ/クエストから取得したSetId
    mstPage,
    mstInGameModel,
    pvpOpponentDeckUnits);
```

**EnemyAutoPlayerInitializer**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/InGameInitializers/EnemyAutoPlayerInitializer.cs`

```csharp
public MstAutoPlayerSequenceModel Initialize(
    AutoPlayerSequenceSetId mstAutoPlayerSequenceSetId,
    MstPageModel mstPageModel,
    IStageEnemyParameterCoef stageEnemyParameterCoef,
    IReadOnlyList<DeckUnitModel> deckUnits)
{
    if (deckUnits == null || deckUnits.Count == 0)
    {
        // 通常のクエスト: AutoPlayerSequence使用
        return InitializeAutoPlayerSequence(
            mstAutoPlayerSequenceSetId,
            mstPageModel,
            stageEnemyParameterCoef);
    }
    else
    {
        // PvP: DeckAutoPlayer使用
        InitializeDeckAutoPlayer(deckUnits);
        return MstAutoPlayerSequenceModel.Empty;
    }
}

MstAutoPlayerSequenceModel InitializeAutoPlayerSequence(...)
{
    // 1. AutoPlayerSequenceModel作成
    var autoPlayerSequenceModel = AutoPlayerSequenceModelFactory.Create(mstAutoPlayerSequenceSetId);

    // 2. Processor作成
    var autoPlayerProcessor = new SequenceAutoPlayerProcessor();

    // 3. Setup実行(ElementStateModelに変換)
    autoPlayerProcessor.Setup(
        autoPlayerSequenceModel,
        BattleSide.Enemy,
        mstPageModel,
        stageEnemyParameterCoef,
        AutoPlayerSequenceElementStateModelFactory,
        InitialCharacterUnitCoefFactory);

    // 4. AutoPlayerに設定
    EnemyAutoPlayer.SetAutoPlayerProcessor(autoPlayerProcessor);
    EnemyAutoPlayer.IsEnabled = AutoPlayerEnabledFlag.True;

    return autoPlayerSequenceModel.MstAutoPlayerSequenceModel;
}
```

### 4.2 AutoPlayerSequenceの実行タイミング

**AutoPlayerUpdateProcess**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/UpdateProcess/AutoPlayerUpdateProcess.cs`

毎フレーム実行される更新処理:

```csharp
public AutoPlayerUpdateProcessResult UpdateAutoPlayer(...)
{
    // 1. 共通条件コンテキスト生成(現在のゲーム状態)
    var commonConditionContext = new CommonConditionContext(
        CharacterUnitModel.Empty,
        units,
        deadUnits,
        totalDeadEnemyCount,
        playerOutpost,
        enemyOutpost,
        stageTime,
        komaDictionary,
        mstPage,
        EnemyAutoPlayer.CurrentAutoPlayerSequenceGroupModel);

    // 2. AutoPlayerコンテキスト生成
    var autoPlayerTickContext = new AutoPlayerTickContext(...);

    // 3. Enemy側のAutoPlayer実行
    IReadOnlyList<IAutoPlayerAction> enemyActions = EnemyAutoPlayer.IsEnabled
        ? EnemyAutoPlayer.Tick(autoPlayerTickContext)
        : new List<IAutoPlayerAction>();

    // 4. Actionに基づいてユニット召喚
    var enemyTupleList = enemyActions
        .Select(action => action.ToSummonEnemyAction())
        .Where(action => !action.IsEmpty())
        .Select(action => (
            Action: action,
            MstEnemyCharacterModel: MstEnemyCharacterDataRepository.GetEnemyStageParameter(action.EnemyId)))
        .ToList();

    // 5. ボス召喚はキューに登録
    // 6. 通常敵は即座に召喚
    // 7. ギミック→敵変換処理
}
```

**SequenceAutoPlayerProcessor.Tick**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/AutoPlayer/SequenceAutoPlayerProcessor.cs`

```csharp
public IReadOnlyList<IAutoPlayerAction> Tick(AutoPlayerTickContext context)
{
    _elapsedTickCount += tickCount;  // 経過時間更新

    // 1. 活性化フラグ更新(条件チェック)
    var updatedElementStateModelsAtActivatedFlag = UpdateActivationFlags(elementStateModels, commonConditionContext);

    // 2. アクション遅延更新
    var updatedElementStateModelsAtActionDelay = UpdateActionDelay(updatedElementStateModelsAtActivatedFlag, tickCount);

    // 3. 召喚処理
    var updatedSummonStatusAndSummonActions = UpdateSummonStatus(updatedElementStateModelsAtActionDelay, unitGenerationModelFactory);
    autoPlayerActions.AddRange(updatedSummonStatusAndSummonActions.actions);

    // 4. 変換処理
    var updatedTransformActions = UpdateTransformStatus(...);
    autoPlayerActions.AddRange(updatedTransformActions.actions);

    // 5. シーケンスグループ切り替え
    if (TryGetSwitchSequenceGroup(out var nextGroupId))
    {
        _autoPlayerSequencer.SwitchSequenceGroup(nextGroupId, _elapsedTickCount);
    }

    return autoPlayerActions;
}
```

### 4.3 ギミックオブジェクト初期化

**InGameGimmickObjectInitializer**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/InGameInitializers/InGameGimmickObjectInitializer.cs`

```csharp
IReadOnlyList<InGameGimmickObjectModel> Initialize(
    MstAutoPlayerSequenceModel mstAutoPlayerSequenceModel,
    IReadOnlyDictionary<KomaId, KomaModel> komaDictionary,
    MstPageModel mstPage)
{
    // InitialSummon条件のギミックオブジェクト召喚要素を取得
    var initialGimmickObjectSummonElements = mstAutoPlayerSequenceModel.GimmickObjectSummonElements
        .Where(e => e.ActivationCondition.Type == AutoPlayerSequenceConditionType.InitialSummon)
        .Where(e => e.SummonPosition != FieldCoordV2.Empty);

    var gimmickObjectModels = new List<InGameGimmickObjectModel>();
    foreach (var autoPlayerSequenceElement in initialGimmickObjectSummonElements)
    {
        var generationModel = InGameGimmickObjectGenerationModelFactory.Create(autoPlayerSequenceElement);
        var mstGimmickObjectModel = MstInGameGimmickObjectDataRepository.GetMstInGameGimmickObjectModel(generationModel.MstInGameGimmickObjectId);
        var gimmickObjectModel = InGameGimmickObjectFactory.Generate(
            generationModel,
            mstGimmickObjectModel.AssetKey,
            komaDictionary,
            mstPage);
        gimmickObjectModels.Add(gimmickObjectModel);
    }

    return gimmickObjectModels;
}
```

## 5. 各列の具体的な使われ方

### 5.1 Condition系フィールド

**AutoPlayerSequenceConditionType**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Constants/AutoGenerated/AutoPlayerSequenceConditionType.cs`

```csharp
public enum AutoPlayerSequenceConditionType
{
    None,                                   // 条件なし
    ElapsedTime,                           // 経過時間
    OutpostDamage,                         // 拠点ダメージ量
    OutpostHpPercentage,                   // 拠点HP割合
    InitialSummon,                         // 初期召喚
    EnterTargetKomaIndex,                  // 指定コマ進入
    DarknessKomaCleared,                   // 闇コマクリア
    FriendUnitDead,                        // 味方ユニット死亡
    FriendUnitTransform,                   // 味方ユニット変身
    FriendUnitSummoned,                    // 味方ユニット召喚
    SequenceElementActivated,              // シーケンス要素活性化
    ElapsedTimeSinceSequenceGroupActivated // グループ活性化後経過時間
}
```

**使用タイミング**: `SequenceAutoPlayerProcessor.UpdateActivationFlags`で毎フレームチェック

```csharp
bool MeetsCondition(ICommonConditionModel conditionModel, CommonConditionContext commonConditionContext)
{
    return conditionModel.MeetsCondition(commonConditionContext);
}
```

**BattleSide別条件変換**: `AutoPlayerSequenceElementStateModelFactory.ToCommonConditionType`

```csharp
InGameCommonConditionType ToCommonConditionType(AutoPlayerSequenceConditionType sequenceConditionType, BattleSide battleSide)
{
    return sequenceConditionType switch
    {
        AutoPlayerSequenceConditionType.InitialSummon => InGameCommonConditionType.StageReady,
        AutoPlayerSequenceConditionType.ElapsedTime => InGameCommonConditionType.StageTime,
        AutoPlayerSequenceConditionType.OutpostDamage =>
            battleSide == BattleSide.Enemy
                ? InGameCommonConditionType.EnemyOutpostDamage
                : InGameCommonConditionType.None,
        // ...
    };
}
```

### 5.2 Action系フィールド

**AutoPlayerSequenceActionType**: `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Constants/AutoGenerated/AutoPlayerSequenceActionType.cs`

```csharp
public enum AutoPlayerSequenceActionType
{
    None,
    SummonEnemy,                      // 敵召喚
    SummonPlayerCharacter,            // プレイヤーキャラ召喚(PvP用)
    SwitchSequenceGroup,              // シーケンスグループ切り替え
    PlayerSpecialAttack,              // プレイヤー必殺技
    SummonPlayerSpecialCharacter,     // プレイヤー特殊キャラ召喚
    SummonGimmickObject,              // ギミックオブジェクト召喚
    TransformGimmickObjectToEnemy,    // ギミック→敵変換
    OpponentRush                      // 対戦相手ラッシュ
}
```

**Action実行**: `SequenceAutoPlayerProcessor.CreateAction`

```csharp
IAutoPlayerAction CreateAction(MstAutoPlayerSequenceElementModel sequenceElement, IUnitGenerationModelFactory unitGenerationModelFactory)
{
    return sequenceElement.Action.Type switch
    {
        AutoPlayerSequenceActionType.SummonEnemy =>
            new AutoPlayerSummonEnemyAction(
                sequenceElement.Action.Value.ToMasterDataId(),
                unitGenerationModelFactory.Create(sequenceElement, _battleSide, _stageEnemeyParameterCoef, _coefFactory)),

        AutoPlayerSequenceActionType.SummonPlayerCharacter =>
            new AutoPlayerSummonDeckUnitAction(sequenceElement.Action.Value.ToDeckUnitIndex()),

        AutoPlayerSequenceActionType.SummonGimmickObject =>
            AutoPlayerEmptyAction.Instance,  // 初期配置のみ有効

        AutoPlayerSequenceActionType.TransformGimmickObjectToEnemy =>
            new AutoPlayerTransformGimmickObjectToEnemyAction(
                sequenceElement.Action.Value.ToMasterDataId(),
                unitGenerationModelFactory.Create(sequenceElement, _battleSide, _stageEnemeyParameterCoef, _coefFactory),
                sequenceElement.Action.Value2.ToAutoPlayerSequenceElementId()),

        _ => AutoPlayerEmptyAction.Instance
    };
}
```

### 5.3 召喚関連フィールド

**summon_count**: 召喚回数(-1で無限)
- `AutoPlayerSequenceSummonCount`型に変換
- `UpdateSummonStatus`で減算処理

```csharp
// 召喚間隔を減らす
var updatedRemainingSummonInterval = elementStateModel.RemainingSummonInterval - new TickCount(1);
var updatedRemainingSummonCount = elementStateModel.RemainingSummonCount;

// 召喚処理
if (updatedRemainingSummonInterval.IsZero())
{
    actions.Add(CreateAction(elementModel, unitGenerationModelFactory));

    // 召喚間隔リセットと可能回数減らす
    updatedRemainingSummonInterval = elementModel.SummonInterval;
    updatedRemainingSummonCount -= 1;
}
```

**summon_interval**: 召喚間隔(Tick単位)
- 初期値として設定され、召喚後にリセット

**summon_position**: 召喚位置(X座標)
- `FieldCoordV2(x, 0f)`に変換
- ギミックオブジェクト初期配置で使用

**action_delay**: アクション遅延時間
- 活性化してから実行までの遅延
- `UpdateActionDelay`で毎フレーム減算

### 5.4 係数フィールド

**enemy_hp_coef / enemy_attack_coef / enemy_speed_coef**:
- `AutoPlayerSequenceCoefficient`型に変換
- `UnitGenerationModelFactory.Create`でユニット生成時のパラメータ補正に使用

### 5.5 特殊フィールド

**priority_sequence_element_id**: 優先シーケンス要素ID
- 同時活性化時、このIDのシーケンスが活性化していたら自分を非活性化

```csharp
// 今回同時活性したSequenceの中に活性化の優先IDのSequenceがあったら非活性化する
foreach (var elementModel in activateElementStateModels)
{
    if (elementModel.ElementModel.PrioritySequenceElementId.IsEmpty())
    {
        result.Add(elementModel);
        continue;
    }

    var isDeactivation = activateElementStateModels.Any(anotherElement =>
        anotherElement.ElementModel.SequenceElementId == elementModel.ElementModel.PrioritySequenceElementId);
    if (isDeactivation)
    {
        var updateElementModel = elementModel with
        {
            IsDeactivated = AutoPlayerSequenceElementDeactivatedFlag.True,
        };
        result.Add(updateElementModel);
        continue;
    }
    result.Add(elementModel);
}
```

**sequence_group_id**: シーケンスグループID
- グループ単位でシーケンスを管理
- `SwitchSequenceGroup`アクションで別グループに切り替え可能

**deactivation_condition_type / deactivation_condition_value**: 非活性化条件
- 活性化後、この条件を満たすと非活性化される

## 6. 実例

### 6.1 マスターデータ実例

```csv
# 例1: 経過時間による敵召喚(無限)
sequence_set_id: develop_002
sequence_element_id: sequence_1
condition_type: ElapsedTime
condition_value: 0
action_type: SummonEnemy
action_value: test_01
summon_count: -1  (無限)
summon_interval: 500
enemy_hp_coef: 1
enemy_attack_coef: 1
enemy_speed_coef: 1
```

```csv
# 例2: 拠点ダメージによる1回限りの召喚
sequence_set_id: develop_001
sequence_element_id: sequence_1
condition_type: OutpostDamage
condition_value: 1
action_type: SummonEnemy
action_value: a2e_0012
summon_count: 1
summon_interval: 0
summon_animation_type: Fall
```

```csv
# 例3: シーケンスグループ切り替え
sequence_set_id: develop_advent_battle
sequence_group_id: group1
sequence_element_id: sequence_3
condition_type: ElapsedTimeSinceSequenceGroupActivated
condition_value: 3000
action_type: SwitchSequenceGroup
action_value: group2  (次のグループID)
```

```csv
# 例4: 初期召喚ギミックオブジェクト
sequence_set_id: XX
sequence_element_id: gimmick_1
condition_type: InitialSummon
action_type: SummonGimmickObject
action_value: gimmick_object_id
summon_position: 2.5  (X座標)
```

### 6.2 具体的なコード箇所

| 機能 | ファイルパス | 行番号 |
|------|-------------|--------|
| データクラス定義 | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated/MstAutoPlayerSequenceData.cs` | 21-204 |
| Translator | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Translators/MstAutoPlayerSequenceDataTranslator.cs` | 14-89 |
| ドメインモデル | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Models/MasterData/MstAutoPlayerSequenceElementModel.cs` | 9-86 |
| Repository取得 | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Repositories/MasterData/MasterDataRepository.cs` | 3026-3042 |
| Factory | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/ModelFactories/AutoPlayerSequenceModelFactory.cs` | 14-42 |
| 初期化 | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/InGameInitializers/EnemyAutoPlayerInitializer.cs` | 26-67 |
| 実行時Processor | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/AutoPlayer/SequenceAutoPlayerProcessor.cs` | 54-396 |
| 更新処理 | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/UpdateProcess/AutoPlayerUpdateProcess.cs` | 31-265 |
| ギミック初期化 | `projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/InGame/Domain/Battle/InGameInitializers/InGameGimmickObjectInitializer.cs` | 19-43 |

---

## まとめ

`mst_auto_player_sequences` テーブルは、GLOWのゲーム内での敵の出現や行動を制御する中核的なマスターデータです。

### 主な特徴:

1. **条件ベースの活性化**: 経過時間、拠点ダメージ、コマ進入など多様な条件で敵やギミックの出現をコントロール
2. **柔軟な召喚システム**: 召喚回数、間隔、遅延、係数により細かい調整が可能
3. **グループによる切り替え**: シーケンスをグループ化し、動的に切り替えることでフェーズ制バトルを実現
4. **型安全な設計**: C#のレコード型と値オブジェクトで堅牢なドメインモデルを構築
5. **毎フレーム実行**: `AutoPlayerUpdateProcess`で常に条件をチェックし、リアルタイムに敵を召喚

このテーブルは、ステージの難易度設計やゲームバランス調整において非常に重要な役割を果たしています。
