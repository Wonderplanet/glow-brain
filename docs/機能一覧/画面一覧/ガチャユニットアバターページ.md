# ガチャユニットアバターページ

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | ガチャユニットアバターページ |
| **画面種別** | UIコンポーネント（画面部品） |

## 概要

ガチャコンテンツ画面内で、ガチャで排出されるユニットのアバター（キャラクター画像）を表示するためのUIコンポーネントです。プレイヤーはスワイプ操作で複数のユニットを切り替えて確認できます。独立した画面ではなく、ガチャコンテンツ画面の一部として機能します。

このコンポーネントは`UnitAvatarPageViewController`を継承しており、Spineアニメーションを使用したユニットの表示機能を提供します。

## プレイヤーができること

### ユニットのビジュアル確認

#### アバター表示
- ガチャで排出されるユニットのキャラクター画像を表示
- Spineアニメーションによる動きのあるビジュアル
- キャラクターの向き（左右反転）が設定可能
- 幻影化（Phantomized）状態の表示対応

#### 複数ユニットの切り替え
- 左右スワイプでユニットを切り替え
- ページインジケーターで現在のユニット位置を表示
- スワイプ時にユニットが歩行アニメーションで移動
- 切り替え完了時に待機アニメーションに戻る

### アニメーション表示

#### 待機アニメーション
- ユニットが待機状態で表示される
- 通常時のデフォルトアニメーション

#### 移動アニメーション
- スワイプ操作中にユニットが歩行モーションを再生
- ページ遷移時に自動的に再生される

#### レベルアップアニメーション
- 特定の演出時にレベルアップエフェクトを表示
- ガチャ演出などで使用

## 画面の要素

### メイン表示エリア
- **ユニットアバター**: Spineアニメーションで動くキャラクター画像
- **影表示**: キャラクターの足元に表示される影
- **キャラクターカラー**: ユニットのカラーバリエーションに対応

### ページコントロール
- **ページインジケーター**: 現在表示中のユニット位置を示すドット
- **スワイプエリア**: 左右スワイプでユニットを切り替え可能

## 画面遷移

### この画面への遷移
このコンポーネントは独立した画面ではなく、以下の画面内で使用されます：
- **ガチャコンテンツ画面**: 排出ユニットの表示部分として組み込まれる

### この画面からの遷移
- 遷移なし（UIコンポーネントのため）

## ゲーム仕様・制約事項

### ユニット切り替えの仕様
- 左右スワイプでユニットをページ送り
- スワイプ中は移動アニメーションが再生される
- スワイプ完了時に待機アニメーションに自動的に切り替わる
- ページ切り替えがキャンセルされた場合は元の表示に戻る

### アニメーション制御
- ユニット表示が初期化される前にアニメーション変更が呼ばれた場合、初期化後に適用される
- 初期化中は設定がキャッシュされ、準備完了後に反映される

### 表示制御
- ユニットの読み込みが完了するまでアバターは非表示
- アセット読み込み完了後にフェードイン表示

### 最小ユニット数
- UIPageViewの仕様上、ユニットが3つ未満の場合は表示が正常に動作しないため、内部的にリストを複製して3つ以上にする処理が実装されている

## 技術参考情報

### 画面実装パス
- `Assets/GLOW/Scripts/Runtime/Scenes/GachaUnitAvatarPage/`
- `Assets/GLOW/Scripts/Runtime/Modules/UnitAvatarPageView/`（親クラス）

### 主要コンポーネント

#### Presenter
- `Presentation/Presenters/GachaUnitAvatarPagePresenter.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaUnitAvatarPage/Presentation/Presenters/GachaUnitAvatarPagePresenter.cs)

#### View
- `Presentation/Views/GachaUnitAvatarPageViewController.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaUnitAvatarPage/Presentation/Views/GachaUnitAvatarPageViewController.cs)
- `Presentation/Views/IGachaUnitAvatarPageViewDelegate.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaUnitAvatarPage/Presentation/Views/IGachaUnitAvatarPageViewDelegate.cs)

#### 親クラス（共通機能）
- `Modules/UnitAvatarPageView/Presentation/Views/UnitAvatarPageViewController.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Modules/UnitAvatarPageView/Presentation/Views/UnitAvatarPageViewController.cs)
- `Modules/UnitAvatarPageView/Presentation/Views/IUnitAvatarPageViewDelegate.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Modules/UnitAvatarPageView/Presentation/Views/IUnitAvatarPageViewDelegate.cs)

#### リスト管理コンポーネント
- `Scenes/GachaContent/Presentation/Views/GachaUnitAvatarPageListComponent.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaContent/Presentation/Views/GachaUnitAvatarPageListComponent.cs)

### UnitAvatarPageViewControllerの構造
親クラスである`UnitAvatarPageViewController`が提供する主要機能：
- **SetupAvatar(unitImageAssetPath, color, isPhantomized)**: ユニットアバターの初期設定
- **SetFlip(isFlip)**: キャラクターの向きを設定（左右反転）
- **PlayLevelUpAnimation()**: レベルアップアニメーションを再生
- **PlayWaitAnimation()**: 待機アニメーションを再生
- **PlayMoveAnimation()**: 移動アニメーションを再生

### 画面初期化時の引数
```csharp
IUnitAvatarPageViewController.Argument(MasterDataId MstUnitId)
```
表示対象のユニットのマスターデータIDを引数として渡す

### GachaUnitAvatarPageListComponentの役割
複数のGachaUnitAvatarPageを管理するリストコンポーネント：
- **Setup()**: ユニットリストの初期化とページビューのセットアップ
- **ScrollToNextPage()**: 次のページへスクロール
- **ScrollToPrevPage()**: 前のページへスクロール
- **ShowLevelUpAnimation()**: 現在表示中のユニットにレベルアップアニメーションを再生
- **ResetUnitAnimation()**: ユニットアニメーションを待機状態にリセット
- **GetUnitId()**: 現在表示中のユニットIDを取得

### 使用しているDBデータ

#### マスタデータ

| テーブル名 | カラム名 | 説明 |
|-----------|---------|------|
| **MstCharacter** (mst_units)<br>キャラクターマスタ | AssetKey | キャラクターアセットキー（Spineアニメーションのパス生成用） |
| | Color | キャラクターカラー（属性、影の色に反映される） |

### 呼び出しているAPI

なし（表示専用コンポーネントのため、API呼び出しは行わない）
