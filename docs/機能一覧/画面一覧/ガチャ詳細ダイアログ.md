# ガチャ詳細ダイアログ

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | ガチャ詳細ダイアログ |
| **画面番号** | 71-1-8-2 |
| **画面種別** | モーダルダイアログ |

## 概要

ガチャ詳細ダイアログは、ガチャコンテンツ画面から開くことができるモーダルダイアログです。選択したガチャに関する詳細な情報（お知らせ・注意事項）をWebビューで表示します。タブで切り替えることができ、お知らせがない場合はタブ自体が非表示になります。

## プレイヤーができること

### 情報の閲覧

#### お知らせタブ
- ガチャに関連するお知らせをWebビューで閲覧
- ガチャの開催期間、新キャラクター情報、イベント詳細などが表示される
- お知らせがない場合、このタブは表示されない

#### 注意事項タブ
- ガチャに関する注意文言をWebビューで閲覧
- ガチャの利用規約、確率に関する説明などが表示される

### タブの切り替え

- お知らせと注意事項の2つのタブを切り替えて表示
- 現在表示中のタブをタップしても切り替わらない
- お知らせがない場合は注意事項のみが表示され、タブは非表示

### ダイアログを閉じる

- 閉じるボタンをタップしてダイアログを終了
- バックキー（Androidの戻るボタン）でも閉じることができる
- ダイアログを閉じると、元のガチャコンテンツ画面に戻る

## 画面の要素

### ヘッダー部分
- タイトル表示エリア
- 閉じるボタン

### タブエリア
- お知らせタブボタン（お知らせがある場合のみ表示）
- 注意事項タブボタン
- お知らせがない場合、タブエリア全体が非表示

### メイン表示エリア
- WebViewコンテンツ表示エリア
- 選択されたタブに応じて、お知らせまたは注意事項のHTMLコンテンツを表示

## 画面遷移

### この画面への遷移
- **ガチャコンテンツ画面**: 「詳細」ボタンをタップ

### この画面からの遷移
- **ガチャコンテンツ画面**: 閉じるボタンまたはバックキーで戻る

## ゲーム仕様・制約事項

### 初期表示タブの決定
- お知らせがある場合: お知らせタブを初期表示
- お知らせがない場合: 注意事項タブのみを表示し、タブ切り替えUI自体を非表示

### お知らせの取得
- 初回表示時にお知らせデータがキャッシュされていない場合、サーバーからお知らせ一覧を取得してキャッシュ
- キャッシュがある場合はキャッシュから該当のお知らせURLを取得
- お知らせIDが設定されていないガチャの場合、お知らせなしとして扱う

### 注意事項の取得
- 注意事項はローカルのHTMLファイルを参照（`gacha_caution/html/{ガチャ注意ID}.html`）
- ガチャ注意IDが設定されていない場合、注意事項なしとして扱う

### タブ切り替えの挙動
- タブをタップすると、現在のWebViewを破棄し、新しいタブのWebViewを表示
- 既に選択されているタブをタップした場合は何も起こらない

## 技術参考情報

### 画面実装パス
- `Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/`

### 主要コンポーネント

#### Presenter
- `Presentation/Presenters/GachaDetailDialogPresenter.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/Presenters/GachaDetailDialogPresenter.cs)

#### ViewModel
- `Presentation/ViewModels/GachaDetailDialogViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/ViewModels/GachaDetailDialogViewModel.cs)

#### View
- `Presentation/Views/GachaDetailDialogView.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/Views/GachaDetailDialogView.cs)
- `Presentation/Views/GachaDetailDialogViewController.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/Views/GachaDetailDialogViewController.cs)
- `Presentation/Views/GachaDetailAnnouncementWebViewController.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/Views/GachaDetailAnnouncementWebViewController.cs)
- `Presentation/Views/GachaDetailCautionWebViewController.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/Views/GachaDetailCautionWebViewController.cs)

#### UseCase
- `Domain/UseCases/GachaDetailDialogUseCase.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Domain/UseCases/GachaDetailDialogUseCase.cs)

#### WireFrame
- `Presentation/Presenters/GachaDetailContentWireFrame.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaDetailDialog/Presentation/Presenters/GachaDetailContentWireFrame.cs)

### GachaDetailDialogViewModelの構造

画面に表示するコンテンツのURL情報を保持：
- `AnnouncementContentsUrl`: お知らせのコンテンツURL
- `GachaCautionContentsUrl`: ガチャ注意事項のコンテンツURL

### 画面初期化時の引数

```csharp
GachaDetailDialogViewController.Argument(
    GachaDetailDialogViewModel(
        AnnouncementContentsUrl, // お知らせURL
        GachaCautionContentsUrl  // 注意事項URL
    )
)
```

引数として渡されたViewModelには、以下の情報が含まれる：
- お知らせのURL（ある場合）
- 注意事項のHTML相対パス

### タブタイプの定義

`GachaDetailTabType`列挙型で管理：
- `Announcement`: お知らせタブ
- `Caution`: 注意事項タブ

### 呼び出しているAPI

#### お知らせ情報の取得（キャッシュがない場合のみ）
- **GET `/information/index?now={ISO8601形式の日時}`**: お知らせ一覧取得API
  - パラメータ: `now` (現在時刻をISO 8601形式で指定)
  - 用途: お知らせがキャッシュされていない場合に、全てのお知らせを取得してキャッシュに保存し、該当ガチャのお知らせURLを特定する

※注意事項はローカルHTMLファイルのため、API呼び出しはありません。
