# GachaContent画面（ガチャコンテンツ画面）

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | GachaContent（ガチャコンテンツ画面） |
| **画面パス** | `Assets/GLOW/Scripts/Runtime/Scenes/GachaContent/` |
| **Presenter** | `GachaContentPresenter.cs` |
| **ViewController** | `GachaContentViewController` |
| **画面種別** | サブ画面（モーダル/オーバーレイ） |
| **画面番号** | 71-1-1（ガシャトップ） |

## 概要説明

特定のガチャの詳細情報を表示し、ガチャを実行するための画面。ガチャの残り時間、コスト、排出ユニット、提供割合などを表示します。

## 主要機能

### ガチャ実行機能
- **単発ガチャ**: 1回分のガチャを実行
  - コスト表示（ダイヤ/チケット）
  - コスト不足時のグレーアウト表示
  - 回数制限の表示
- **10連ガチャ**: 10回分のガチャを実行
  - コスト表示（ダイヤ/チケット）
  - コスト不足時のグレーアウト表示
  - 確定枠情報の表示
  - 回数制限の表示
- **広告ガチャ**: 広告視聴による無料ガチャ
  - 残り回数表示
  - リセット時間表示

### 情報表示機能
- **ガチャ基本情報**
  - ガチャ名
  - ガチャロゴ
  - 開催期間、残り時間
  - ガチャ説明文
- **排出ユニット情報**
  - 排出対象ユニット一覧
  - ユニット画像、名前、レアリティ
  - ユニット詳細表示（タップ時）
  - 必殺技プレビュー表示
- **ガチャ詳細情報**
  - 提供割合（確率）の表示
  - ガチャ詳細説明の表示
  - 天井情報の表示
  - 特定商取引法に基づく表記

### ガチャ実行制御
- **回数制限チェック**: 回数上限到達時のボタン無効化
- **コストチェック**: コスト不足時のグレーアウト、不足テキスト表示
- **開催期間チェック**: 開催期間外の場合の制御
- **解放条件チェック**: ガチャの解放条件による制御

## UI構成要素

### GachaContentViewModel
- **ガチャID** (GachaId)
- **ガチャ名** (GachaName)
- **ガチャタイプ** (GachaType)
- **終了日時** (EndAt)
- **残り時間テキスト** (GachaRemainingTimeText)
- **天井テキスト** (GachaThresholdText)
- **ガチャ説明** (GachaDescription)
- **ガチャロゴパス** (GachaLogoAssetPath)
- **解放条件タイプ** (GachaUnlockConditionType)

#### 単発ガチャ情報
- コストタイプ (SingleDrawCostType)
- コスト金額 (SingleDrawCostAmount)
- コストアイコンパス (SingleDrawCostIconAssetPath)
- 回数上限 (SingleDrawLimitCount)
- ボタン表示フラグ (IsDisplaySingleDrawButton)
- コスト充足フラグ (IsEnoughSingleDrawCostItem)

#### 10連ガチャ情報
- コストタイプ (MultiDrawCostType)
- コスト金額 (MultiDrawCostAmount)
- コストアイコンパス (MultiDrawCostIconAssetPath)
- 回数上限 (MultiDrawLimitCount)
- ボタン表示フラグ (IsDisplayMultiDrawButton)
- コスト充足フラグ (IsEnoughMultiDrawCostItem)
- 確定枠説明 (GachaFixedPrizeDescription)

#### 広告ガチャ情報
- ボタン表示フラグ (IsDisplayGachaAdDrawButton)
- 実行可能フラグ (CanAdGachaDraw)
- 残り回数 (AdGachaDrawableCount)
- リセット残り時間テキスト (AdGachaResetRemainingText)

#### 排出ユニット情報
- 排出ユニット一覧 (GachaDisplayUnitViewModels)

#### その他
- 広告スキップパス情報 (HeldAdSkipPassInfoViewModel)
- 回数上限到達フラグ (IsDrawableFlagByHasDrawLimitedCount)

### ViewModelのメソッド

#### ボタン状態制御メソッド
- `IsSingleDrawButtonEnabled()`: 単発ガチャボタンが押せる状態か
- `IsMultiDrawButtonEnabled()`: 10連ガチャボタンが押せる状態か
- `ShouldShowSingleDrawButtonGrayOut()`: 単発ボタンをグレーアウトするか
- `ShouldShowMultiDrawButtonGrayOut()`: 10連ボタンをグレーアウトするか

#### 表示制御メソッド
- `ShouldShowLackOfSingleItemText()`: 単発コスト不足テキストを表示するか
- `ShouldShowLackOfMultiItemText()`: 10連コスト不足テキストを表示するか
- `ShouldShowSingleGachaResources()`: 単発コスト表示をするか
- `ShouldShowMultiGachaResources()`: 10連コスト表示をするか
- `ShouldShowSingleLimitedCountText()`: 単発回数制限テキストを表示するか
- `ShouldShowMultiLimitedCountText()`: 10連回数制限テキストを表示するか
- `ShouldShowSingleDrawTicketCostText()`: 単発チケットコストテキストを表示するか
- `ShouldShowMultiDrawTicketCostText()`: 10連チケットコストテキストを表示するか

## 画面遷移

### 遷移元
- ガチャ一覧画面（GachaList）
- ホーム画面のガチャバナー

### 遷移先
- **ガチャ確認ダイアログ**: ガチャボタンタップ時
- **ユニット詳細**: 排出ユニット画像タップ時
- **ガチャ提供割合ダイアログ**: 提供割合ボタンタップ時
- **ガチャ詳細ダイアログ**: ガチャ詳細ボタンタップ時
- **特定商取引法Webビュー**: 特定商取引法ボタンタップ時
- **必殺技プレビュー**: 必殺技ボタンタップ時

## 関連ファイル

### Presenter
- `Presentation/Presenters/GachaContentPresenter.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaContent/Presentation/Presenters/GachaContentPresenter.cs:30): メインPresenter

### ViewModel
- `Presentation/ViewModels/GachaContentViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaContent/Presentation/ViewModels/GachaContentViewModel.cs:10): メインViewModel
- `Presentation/ViewModels/GachaDisplayUnitViewModel.cs`: 排出ユニットViewModel

### UseCase
- `Domain/UseCases/GachaContentUseCase.cs`: ガチャコンテンツUseCase
- `Domain/UseCases/GachaDetailDialogUseCase.cs`: ガチャ詳細ダイアログUseCase
- `Domain/UseCases/GachaRatioDialogUseCase.cs`: ガチャ提供割合ダイアログUseCase

### Translator
- `Presentation/Translator/GachaContentTranslator.cs`: ViewModelトランスレータ

### View
- `Presentation/Views/GachaContentView.cs`: メインView
- `Presentation/Views/GachaContentViewController.cs`: ViewController
- `Presentation/Views/GachaContentPageView.cs`: ページView
- `Presentation/Views/IGachaContentViewDelegate.cs`: Viewデリゲート

## 実装詳細

### 主要メソッド

#### IGachaContentViewDelegate.OnViewDidLoad()
画面読み込み時の初期化処理
- GachaWireFrameにViewControllerを登録
- ViewModelを取得してViewControllerに設定

#### IGachaContentViewDelegate.UpdateView()
画面更新処理
- ViewModelを再取得してViewControllerを更新

#### IGachaContentViewDelegate.ShowGachaConfirmDialogView(MasterDataId gachaId, GachaDrawType gachaDrawType, GachaDrawFromContentViewFlag gachaDrawFromContentViewFlag)
ガチャ確認ダイアログ表示
- GachaConfirmDialogViewControllerを生成
- モーダル表示

#### IGachaContentViewDelegate.OnUnitDetailViewButton(MasterDataId unitId)
ユニット詳細表示
- UnitDetailModalViewControllerを生成（最大ステータス表示）
- モーダル表示

#### IGachaContentViewDelegate.OnGachaProvisionRatioTapped(MasterDataId gachaId)
ガチャ提供割合表示
- ShowGachaRatioDialogView()を呼び出し

#### IGachaContentViewDelegate.OnGachaDetailButtonTapped(MasterDataId gachaId)
ガチャ詳細表示
- ShowGachaDetailDialogView()を呼び出し

#### ShowGachaRatioDialogView(MasterDataId gachaId)
ガチャ提供割合ダイアログ表示（非同期）
- GachaRatioDialogUseCaseでモデルを取得
- ViewModelに変換
- GachaWireFrameでダイアログを表示

#### ShowGachaDetailDialogView(MasterDataId gachaId)
ガチャ詳細ダイアログ表示（非同期）
- GachaDetailDialogUseCaseでモデルを取得
- ViewModelに変換
- GachaWireFrameでダイアログを表示

#### IGachaContentViewDelegate.OnSpecialAttackButtonTapped(MasterDataId unitId)
必殺技プレビュー表示
- UnitSpecialAttackPreviewViewControllerを生成
- スクロールを無効化
- HomeViewControllerで表示（ヘッダーより上に表示）
- クローズ時にスクロールを有効化

### Argument

```csharp
GachaContentViewController.Argument(MasterDataId GachaId)
```

画面表示時に表示対象のガチャIDを引数として渡す必要があります。

## 備考

- Zenjectによる依存性注入を使用
- UniTaskによる非同期処理
- MVPパターンでPresenterがViewとUseCaseを仲介
- GachaWireFrameを通じてガチャ関連の画面遷移を管理
- コスト種別によってUI表示を動的に切り替え
- 回数制限とコスト不足の2つの状態を管理

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| 2025-12-23 | 初版作成 |
