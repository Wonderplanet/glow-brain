# ガチャワイヤーフレーム

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | ガチャワイヤーフレーム（GachaWireFrame） |
| **画面種別** | 画面遷移管理層（直接プレイヤーに表示される画面ではない） |

## 概要

ガチャワイヤーフレームは、ガチャ関連の複数画面からの共通の画面遷移処理を一元管理するための中間層です。プレイヤーが直接見る画面ではなく、以下のような画面間の遷移を統一的に制御します：

- ガチャコンテンツ画面
- ガチャ一覧画面
- ガチャ提供割合ダイアログ
- ガチャラインナップダイアログ
- ユニット詳細モーダル
- アイテム詳細モーダル

これにより、各画面からの遷移ロジックが一箇所に集約され、一貫した画面遷移体験を提供します。

## 管理している画面遷移

### ガチャ詳細ダイアログの表示
- 各ガチャの詳細情報を表示するダイアログを開く
- ガチャIDとViewModelを受け取って表示

### ガチャ提供割合ダイアログの表示
- ガチャの提供割合（排出確率）を表示するダイアログを開く
- ガチャIDとViewModelを受け取って表示
- 表示中のダイアログインスタンスを保持し、閉じる処理も管理

### ガチャラインナップダイアログの表示
- ガチャで入手可能なアイテムのラインナップを表示するダイアログを開く
- ガチャIDとViewModelを受け取って表示
- 表示中のダイアログインスタンスを保持し、閉じる処理も管理

### アイコン詳細の表示
- リソースアイコン（ユニットまたはアイテム）をタップした際の詳細表示を制御
- **ユニットの場合**: ユニット詳細モーダルを表示
- **アイテムの場合**: アイテム詳細モーダルを表示

### ユニット詳細からの復帰処理
ユニット詳細モーダルを表示する際、開いた元のダイアログを記憶し、ユニット詳細を閉じた際に元のダイアログを再表示します。これにより、プレイヤーは詳細を見た後、元の画面に戻ってスクロール位置や選択タブを保持した状態で閲覧を続けられます。

#### 提供割合ダイアログから開いた場合
- ユニット詳細を閉じると、提供割合ダイアログが再表示される
- スクロール位置とタブの選択状態が復元される

#### ラインナップダイアログから開いた場合
- ユニット詳細を閉じると、ラインナップダイアログが再表示される
- スクロール位置とタブの選択状態が復元される

## ゲーム仕様・制約事項

### 画面遷移中の画面移動検知
ユニット詳細モーダルを表示している間にプレイヤーがホーム画面の別のコンテンツに移動した場合、ユニット詳細を閉じた際に元のダイアログは再表示されません。これにより、プレイヤーが意図的に移動した場合に古い画面が表示されるのを防ぎます。

### ダイアログの状態保持
- 提供割合ダイアログとラインナップダイアログは、それぞれ1つまでしか同時に表示できません
- ユニット詳細を開く際は元のダイアログを一時的に閉じ、復帰時に再作成します

### アイコンタップ時の処理
- 空のリソース（データが存在しない）の場合は、詳細表示を行いません
- リソースタイプに応じて適切な詳細画面（ユニット詳細またはアイテム詳細）を自動判別します

## 技術参考情報

### 画面実装パス
- `Assets/GLOW/Scripts/Runtime/Scenes/GachaWireFrame/`

### 主要コンポーネント

#### WireFrame
- `Presentation/Presenters/GachaWireFrame.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaWireFrame/Presentation/Presenters/GachaWireFrame.cs)

#### ValueObject
- `Presentation/ValueObject/UnitDetailViewContentType.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaWireFrame/Presentation/ValueObject/UnitDetailViewContentType.cs)

### GachaWireFrameの役割

ガチャワイヤーフレームは、以下の画面遷移を管理します：

#### 管理対象の画面
- **GachaContentViewController**: ガチャコンテンツ画面
- **IGachaListViewController**: ガチャ一覧画面
- **GachaDetailDialogViewController**: ガチャ詳細ダイアログ
- **GachaRatioDialogViewController**: ガチャ提供割合ダイアログ
- **GachaLineupDialogViewController**: ガチャラインナップダイアログ
- **UnitDetailModalViewController**: ユニット詳細モーダル
- **ItemDetailWireFrame**: アイテム詳細（別のWireFrame経由）

#### 主要メソッド

**画面の登録・解除**
- `RegisterGachaContentViewController()`: ガチャコンテンツ画面を登録
- `UnregisterGachaContentViewController()`: ガチャコンテンツ画面の登録解除
- `RegisterGachaListViewController()`: ガチャ一覧画面を登録
- `UnregisterGachaListViewController()`: ガチャ一覧画面の登録解除

**画面の表示**
- `ShowGachaContentView()`: ガチャコンテンツ画面を表示
- `ShowGachaDetailView()`: ガチャ詳細ダイアログを表示
- `ShowGachaRatioDialogView()`: ガチャ提供割合ダイアログを表示
- `ShowGachaLineUpDialogView()`: ガチャラインナップダイアログを表示

**ダイアログの閉じる処理**
- `OnCloseGachaRatioDialogViewAndInvokeAction()`: 提供割合ダイアログを閉じ、コールバックを実行
- `OnCloseGachaLineUpDialogViewAndInvokeAction()`: ラインナップダイアログを閉じ、コールバックを実行

**アイコン詳細の表示**
- `OnClickIconDetail()`: リソースアイコンをタップした際の詳細表示を制御
  - ユニットの場合: `OnUnitDetailView()`を呼び出し
  - アイテムの場合: `OnItemDetailView()`を呼び出し

**ユニット詳細の表示（復帰処理付き）**
- `ShowUnitDetailViewFromRatio()`: 提供割合ダイアログからユニット詳細を表示
  - 元のダイアログの状態（スクロール位置、タブ）を保存
  - ユニット詳細を閉じた際に元のダイアログを復元
- `ShowUnitDetailViewFromLineUp()`: ラインナップダイアログからユニット詳細を表示
  - 元のダイアログの状態（スクロール位置、タブ）を保存
  - ユニット詳細を閉じた際に元のダイアログを復元

### UnitDetailViewContentTypeの構造

画面遷移中の画面移動を検知するためのValueObject。

- `ContentType`: ホーム画面のコンテンツタイプ（`HomeContentTypes`）
- `Empty`: 空の状態を表す静的インスタンス
- `IsEmpty()`: 空の状態かどうかを判定
- `IsSameContentType()`: 指定されたコンテンツタイプと一致するかを判定

**用途**：
ユニット詳細モーダルを開く前のコンテンツタイプを記憶し、閉じた後のコンテンツタイプと比較することで、プレイヤーが画面を移動したかどうかを判定します。

### 使用箇所

このWireFrameは以下の画面から使用されます：

- **ガチャコンテンツ画面（GachaContentPresenter）**: 各種ダイアログの表示に使用
- **ガチャ一覧画面（GachaListPresenter）**: ガチャコンテンツ画面への遷移に使用

### 呼び出しているAPI

このWireFrameは画面遷移のみを管理しており、API呼び出しは行いません。
