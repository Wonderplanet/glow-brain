# Home画面（ホーム画面）

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | Home（ホーム画面） |
| **画面パス** | `Assets/GLOW/Scripts/Runtime/Scenes/Home/` |
| **Presenter** | `HomePresenter.cs` |
| **ViewController** | `HomeViewController` |
| **画面種別** | メイン画面 |

## 概要説明

ゲームのメインとなるホーム画面。ヘッダー、フッター、コンテンツエリアで構成され、各種ゲーム機能への起点となる画面です。

## 主要機能

### ヘッダー機能
- **ユーザープロフィール表示**
  - ユーザー名、レベル、経験値ゲージ
  - アバター、エンブレムの表示
- **スタミナ表示と管理**
  - 現在スタミナ/最大スタミナ
  - スタミナ回復までの残り時間
  - スタミナ回復ボタン
  - スタミナ回復広告バッジ
- **ダイヤ表示**
  - 所持ダイヤ数の表示
  - タップでショップへ遷移
- **通知バッジ**
  - 各種コンテンツの新着情報表示

### フッター機能
- **コンテンツナビゲーション**
  - メイン、ガチャ、キャラクター、コンテンツ、ショップへの遷移
  - 各ボタンに通知バッジ表示
- **フッターバルーン**
  - 各種お知らせやヒントの表示

### コンテンツ切り替え機能
- **HomeContentTypes別の画面切り替え**
  - `Main`: メインコンテンツ（クエスト、ミッション等）
  - `Gacha`: ガチャ一覧
  - `Character`: キャラクター管理、パーティ編成
  - `Shop`: ショップ（アイテム、パック、パス）
  - `Content`: 期間限定コンテンツ

### その他の機能
- **パーティ編成の適用**: パーティ編成変更の反映
- **拠点アートワーク適用**: 拠点画像の変更反映
- **レベルアップアニメーション**: 経験値取得時のレベルアップ演出
- **コンテンツメンテナンス対応**: メンテナンス中のコンテンツへのアクセス制御
- **背景管理**: 基本背景、イベント背景の切り替え
- **バックキー対応**: タイトル画面への戻り確認

## UI構成要素

### ヘッダー部分（HomeHeaderStaminaViewModel）
- スタミナ（Stamina）
- 最大スタミナ（MaxStamina）
- 完全回復までの残り秒数（RemainFullRecoverySeconds）
- スタミナ更新までの残り秒数（RemainUpdatingStaminaRecoverSeconds）
- パス効果所持フラグ（IsHeldAdditionalStaminaPassEffect）

### フッター部分（HomeFooterViewModel）
- ガチャ通知バッジ
- キャラクター通知バッジ
- コンテンツ通知バッジ
- ショップ通知バッジ

## 画面遷移

### 遷移元
- タイトル画面
- 各種ゲーム内画面からの戻り

### 遷移先
- **ガチャ一覧**: フッターのガチャボタンまたはガチャバナータップ
- **ショップ**: フッターのショップボタンまたはダイヤタップ
- **キャラクター管理**: フッターのキャラクターボタン
- **クエスト選択**: メインコンテンツのクエストボタン
- **ユーザープロフィール**: ヘッダーのアバタータップ
- **エンブレム選択**: ヘッダーのエンブレムタップ
- **スタミナ回復**: ヘッダーのスタミナ回復ボタン
- **ミッション**: メインコンテンツのミッションボタン
- **PvPトップ**: コンテンツからPvP選択
- **イベントクエスト**: コンテンツからイベント選択
- **交換所**: メインコンテンツの交換所ボタン

## 関連ファイル

### Presenter
- `Presentation/Presenters/HomePresenter.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/Home/Presentation/Presenters/HomePresenter.cs:66): メインPresenter
- `Presentation/Presenters/HomeMainPresenter.cs`: メインコンテンツPresenter
- `Presentation/Presenters/HomeStageInfoPresenter.cs`: ステージ情報Presenter
- `Presentation/Presenters/StageSelectPresenter.cs`: ステージ選択Presenter

### ViewModel
- `Presentation/ViewModels/HomeHeaderStaminaViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/Home/Presentation/ViewModels/HomeHeaderStaminaViewModel.cs:7): ヘッダースタミナViewModel
- `Presentation/ViewModels/HomeFooterViewModel.cs`: フッターViewModel
- `Presentation/ViewModels/HomeStageInfoViewModel.cs`: ステージ情報ViewModel

### UseCase
- `Domain/UseCases/IHomeUseCases.cs`: ホーム関連UseCase
- `Domain/UseCases/HomeHeaderBadgeUseCase.cs`: ヘッダーバッジUseCase
- `Domain/UseCases/HomeFooterBalloonUseCase.cs`: フッターバルーンUseCase

### その他
- `Presentation/Interface/IHomeViewNavigation.cs`: 画面ナビゲーションインターフェース
- `Presentation/Translator/HomeViewModelTranslator.cs`: ViewModelトランスレータ

## 実装詳細

### 主要メソッド

#### IHomeViewDelegate.OnViewDidLoad()
画面読み込み時の初期化処理
- コンテンツメンテナンス設定
- 初期表示コンテンツの設定
- ヘッダーにユーザー情報を設定
- ヘッダー状態の監視開始
- ショップのNEW状態初期化
- パーティキャッシュ情報の更新
- フッター状態の設定

#### IHomeViewDelegate.OnContentSelected(HomeContentTypes contentType)
コンテンツ選択時の処理
- 現在のコンテンツタイプと同じ場合は何もしない
- SwitchContentAsyncでコンテンツを切り替え
- 後処理としてPostProcessContentSelectedを呼び出し

#### SwitchContentAsync(HomeContentTypes contentType, Action onComplete = null)
コンテンツ切り替えの非同期処理
- ユーザーインタラクションを無効化
- HomeViewNavigation.Switchでコンテンツを切り替え
- フッター状態を更新
- 完了後にユーザーインタラクションを有効化

#### MonitorHeaderStatus()
ヘッダー状態の監視
- 1秒ごとにスタミナ数値を更新
- スタミナ回復広告バッジの確認
- CancellationTokenによるループ終了制御

#### SetFooterStatus()
フッター状態の設定
- 各種通知バッジの取得
- HomeFooterViewModelを生成してViewControllerに設定

## 備考

- Zenjectによる依存性注入を使用
- UniTaskによる非同期処理
- MVPパターンでPresenterがViewとUseCaseを仲介
- コンテンツメンテナンス機能により部分的な機能制限が可能

## 更新履歴

| 日付 | 更新内容 |
|------|----------|
| 2025-12-23 | 初版作成 |
