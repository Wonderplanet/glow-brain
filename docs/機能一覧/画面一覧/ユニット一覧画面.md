# ユニット一覧画面

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | ユニット一覧画面 |
| **画面種別** | メイン画面 |

## 概要

プレイヤーが所持している全てのユニットを一覧表示する画面です。ソートやフィルター機能を使って、目的のユニットを素早く見つけることができます。各ユニットをタップすると、詳細情報の確認や強化などの操作が可能なユニット詳細画面に遷移します。

## プレイヤーができること

### ユニットを探す・閲覧する

#### ユニット一覧の表示
- 所持している全ユニットが一覧表示される
- 各ユニットはキャラクターアイコンとして表示される
- ユニットのレベル、ランク、グレード情報が視覚的に表示される
- 強化可能なユニットには通知バッジが表示される

#### ユニットの選択
- ユニットアイコンをタップすると、ユニット詳細画面に遷移
- 詳細画面では、ステータス確認、強化、装備変更などの操作が可能
- 詳細画面から戻ってきた際、スクロール位置が保持される

### ソート・フィルターで絞り込む

#### ソート順の切り替え
- **昇順ボタン**: 選択中のソート項目で昇順に並び替え
- **降順ボタン**: 選択中のソート項目で降順に並び替え
- ソート項目は別途設定可能（ソート・フィルターダイアログから）

#### ソート・フィルター設定
- **ソート・フィルターボタン**: ソート・フィルターダイアログを表示
- ダイアログでは以下の設定が可能：
  - **ソート項目**: レベル、HP、攻撃力、レアリティ、作品、入手日時など
  - **属性フィルター**: 赤、青、黄、緑、無属性
  - **レアリティフィルター**: N、R、SR、SSR、UR
  - **ロールフィルター**: アタック、バランス、ディフェンス、サポート、ユニーク、テクニカル、スペシャル
  - **作品フィルター**: ジャンプ+作品ごとの絞り込み
  - **攻撃範囲フィルター**: 近距離、中距離、遠距離など
  - **アビリティフィルター**: 特定のアビリティを持つユニット
  - **必殺技フィルター**: 特定の必殺技を持つユニット
- 設定を変更すると即座にユニット一覧が更新される
- ボーナスフィルターと編成フィルターは自動的に無効化される（ユニット一覧画面では使用しない仕様）

### 通知バッジの確認

- 強化可能なユニット（レベルアップ、ランクアップ、グレードアップが可能）には通知バッジが表示される
- バッジの種類により、何が強化可能かを識別できる

## 画面の要素

### ヘッダー部分
- 画面タイトル「ユニット一覧」
- 戻るボタン（前の画面に戻る）

### メイン表示エリア
- **ユニット一覧**
  - スクロール可能なグリッド表示
  - 各セルにユニットのキャラクターアイコン
  - ユニット名、レベル、ランク、グレードの表示
  - レアリティに応じた背景色やエフェクト
  - 通知バッジ（強化可能な場合のみ）
- **セル表示アニメーション**
  - 画面表示時にセルが順次アニメーション表示される

### ツールバー部分
- **ソート・フィルターボタン**: ソート・フィルター設定ダイアログを開く
- **昇順ボタン**: 昇順でソート
- **降順ボタン**: 降順でソート
- **現在のソート項目表示**: 適用中のソート項目が表示される

## 画面遷移

### この画面への遷移
- **ホーム画面**: 「ユニット」タブをタップ
- **編成画面**: 「ユニット一覧」ボタンをタップ

### この画面からの遷移
- **ユニット詳細画面**: ユニットアイコンをタップ
  - 遷移時、選択したユニットを含む一覧情報を引き継ぐ
  - 詳細画面では左右スワイプで前後のユニットに切り替え可能
  - 詳細画面を閉じると、元のスクロール位置に戻る
- **ソート・フィルターダイアログ**: ソート・フィルターボタンをタップ
  - ダイアログで設定を変更後、自動的に一覧が更新される

## ゲーム仕様・制約事項

### ソート・フィルター仕様
- ユニット一覧画面では、ボーナスフィルター（編成ボーナス対象）と編成フィルター（編成済みユニット）は自動的に無効化される
- これらのフィルターは編成画面やクエスト選択画面でのみ有効
- ソート・フィルター設定は画面ごとに個別に保存される（ユニット一覧、編成、クエスト選択など）

### ユニット表示順
- 選択したソート項目とソート順に従って表示
- デフォルトは入手日時の降順（新しく入手したユニットが上に表示）
- フィルター条件に一致しないユニットは非表示

### 通知バッジ表示条件
- レベルアップ可能（必要なコインとEXPを所持）
- ランクアップ可能（必要な素材を所持）
- グレードアップ可能（必要な素材を所持）
- これらの条件を満たすと、該当する通知バッジが表示される

### スクロール位置の保持
- ユニット詳細画面に遷移する前のスクロール位置を記憶
- 詳細画面から戻ってきた際、元の位置にスクロールを復元
- これにより、複数のユニットを連続で確認する際の操作性が向上

## 技術参考情報

### 画面実装パス
- `Assets/GLOW/Scripts/Runtime/Scenes/UnitList/`

### 主要コンポーネント

#### Presenter
- `Presentation/Presenters/UnitListPresenter.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/UnitList/Presentation/Presenters/UnitListPresenter.cs)

#### ViewModel
- `Presentation/ViewModels/UnitListViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/UnitList/Presentation/ViewModels/UnitListViewModel.cs)
- `Presentation/ViewModels/UnitListCellViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/UnitList/Presentation/ViewModels/UnitListCellViewModel.cs)

#### UseCase
- `Domain/UseCases/GetUnitListUseCase.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/UnitList/Domain/UseCases/GetUnitListUseCase.cs)
- `Domain/UseCases/UpdateUnitListFilterUseCase.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/UnitList/Domain/UseCases/UpdateUnitListFilterUseCase.cs)
- `Domain/UseCases/SetupUnitListConditionalFilterUseCase.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/UnitList/Domain/UseCases/SetupUnitListConditionalFilterUseCase.cs)

### UnitListViewModelの構造

画面全体のデータ構造：
- **Units**: ユニット一覧のリスト（`UnitListCellViewModel`の配列）
- **CategoryModel**: ソート・フィルター設定情報
- **SortOrder**: 現在のソート順（昇順/降順）

各ユニットセルのデータ構造（`UnitListCellViewModel`）：
- **UserUnitId**: ユーザーユニットのID
- **CharacterIcon**: キャラクターアイコン情報（画像、レベル、ランク、グレードなど）
- **NotificationBadge**: 通知バッジ情報（強化可能かどうか）
- **SortType**: 現在適用されているソート項目

### 使用しているDBデータ

#### マスタデータ

| クライアント定義 | サーバー定義 | クライアント説明 |
|----------------|-------------|----------------|
| MstCharacter.Id | mst_units.id | ユニットのマスタID |
| MstCharacter.Color | mst_units.color | ユニットの属性（赤、青、黄、緑、無属性） |
| MstCharacter.RoleType | mst_units.role_type | ユニットのロール（アタック、バランス、ディフェンス、サポート、ユニーク、テクニカル、スペシャル） |
| MstCharacter.AttackRangeType | mst_units.attack_range_type | ユニットの攻撃範囲（近距離、中距離、遠距離など） |
| MstCharacter.Rarity | mst_units.rarity | ユニットのレアリティ（N、R、SR、SSR、UR） |
| MstCharacter.MstSeriesId | mst_units.mst_series_id | 所属する作品のID |
| MstCharacter.MinHp | mst_units.min_hp | 基礎最小HP |
| MstCharacter.MaxHp | mst_units.max_hp | 基礎最大HP |
| MstCharacter.MinAttackPower | mst_units.min_attack_power | 最小攻撃力 |
| MstCharacter.MaxAttackPower | mst_units.max_attack_power | 最大攻撃力 |
| MstCharacter.MstUnitAbilityId1 | mst_units.mst_unit_ability_id1 | アビリティ1のID |
| MstCharacter.MstUnitAbilityId2 | mst_units.mst_unit_ability_id2 | アビリティ2のID |
| MstCharacter.MstUnitAbilityId3 | mst_units.mst_unit_ability_id3 | アビリティ3のID |
| MstSeries.Id | mst_series.id | 作品ID |
| MstSeries.AssetKey | mst_series.asset_key | 作品のアセットキー |
| MstUnitLevelUp.UnitLabel | mst_unit_level_ups.unit_label | ユニットタイプ（DropR、DropSR、DropSSR、DropUR、PremiumR、PremiumSR、PremiumSSR、PremiumUR、FestivalUR） |
| MstUnitLevelUp.Level | mst_unit_level_ups.level | レベル |
| MstUnitLevelUp.RequiredCoin | mst_unit_level_ups.required_coin | レベルアップに必要なコイン |

#### ユーザーデータ（GameFetch）

| クライアント定義 | サーバー定義 | クライアント説明 |
|----------------|-------------|----------------|
| UserUnit.UsrUnitId | usr_units.id | ユーザーユニットのID（個別のユニットインスタンス） |
| UserUnit.MstUnitId | usr_units.mst_unit_id | ユニットのマスタID |
| UserUnit.Level | usr_units.level | ユニットの現在レベル |
| UserUnit.Rank | usr_units.rank | ユニットの現在ランク |
| UserUnit.Grade | usr_units.grade_level | ユニットの現在グレード |
| UserUnit.BattleCount | usr_units.battle_count | 出撃回数 |
| UserUnit.IsNewEncyclopedia | usr_units.is_new_encyclopedia | 新規獲得フラグ（図鑑で未確認） |

### 呼び出しているAPI

なし（全てローカルデータから取得）
