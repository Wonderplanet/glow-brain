# ガチャ履歴詳細ダイアログ

## 基本情報

| 項目 | 内容 |
|------|------|
| **画面名** | ガチャ履歴詳細ダイアログ |
| **画面種別** | モーダルダイアログ |

## 概要

ガチャ履歴ダイアログで選択した1回分のガチャ実行結果の詳細を表示するモーダルダイアログです。

このダイアログでは、選択したガチャで獲得したすべてのアイテムやユニットを一覧で確認できます。各アイテムには、アイコン、名前、レアリティ、獲得個数が表示され、初めて獲得したユニットの場合は「獲得」表記が追加されます。

## プレイヤーができること

### ガチャ結果の詳細確認

#### ガチャ情報の確認
- ガチャ実行日時
- ガチャ名
- 使用したコストアイテムとその個数
- 広告視聴ガチャかどうか

#### 獲得アイテムリストの確認
- 獲得したすべてのアイテム・ユニットを一覧表示
- 各アイテムごとに以下の情報を表示：
  - アイテム/ユニットのアイコン
  - 名前（ユニットの場合はキャラクター名を優先表示）
  - レアリティアイコン（コインの場合は非表示）
  - 獲得個数
  - 初獲得ユニットの場合は「獲得」テキスト表示

### ダイアログを閉じる

#### 閉じるボタンをタップ
- ダイアログを閉じる
- 自動的にガチャ履歴ダイアログに戻る

## 画面の要素

### ヘッダー部分
- ガチャ実行の基本情報（ガチャ履歴セル）
  - ガチャ実行日時
  - ガチャ名
  - 使用コストアイテムのアイコンと個数
  - 広告視聴ガチャの表示

### メイン表示エリア
- 獲得アイテムリスト（スクロール可能）
  - 各アイテムセルに以下を表示：
    - 左側：アイテム/ユニットのアイコンとレアリティ
    - 中央：名前（ユニットはキャラ名、それ以外はリソース名）
    - 右側：獲得個数とアイコン
    - 初獲得ユニットの場合：「獲得」表記

### ボタンエリア
- 閉じるボタン

## 画面遷移

### この画面への遷移
- **ガチャ履歴ダイアログ**: ガチャ履歴セルをタップ

### この画面からの遷移
- **ガチャ履歴ダイアログ**: 閉じるボタンタップ、または画面外タップで自動的に戻る
  - 遷移後、元のスクロール位置とページを復元

## ゲーム仕様・制約事項

### アイテム表示ルール

#### ユニット表示
- ユニットの場合はキャラクター名を優先表示
- キャラクター名が空の場合はリソース名を表示
- レアリティアイコンを表示

#### コイン表示
- コインの場合はレアリティアイコンを非表示
- コイン専用のテキストスタイルで表示

#### 獲得個数の表示
- 初めて獲得したユニットの場合：
  - 「獲得」テキストを表示
  - 獲得個数欄にはアイコンと個数を表示
- すでに所持済みのユニット・アイテムの場合：
  - 獲得個数を「×個数」形式で表示

#### 未獲得ユニット
- アセットパスが空の場合は獲得個数欄を非表示

### 画面遷移の仕様

#### ガチャ履歴ダイアログへの復帰
- このダイアログを閉じると、ガチャ履歴ダイアログが再表示される
- 再表示時には、このダイアログを開く前のスクロール位置とページ番号を復元
- これにより、プレイヤーは複数の履歴を連続して確認しやすい

## 技術参考情報

### 画面実装パス
- `Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/`

### 主要コンポーネント

#### Presenter
- `Presentation/Presenters/GachaHistoryDetailDialogPresenter.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/Presentation/Presenters/GachaHistoryDetailDialogPresenter.cs)

#### ViewModel
- `Presentation/ViewModels/GachaHistoryDetailDialogViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/Presentation/ViewModels/GachaHistoryDetailDialogViewModel.cs)
- `Presentation/ViewModels/GachaHistoryDetailCellViewModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/Presentation/ViewModels/GachaHistoryDetailCellViewModel.cs)

#### View
- `Presentation/Views/GachaHistoryDetailDialogViewController.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/Presentation/Views/GachaHistoryDetailDialogViewController.cs)
- `Presentation/Views/GachaHistoryDetailDialogView.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/Presentation/Views/GachaHistoryDetailDialogView.cs)
- `Presentation/Views/GachaHistoryDetailCell.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDetailDialog/Presentation/Views/GachaHistoryDetailCell.cs)

#### Domain Model（GachaHistoryDialog配下）
- `Domain/Models/GachaHistoryDetailModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDialog/Domain/Models/GachaHistoryDetailModel.cs)
- `Domain/Models/GachaHistoryDetailCellModel.cs` (projects/glow-client/Assets/GLOW/Scripts/Runtime/Scenes/GachaHistoryDialog/Domain/Models/GachaHistoryDetailCellModel.cs)

### GachaHistoryDetailDialogViewModelの構造

```csharp
public record GachaHistoryDetailDialogViewModel(
    IReadOnlyList<GachaHistoryDetailCellViewModel> GachaHistoryDetailCellViewModels)
```

- 獲得したアイテム・ユニットのリストを保持
- `Empty`プロパティで空の状態を表現

### GachaHistoryDetailCellViewModelの構造

```csharp
public record GachaHistoryDetailCellViewModel(
    PlayerResourceIconViewModel PlayerResourceIconViewModel,  // アイテム/ユニットアイコン情報
    PlayerResourceName ResourceName,                          // リソース名
    CharacterName CharacterName,                             // キャラクター名
    PlayerResourceIconAssetPath AcquiredPlayerResourceIconAssetPath, // 獲得個数側のアイコンパス
    PlayerResourceAmount AcquiredPlayerResourceAmount)        // 獲得個数
```

**表示制御ロジック**：
- `IsAcquiredUnit()`: ユニットかつアイコンパスが空でない場合に初獲得と判定
- `GetDisplayName()`: ユニットの場合はキャラ名、それ以外はリソース名を返す
- `ShouldShowAmountObject()`: アイコンパスが空でない場合に個数欄を表示

### 画面初期化時の引数

```csharp
GachaHistoryDetailDialogViewController.Argument(
    GachaHistoryCellViewModel CellViewModel,           // ガチャ履歴セル情報
    GachaHistoryDetailDialogViewModel DetailCellViewModel) // 詳細アイテムリスト
```

- `CellViewModel`: ガチャ実行日時、ガチャ名、コスト情報などの基本情報
- `DetailCellViewModel`: 獲得したアイテム・ユニットの詳細リスト

### 呼び出し元

このダイアログはガチャ履歴ダイアログから呼び出されます：
- 呼び出し元: `GachaHistoryDialogPresenter` → `GachaHistoryWireFrame.ShowGachaHistoryDetailDialogView()`
- 引数として現在のページ番号とスクロール位置を受け取り、閉じた際に復元する

### 呼び出しているAPI

このダイアログは独自のAPI呼び出しを行いません。
ガチャ履歴ダイアログで取得済みのデータを受け取って表示します。
