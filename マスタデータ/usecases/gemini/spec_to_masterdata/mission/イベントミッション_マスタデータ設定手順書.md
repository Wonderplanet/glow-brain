# イベントミッション マスタデータ設定手順書

## 概要

イベントミッションのマスタデータ作成手順を記載します。
本手順書に従うことで、ゲーム内でエラーが発生しない正確なマスタデータを作成できます。

## 対象テーブル

イベントミッションでは、以下の3シート構成でマスタデータを作成します。

**出力シート**:
- **MstMissionEvent** - イベントミッションの基本情報(MstMissionEventI18nのカラムを含む)
- **MstMissionEventDependency** - ミッション間の解放順序の依存関係
- **MstMissionReward** - ミッション報酬

**重要**: MstMissionEventI18nは独立したシートではなく、MstMissionEventシート内に`description.ja`カラムとして統合されています。

## 作成フロー

### 1. 仕様書の確認

運営仕様書から以下の情報を抽出します。

**必要情報**:
- ミッションの達成条件(何を何回実行するか)
- ミッションの報酬内容
- イベントID(mst_event_id)
- ミッションの表示順序
- ミッション説明文(日本語)
- ミッション間の依存関係(順序解放の有無)

### 2. MstMissionEvent シートの作成(I18n含む)

#### 2.1 シートスキーマ

このシートには、TABLE行、ENABLE行、データ行が含まれます。

**TABLE行** - 各カラムがどのテーブルに属するかを示します。

```
TABLE,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEventI18n
```

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,release_key,mst_event_id,criterion_type,criterion_value,criterion_count,unlock_criterion_type,unlock_criterion_value,unlock_criterion_count,group_key,mst_mission_reward_group_id,sort_order,destination_scene,description.ja
```

#### 2.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | ミッションの一意識別子。命名規則: `event_{作品ID}_{イベント連番}_{ミッション連番}` |
| **release_key** | リリースキー。例: `202512020` |
| **mst_event_id** | イベントID。MstEventテーブルのidと対応。例: `event_osh_00001`, `event_glo_00001` |
| **criterion_type** | 達成条件タイプ。下記の「criterion_type設定一覧」を参照 |
| **criterion_value** | 条件の指定値。criterion_typeに応じて設定。不要な場合は空欄 |
| **criterion_count** | 条件の回数。例: `5`(5回クリア) |
| **unlock_criterion_type** | 解放条件タイプ。通常は `__NULL__` (依存関係はMstMissionEventDependencyで管理) |
| **unlock_criterion_value** | 解放条件の値。通常は空欄 |
| **unlock_criterion_count** | 解放条件の回数。通常は `0` |
| **group_key** | グループキー。通常は空欄(必要に応じて設定) |
| **mst_mission_reward_group_id** | 報酬グループID。MstMissionRewardのgroup_idと対応。例: `osh_00001_event_reward_1` |
| **sort_order** | 表示順序。小さい数字ほど上位に表示。例: `1`, `2`, `3`... |
| **destination_scene** | タップ時の遷移先シーン。例: `Event`, `Gacha` |
| **description.ja** | ミッション説明文(日本語)。ユーザーに表示される文言 |

#### criterion_type設定一覧

イベントミッション(mst_event_id指定)で使用可能なcriterion_typeは以下の通りです。**大文字小文字を正確に一致**させてください。

| criterion_type | 説明 | criterion_value | criterion_count | 使用例 |
|---------------|------|----------------|----------------|--------|
| **StageClearCount** | ステージクリア回数(イベント全体) | 空欄(NULL) | 必要なクリア回数 | ステージを5回クリア、10回クリア |
| **SpecificStageClearCount** | 特定ステージのクリア回数 | ステージID<br>例: `event_glo1_1day_00001` | 必要なクリア回数 | デイリークエスト「開運!ジャンブル運試し」を1回クリア |
| **SpecificUnitStageClearCount** | 特定ユニット編成でのステージクリア | ユニットID.ステージID<br>例: `chara_osh_00601.event_osh1_1day_00001` | 必要なクリア回数 | ぴえヨンを編成に入れて「ファンと推し合戦!」を1回クリア |
| **SpecificUnitStageChallengeCount** | 特定ユニット編成でのステージ挑戦 | ユニットID.ステージID<br>例: `chara_osh_00601.event_osh1_challenge01_00001` | 必要な挑戦回数 | ぴえヨンを編成に入れて「推しの子になってやる」1話を1回挑戦 |
| **SpecificQuestClear** | 特定クエストのクリア | クエストID<br>例: `quest_event_osh1_charaget01` | クリア回数(通常1) | 収集クエスト「芸能界へ!」をクリアしよう |
| **SpecificGachaDrawCount** | 特定ガシャの引き回数 | ガシャID<br>例: `gasho_001` | 必要な引き回数 | 賀正ガシャ2026を10回引こう |

#### 2.3 イベントミッション固有の設定

イベントミッションでは、以下のように設定します。

- **mst_event_id**: イベントIDを必ず指定(例: `event_osh_00001`)
- **criterion_type**: 上記の6種類から選択
- **criterion_value**: criterion_typeに応じて設定(不要な場合は空欄)
- **criterion_count**: 達成に必要な回数
- **unlock_criterion_type**: 通常は `__NULL__`
- **unlock_criterion_value**: 通常は空欄
- **unlock_criterion_count**: 通常は `0`
- **destination_scene**: ミッションに関連するシーン(例: `Event`, `Gacha`)

#### 2.4 作成例

```
TABLE,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEvent,MstMissionEventI18n
ENABLE,id,release_key,mst_event_id,criterion_type,criterion_value,criterion_count,unlock_criterion_type,unlock_criterion_value,unlock_criterion_count,group_key,mst_mission_reward_group_id,sort_order,destination_scene,description.ja
e,event_osh_00001_1,202512020,event_osh_00001,StageClearCount,,5,__NULL__,,0,,osh_00001_event_reward_1,1,Event,ステージを5回クリアしよう
e,event_osh_00001_2,202512020,event_osh_00001,StageClearCount,,10,__NULL__,,0,,osh_00001_event_reward_2,2,Event,ステージを10回クリアしよう
e,event_osh_00001_28,202512020,event_osh_00001,SpecificGachaDrawCount,gasho_001,10,__NULL__,,0,,osh_00001_event_reward_28,28,Gacha,賀正ガシャ2026を10回引こう
e,event_osh_00001_33,202512020,event_osh_00001,SpecificUnitStageClearCount,chara_osh_00601.event_osh1_1day_00001,1,__NULL__,,0,,osh_00001_event_reward_33,33,Event,【汗が輝いてるよ!】ぴえヨンを編成に入れて「ファンと推し合戦!」を1回クリア
```

#### 2.5 説明文作成のポイント

- イベント名を明記する(例: 「ファンと推し合戦!」)
- 達成条件を明確に記載する(例: 「5回クリア」)
- ユーザーフレンドリーな表現にする
- 文末は「〜しよう」形式が推奨
- 特別な演出がある場合は【】で強調する(例: 【汗が輝いてるよ!】)

### 3. MstMissionEventDependency シートの作成

#### 3.1 シートスキーマ

このシートには、TABLE行、ENABLE行、データ行が含まれます。

**TABLE行** - 各カラムがどのテーブルに属するかを示します。

```
TABLE,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency
```

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,release_key,group_id,mst_mission_event_id,unlock_order,備考
```

#### 3.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | 依存関係の一意識別子。連番で設定。例: `190`, `191`, `192`... |
| **release_key** | リリースキー。MstMissionEventと同じ値 |
| **group_id** | 依存関係のグループID。同じグループ内で順序が定義される。例: `event_osh_00001_1` |
| **mst_mission_event_id** | ミッションID。MstMissionEvent.idと対応 |
| **unlock_order** | 解放順序。1から順番に設定 |
| **備考** | 任意のメモ |

#### 3.3 依存関係の設定方法

**重要**: 依存関係は、**順序解放が必要なミッショングループのみ**に設定します。全てのミッションに設定する必要はありません。

- **同じgroup_id内のミッション**が、unlock_orderの順番に解放される
- 例: ステージクリア回数ミッション(5回→10回→15回...)は依存関係を設定
- 独立したミッション(例: ガシャミッション、特定クエストクリアミッション)は依存関係不要

#### 3.4 作成例

```
TABLE,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency,MstMissionEventDependency
ENABLE,id,release_key,group_id,mst_mission_event_id,unlock_order,備考
e,190,202512020,event_osh_00001_1,event_osh_00001_1,1,
e,191,202512020,event_osh_00001_1,event_osh_00001_2,2,
e,192,202512020,event_osh_00001_1,event_osh_00001_3,3,
e,193,202512020,event_osh_00001_1,event_osh_00001_4,4,
e,217,202512020,event_osh_00001_28,event_osh_00001_28,1,
e,218,202512020,event_osh_00001_28,event_osh_00001_29,2,
e,219,202512020,event_osh_00001_28,event_osh_00001_30,3,
```

上記の例:
- `event_osh_00001_1`グループ: ステージクリア回数ミッション(1→2→3→4の順に解放)
- `event_osh_00001_28`グループ: ガシャミッション(28→29→30の順に解放)

### 4. MstMissionReward シートの作成

#### 4.1 シートスキーマ

このシートには、TABLE行、ENABLE行、データ行が含まれます。

**TABLE行** - 各カラムがどのテーブルに属するかを示します。

```
TABLE,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward
```

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
```

#### 4.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | 報酬の一意識別子。命名規則: `mission_reward_{連番}` |
| **release_key** | リリースキー。MstMissionEventと同じ値 |
| **group_id** | 報酬グループID。MstMissionEvent.mst_mission_reward_group_idと対応 |
| **resource_type** | 報酬のリソースタイプ。下記の「resource_type設定一覧」を参照 |
| **resource_id** | リソースID。resource_typeに応じて設定。不要な場合は空欄 |
| **resource_amount** | 報酬の数量 |
| **sort_order** | 表示順序。複数報酬がある場合の並び順 |
| **備考** | 任意のメモ。ミッション説明文などを記載すると管理しやすい |

#### resource_type設定一覧

ミッション報酬(MstMissionReward)で使用可能なresource_typeは以下の通りです。**大文字小文字を正確に一致**させてください。

| resource_type | 説明 | resource_id | 参照先テーブル | 主な用途 |
|--------------|------|------------|--------------|---------|
| **Coin** | コイン(ゲーム内通貨) | 不要(空欄) | - | ミッション報酬の定番 |
| **FreeDiamond** | 無償プリズム | 不要(空欄) | - | 重要なミッション報酬 |
| **Exp** | 経験値(プレイヤー経験値) | 不要(空欄) | - | クエストクリア報酬 |
| **Item** | アイテム(チケット、素材など) | **必要** | **MstItem** | ガシャチケット、育成素材 |
| **Emblem** | エンブレム(称号) | **必要** | **MstEmblem** | イベント達成報酬 |
| **Unit** | ユニット(キャラクター) | **必要** | **MstUnit** | ガシャ報酬、特別報酬 |

#### 4.3 作成例

```
TABLE,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_531,202512020,osh_00001_event_reward_1,Item,ticket_glo_10001,2,1,推しの子ミッション(賀正チケット)
e,mission_reward_535,202512020,osh_00001_event_reward_5,FreeDiamond,,50,1,推しの子ミッション(賀正チケット)
e,mission_reward_563,202512020,osh_00001_event_reward_33,Coin,,1000,1,ぴえヨン連れて行こうミッション
e,mission_reward_571,202512020,osh_00001_event_reward_41,Emblem,emblem_event_osh_00008,1,1,ぴえヨン連れて行こうミッション
```

### 5. データ整合性のチェック

マスタデータ作成後、以下の項目を確認してください。

#### 5.1 必須チェック項目

- [ ] **ヘッダーの列順が正しいか**
  - スキーマファイルと完全一致している

- [ ] **IDの一意性**
  - すべてのidが一意である
  - 他のリリースのidと重複していない

- [ ] **ID採番ルール**
  - MstMissionEvent.id: `event_{作品ID}_{イベント連番}_{ミッション連番}`
  - MstMissionEvent.mst_event_id: MstEventテーブルに存在するイベントID
  - MstMissionEvent.mst_mission_reward_group_id: `{作品ID}_{イベント連番}_event_reward_{連番}`
  - MstMissionEventDependency.id: 連番
  - MstMissionEventDependency.group_id: `event_{作品ID}_{イベント連番}_{ミッション連番}`(依存関係の開始ミッションID)
  - MstMissionReward.id: `mission_reward_{連番}`
  - MstMissionReward.group_id: MstMissionEvent.mst_mission_reward_group_idと同じ値

- [ ] **リレーションの整合性**
  - `MstMissionEvent.mst_event_id` がMstEventテーブルに存在する
  - `MstMissionEvent.mst_mission_reward_group_id` = `MstMissionReward.group_id`
  - `MstMissionEventDependency.mst_mission_event_id` がMstMissionEvent.idに存在する
  - すべてのミッションにdescription.ja(説明文)が設定されている

- [ ] **criterion_typeの正確性**
  - 「criterion_type設定一覧」に記載された6種類のいずれかを使用している
  - 大文字小文字が正確に一致している
  - criterion_valueの設定有無が正しい(必要なタイプには設定、不要なタイプは空欄)

- [ ] **resource_typeの正確性**
  - 「resource_type設定一覧」に記載された値を使用している
  - 大文字小文字が正確に一致している
  - resource_idの設定有無が正しい(必要なタイプには設定、不要なタイプは空欄)

- [ ] **unlock設定の統一性**
  - unlock_criterion_typeは通常 `__NULL__`
  - unlock_criterion_valueは通常空欄
  - unlock_criterion_countは通常 `0`

- [ ] **数値の妥当性**
  - criterion_count, resource_amount, sort_orderが正の整数である

#### 5.2 推奨チェック項目

- [ ] **命名規則の統一**
  - idのプレフィックスが統一されている

- [ ] **説明文の品質**
  - 誤字脱字がない
  - ユーザーが理解しやすい表現である

- [ ] **依存関係の妥当性**
  - unlock_orderが1から連番で設定されている
  - 同じgroup_id内で欠番がない

### 6. 出力フォーマット

最終的な出力は以下の3シート構成で行います。

#### 6.1 MstMissionEvent シート

| TABLE | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEvent | MstMissionEventI18n |
|-------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|----------------|--------------------|
| **ENABLE** | **id** | **release_key** | **mst_event_id** | **criterion_type** | **criterion_value** | **criterion_count** | **unlock_criterion_type** | **unlock_criterion_value** | **unlock_criterion_count** | **group_key** | **mst_mission_reward_group_id** | **sort_order** | **destination_scene** | **description.ja** |
| e | event_osh_00001_1 | 202512020 | event_osh_00001 | StageClearCount | | 5 | __NULL__ | | 0 | | osh_00001_event_reward_1 | 1 | Event | ステージを5回クリアしよう |
| e | event_osh_00001_2 | 202512020 | event_osh_00001 | StageClearCount | | 10 | __NULL__ | | 0 | | osh_00001_event_reward_2 | 2 | Event | ステージを10回クリアしよう |

#### 6.2 MstMissionEventDependency シート

| TABLE | MstMissionEventDependency | MstMissionEventDependency | MstMissionEventDependency | MstMissionEventDependency | MstMissionEventDependency | MstMissionEventDependency |
|-------|--------------------------|--------------------------|--------------------------|--------------------------|--------------------------|--------------------------|
| **ENABLE** | **id** | **release_key** | **group_id** | **mst_mission_event_id** | **unlock_order** | **備考** |
| e | 190 | 202512020 | event_osh_00001_1 | event_osh_00001_1 | 1 | |
| e | 191 | 202512020 | event_osh_00001_1 | event_osh_00001_2 | 2 | |

#### 6.3 MstMissionReward シート

| TABLE | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward |
|-------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
| **ENABLE** | **id** | **release_key** | **group_id** | **resource_type** | **resource_id** | **resource_amount** | **sort_order** | **備考** |
| e | mission_reward_531 | 202512020 | osh_00001_event_reward_1 | Item | ticket_glo_10001 | 2 | 1 | 推しの子ミッション(賀正チケット) |
| e | mission_reward_535 | 202512020 | osh_00001_event_reward_5 | FreeDiamond | | 50 | 1 | 推しの子ミッション(賀正チケット) |

#### 重要なポイント

- **TABLE行は必須**: 各シートの先頭にTABLE行を含める
- **3シート構成**: MstMissionEvent、MstMissionEventDependency、MstMissionRewardの3シート
- **I18nはカラムとして統合**: description.jaカラムでI18n情報を管理
- **依存関係は必要に応じて**: 順序解放が必要なミッショングループのみMstMissionEventDependencyを設定
