# イベントログインボーナス マスタデータ設定手順書

## 概要

イベントログインボーナスのマスタデータ作成手順を記載します。
本手順書に従うことで、ゲーム内でエラーが発生しない正確なマスタデータを作成できます。

## 対象テーブル

イベントログインボーナスでは、以下の3シート構成でマスタデータを作成します。

**出力シート**:
- **MstMissionEventDailyBonusSchedule** - イベントログインボーナスの開催期間
- **MstMissionEventDailyBonus** - 各ログイン日のボーナス設定
- **MstMissionReward** - ログインボーナスの報酬内容

## 作成フロー

### 1. 仕様書の確認

運営仕様書から以下の情報を抽出します。

**必要情報**:
- イベントID(mst_event_id)
- ログインボーナスの開催期間
- 各ログイン日の報酬内容（プリズム、コイン、アイテムなど）
- ログイン日数（何日目まで設定するか）

### 2. MstMissionEventDailyBonusSchedule シートの作成

#### 2.1 シートスキーマ

このシートには、TABLE行、ENABLE行、データ行が含まれます。

**TABLE行** - 各カラムがどのテーブルに属するかを示します。

```
TABLE,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule
```

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,release_key,mst_event_id,start_at,end_at
```

#### 2.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | スケジュールの一意識別子。命名規則: `{イベントID}_daily_bonus` |
| **release_key** | リリースキー。例: `202512020` |
| **mst_event_id** | イベントID。MstEventテーブルのidと対応。例: `event_osh_00001`, `event_glo_00001` |
| **start_at** | 開始日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |
| **end_at** | 終了日時。フォーマット: `YYYY-MM-DD HH:MM:SS` |

#### 2.3 id採番ルール

MstMissionEventDailyBonusScheduleのidは、以下の形式で採番します。

```
{イベントID}_daily_bonus
```

**パラメータ:**
- `イベントID`: MstEventテーブルのid (例: `event_osh_00001`, `event_kai_00001`, `event_glo_00001`)

**採番例:**
```
event_osh_00001_daily_bonus   (推しの子 イベント1)
event_kai_00001_daily_bonus   (怪獣8号 イベント1)
event_glo_00001_daily_bonus   (GLOW全体 イベント1)
```

#### 2.4 作成例

```
TABLE,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule,MstMissionEventDailyBonusSchedule
ENABLE,id,release_key,mst_event_id,start_at,end_at
e,event_osh_00001_daily_bonus,202512020,event_osh_00001,2026-01-01 00:00:00,2026-01-16 03:59:59
```

### 3. MstMissionEventDailyBonus シートの作成

#### 3.1 シートスキーマ

このシートには、TABLE行、ENABLE行、データ行が含まれます。

**TABLE行** - 各カラムがどのテーブルに属するかを示します。

```
TABLE,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus
```

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day_count,mst_mission_reward_group_id,sort_order,備考
```

#### 3.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | ログインボーナスの一意識別子。命名規則: `{イベントID}_daily_bonus_{2桁ゼロパディング}` |
| **release_key** | リリースキー。MstMissionEventDailyBonusScheduleと同じ値 |
| **mst_mission_event_daily_bonus_schedule_id** | スケジュールID。MstMissionEventDailyBonusSchedule.idと対応 |
| **login_day_count** | ログイン日数。1日目は`1`, 2日目は`2`... |
| **mst_mission_reward_group_id** | 報酬グループID。MstMissionRewardのgroup_idと対応。通常はidと同じ値を設定 |
| **sort_order** | 表示順序。通常は`1`（複数報酬を同時表示する場合に使用） |
| **備考** | 任意のメモ。報酬の内容を記載すると管理しやすい |

#### 3.3 id採番ルール

MstMissionEventDailyBonusのidは、以下の形式で採番します。

```
{イベントID}_daily_bonus_{2桁ゼロパディング}
```

**パラメータ:**
- `イベントID`: MstEventテーブルのid (例: `event_osh_00001`)
- `2桁ゼロパディング`: ログイン日数の連番 (01, 02, 03...15)

**採番例:**
```
event_osh_00001_daily_bonus_01   (推しの子 イベント1 1日目)
event_osh_00001_daily_bonus_02   (推しの子 イベント1 2日目)
event_osh_00001_daily_bonus_15   (推しの子 イベント1 15日目)
event_kai_00001_daily_bonus_01   (怪獣8号 イベント1 1日目)
```

#### 3.4 mst_mission_reward_group_id設定ルール

**重要**: `mst_mission_reward_group_id`は、通常**idと同じ値**を設定します。

**理由**: 各ログイン日のボーナスは独立した報酬グループとして管理されるため、idをそのまま報酬グループIDとして使用します。

**例:**
```
id: event_osh_00001_daily_bonus_01
mst_mission_reward_group_id: event_osh_00001_daily_bonus_01  (idと同じ)
```

#### 3.5 作成例

```
TABLE,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus,MstMissionEventDailyBonus
ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day_count,mst_mission_reward_group_id,sort_order,備考
e,event_osh_00001_daily_bonus_01,202512020,event_osh_00001_daily_bonus,1,event_osh_00001_daily_bonus_01,1,【推しの子】SSR確定ガシャ
e,event_osh_00001_daily_bonus_02,202512020,event_osh_00001_daily_bonus,2,event_osh_00001_daily_bonus_02,1,プリズム
e,event_osh_00001_daily_bonus_03,202512020,event_osh_00001_daily_bonus,3,event_osh_00001_daily_bonus_03,1,いいジャンメダル【赤】
e,event_osh_00001_daily_bonus_04,202512020,event_osh_00001_daily_bonus,4,event_osh_00001_daily_bonus_04,1,ピックアップガシャチケット
e,event_osh_00001_daily_bonus_05,202512020,event_osh_00001_daily_bonus,5,event_osh_00001_daily_bonus_05,1,プリズム
```

### 4. MstMissionReward シートの作成

#### 4.1 シートスキーマ

このシートには、TABLE行、ENABLE行、データ行が含まれます。

**TABLE行** - 各カラムがどのテーブルに属するかを示します。

```
TABLE,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward
```

**ENABLEと列名行** - カラム名を示します。

```
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
```

#### 4.2 各カラムの設定ルール

| カラム名 | 設定ルール |
|---------|-----------|
| **ENABLE** | 固定値: `e` (有効化) |
| **id** | 報酬の一意識別子。命名規則: `mission_reward_{連番}` |
| **release_key** | リリースキー。MstMissionEventDailyBonusと同じ値 |
| **group_id** | 報酬グループID。MstMissionEventDailyBonus.mst_mission_reward_group_idと対応 |
| **resource_type** | 報酬のリソースタイプ。下記の「resource_type設定一覧」を参照 |
| **resource_id** | リソースID。resource_typeに応じて設定。不要な場合は空欄 |
| **resource_amount** | 報酬の数量 |
| **sort_order** | 表示順序。複数報酬がある場合の並び順 |
| **備考** | 任意のメモ。報酬の内容などを記載すると管理しやすい |

#### resource_type設定一覧

イベントログインボーナス(MstMissionReward)で使用可能なresource_typeは以下の通りです。**大文字小文字を正確に一致**させてください。

| resource_type | 説明 | resource_id | 参照先テーブル | 主な用途 |
|--------------|------|------------|--------------|---------|
| **Coin** | コイン（ゲーム内通貨） | 不要（空欄） | - | ログインボーナスの定番 |
| **FreeDiamond** | 無償プリズム | 不要（空欄） | - | 重要なログインボーナス |
| **Exp** | 経験値（プレイヤー経験値） | 不要（空欄） | - | プレイヤーレベルアップ用 |
| **Item** | アイテム（チケット、素材など） | **必要** | **MstItem** | ガシャチケット、育成素材、メモリーフラグメント |
| **Emblem** | エンブレム（称号） | **必要** | **MstEmblem** | イベント達成報酬 |
| **Unit** | ユニット（キャラクター） | **必要** | **MstUnit** | ガシャ報酬、特別報酬 |

#### イベントログインボーナスでよく使われるresource_type

イベントログインボーナスでは、以下のresource_typeが頻繁に使用されます:

| 報酬種類 | resource_type | resource_id例 | 説明 |
|---------|--------------|--------------|------|
| プリズム | FreeDiamond | 空欄 | 無償プリズム（ガシャ用通貨） |
| コイン | Coin | 空欄 | ゲーム内通貨 |
| ガシャチケット | Item | `ticket_glo_00002`, `ticket_glo_00003` | スペシャル/ピックアップガシャチケット |
| メモリーフラグメント | Item | `memoryfragment_glo_00001` | ユニット育成素材 |
| カラーメモリー | Item | `item_glo_00015` | ユニット育成素材 |
| イベントアイテム | Item | `item_glo_00001` | イベント専用アイテム（いいジャンメダルなど） |
| スタミナドリンク | Item | `item_glo_00005` | スタミナ回復アイテム |

#### 4.3 作成例

```
TABLE,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward,MstMissionReward
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_441,202512020,event_osh_00001_daily_bonus_01,Item,ticket_osh_10000,1,1,【推しの子】SSR確定ガシャ
e,mission_reward_442,202512020,event_osh_00001_daily_bonus_02,FreeDiamond,,150,1,プリズム
e,mission_reward_443,202512020,event_osh_00001_daily_bonus_03,Item,item_glo_00001,200,1,いいジャンメダル【赤】
e,mission_reward_444,202512020,event_osh_00001_daily_bonus_04,Item,ticket_glo_00003,1,1,ピックアップガシャチケット
e,mission_reward_445,202512020,event_osh_00001_daily_bonus_05,FreeDiamond,,150,1,プリズム
e,mission_reward_446,202512020,event_osh_00001_daily_bonus_06,Item,memoryfragment_glo_00001,5,1,メモリーフラグメント・初級
e,mission_reward_447,202512020,event_osh_00001_daily_bonus_07,Item,ticket_glo_00003,1,1,ピックアップガシャチケット
e,mission_reward_448,202512020,event_osh_00001_daily_bonus_08,FreeDiamond,,100,1,プリズム
e,mission_reward_449,202512020,event_osh_00001_daily_bonus_09,Coin,,5000,1,コイン
e,mission_reward_450,202512020,event_osh_00001_daily_bonus_10,Item,ticket_glo_00002,1,1,スペシャルガシャチケット
```

#### 4.4 複数報酬がある場合の設定

1日のログインボーナスで複数の報酬を同時に付与する場合は、同じ`group_id`で複数の報酬レコードを作成し、`sort_order`で並び順を指定します。

**例: 1日目にプリズム50と コイン10000を同時に付与**

```
e,mission_reward_441,202512020,event_osh_00001_daily_bonus_01,FreeDiamond,,50,1,1日目報酬(プリズム)
e,mission_reward_442,202512020,event_osh_00001_daily_bonus_01,Coin,,10000,2,1日目報酬(コイン)
```

### 5. データ整合性のチェック

マスタデータ作成後、以下の項目を確認してください。

#### 5.1 必須チェック項目

- [ ] **ヘッダーの列順が正しいか**
  - スキーマファイルと完全一致している

- [ ] **IDの一意性**
  - すべてのidが一意である
  - 他のリリースのidと重複していない

- [ ] **ID採番ルール**
  - MstMissionEventDailyBonusSchedule.id: `{イベントID}_daily_bonus`
  - MstMissionEventDailyBonus.id: `{イベントID}_daily_bonus_{2桁ゼロパディング}`
  - MstMissionEventDailyBonus.mst_mission_reward_group_id: idと同じ値
  - MstMissionReward.id: `mission_reward_{連番}`
  - MstMissionReward.group_id: MstMissionEventDailyBonus.mst_mission_reward_group_idと同じ値

- [ ] **リレーションの整合性**
  - `MstMissionEventDailyBonusSchedule.mst_event_id` がMstEventテーブルに存在する
  - `MstMissionEventDailyBonus.mst_mission_event_daily_bonus_schedule_id` = `MstMissionEventDailyBonusSchedule.id`
  - `MstMissionEventDailyBonus.mst_mission_reward_group_id` = `MstMissionReward.group_id`
  - すべてのログイン日に報酬が設定されている

- [ ] **login_day_countの連続性**
  - login_day_countが1から連番で設定されている
  - 欠番がない（1, 2, 3, 4, 5...と連続している）
  - 同じschedule_id内でlogin_day_countが重複していない

- [ ] **resource_typeの正確性**
  - 「resource_type設定一覧」に記載された値を使用している
  - 大文字小文字が正確に一致している
  - resource_idの設定有無が正しい（必要なタイプには設定、不要なタイプは空欄）

- [ ] **日時フォーマット**
  - `YYYY-MM-DD HH:MM:SS`形式である
  - start_at < end_at である

- [ ] **数値の妥当性**
  - login_day_count, resource_amount, sort_orderが正の整数である

#### 5.2 推奨チェック項目

- [ ] **命名規則の統一**
  - idのプレフィックスが統一されている

- [ ] **報酬の妥当性**
  - resource_idが実際に存在するアイテムIDである
  - resource_amountが適切な数量である（プリズムが数十〜数百、コインが数千〜数万など）

- [ ] **備考欄の記載**
  - 各報酬に説明が記載されており、管理しやすい

### 6. 出力フォーマット

最終的な出力は以下の3シート構成で行います。

#### 6.1 MstMissionEventDailyBonusSchedule シート

| TABLE | MstMissionEventDailyBonusSchedule | MstMissionEventDailyBonusSchedule | MstMissionEventDailyBonusSchedule | MstMissionEventDailyBonusSchedule | MstMissionEventDailyBonusSchedule |
|-------|----------------------------------|----------------------------------|----------------------------------|----------------------------------|----------------------------------|
| **ENABLE** | **id** | **release_key** | **mst_event_id** | **start_at** | **end_at** |
| e | event_osh_00001_daily_bonus | 202512020 | event_osh_00001 | 2026-01-01 00:00:00 | 2026-01-16 03:59:59 |

#### 6.2 MstMissionEventDailyBonus シート

| TABLE | MstMissionEventDailyBonus | MstMissionEventDailyBonus | MstMissionEventDailyBonus | MstMissionEventDailyBonus | MstMissionEventDailyBonus | MstMissionEventDailyBonus | MstMissionEventDailyBonus |
|-------|--------------------------|--------------------------|--------------------------|--------------------------|--------------------------|--------------------------|--------------------------|
| **ENABLE** | **id** | **release_key** | **mst_mission_event_daily_bonus_schedule_id** | **login_day_count** | **mst_mission_reward_group_id** | **sort_order** | **備考** |
| e | event_osh_00001_daily_bonus_01 | 202512020 | event_osh_00001_daily_bonus | 1 | event_osh_00001_daily_bonus_01 | 1 | 【推しの子】SSR確定ガシャ |
| e | event_osh_00001_daily_bonus_02 | 202512020 | event_osh_00001_daily_bonus | 2 | event_osh_00001_daily_bonus_02 | 1 | プリズム |
| e | event_osh_00001_daily_bonus_03 | 202512020 | event_osh_00001_daily_bonus | 3 | event_osh_00001_daily_bonus_03 | 1 | いいジャンメダル【赤】 |

#### 6.3 MstMissionReward シート

| TABLE | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward | MstMissionReward |
|-------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
| **ENABLE** | **id** | **release_key** | **group_id** | **resource_type** | **resource_id** | **resource_amount** | **sort_order** | **備考** |
| e | mission_reward_441 | 202512020 | event_osh_00001_daily_bonus_01 | Item | ticket_osh_10000 | 1 | 1 | 【推しの子】SSR確定ガシャ |
| e | mission_reward_442 | 202512020 | event_osh_00001_daily_bonus_02 | FreeDiamond | | 150 | 1 | プリズム |
| e | mission_reward_443 | 202512020 | event_osh_00001_daily_bonus_03 | Item | item_glo_00001 | 200 | 1 | いいジャンメダル【赤】 |

#### 重要なポイント

- **TABLE行は必須**: 各シートの先頭にTABLE行を含める
- **3シート構成**: MstMissionEventDailyBonusSchedule、MstMissionEventDailyBonus、MstMissionRewardの3シート
- **リレーション管理**: schedule_id → daily_bonus_id → reward_group_id の順で紐付ける
- **login_day_countの連続性**: 1から連番で設定し、欠番がないようにする

### 7. 運営仕様書からの変換例

#### 7.1 運営仕様書の形式

運営仕様書では、以下のような表形式でログインボーナスが記載されています。

| ログイン日数 | 日付 | プリズム | コイン | ピックアップガシャチケット | スペシャルガシャチケット | メモリーフラグメント・初級 | メモリーフラグメント・中級 | カラーメモリー・イエロー | カラーメモリー・レッド | スタミナドリンク |
|------------|------|---------|-------|------------------------|---------------------|----------------------|----------------------|---------------------|-------------------|--------------|
| 1 | 2/2 15:00 | | | 2 | | | | | | |
| 2 | 2/3 4:00 | | 10000 | | | | | | | |
| 3 | 2/4 4:00 | 50 | | | | | | | | |
| 4 | 2/5 4:00 | | | | | | | | | 5 |
| 5 | 2/6 4:00 | | | | | 5 | | | | |

#### 7.2 マスタデータへの変換手順

1. **空欄セルの扱い**: 空欄の列は報酬なしとして扱い、MstMissionRewardに含めない
2. **複数報酬の扱い**: 1日に複数の報酬がある場合は、同じgroup_idで複数のMstMissionRewardレコードを作成
3. **resource_typeの判定**:
   - プリズム → `FreeDiamond`
   - コイン → `Coin`
   - ガシャチケット/素材 → `Item` + resource_id指定

#### 7.3 変換例

**運営仕様書:**
```
1日目: ピックアップガシャチケット × 2
2日目: コイン × 10000
3日目: プリズム × 50
```

**MstMissionEventDailyBonus:**
```
e,event_osh_00001_daily_bonus_01,202512020,event_osh_00001_daily_bonus,1,event_osh_00001_daily_bonus_01,1,ピックアップガシャチケット
e,event_osh_00001_daily_bonus_02,202512020,event_osh_00001_daily_bonus,2,event_osh_00001_daily_bonus_02,1,コイン
e,event_osh_00001_daily_bonus_03,202512020,event_osh_00001_daily_bonus,3,event_osh_00001_daily_bonus_03,1,プリズム
```

**MstMissionReward:**
```
e,mission_reward_441,202512020,event_osh_00001_daily_bonus_01,Item,ticket_glo_00003,2,1,ピックアップガシャチケット
e,mission_reward_442,202512020,event_osh_00001_daily_bonus_02,Coin,,10000,1,コイン
e,mission_reward_443,202512020,event_osh_00001_daily_bonus_03,FreeDiamond,,50,1,プリズム
```

### 8. よくある質問

#### Q1. 1日に複数の報酬を設定できますか？

**A:** はい、可能です。同じ`group_id`で複数のMstMissionRewardレコードを作成し、`sort_order`で表示順序を指定してください。

**例:**
```
e,mission_reward_441,202512020,event_osh_00001_daily_bonus_01,FreeDiamond,,50,1,1日目プリズム
e,mission_reward_442,202512020,event_osh_00001_daily_bonus_01,Coin,,10000,2,1日目コイン
```

#### Q2. login_day_countは連続している必要がありますか？

**A:** はい、必須です。login_day_countは1から連番で設定する必要があります。欠番があるとゲーム内で正しく表示されません。

#### Q3. 報酬がない日を設定できますか？

**A:** いいえ、推奨されません。すべてのログイン日には何らかの報酬を設定してください。報酬が少ない日はコインやプリズムを少量設定することを推奨します。

#### Q4. mst_mission_reward_group_idとidが同じ値なのはなぜですか？

**A:** 各ログイン日のボーナスは独立した報酬グループとして管理されるため、idをそのまま報酬グループIDとして使用します。これにより、データ構造がシンプルになり、管理しやすくなります。

#### Q5. 開催期間は何日間設定できますか？

**A:** 技術的には制限はありませんが、一般的には7日〜15日程度が多いです。login_day_countの最大値が開催日数に対応します。

#### Q6. イベントIDはどこで確認できますか？

**A:** MstEventテーブルを参照してください。存在しないイベントIDを指定するとエラーになります。

### 9. トラブルシューティング

#### エラー: リレーション整合性エラー

**症状**: `MstMissionEventDailyBonus.mst_mission_event_daily_bonus_schedule_id`が存在しない

**原因**: MstMissionEventDailyBonusScheduleのidとMstMissionEventDailyBonus.mst_mission_event_daily_bonus_schedule_idが一致していない

**解決方法**: idの採番ルールを確認し、両者が一致していることを確認してください

#### エラー: 報酬が表示されない

**症状**: ゲーム内でログインボーナスの報酬が表示されない

**原因**: MstMissionReward.group_idとMstMissionEventDailyBonus.mst_mission_reward_group_idが一致していない

**解決方法**: 両者が完全に一致しているか確認してください（通常はidと同じ値）

#### エラー: login_day_countの順序エラー

**症状**: ログインボーナスが正しい順序で表示されない

**原因**: login_day_countに欠番がある、または重複がある

**解決方法**: login_day_countが1から連番で、重複なく設定されているか確認してください
