# 恒常ミッション（アチーブメント）作成手順書

## 概要

期限のない恒常的な達成型ミッション（メインクエストクリア、プレイヤーランク到達等）を設定するためのマスタデータ作成手順です。

**参照する運営仕様書**: `04_ミッション.csv` の「◆メインクエスト追加の恒常ミッション」セクション

**参照する技術資料**: `マスタデータ/docs/mission/ミッショントリガー一覧 - データ入力用ミッショントリガー一覧.csv`

---

## 恒常ミッション（アチーブメント）の特徴

- **期限なし**: start_at/end_atの設定なし（または長期間設定）
- **達成条件**: クエストクリア、プレイヤーランク到達等
- **報酬**: プリズム、コインなど
- **用途**: メインクエスト追加時のクリア報酬、初心者向けガイドミッション等

---

## 必要な情報（運営仕様書から取得）

| 項目 | 例 |
|------|-----|
| 施策名称 | メインクエスト追加の恒常ミッション |
| 開催期間 | 2026-01-01 00:00:00 ～ 無期限 |
| ミッション内容 | メインクエスト「【推しの子】」の難易度ノーマルをクリアしよう |
| 報酬 | プリズム×50 |

---

## 作成するマスタデータテーブル

1. **MstMissionAchievement.csv** - アチーブメントミッション定義
2. **MstMissionReward.csv** - ミッション報酬

---

## 作成手順

### Step 1: アチーブメントミッションを作成（MstMissionAchievement.csv）

| カラム | 設定値 | 例 |
|--------|--------|-----|
| ENABLE | `e` | e |
| id | `achievement_{カテゴリー}_{連番}` | achievement_2_101 |
| release_key | リリースキー | 202512020 |
| criterion_type | ミッション条件タイプ | SpecificQuestClear |
| criterion_value | 条件の値 | quest_main_osh_normal_17 |
| criterion_count | 達成回数 | 1 |
| unlock_criterion_type | 前提条件タイプ | __NULL__ |
| unlock_criterion_value | 前提条件の値 | （空欄） |
| unlock_criterion_count | 前提条件回数 | 0 |
| group_key | グループキー | （空欄） |
| mst_mission_reward_group_id | 報酬グループID | achievement_2_101 |
| sort_order | 表示順 | 101 |
| destination_scene | 遷移先 | QuestSelect |

**ポイント**:
- idは `achievement_{カテゴリー番号}_{連番}` の命名規則
- カテゴリー番号は1（デイリー）、2（メインクエスト）等で管理
- start_at/end_atのカラムは **存在しない**（恒常なので）

---

### Step 2: ミッション報酬を作成（MstMissionReward.csv）

| カラム | 設定値 | 例 |
|--------|--------|-----|
| ENABLE | `e` | e |
| id | 連番 | mission_reward_460 |
| release_key | リリースキー | 202512020 |
| group_id | Step1のmst_mission_reward_group_id | achievement_2_101 |
| resource_type | 報酬タイプ | FreeDiamond |
| resource_id | リソースID | （空欄） |
| resource_amount | 個数 | 50 |
| sort_order | 表示順 | 1 |
| 備考 | （任意）報酬名 | アチーブメントミッション |

---

## ミッション条件タイプ（criterion_type）

**重要**: `criterion_type`に設定できる値は、`マスタデータ/docs/mission/ミッショントリガー一覧.csv`に記載されているものだけです。

### アチーブメントでよく使う条件タイプ

| criterion_type | 説明 | criterion_value | criterion_count | 対象ミッションタイプ | 用途例 |
|---------------|------|-----------------|-----------------|---------------------|--------|
| **SpecificQuestClear** | 指定クエスト初クリア | クエストID | 1 | 全て対象 | メインクエスト「【推しの子】」の難易度ノーマルをクリアしよう |
| **StageClearCount** | 通算ステージクリア回数 | NULL(未指定) | 回数 | 全て対象 | ステージを100回クリアしよう |
| **PlayerRankReach** | プレイヤーランク到達 | NULL(未指定) | ランク数 | 全て対象 | プレイヤーランク10に到達しよう |

**criterion_valueの設定ルール**:
- **NULL(未指定)**: 特定の対象を指定しない場合。CSVでは空欄または`__NULL__`と記載
- **ID指定**: 特定のクエストを指定する場合

**注意**: `SpecificQuestClear`のcriterion_countは常に`1`です。クエストの初クリアのみを判定するため、2以上は設定できません。

---

## 遷移先（destination_scene）

| destination_scene | 遷移先画面 | 使用例 |
|------------------|----------|--------|
| **QuestSelect** | クエスト選択画面 | メインクエストクリア系ミッション |
| **Home** | ホーム画面 | プレイヤーランク系ミッション |

---

## IDの命名規則

### achievement_id の構成

**フォーマット**: `achievement_{カテゴリー}_{連番}`

**カテゴリー番号の例**:
- `1`: デイリー系アチーブメント
- `2`: メインクエスト系アチーブメント
- `3`: イベント系アチーブメント
- `4`: プレイヤー育成系アチーブメント

**連番の例**:
- メインクエスト追加時: 101, 102, 103, ...
- 既存のアチーブメントと重複しないように採番

---

## 実装パターン例

### 例: メインクエスト難易度別クリアミッション（3個）

**運営仕様書の記載**:
```
ミッション内容: メインクエスト「【推しの子】」の難易度ノーマルをクリアしよう
報酬: プリズム×50

ミッション内容: メインクエスト「【推しの子】」の難易度ハードをクリアしよう
報酬: プリズム×50

ミッション内容: メインクエスト「【推しの子】」の難易度エクストラをクリアしよう
報酬: プリズム×50
```

**作成レコード**:

#### MstMissionAchievement

| id | criterion_type | criterion_value | mst_mission_reward_group_id |
|----|---------------|-----------------|----------------------------|
| achievement_2_101 | SpecificQuestClear | quest_main_osh_normal_17 | achievement_2_101 |
| achievement_2_102 | SpecificQuestClear | quest_main_osh_hard_17 | achievement_2_102 |
| achievement_2_103 | SpecificQuestClear | quest_main_osh_veryhard_17 | achievement_2_103 |

#### MstMissionReward

| id | group_id | resource_type | resource_amount |
|----|----------|--------------|-----------------|
| mission_reward_460 | achievement_2_101 | FreeDiamond | 50 |
| mission_reward_461 | achievement_2_102 | FreeDiamond | 50 |
| mission_reward_462 | achievement_2_103 | FreeDiamond | 50 |

**作成レコード数**:
- MstMissionAchievement: 3レコード
- MstMissionReward: 3レコード

---

## チェックリスト

作成後、以下を確認してください：

- [ ] ミッション数が運営仕様書と一致しているか
- [ ] achievement_idの命名規則が正しいか（カテゴリー番号と連番）
- [ ] criterion_typeがミッショントリガー一覧に存在するか
- [ ] criterion_valueの設定方法が正しいか（NULL指定 vs ID指定）
- [ ] SpecificQuestClearのcriterion_countが1になっているか
- [ ] criterion_countが仕様書と一致しているか
- [ ] 報酬グループIDが正しく紐づいているか
- [ ] 報酬の種類と個数が仕様書と一致しているか
- [ ] destination_sceneが適切に設定されているか
- [ ] sort_orderが適切に設定されているか

---

## 注意点

### criterion_typeの制約
- 設定可能な値は**ミッショントリガー一覧に記載されているもののみ**
- 記載のないcriterion_typeを設定するとエラーになる
- 新しいcriterion_typeが必要な場合は、サーバー実装の追加が必要

### criterion_valueの記載ルール

| 値の種類 | CSVでの記載方法 | 例 |
|---------|---------------|-----|
| NULL(未指定) | 空欄または`__NULL__` | （空欄） |
| ID指定 | IDを直接記載 | `quest_main_osh_normal_17` |

### SpecificQuestClearの特殊な仕様
- クエストの**初クリア**のみを判定
- criterion_countは常に`1`（2以上は設定不可）
- クエスト内の全ステージを1回以上クリアした時点で達成

### 恒常ミッションとイベントミッションの使い分け

| テーブル | 用途 | 期限 |
|---------|------|------|
| **MstMissionAchievement** | 恒常ミッション | なし（または長期間） |
| **MstMissionEvent** | イベントミッション | イベント期間のみ |
| **MstMissionLimitedTerm** | 期間限定ミッション | 短期間 |

### IDの採番
- achievement_idは既存のアチーブメントと重複しないように注意
- カテゴリー番号は事前に決めたルールに従う
- 連番は101から開始することが多い（100番台＝メインクエスト関連等）

### 報酬グループIDの命名
- アチーブメントIDと同じ値を使用することが多い
- 例: `achievement_2_101` → 報酬グループIDも `achievement_2_101`

### クエストIDの確認
- criterion_valueに設定するクエストIDは、MstQuest.csvに存在する必要がある
- 難易度別のクエストIDを正しく設定する
  - ノーマル: `quest_main_osh_normal_17`
  - ハード: `quest_main_osh_hard_17`
  - エクストラ: `quest_main_osh_veryhard_17`

**完全なリストは**: `マスタデータ/docs/mission/ミッショントリガー一覧.csv` を参照してください。

---

## 実例（202512020リリース）

### メインクエスト追加の恒常ミッション
- カテゴリー: 2（メインクエスト系）
- ミッション数: 3個
- 達成条件: 【推しの子】メインクエストの各難易度クリア
- 報酬: プリズム×50（各難易度）
- 作成レコード:
  - achievement_2_101: ノーマルクリア
  - achievement_2_102: ハードクリア
  - achievement_2_103: エクストラクリア

---

## その他のアチーブメント例（参考）

### 初心者向けアチーブメント
- プレイヤーランク到達（ランク5、10、20等）
- 累計ステージクリア回数（10回、50回、100回等）
- 累計ガシャ回数（10回、50回、100回等）

### シリーズ別アチーブメント
- 各シリーズのメインクエストクリア
- 各シリーズのキャラ獲得

**これらは将来的に追加される可能性があります**

---

**作成完了後**: 全てのミッション系マスタデータ作成が完了です。
