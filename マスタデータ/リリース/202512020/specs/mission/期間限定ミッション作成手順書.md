# 期間限定ミッション作成手順書

## 概要

特定期間のみ有効なミッション（年始イベント、降臨バトル専用等）を設定するためのマスタデータ作成手順です。

**参照する運営仕様書**:
- `04_ミッション.csv` の「◆年始ミッション」セクション
- `03_降臨バトル.csv` の「◆降臨バトル専用ミッション」セクション

**参照する技術資料**: `マスタデータ/docs/mission/ミッショントリガー一覧.csv`

---

## ミッションの種類

### 年始ミッション
- **目的**: 年始イベント期間の限定ミッション
- **達成条件**: 特定デイリークエストクリア回数
- **報酬**: コイン
- **期間**: 短期間（5日間程度）

### 降臨バトル専用ミッション
- **目的**: 降臨バトルへの挑戦を促進
- **達成条件**: 降臨バトル挑戦回数
- **報酬**: プリズム、コイン
- **期間**: 降臨バトル開催期間と同じ

---

## 必要な情報（運営仕様書から取得）

| 項目 | 年始ミッションの例 | 降臨バトル専用ミッションの例 |
|------|--------------------|--------------------------|
| 施策名称 | 年始ミッション | 降臨バトル「ファーストライブ」専用ミッション |
| 開催期間 | 2026-01-01 00:00:00 ～ 2026-01-05 23:59:59 | 2026-01-09 15:00:00 ～ 2026-01-13 14:59:59 |
| ミッション数 | 3個 | 4個 |
| 達成条件 | デイリークエストクリア1～3回 | 降臨バトル挑戦5～25回 |
| 報酬 | コイン | プリズム、コイン |

---

## 作成するマスタデータテーブル

### イベント紐づきの期間限定ミッション（年始ミッション等）
1. **MstMissionEvent.csv** - イベントミッション定義
2. **MstMissionReward.csv** - ミッション報酬

### 降臨バトル専用ミッション
1. **MstMissionLimitedTerm.csv** - 期間限定ミッション定義
2. **MstMissionReward.csv** - ミッション報酬

---

## 作成手順

### パターン1: イベント紐づきの期間限定ミッション（MstMissionEvent）

年始ミッションなど、イベントに紐づく短期間ミッションの場合、**MstMissionEvent.csv** を使用します。

#### Step 1: イベントミッションを作成（MstMissionEvent.csv）

| カラム | 設定値 | 例 |
|--------|--------|-----|
| ENABLE | `e` | e |
| id | `{event_id}_{連番}` | event_glo_00001_1 |
| release_key | リリースキー | 202512020 |
| mst_event_id | イベントID | event_glo_00001 |
| criterion_type | ミッション条件タイプ | SpecificStageClearCount |
| criterion_value | ステージID | event_glo1_1day_00001 |
| criterion_count | 達成回数 | 1 |
| unlock_criterion_type | 前提条件タイプ | __NULL__ |
| unlock_criterion_value | 前提条件の値 | （空欄） |
| unlock_criterion_count | 前提条件回数 | 0 |
| group_key | グループキー | （空欄） |
| mst_mission_reward_group_id | 報酬グループID | glo_00001_event_reward_01 |
| sort_order | 表示順 | 1 |
| destination_scene | 遷移先 | Event |

---

### パターン2: 降臨バトル専用ミッション（MstMissionLimitedTerm）

降臨バトル専用ミッションは、**MstMissionLimitedTerm.csv** を使用します。

#### Step 1: 期間限定ミッションを作成（MstMissionLimitedTerm.csv）

| カラム | 設定値 | 例 |
|--------|--------|-----|
| ENABLE | `e` | e |
| id | `limited_term_{連番}` | limited_term_33 |
| release_key | リリースキー | 202512020 |
| progress_group_key | 進捗グループキー | group9 |
| criterion_type | ミッション条件タイプ | AdventBattleChallengeCount |
| criterion_value | 条件の値 | （空欄） |
| criterion_count | 達成回数 | 5 |
| mission_category | ミッションカテゴリー | AdventBattle |
| mst_mission_reward_group_id | 報酬グループID | osh_00001_limited_term_1 |
| sort_order | 表示順 | 1 |
| destination_scene | 遷移先 | AdventBattle |
| start_at | 開始日時 | 2026-01-09 15:00:00 |
| end_at | 終了日時 | 2026-01-13 14:59:59 |

**ポイント**:
- **progress_group_key**: 同じグループのミッションは進捗を共有
- **mission_category**: `AdventBattle` を設定
- **start_at/end_at**: 降臨バトルの期間と完全一致させる

---

### Step 2: ミッション報酬を作成（MstMissionReward.csv）

どちらのパターンでも、報酬設定は同じです。

| カラム | 設定値 | 例（コイン） | 例（プリズム） |
|--------|--------|------------|--------------|
| ENABLE | `e` | e | e |
| id | 連番 | mission_reward_584 | mission_reward_528 |
| release_key | リリースキー | 202512020 | 202512020 |
| group_id | 報酬グループID | glo_00001_event_reward_01 | osh_00001_limited_term_2 |
| resource_type | 報酬タイプ | Coin | FreeDiamond |
| resource_id | リソースID | （空欄） | （空欄） |
| resource_amount | 個数 | 1000 | 20 |
| sort_order | 表示順 | 1 | 1 |
| 備考 | （任意）報酬名 | 年始ミッション | 降臨バトル「ファーストライブ」に10回挑戦しよう！ |

---

## 報酬タイプ（resource_type）

**重要**: `resource_type`に設定できる値は、DBスキーマ（master_tables_schema.json）で定義されたenumのみです。

### 設定可能なresource_type一覧

| resource_type | 日本語名 | resource_idの指定 | resource_idの参照先 | 例 |
|--------------|---------|-----------------|-------------------|-----|
| **Coin** | コイン | 不要（空欄） | - | コイン×1000 |
| **FreeDiamond** | 無償プリズム | 不要（空欄） | - | プリズム×50 |
| **Exp** | 経験値 | 不要（空欄） | - | 経験値×100 |
| **Item** | アイテム | **必須** | MstItem.id | 賀正ガシャチケット（ticket_glo_10001） |
| **Emblem** | エンブレム | **必須** | MstEmblem.id | 筋肉推し!エンブレム（emblem_osh1_00001） |
| **Unit** | キャラ | **必須** | MstUnit.id | ぴえヨン（chara_osh_00601） |

**参考**: RewardType.phpには他にもStamina、PaidDiamond、Artworkが定義されていますが、**MstMissionReward.csvでは使用できません**。

### resource_idの設定ルール

| resource_typeの値 | resource_idの設定 | 設定例 |
|------------------|-----------------|--------|
| Coin, FreeDiamond, Exp | 空欄または__NULL__ | （空欄） |
| Item | MstItem.csvのid | ticket_glo_10001 |
| Emblem | MstEmblem.csvのid | emblem_osh1_00001 |
| Unit | MstUnit.csvのid | chara_osh_00601 |

---

## ミッション条件タイプ（criterion_type）

**重要**: `criterion_type`に設定できる値は、`マスタデータ/docs/mission/ミッショントリガー一覧.csv`に記載されているものだけです。

### 期間限定ミッションでよく使う条件タイプ

| criterion_type | 説明 | criterion_value | criterion_count | 対象ミッションタイプ | 用途例 |
|---------------|------|-----------------|-----------------|---------------------|--------|
| **AdventBattleChallengeCount** | 降臨バトル挑戦回数 | NULL(未指定) | 回数 | 全て対象 | 降臨バトル「ファーストライブ」に5回挑戦しよう！ |
| **SpecificStageClearCount** | 指定ステージクリア回数 | ステージID | 回数 | 全て対象 | デイリークエスト「開運!ジャンブル運試し」を1回クリアしよう |

**criterion_valueの設定ルール**:
- **NULL(未指定)**: 特定の対象を指定しない場合。CSVでは空欄または`__NULL__`と記載
- **ID指定**: 特定のステージを指定する場合

**注意**:
- **AdventBattleChallengeCount**: 降臨バトルのミッションは、特定の降臨バトルIDを指定せず、全体の挑戦回数をカウントします（criterion_valueは空欄）

---

## ミッションカテゴリー（mission_category）

MstMissionLimitedTermの場合のみ設定します。

| mission_category | 説明 | 使用例 |
|-----------------|------|--------|
| **AdventBattle** | 降臨バトル専用ミッション | 降臨バトル挑戦回数ミッション |
| **Event** | イベント期間限定ミッション | 年始イベント等 |

---

## 遷移先（destination_scene）

| destination_scene | 遷移先画面 | 使用例 |
|------------------|----------|--------|
| **AdventBattle** | 降臨バトル画面 | 降臨バトル専用ミッション |
| **Event** | イベントTOP画面 | 年始ミッション等 |

---

## 実装パターン例

### 例1: 年始ミッション（3個）

**運営仕様書の記載**:
```
ミッション内容: デイリークエスト「開運!ジャンブル運試し」を1回クリアしよう
報酬: コイン×1000

ミッション内容: デイリークエスト「開運!ジャンブル運試し」を2回クリアしよう
報酬: コイン×1000

ミッション内容: デイリークエスト「開運!ジャンブル運試し」を3回クリアしよう
報酬: コイン×3000
```

**作成レコード数**:
- MstMissionEvent: 3レコード
- MstMissionReward: 3レコード

---

### 例2: 降臨バトル専用ミッション（4個）

**運営仕様書の記載**:
```
ミッション内容: 降臨バトル「ファーストライブ」に5回挑戦しよう！
報酬: コイン×2000

ミッション内容: 降臨バトル「ファーストライブ」に10回挑戦しよう！
報酬: プリズム×20

ミッション内容: 降臨バトル「ファーストライブ」に20回挑戦しよう！
報酬: コイン×3000

ミッション内容: 降臨バトル「ファーストライブ」に25回挑戦しよう！
報酬: プリズム×30
```

**作成レコード数**:
- MstMissionLimitedTerm: 4レコード
- MstMissionReward: 4レコード

---

## チェックリスト

作成後、以下を確認してください：

### 共通
- [ ] ミッション数が運営仕様書と一致しているか
- [ ] 開催期間が正しく設定されているか
- [ ] criterion_typeがミッショントリガー一覧に存在するか
- [ ] criterion_valueの設定方法が正しいか（NULL指定 vs ID指定）
- [ ] criterion_countが仕様書と一致しているか
- [ ] 報酬グループIDが正しく紐づいているか
- [ ] resource_typeがDBスキーマで定義されたenum値（Coin, FreeDiamond, Exp, Item, Emblem, Unit）のいずれかか
- [ ] resource_idが必要なresource_type（Item, Emblem, Unit）でresource_idが設定されているか
- [ ] resource_idが不要なresource_type（Coin, FreeDiamond, Exp）でresource_idが空欄になっているか
- [ ] resource_idに設定したIDが参照先マスタテーブル（MstItem, MstEmblem, MstUnit）に存在するか
- [ ] 報酬の種類と個数が仕様書と一致しているか
- [ ] destination_sceneが適切に設定されているか
- [ ] sort_orderが適切に設定されているか

### MstMissionEvent使用の場合
- [ ] mst_event_idが正しいイベントを参照しているか

### MstMissionLimitedTerm使用の場合
- [ ] progress_group_keyが適切に設定されているか
- [ ] mission_categoryが正しいか
- [ ] start_at/end_atが降臨バトル期間と一致しているか

---

## 注意点

### criterion_typeの制約
- 設定可能な値は**ミッショントリガー一覧に記載されているもののみ**
- 記載のないcriterion_typeを設定するとエラーになる
- 新しいcriterion_typeが必要な場合は、サーバー実装の追加が必要

### resource_typeの制約
- 設定可能な値は**DBスキーマで定義されたenumのみ**: Coin, FreeDiamond, Exp, Item, Emblem, Unit
- Item, Emblem, Unitの場合、resource_idの指定が**必須**
- Coin, FreeDiamond, Expの場合、resource_idは**空欄**にする
- resource_idに設定するIDは、対応するマスタテーブル（MstItem, MstEmblem, MstUnit）に存在する必要がある

### criterion_valueの記載ルール

| 値の種類 | CSVでの記載方法 | 例 |
|---------|---------------|-----|
| NULL(未指定) | 空欄または`__NULL__` | （空欄） |
| ID指定 | IDを直接記載 | `event_glo1_1day_00001` |

### テーブルの使い分け

| 使用するテーブル | 使用ケース |
|-----------------|----------|
| **MstMissionEvent** | イベントに紐づく期間限定ミッション（年始ミッション等） |
| **MstMissionLimitedTerm** | イベントに紐づかない期間限定ミッション（降臨バトル専用ミッション等） |

### 降臨バトル専用ミッションの期間
- 降臨バトルの開催期間と **完全一致** させる
- 開始日時・終了日時が1秒でもずれると正しく動作しない

### 進捗グループキー（progress_group_key）
- 同じグループのミッションは進捗を共有
- 例：「5回挑戦」「10回挑戦」「20回挑戦」は全て同じグループに設定
- グループキーは `group{番号}` の形式（例：`group9`）

### ミッション達成回数の設定
- 降臨バトル専用ミッションは、期間中の最大挑戦回数を考慮して設定
- 例：1日5回×5日間=25回が上限の場合、25回以上のミッションは設定しない

**完全なリストは**: `マスタデータ/docs/mission/ミッショントリガー一覧.csv` を参照してください。

---

## 実例（202512020リリース）

### 年始ミッション
- イベントID: event_glo_00001
- 期間: 2026-01-01 00:00:00 ～ 2026-01-05 23:59:59
- ミッション数: 3個
- 使用テーブル: MstMissionEvent

### 降臨バトル専用ミッション
- 降臨バトル: ファーストライブ
- 期間: 2026-01-09 15:00:00 ～ 2026-01-13 14:59:59
- ミッション数: 4個（5回、10回、20回、25回）
- 使用テーブル: MstMissionLimitedTerm
- progress_group_key: group9

---

**作成完了後**: 次は恒常ミッションの作成に進んでください。
