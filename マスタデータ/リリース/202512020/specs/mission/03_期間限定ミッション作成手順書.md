# 期間限定ミッション作成手順書

## 概要

特定期間のみ有効なミッション（年始イベント、降臨バトル専用等）を設定するためのマスタデータ作成手順です。

**参照する運営仕様書**:
- `04_ミッション.csv` の「◆年始ミッション」セクション
- `03_降臨バトル.csv` の「◆降臨バトル専用ミッション」セクション

---

## ミッションの種類

### 年始ミッション
- **目的**: 年始イベント期間の限定ミッション
- **達成条件**: 特定デイリークエストクリア回数
- **報酬**: コイン
- **期間**: 短期間（5日間程度）

### 降臨バトル専用ミッション
- **目的**: 降臨バトルへの挑戦を促進
- **達成条件**: 降臨バトル挑戦回数
- **報酬**: プリズム、コイン
- **期間**: 降臨バトル開催期間と同じ

---

## 必要な情報（運営仕様書から取得）

| 項目 | 年始ミッションの例 | 降臨バトル専用ミッションの例 |
|------|--------------------|--------------------------|
| 施策名称 | 年始ミッション | 降臨バトル「ファーストライブ」専用ミッション |
| 開催期間 | 2026-01-01 00:00:00 ～ 2026-01-05 23:59:59 | 2026-01-09 15:00:00 ～ 2026-01-13 14:59:59 |
| ミッション数 | 3個 | 4個 |
| 達成条件 | デイリークエストクリア1～3回 | 降臨バトル挑戦5～25回 |
| 報酬 | コイン | プリズム、コイン |

---

## 作成するマスタデータテーブル

### イベント紐づきの期間限定ミッション（年始ミッション等）
1. **MstMissionEvent.csv** - イベントミッション定義
2. **MstMissionReward.csv** - ミッション報酬

### 降臨バトル専用ミッション
1. **MstMissionLimitedTerm.csv** - 期間限定ミッション定義
2. **MstMissionReward.csv** - ミッション報酬

---

## 作成手順

### パターン1: イベント紐づきの期間限定ミッション（MstMissionEvent）

年始ミッションなど、イベントに紐づく短期間ミッションの場合、**MstMissionEvent.csv** を使用します。

#### Step 1: イベントミッションを作成（MstMissionEvent.csv）

| カラム | 設定値 | 例 |
|--------|--------|-----|
| ENABLE | `e` | e |
| id | `{event_id}_{連番}` | event_glo_00001_1 |
| release_key | リリースキー | 202512020 |
| mst_event_id | イベントID | event_glo_00001 |
| criterion_type | ミッション条件タイプ | SpecificStageClearCount |
| criterion_value | ステージID | event_glo1_1day_00001 |
| criterion_count | 達成回数 | 1 |
| unlock_criterion_type | 前提条件タイプ | __NULL__ |
| unlock_criterion_value | 前提条件の値 | （空欄） |
| unlock_criterion_count | 前提条件回数 | 0 |
| group_key | グループキー | （空欄） |
| mst_mission_reward_group_id | 報酬グループID | glo_00001_event_reward_01 |
| sort_order | 表示順 | 1 |
| destination_scene | 遷移先 | Event |

---

### パターン2: 降臨バトル専用ミッション（MstMissionLimitedTerm）

降臨バトル専用ミッションは、**MstMissionLimitedTerm.csv** を使用します。

#### Step 1: 期間限定ミッションを作成（MstMissionLimitedTerm.csv）

| カラム | 設定値 | 例 |
|--------|--------|-----|
| ENABLE | `e` | e |
| id | `limited_term_{連番}` | limited_term_33 |
| release_key | リリースキー | 202512020 |
| progress_group_key | 進捗グループキー | group9 |
| criterion_type | ミッション条件タイプ | AdventBattleChallengeCount |
| criterion_value | 条件の値 | （空欄） |
| criterion_count | 達成回数 | 5 |
| mission_category | ミッションカテゴリー | AdventBattle |
| mst_mission_reward_group_id | 報酬グループID | osh_00001_limited_term_1 |
| sort_order | 表示順 | 1 |
| destination_scene | 遷移先 | AdventBattle |
| start_at | 開始日時 | 2026-01-09 15:00:00 |
| end_at | 終了日時 | 2026-01-13 14:59:59 |

**ポイント**:
- **progress_group_key**: 同じグループのミッションは進捗を共有
- **mission_category**: `AdventBattle` を設定
- **start_at/end_at**: 降臨バトルの期間と完全一致させる

---

### Step 2: ミッション報酬を作成（MstMissionReward.csv）

どちらのパターンでも、報酬設定は同じです。

| カラム | 設定値 | 例（コイン） | 例（プリズム） |
|--------|--------|------------|--------------|
| ENABLE | `e` | e | e |
| id | 連番 | mission_reward_584 | mission_reward_528 |
| release_key | リリースキー | 202512020 | 202512020 |
| group_id | 報酬グループID | glo_00001_event_reward_01 | osh_00001_limited_term_2 |
| resource_type | 報酬タイプ | Coin | FreeDiamond |
| resource_id | リソースID | （空欄） | （空欄） |
| resource_amount | 個数 | 1000 | 20 |
| sort_order | 表示順 | 1 | 1 |
| 備考 | （任意）報酬名 | 年始ミッション | 降臨バトル「ファーストライブ」に10回挑戦しよう！ |

---

## ミッション条件タイプ（criterion_type）

### 降臨バトル専用

| criterion_type | 説明 | criterion_value | criterion_count | 用途例 |
|---------------|------|-----------------|-----------------|--------|
| **AdventBattleChallengeCount** | 降臨バトル挑戦回数 | （空欄） | 回数 | 降臨バトル「ファーストライブ」に5回挑戦しよう！ |

**注意**: 降臨バトルのミッションは、特定の降臨バトルIDを指定せず、全体の挑戦回数をカウントします。

### 一般的な条件（年始ミッション等）

| criterion_type | 説明 | criterion_value | criterion_count | 用途例 |
|---------------|------|-----------------|-----------------|--------|
| **SpecificStageClearCount** | 特定ステージクリア回数 | ステージID | 回数 | デイリークエスト「開運!ジャンブル運試し」を1回クリアしよう |

---

## ミッションカテゴリー（mission_category）

MstMissionLimitedTermの場合のみ設定します。

| mission_category | 説明 | 使用例 |
|-----------------|------|--------|
| **AdventBattle** | 降臨バトル専用ミッション | 降臨バトル挑戦回数ミッション |
| **Event** | イベント期間限定ミッション | 年始イベント等 |

---

## 遷移先（destination_scene）

| destination_scene | 遷移先画面 | 使用例 |
|------------------|----------|--------|
| **AdventBattle** | 降臨バトル画面 | 降臨バトル専用ミッション |
| **Event** | イベントTOP画面 | 年始ミッション等 |

---

## 実装パターン例

### 例1: 年始ミッション（3個）

**運営仕様書の記載**:
```
ミッション内容: デイリークエスト「開運!ジャンブル運試し」を1回クリアしよう
報酬: コイン×1000

ミッション内容: デイリークエスト「開運!ジャンブル運試し」を2回クリアしよう
報酬: コイン×1000

ミッション内容: デイリークエスト「開運!ジャンブル運試し」を3回クリアしよう
報酬: コイン×3000
```

**作成レコード数**:
- MstMissionEvent: 3レコード
- MstMissionReward: 3レコード

---

### 例2: 降臨バトル専用ミッション（4個）

**運営仕様書の記載**:
```
ミッション内容: 降臨バトル「ファーストライブ」に5回挑戦しよう！
報酬: コイン×2000

ミッション内容: 降臨バトル「ファーストライブ」に10回挑戦しよう！
報酬: プリズム×20

ミッション内容: 降臨バトル「ファーストライブ」に20回挑戦しよう！
報酬: コイン×3000

ミッション内容: 降臨バトル「ファーストライブ」に25回挑戦しよう！
報酬: プリズム×30
```

**作成レコード数**:
- MstMissionLimitedTerm: 4レコード
- MstMissionReward: 4レコード

---

## チェックリスト

作成後、以下を確認してください：

### 共通
- [ ] ミッション数が運営仕様書と一致しているか
- [ ] 開催期間が正しく設定されているか
- [ ] 報酬の種類と個数が仕様書と一致しているか

### MstMissionEvent使用の場合
- [ ] mst_event_idが正しいイベントを参照しているか
- [ ] criterion_typeが正しく設定されているか

### MstMissionLimitedTerm使用の場合
- [ ] progress_group_keyが適切に設定されているか
- [ ] mission_categoryが正しいか
- [ ] start_at/end_atが降臨バトル期間と一致しているか

---

## 注意点

### テーブルの使い分け

| 使用するテーブル | 使用ケース |
|-----------------|----------|
| **MstMissionEvent** | イベントに紐づく期間限定ミッション（年始ミッション等） |
| **MstMissionLimitedTerm** | イベントに紐づかない期間限定ミッション（降臨バトル専用ミッション等） |

### 降臨バトル専用ミッションの期間
- 降臨バトルの開催期間と **完全一致** させる
- 開始日時・終了日時が1秒でもずれると正しく動作しない

### 進捗グループキー（progress_group_key）
- 同じグループのミッションは進捗を共有
- 例：「5回挑戦」「10回挑戦」「20回挑戦」は全て同じグループに設定
- グループキーは `group{番号}` の形式（例：`group9`）

### ミッション達成回数の設定
- 降臨バトル専用ミッションは、期間中の最大挑戦回数を考慮して設定
- 例：1日5回×5日間=25回が上限の場合、25回以上のミッションは設定しない

---

## 実例（202512020リリース）

### 年始ミッション
- イベントID: event_glo_00001
- 期間: 2026-01-01 00:00:00 ～ 2026-01-05 23:59:59
- ミッション数: 3個
- 使用テーブル: MstMissionEvent

### 降臨バトル専用ミッション
- 降臨バトル: ファーストライブ
- 期間: 2026-01-09 15:00:00 ～ 2026-01-13 14:59:59
- ミッション数: 4個（5回、10回、20回、25回）
- 使用テーブル: MstMissionLimitedTerm
- progress_group_key: group9

---

**作成完了後**: 次は恒常ミッションの作成に進んでください。
