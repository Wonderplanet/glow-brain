# イベントミッション作成手順書

## 概要

イベント期間中の達成型ミッション（ステージクリア回数、ガシャ引き回数、特定キャラ使用等）を設定するためのマスタデータ作成手順です。

**参照する運営仕様書**: `04_ミッション.csv` の「◆いいジャン祭ミッション」「◆ぴえヨンミッション」セクション
**参照する技術資料**: `マスタデータ/docs/mission/ミッショントリガー一覧.csv`

---

## ミッションの種類

### いいジャン祭ミッション
- **目的**: イベント全体の達成目標
- **達成条件**: ステージクリア回数、ガシャ引き回数
- **報酬**: プリズム、賀正ガシャチケット、スペシャルガシャチケット

### ぴえヨンミッション
- **目的**: 特定キャラ（ぴえヨン）を使用してクエストをクリア
- **達成条件**: 特定キャラを編成してクエストクリア/挑戦
- **報酬**: コイン、エンブレム

---

## 必要な情報（運営仕様書から取得）

| 項目 | 例 |
|------|-----|
| 施策名称 | 【推しの子】いいジャン祭 特別ミッション |
| 開催期間 | 2026-01-01 00:00:00 ～ 2026-02-02 10:59:59 |
| ミッション内容 | ステージを5回クリアしよう |
| 報酬 | 賀正ガシャチケット×2 |

---

## 作成するマスタデータテーブル

1. **MstMissionEvent.csv** - イベントミッション定義
2. **MstMissionReward.csv** - ミッション報酬

---

## 作成手順

### Step 1: イベントミッションを作成（MstMissionEvent.csv）

| カラム | 設定値 | 例（ステージクリア回数） | 例（ガシャ引き回数） | 例（特定キャラ編成） |
|--------|--------|----------------------|---------------------|-------------------|
| ENABLE | `e` | e | e | e |
| id | `{event_id}_{連番}` | event_osh_00001_1 | event_osh_00001_28 | event_osh_00001_33 |
| release_key | リリースキー | 202512020 | 202512020 | 202512020 |
| mst_event_id | イベントID | event_osh_00001 | event_osh_00001 | event_osh_00001 |
| criterion_type | ミッション条件タイプ | StageClearCount | SpecificGachaDrawCount | SpecificUnitStageClearCount |
| criterion_value | 条件の値 | （空欄または__NULL__） | gasho_001 | chara_osh_00601.event_osh1_1day_00001 |
| criterion_count | 達成回数 | 5 | 10 | 1 |
| unlock_criterion_type | 前提条件タイプ | __NULL__ | __NULL__ | __NULL__ |
| unlock_criterion_value | 前提条件の値 | （空欄） | （空欄） | （空欄） |
| unlock_criterion_count | 前提条件回数 | 0 | 0 | 0 |
| group_key | グループキー | （空欄） | （空欄） | （空欄） |
| mst_mission_reward_group_id | 報酬グループID | osh_00001_event_reward_1 | osh_00001_event_reward_28 | osh_00001_event_reward_33 |
| sort_order | 表示順 | 1 | 28 | 33 |
| destination_scene | 遷移先 | Event | Gacha | Event |

---

### Step 2: ミッション報酬を作成（MstMissionReward.csv）

| カラム | 設定値 | 例（賀正チケット） | 例（プリズム） | 例（コイン） |
|--------|--------|-------------------|--------------|------------|
| ENABLE | `e` | e | e | e |
| id | 連番 | mission_reward_531 | mission_reward_535 | mission_reward_563 |
| release_key | リリースキー | 202512020 | 202512020 | 202512020 |
| group_id | Step1のmst_mission_reward_group_id | osh_00001_event_reward_1 | osh_00001_event_reward_5 | osh_00001_event_reward_33 |
| resource_type | 報酬タイプ | Item | FreeDiamond | Coin |
| resource_id | リソースID | ticket_glo_10001 | （空欄） | （空欄） |
| resource_amount | 個数 | 2 | 50 | 1000 |
| sort_order | 表示順 | 1 | 1 | 1 |
| 備考 | （任意）報酬名 | 推しの子ミッション(賀正チケット) | 推しの子ミッション(賀正チケット) | ぴえヨン連れて行こうミッション |

---

## 報酬タイプ（resource_type）

**重要**: `resource_type`に設定できる値は、DBスキーマ（master_tables_schema.json）で定義されたenumのみです。

### 設定可能なresource_type一覧

| resource_type | 日本語名 | resource_idの指定 | resource_idの参照先 | 例 |
|--------------|---------|-----------------|-------------------|-----|
| **Coin** | コイン | 不要（空欄） | - | コイン×1000 |
| **FreeDiamond** | 無償プリズム | 不要（空欄） | - | プリズム×50 |
| **Exp** | 経験値 | 不要（空欄） | - | 経験値×100 |
| **Item** | アイテム | **必須** | MstItem.id | 賀正ガシャチケット（ticket_glo_10001） |
| **Emblem** | エンブレム | **必須** | MstEmblem.id | 筋肉推し!エンブレム（emblem_osh1_00001） |
| **Unit** | キャラ | **必須** | MstUnit.id | ぴえヨン（chara_osh_00601） |

**参考**: RewardType.phpには他にもStamina、PaidDiamond、Artworkが定義されていますが、**MstMissionReward.csvでは使用できません**。

### resource_idの設定ルール

| resource_typeの値 | resource_idの設定 | 設定例 |
|------------------|-----------------|--------|
| Coin, FreeDiamond, Exp | 空欄または__NULL__ | （空欄） |
| Item | MstItem.csvのid | ticket_glo_10001 |
| Emblem | MstEmblem.csvのid | emblem_osh1_00001 |
| Unit | MstUnit.csvのid | chara_osh_00601 |

---

## ミッション条件タイプ（criterion_type）一覧

**重要**: `criterion_type`に設定できる値は、`マスタデータ/docs/mission/ミッショントリガー一覧.csv`に記載されているものだけです。

### イベントミッションでよく使う条件タイプ

| criterion_type | 説明 | criterion_value | criterion_count | 対象ミッションタイプ | 用途例 |
|---------------|------|-----------------|-----------------|---------------------|--------|
| **StageClearCount** | 通算ステージクリア回数 | NULL(未指定) | 回数 | 全て対象 | ステージを5回クリアしよう |
| **SpecificStageClearCount** | 指定ステージクリア回数 | ステージID | 回数 | 全て対象 | デイリークエストを1回クリアしよう |
| **SpecificQuestClear** | 指定クエスト初クリア | クエストID | 1 | 全て対象 | 収集クエスト「芸能界へ！」をクリアしよう |
| **SpecificGachaDrawCount** | 指定ガシャ引き回数 | ガシャID | 回数 | 全て対象 | 賀正ガシャ2026を10回引こう |
| **SpecificUnitStageClearCount** | 特定キャラ編成でクリア | ユニットID.ステージID | 回数 | 全て対象 | ぴえヨンを編成してクエスト1回クリア |
| **SpecificUnitStageChallengeCount** | 特定キャラ編成で挑戦 | ユニットID.ステージID | 回数 | 全て対象 | ぴえヨンを編成してクエスト1回挑戦 |

**criterion_valueの設定ルール**:
- **NULL(未指定)**: 特定の対象を指定しない場合。CSVでは空欄または`__NULL__`と記載
- **ID指定**: 特定のステージ、クエスト、ガシャ等を指定する場合
- **複合ID**: ユニットIDとステージIDを `.`（ドット）で連結（例：`chara_osh_00601.event_osh1_1day_00001`）

---

## その他の条件タイプ（参考）

イベントミッションではあまり使いませんが、設定可能な条件タイプの例：

| criterion_type | 説明 | criterion_value | 対象ミッションタイプ |
|---------------|------|-----------------|---------------------|
| QuestClearCount | 通算クエストクリア回数 | NULL(未指定) | 全て対象 |
| GachaDrawCount | 通算ガシャ引き回数 | NULL(未指定) | 全て対象 |
| UnitLevelUpCount | ユニットレベルアップ回数 | NULL(未指定) | 全て対象 |
| SpecificUnitLevel | 指定ユニットがLv到達 | ユニットID | 全て対象 |
| DefeatEnemyCount | 敵撃破回数 | NULL(未指定) | 全て対象 |

**完全なリストは**: `マスタデータ/docs/mission/ミッショントリガー一覧.csv` を参照してください。

---

## 遷移先（destination_scene）

**重要**: `destination_scene`に設定できる値は、クライアント実装（DestinationScene.cs）で定義されたenumのみです。

### 設定可能なdestination_scene一覧

| destination_scene | 遷移先画面 | イベントミッションでの使用例 |
|------------------|----------|------------------------|
| **Event** | イベントTOP画面 | イベント全般ミッション |
| **Gacha** | ガシャ画面 | ガシャ引き回数ミッション |
| **QuestSelect** | クエスト選択画面 | クエストクリア系ミッション |
| **StageSelect** | ステージ選択画面 | ステージクリア系ミッション |
| **Home** | ホーム画面 | 汎用ミッション |
| **Shop** | ショップ画面 | ショップ関連ミッション |
| **UnitList** | ユニット一覧画面 | ユニット育成系ミッション |
| **Exchange** | 交換所画面 | 交換所関連ミッション |

### その他の設定可能な値（参考）

以下の値も設定可能ですが、イベントミッションではあまり使用しません：

| destination_scene | 遷移先画面 |
|------------------|----------|
| Empty | 遷移なし |
| IdleIncentive | 放置報酬画面 |
| Web | Web画面 |
| OutpostEnhance | 拠点強化画面 |
| Pack | パック画面 |
| Pass | パス画面 |
| Pvp | PvP画面 |
| LinkBnId | バンダイナムコID連携画面 |

**注意**: クライアント実装で定義されていない値を設定するとエラーになります。

---

## ミッション作成パターン

### パターン1: ステージクリア回数ミッション

**運営仕様書の記載**:
```
ミッション内容: ステージを5回クリアしよう
報酬: 賀正ガシャチケット×2
```

**MstMissionEvent**:
- criterion_type: `StageClearCount`
- criterion_value: （空欄または__NULL__）← NULL(未指定)
- criterion_count: `5`

**MstMissionReward**:
- resource_type: `Item`
- resource_id: `ticket_glo_10001`
- resource_amount: `2`

---

### パターン2: ガシャ引き回数ミッション

**運営仕様書の記載**:
```
ミッション内容: 賀正ガシャ2026を10回引こう
報酬: スペシャルガシャチケット×1
```

**MstMissionEvent**:
- criterion_type: `SpecificGachaDrawCount`
- criterion_value: `gasho_001` ← ガシャIDを指定
- criterion_count: `10`

**MstMissionReward**:
- resource_type: `Item`
- resource_id: `ticket_glo_00002`
- resource_amount: `1`

---

### パターン3: 特定キャラ編成クリアミッション

**運営仕様書の記載**:
```
ミッション内容: 【汗が輝いてるよ!】ぴえヨンを編成に入れて「ファンと推し合戦！」を1回クリア
報酬: コイン×1000
```

**MstMissionEvent**:
- criterion_type: `SpecificUnitStageClearCount`
- criterion_value: `chara_osh_00601.event_osh1_1day_00001` ← ユニットID.ステージID
- criterion_count: `1`

**MstMissionReward**:
- resource_type: `Coin`
- resource_id: （空欄）
- resource_amount: `1000`

**criterion_valueの構成**:
- `chara_osh_00601`: ぴえヨンのキャラID
- `.`: 区切り文字（ドット）
- `event_osh1_1day_00001`: ファンと推し合戦！のステージID

---

### パターン4: 特定クエストクリアミッション

**運営仕様書の記載**:
```
ミッション内容: 【胸筋の登山始まってるよ!】収集クエスト「芸能界へ！」をクリアしよう
報酬: コイン×1000
```

**MstMissionEvent**:
- criterion_type: `SpecificQuestClear`
- criterion_value: `quest_event_osh1_charaget01`
- criterion_count: `1` ← クエストクリアは常に1（2以上は設定不可）

**MstMissionReward**:
- resource_type: `Coin`
- resource_id: （空欄）
- resource_amount: `1000`

**注意**: `SpecificQuestClear`のcriterion_countは常に`1`です。クエストの初クリアのみを判定するため、2以上は設定できません。

---

## チェックリスト

作成後、以下を確認してください：

- [ ] ミッション数が運営仕様書と一致しているか
- [ ] criterion_typeがミッショントリガー一覧に存在するか
- [ ] criterion_valueの設定方法が正しいか（NULL指定 vs ID指定）
- [ ] 特定キャラ編成系のcriterion_valueが`{ユニットID}.{ステージID}`の形式か
- [ ] SpecificQuestClearのcriterion_countが1になっているか
- [ ] criterion_countが仕様書と一致しているか
- [ ] 報酬グループIDが正しく紐づいているか
- [ ] resource_typeがDBスキーマで定義されたenum値（Coin, FreeDiamond, Exp, Item, Emblem, Unit）のいずれかか
- [ ] resource_idが必要なresource_type（Item, Emblem, Unit）でresource_idが設定されているか
- [ ] resource_idが不要なresource_type（Coin, FreeDiamond, Exp）でresource_idが空欄になっているか
- [ ] resource_idに設定したIDが参照先マスタテーブル（MstItem, MstEmblem, MstUnit）に存在するか
- [ ] 報酬の種類と個数が仕様書と一致しているか
- [ ] destination_sceneがクライアント実装で定義されたenum値のいずれかか
- [ ] destination_sceneがミッションの目的に合った遷移先になっているか
- [ ] sort_orderが適切に設定されているか

---

## 注意点

### criterion_typeの制約
- 設定可能な値は**ミッショントリガー一覧に記載されているもののみ**
- 記載のないcriterion_typeを設定するとエラーになる
- 新しいcriterion_typeが必要な場合は、サーバー実装の追加が必要

### resource_typeの制約
- 設定可能な値は**DBスキーマで定義されたenumのみ**: Coin, FreeDiamond, Exp, Item, Emblem, Unit
- Item, Emblem, Unitの場合、resource_idの指定が**必須**
- Coin, FreeDiamond, Expの場合、resource_idは**空欄**にする
- resource_idに設定するIDは、対応するマスタテーブル（MstItem, MstEmblem, MstUnit）に存在する必要がある

### destination_sceneの制約
- 設定可能な値は**クライアント実装（DestinationScene.cs）で定義されたenumのみ**
- 主な値: Event, Gacha, QuestSelect, StageSelect, Home, Shop, UnitList, Exchange
- クライアント実装で定義されていない値を設定するとエラーになる
- ミッションの目的に合った遷移先を選択する（例：ガシャミッション→Gacha、クエストミッション→QuestSelect）

### criterion_valueの記載ルール

| 値の種類 | CSVでの記載方法 | 例 |
|---------|---------------|-----|
| NULL(未指定) | 空欄または`__NULL__` | （空欄） |
| ID指定 | IDを直接記載 | `quest_event_osh1_charaget01` |
| 複合ID | `.`で連結 | `chara_osh_00601.event_osh1_1day_00001` |

### ミッションIDの採番
- イベントIDの後に連番を付ける: `event_osh_00001_1`, `event_osh_00001_2`, ...
- 連番はイベント全体で通し番号

### 報酬グループIDの命名
- `{event_id}_event_reward_{連番}` の形式
- 例: `osh_00001_event_reward_1`

### 特定キャラ編成ミッションの注意
- criterion_valueは `{ユニットID}.{ステージID}` の形式
- ユニットIDとステージIDの間に `.`（ドット）を必ず入れる
- ステージIDは完全一致する必要がある

### クリアと挑戦の違い
- **SpecificUnitStageClearCount**: クリア（成功）した回数
- **SpecificUnitStageChallengeCount**: 挑戦（失敗含む）した回数
- 高難易度クエストでは「挑戦」を使うことが多い

### SpecificQuestClearの特殊な仕様
- クエストの**初クリア**のみを判定
- criterion_countは常に`1`（2以上は設定不可）
- クエスト内の全ステージを1回以上クリアした時点で達成

---

## 実例（202512020リリース）

### いいジャン祭ミッション
- ミッション数: 32個
- 主な条件: ステージクリア回数（5～600回）、ガシャ引き回数（10～50回）
- 主な報酬: プリズム、賀正ガシャチケット、スペシャルガシャチケット

### ぴえヨンミッション
- ミッション数: 21個
- 主な条件: ぴえヨンを編成してクエストクリア/挑戦
- 主な報酬: コイン、筋肉推し!エンブレム

---

**作成完了後**: 次は期間限定ミッションや恒常ミッションの作成に進んでください。

**困ったときは**: `マスタデータ/docs/mission/ミッショントリガー一覧.csv` を参照してください。
