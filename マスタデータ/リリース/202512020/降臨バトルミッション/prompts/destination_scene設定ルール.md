# destination_scene設定ルール

## 概要

`destination_scene`は、ミッションをタップした際の遷移先シーンを指定するカラムです。
このドキュメントでは、設定可能な値とその使用方法を説明します。

## データソース

destination_sceneの定義は以下のファイルに記載されています。

- `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/ValueObjects/DestinationScene.cs`

## 基本ルール

### 1. enum定義済みの値を使用

destination_sceneには、`DestinationScene.cs`の`DestinationSceneEnum`に定義されている値を基本とします。
未定義の値を設定すると、クライアント側で正しく処理されない可能性があります。

### 2. 大文字小文字の一致

enum名と完全一致する文字列を設定してください。
大文字小文字が異なると、正しく遷移しない場合があります。

## 設定可能な値一覧

以下は、`DestinationScene.cs`に定義されている標準的な遷移先です。

### Empty

**説明**: 遷移先なし（空）

**用途**: ミッション達成後に特定の画面へ遷移させたくない場合

**設定値**: `Empty` または 空文字列

---

### QuestSelect

**説明**: クエスト選択画面

**用途**: クエストに関連するミッション

**設定値**: `QuestSelect`

**例**:
- 指定クエストを初クリアする
- 通算クエストクリア回数が〇回に到達

---

### StageSelect

**説明**: ステージ選択画面

**用途**: ステージに関連するミッション

**設定値**: `StageSelect`

**例**:
- 指定ステージを〇回クリア
- 指定ステージに〇回挑戦

---

### Home

**説明**: ホーム画面

**用途**: 特定の画面への遷移が不要な場合や、ホームに戻す場合

**設定値**: `Home`

---

### IdleIncentive

**説明**: 放置探索画面

**用途**: 探索に関連するミッション

**設定値**: `IdleIncentive`

**例**:
- クイック探索を〇回する
- 探索を〇回する

---

### Web

**説明**: Web画面（外部リンク）

**用途**: 外部サイトへの遷移が必要なミッション

**設定値**: `Web`

**例**:
- 公式サイトにアクセス
- 特定のWebページを確認

---

### UnitList

**説明**: ユニット一覧画面

**用途**: ユニットに関連するミッション

**設定値**: `UnitList`

**例**:
- ユニットのレベルアップを〇回
- 指定ユニットがLv.〇に到達

---

### OutpostEnhance

**説明**: ゲート強化画面

**用途**: ゲート強化に関連するミッション

**設定値**: `OutpostEnhance`

**注意**: クライアントコードでは`OutPostEnhance`（大文字P）で定義されていますが、設定時は`OutpostEnhance`を使用してください

**例**:
- ゲートを〇回以上強化
- 指定ゲート強化項目がLv〇に到達

---

### Shop

**説明**: ショップ画面

**用途**: ショップに関連するミッション

**設定値**: `Shop`

---

### Pack

**説明**: パック購入画面

**用途**: パック購入に関連するミッション

**設定値**: `Pack`

---

### Pass

**説明**: パス画面（シーズンパスなど）

**用途**: パスに関連するミッション

**設定値**: `Pass`

---

### Event

**説明**: イベントトップ画面

**用途**: イベントに関連するミッション

**設定値**: `Event`

**例**:
- イベント特設ページへの遷移
- イベント限定ミッション

---

### Gacha

**説明**: ガシャ画面

**用途**: ガシャに関連するミッション

**設定値**: `Gacha`

**例**:
- 指定ガシャを〇回引く
- 通算でガシャを〇回引く

---

### Pvp

**説明**: 決闘（PvP）画面

**用途**: 決闘に関連するミッション

**設定値**: `Pvp`

**例**:
- 決闘に〇回挑戦
- 決闘に〇回勝利

---

### LinkBnId

**説明**: アカウント連携画面

**用途**: アカウント連携に関連するミッション

**設定値**: `LinkBnId`

**例**:
- アカウント連携を行う

---

### Exchange

**説明**: 交換所画面

**用途**: アイテム交換に関連するミッション

**設定値**: `Exchange`

---

## 特殊なケース

### カスタム遷移先

一部のミッションでは、enum定義にない独自の遷移先を使用する場合があります。

例: `AdventBattle`（降臨バトル画面）

**注意**: カスタム遷移先を使用する場合は、以下を確認してください。
1. クライアント側で対応する遷移処理が実装されているか
2. 過去の実装例があるか
3. 開発チームとの合意があるか

カスタム遷移先が不明な場合は、開発チームに確認してください。

## 設定時の考え方

### ミッションの達成条件から遷移先を決定

ミッションの達成条件に応じて、適切な遷移先を設定します。

| 達成条件の種類 | 推奨遷移先 |
|--------------|-----------|
| ステージクリア | `StageSelect` |
| クエストクリア | `QuestSelect` |
| ガシャを引く | `Gacha` |
| ユニット強化 | `UnitList` |
| ゲート強化 | `OutpostEnhance` |
| 探索実行 | `IdleIncentive` |
| 決闘挑戦 | `Pvp` |
| 降臨バトル | `AdventBattle` |
| 特定アクション不要 | `Home` または `Empty` |

### ユーザー体験の考慮

遷移先は、ユーザーがミッション達成のために次に取るべきアクションを考慮して設定します。

**良い例**:
- ミッション: 「ステージ1-5を3回クリア」
- 遷移先: `StageSelect`
- 理由: ユーザーが該当ステージに素早くアクセスできる

**悪い例**:
- ミッション: 「ステージ1-5を3回クリア」
- 遷移先: `Home`
- 理由: ユーザーが自分でステージ選択画面まで移動する必要がある

## 降臨バトルミッションの場合

降臨バトルミッションでは、通常以下のように設定します。

```csv
destination_scene
AdventBattle
```

**理由**: ユーザーが降臨バトル画面に直接アクセスして、ミッションを達成できるようにするため

## データ検証チェックリスト

destination_scene設定時は、以下を確認してください。

- [ ] `DestinationScene.cs`のenum定義に存在する値である（またはカスタム遷移先として承認済み）
- [ ] 大文字小文字が正確に一致している
- [ ] ミッションの達成条件に適した遷移先である
- [ ] ユーザーが次のアクションを取りやすい遷移先である
- [ ] 空欄にする場合は意図的である（`Empty`を使用すべきか確認）

## トラブルシューティング

### エラー: 遷移先が正しく動作しない

**原因1**: enum定義にない値を設定している

**対処**:
1. `DestinationScene.cs`を確認
2. 正しい値に修正
3. カスタム遷移先の場合は開発チームに確認

**原因2**: 大文字小文字が異なる

**対処**:
1. enum定義と完全一致させる
2. 例: `questselect` → `QuestSelect`

### エラー: タップしても何も起きない

**原因**: `Empty`または空文字列が設定されている

**対処**:
1. 意図的に遷移先なしにしている場合 → 問題なし
2. 遷移させたい場合 → 適切な遷移先を設定

### 警告: カスタム遷移先の使用

**原因**: enum定義にない値（例: `AdventBattle`）を使用している

**対処**:
1. 過去の実装例を確認
2. クライアント側の対応を確認
3. 不明な場合は開発チームに確認

## 実装の確認方法

### クライアントコードでの定義確認

`DestinationScene.cs`ファイルで、利用可能な値を確認できます。

```csharp
public enum DestinationSceneEnum
{
    Empty,
    QuestSelect,
    StageSelect,
    Home,
    // ... その他の値
}
```

### 遷移処理の実装確認

各遷移先の実際の処理は、クライアント側のPresenterやUseCaseで実装されています。
新しい遷移先を追加する場合は、対応する処理の実装が必要です。

## 参考資料

- `projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/ValueObjects/DestinationScene.cs` - destination_sceneの定義
- 過去のマスタデータCSV - 実装例の参照

## 補足情報

### destination_sceneとmission_categoryの関係

`destination_scene`は通常、`mission_category`と関連しています。

例:
- `mission_category=AdventBattle` → `destination_scene=AdventBattle`
- `mission_category=Stage` → `destination_scene=StageSelect`

ただし、必ずしも一致するわけではありません。
ミッションの性質に応じて、最適な遷移先を選択してください。

### 空値の扱い

destination_sceneが空欄の場合、クライアント側では`Empty`として扱われます。
明示的に`Empty`を設定することを推奨します。

## 更新履歴

- 2026-01-17: 初版作成
