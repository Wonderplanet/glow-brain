{
  "name": "Google Sheets to GitHub Issue with CSV Attachments (Read-Only)",
  "nodes": [
    {
      "parameters": {},
      "id": "a1b2c3d4-e5f6-7a8b-9c0d-e1f2a3b4c5d6",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "// ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°\nfunction extractSpreadsheetId(url) {\n  const match = url.match(/\\/spreadsheets\\/d\\/([a-zA-Z0-9-_]+)/);\n  return match ? match[1] : url;\n}\n\nconst spreadsheetUrl = $input.first().json.spreadsheet_url;\nconst spreadsheetId = extractSpreadsheetId(spreadsheetUrl);\n\nreturn {\n  json: {\n    spreadsheet_url: spreadsheetUrl,\n    spreadsheet_id: spreadsheetId\n  }\n};"
      },
      "id": "b1c2d3e4-f5a6-7b8c-9d0e-a1f2b3c4d5e6",
      "name": "Extract Spreadsheet ID",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [550, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ 'https://sheets.googleapis.com/v4/spreadsheets/' + $json.spreadsheet_id + '?fields=properties.title,sheets.properties' }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "options": {}
      },
      "id": "b2c3d4e5-f6a7-8b9c-0d1e-f2a3b4c5d6e7",
      "name": "Get Spreadsheet Metadata (API GET - READ ONLY)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [850, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets account (readonly scope)"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰å¿…è¦ãªæƒ…å ±ã‚’æŠ½å‡º\nconst response = $input.first().json;\nconst spreadsheetName = response.properties?.title || 'Unknown Spreadsheet';\nconst spreadsheetId = $node[\"Extract Spreadsheet ID\"].json.spreadsheet_id;\nconst spreadsheetUrl = $node[\"Extract Spreadsheet ID\"].json.spreadsheet_url;\n\n// å…¨ã‚·ãƒ¼ãƒˆæƒ…å ±ã‚’æŠ½å‡º\nconst sheets = response.sheets || [];\n\n// å„ã‚·ãƒ¼ãƒˆã®æƒ…å ±ã‚’æ•´å½¢\nconst outputData = sheets.map(sheet => ({\n  spreadsheet_id: spreadsheetId,\n  spreadsheet_name: spreadsheetName,\n  spreadsheet_url: spreadsheetUrl,\n  sheet_name: sheet.properties?.title,\n  sheet_id: sheet.properties?.sheetId,\n  sheet_index: sheet.properties?.index\n}));\n\nreturn outputData;"
      },
      "id": "c3d4e5f6-a7b8-9c0d-1e2f-a3b4c5d6e7f8",
      "name": "Parse Sheet Names",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1150, 300]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "={{ 'https://sheets.googleapis.com/v4/spreadsheets/' + $json.spreadsheet_id + '/values/' + encodeURIComponent($json.sheet_name) }}",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "options": {}
      },
      "id": "e5f6a7b8-c9d0-1e2f-3a4b-c5d6e7f8a9b0",
      "name": "Read Each Sheet (API GET - READ ONLY)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1450, 300],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "1",
          "name": "Google Sheets account (readonly scope)"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›\nconst sheetName = $node[\"Parse Sheet Names\"].json.sheet_name;\nconst response = $input.first().json;\nconst values = response.values || [];\n\nif (values.length === 0) {\n  return {\n    json: {\n      sheet_name: sheetName,\n      csv_content: '',\n      filename: `${sheetName}.csv`,\n      row_count: 0\n    }\n  };\n}\n\n// CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›\nconst csvRows = values.map(row => {\n  return row.map(cell => {\n    const value = cell !== null && cell !== undefined ? String(cell) : '';\n    // CSVã‚¨ã‚¹ã‚±ãƒ¼ãƒ—å‡¦ç†ï¼ˆãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã¨ã‚«ãƒ³ãƒã‚’å«ã‚€å€¤ã‚’å‡¦ç†ï¼‰\n    if (value.includes(',') || value.includes('\"') || value.includes('\\n')) {\n      return `\"${value.replace(/\"/g, '\"\"')}\"`;\n    }\n    return value;\n  }).join(',');\n});\n\nconst csvContent = csvRows.join('\\n');\n\nreturn {\n  json: {\n    sheet_name: sheetName,\n    csv_content: csvContent,\n    filename: `${sheetName}.csv`,\n    row_count: values.length - 1, // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’é™¤ã\n    spreadsheet_id: $node[\"Parse Sheet Names\"].json.spreadsheet_id,\n    spreadsheet_name: $node[\"Parse Sheet Names\"].json.spreadsheet_name,\n    spreadsheet_url: $node[\"Parse Sheet Names\"].json.spreadsheet_url\n  }\n};"
      },
      "id": "f6a7b8c9-d0e1-2f3a-4b5c-d6e7f8a9b0c1",
      "name": "Convert to CSV",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1750, 300]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByPosition",
        "options": {}
      },
      "id": "a7b8c9d0-e1f2-3a4b-5c6d-e7f8a9b0c1d2",
      "name": "Aggregate CSVs",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [2050, 300]
    },
    {
      "parameters": {
        "jsCode": "// å…¨CSVãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„\nconst allItems = $input.all();\nconst csvFiles = [];\nlet totalRows = 0;\nlet spreadsheetUrl = '';\nlet spreadsheetName = '';\n\nallItems.forEach(item => {\n  if (item.json.csv_content !== undefined) {\n    csvFiles.push({\n      filename: item.json.filename,\n      content: item.json.csv_content,\n      sheet_name: item.json.sheet_name,\n      row_count: item.json.row_count || 0\n    });\n    totalRows += item.json.row_count || 0;\n    spreadsheetUrl = item.json.spreadsheet_url || spreadsheetUrl;\n    spreadsheetName = item.json.spreadsheet_name || spreadsheetName;\n  }\n});\n\nreturn {\n  json: {\n    csv_files: csvFiles,\n    spreadsheet_url: spreadsheetUrl,\n    spreadsheet_name: spreadsheetName,\n    total_sheets: csvFiles.length,\n    total_rows: totalRows\n  }\n};"
      },
      "id": "b8c9d0e1-f2a3-4b5c-6d7e-f8a9b0c1d2e3",
      "name": "Prepare GitHub Issue Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2350, 300]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "issue",
        "operation": "create",
        "owner": "Wonderplanet",
        "repository": "glow-brain",
        "title": "=[ãƒ‡ãƒ¼ã‚¿æ›´æ–°] {{ $json.spreadsheet_name }}",
        "body": "=## ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®CSVå¤‰æ›å®Œäº†\n\n**ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ**: [{{ $json.spreadsheet_name }}]({{ $json.spreadsheet_url }})\n**å¤‰æ›æ—¥æ™‚**: {{ $now.toISO() }}\n**ã‚·ãƒ¼ãƒˆæ•°**: {{ $json.total_sheets }}\n**ç·ãƒ‡ãƒ¼ã‚¿è¡Œæ•°**: {{ $json.total_rows }}\n\n### å¤‰æ›ã•ã‚ŒãŸCSVãƒ•ã‚¡ã‚¤ãƒ«\n\n{{ $json.csv_files.map(f => `- \\`${f.filename}\\` (${f.row_count}è¡Œ)`).join('\\n') }}\n\n---\nå„ã‚·ãƒ¼ãƒˆã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã“ã®issueã®ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦é †æ¬¡æ·»ä»˜ã•ã‚Œã¾ã™ã€‚\n\n**æ³¨æ„**: ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯**å®Œå…¨ã«èª­ã¿å–ã‚Šå°‚ç”¨**ã§ã™ã€‚å…ƒã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã¯ä¸€åˆ‡å¤‰æ›´ã•ã‚Œã¾ã›ã‚“ã€‚",
        "labels": "data-update,automated",
        "additionalFields": {}
      },
      "id": "c9d0e1f2-a3b4-5c6d-7e8f-a9b0c1d2e3f4",
      "name": "Create GitHub Issue",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [2650, 300]
    },
    {
      "parameters": {
        "jsCode": "// Issueç•ªå·ã¨CSVãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’æ¬¡ã®ãƒãƒ¼ãƒ‰ã«æ¸¡ã™\nconst issueNumber = $input.first().json.number;\nconst csvFiles = $node[\"Prepare GitHub Issue Data\"].json.csv_files;\n\nreturn {\n  json: {\n    issue_number: issueNumber,\n    csv_files: csvFiles\n  }\n};"
      },
      "id": "d0e1f2a3-b4c5-6d7e-8f9a-b0c1d2e3f4a5",
      "name": "Extract Issue Number",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2950, 300]
    },
    {
      "parameters": {
        "batchSize": 1,
        "options": {}
      },
      "id": "e1f2a3b4-c5d6-7e8f-9a0b-c1d2e3f4a5b6",
      "name": "Loop Over CSV Files",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [3250, 300]
    },
    {
      "parameters": {
        "jsCode": "// ç¾åœ¨ã®CSVãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±ã‚’å–å¾—\nconst issueNumber = $node[\"Extract Issue Number\"].json.issue_number;\nconst csvFiles = $node[\"Extract Issue Number\"].json.csv_files;\nconst batchIndex = $node[\"Loop Over CSV Files\"].context.currentRunIndex;\nconst currentFile = csvFiles[batchIndex];\n\nreturn {\n  json: {\n    issue_number: issueNumber,\n    csv_file: currentFile\n  }\n};"
      },
      "id": "f1a2b3c4-d5e6-7f8a-9b0c-d1e2f3a4b5c6",
      "name": "Get Current CSV File",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3550, 300]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "resource": "issue",
        "operation": "createComment",
        "owner": "Wonderplanet",
        "repository": "glow-brain",
        "issueNumber": "={{ $json.issue_number }}",
        "body": "=### ğŸ“„ {{ $json.csv_file.filename }}\n\n**ã‚·ãƒ¼ãƒˆå**: {{ $json.csv_file.sheet_name }}\n**ãƒ‡ãƒ¼ã‚¿è¡Œæ•°**: {{ $json.csv_file.row_count }}\n\n```csv\n{{ $json.csv_file.content }}\n```"
      },
      "id": "f2a3b4c5-d6e7-8f9a-0b1c-d2e3f4a5b6c7",
      "name": "Add CSV as Comment",
      "type": "n8n-nodes-base.github",
      "typeVersion": 1,
      "position": [3850, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "spreadsheet_url_exists",
              "leftValue": "={{ $json.spreadsheet_url }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "a3b4c5d6-e7f8-9a0b-1c2d-e3f4a5b6c7d8",
      "name": "Validate Input",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [400, 300]
    }
  ],
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Validate Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Input": {
      "main": [
        [
          {
            "node": "Extract Spreadsheet ID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Spreadsheet ID": {
      "main": [
        [
          {
            "node": "Get Spreadsheet Metadata (API GET - READ ONLY)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Spreadsheet Metadata (API GET - READ ONLY)": {
      "main": [
        [
          {
            "node": "Parse Sheet Names",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Sheet Names": {
      "main": [
        [
          {
            "node": "Read Each Sheet (API GET - READ ONLY)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Each Sheet (API GET - READ ONLY)": {
      "main": [
        [
          {
            "node": "Convert to CSV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to CSV": {
      "main": [
        [
          {
            "node": "Aggregate CSVs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate CSVs": {
      "main": [
        [
          {
            "node": "Prepare GitHub Issue Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare GitHub Issue Data": {
      "main": [
        [
          {
            "node": "Create GitHub Issue",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create GitHub Issue": {
      "main": [
        [
          {
            "node": "Extract Issue Number",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Issue Number": {
      "main": [
        [
          {
            "node": "Loop Over CSV Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over CSV Files": {
      "main": [
        [
          {
            "node": "Get Current CSV File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Current CSV File": {
      "main": [
        [
          {
            "node": "Add CSV as Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add CSV as Comment": {
      "main": [
        [
          {
            "node": "Loop Over CSV Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "pinData": {},
  "staticData": null,
  "tags": [
    {
      "createdAt": "2026-01-06T00:00:00.000Z",
      "updatedAt": "2026-01-06T00:00:00.000Z",
      "id": "1",
      "name": "google-sheets-readonly"
    },
    {
      "createdAt": "2026-01-06T00:00:00.000Z",
      "updatedAt": "2026-01-06T00:00:00.000Z",
      "id": "2",
      "name": "github"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2026-01-06T00:00:00.000Z",
  "versionId": "2"
}
