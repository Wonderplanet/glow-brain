# 降臨バトル マスタデータ設定方法

## 目次

1. [概要](#概要)
2. [マスタデータテーブル一覧](#マスタデータテーブル一覧)
3. [基本設定手順](#基本設定手順)
4. [各テーブルの設定方法](#各テーブルの設定方法)
5. [設定例](#設定例)
6. [注意事項とチェックポイント](#注意事項とチェックポイント)

---

## 概要

降臨バトルは、期間限定の強敵バトルイベントです。プレイヤーはスコアを競い、ランキング報酬やハイスコア報酬を獲得します。

### 降臨バトルの2つのタイプ

| タイプ | 説明 | 報酬体系 |
|-------|------|---------|
| **ScoreChallenge（スコアチャレンジ）** | 個人スコアのみを競う | ハイスコア報酬、ランキング報酬、ランク報酬、ドロップ報酬 |
| **Raid（協力バトル）** | 個人スコア + 全プレイヤー合計スコアを競う | 上記 + 協力スコア報酬 |

### スコアとランクの仕組み

- **MaxScore（最高スコア）**: 1回のバトルで獲得した最高スコア
- **TotalScore（累積スコア）**: 全バトルの累積スコア
- **Rank（ランク）**: TotalScoreに応じて昇格する4段階のランク（Bronze → Silver → Gold → Master）
- **RankLevel（ランクレベル）**: 各ランク内での細分化されたレベル（Lv1, Lv2, Lv3...）

---

## マスタデータテーブル一覧

降臨バトルの設定には以下の6つのテーブルを使用します。

| テーブル名 | 用途 | 必須 |
|-----------|------|-----|
| **MstAdventBattle** | 降臨バトルの基本設定 | ✅ |
| **MstAdventBattleI18n** | 降臨バトル名・説明文（多言語対応） | ✅ |
| **MstAdventBattleRank** | スコアランク定義 | ✅ |
| **MstAdventBattleRewardGroup** | 報酬グループ定義 | ✅ |
| **MstAdventBattleReward** | 報酬内容詳細 | ✅ |
| **MstAdventBattleClearReward** | バトルクリア時の報酬 | オプション |

**データファイル格納先**:
```
glow-masterdata/
├── MstAdventBattle.csv
├── MstAdventBattleI18n.csv
├── MstAdventBattleRank.csv
├── MstAdventBattleRewardGroup.csv
├── MstAdventBattleReward.csv
└── MstAdventBattleClearReward.csv
```

**スキーマ定義格納先**:
```
glow-masterdata/sheet_schema/
├── MstAdventBattle.csv
├── MstAdventBattleI18n.csv
├── MstAdventBattleRank.csv
├── MstAdventBattleRewardGroup.csv
├── MstAdventBattleReward.csv
└── MstAdventBattleClearReward.csv
```

---

## 基本設定手順

降臨バトルを新規作成する際の推奨手順は以下の通りです。

### STEP 1: 基本情報の設計

まず、以下の項目を決定します。

- [ ] 降臨バトルID（例: `advent_battle_summer_2025`）
- [ ] バトルタイプ（ScoreChallenge / Raid）
- [ ] 開催期間（start_at, end_at）
- [ ] 挑戦可能回数（1日あたり）
- [ ] バトル時間制限（秒）
- [ ] 表示する敵キャラID（最大3体）

### STEP 2: ランク体系の設計

- [ ] Bronze/Silver/Gold/Master の各ランクレベル数を決定
- [ ] 各ランクレベルに到達するための必要累積スコアを設定

### STEP 3: 報酬体系の設計

- [ ] ハイスコア報酬の段階とスコア条件を設定
- [ ] ランク到達報酬を各ランクレベルに設定
- [ ] ランキング報酬を設定（上位何位まで報酬を出すか）
- [ ] 協力スコア報酬を設定（Raidの場合のみ）
- [ ] ドロップ報酬・クリア報酬を設定

### STEP 4: マスタデータCSVの作成

上記の設計に基づき、6つのCSVファイルを作成します。

### STEP 5: 動作確認

- [ ] ゲーム内で降臨バトルが表示されるか確認
- [ ] バトル開始・終了が正常に動作するか確認
- [ ] スコア計算が正しいか確認
- [ ] ランク昇格が正しいか確認
- [ ] 各報酬が正しく受け取れるか確認

---

## 各テーブルの設定方法

### 1. MstAdventBattle（降臨バトル基本設定）

降臨バトルの基本情報を定義するメインテーブルです。

#### スキーマ定義

```csv
ENABLE, id, mst_event_id, mst_in_game_id, asset_key, advent_battle_type,
time_limit_seconds, initial_battle_point, score_addition_type, score_additional_coef,
score_addition_target_mst_enemy_stage_parameter_id, mst_stage_rule_group_id,
event_bonus_group_id, challengeable_count, ad_challengeable_count,
display_mst_unit_id1, display_mst_unit_id2, display_mst_unit_id3,
exp, coin, start_at, end_at, release_key, name.ja, boss_description.ja
```

#### 主要フィールド説明

| フィールド | 型 | 必須 | 説明 | 設定例 |
|-----------|-----|-----|------|--------|
| **ENABLE** | Boolean | ✅ | 有効フラグ | `TRUE` |
| **id** | String | ✅ | 降臨バトルID（一意キー） | `advent_battle_summer_2025` |
| **mst_event_id** | String | ✅ | イベントID（外部参照） | `event_summer_2025` |
| **mst_in_game_id** | String | ✅ | インゲームID（バトルステージ設定） | `advent_summer_stage` |
| **asset_key** | String | ✅ | 背景アセットキー | `advent_summer_bg` |
| **advent_battle_type** | Enum | ✅ | バトルタイプ | `ScoreChallenge` または `Raid` |
| **time_limit_seconds** | Integer | ✅ | バトルの時間制限（秒） | `180` (3分) |
| **initial_battle_point** | Integer | ✅ | 初期バトルポイント | `3` |
| **score_addition_type** | Enum | ✅ | スコア加算タイプ | `AllEnemies` または `AllEnemiesAndOutPost` |
| **score_additional_coef** | Decimal | ✅ | スコア加算係数 | `1.0` |
| **score_addition_target_mst_enemy_stage_parameter_id** | String |  | スコア加算対象の敵ステージパラメータID | （未使用の場合は空） |
| **mst_stage_rule_group_id** | String |  | ステージルールグループID | （未使用の場合は空） |
| **event_bonus_group_id** | String |  | イベントボーナスグループID | `advent_summer_bonus` |
| **challengeable_count** | Integer | ✅ | 1日の通常挑戦可能回数 | `5` |
| **ad_challengeable_count** | Integer | ✅ | 1日の広告挑戦可能回数 | `3` |
| **display_mst_unit_id1** | String | ✅ | トップ画面に表示する敵キャラID（1体目） | `enemy_boss_dragon` |
| **display_mst_unit_id2** | String |  | トップ画面に表示する敵キャラID（2体目） | `enemy_boss_knight` |
| **display_mst_unit_id3** | String |  | トップ画面に表示する敵キャラID（3体目） | （空でも可） |
| **exp** | Integer | ✅ | バトルクリア時の獲得リーダーEXP | `100` |
| **coin** | Integer | ✅ | バトルクリア時の獲得コイン | `500` |
| **start_at** | DateTime | ✅ | 開催開始日時（JST） | `2025-07-01 15:00:00` |
| **end_at** | DateTime | ✅ | 開催終了日時（JST） | `2025-07-15 14:59:59` |
| **release_key** | String |  | リリースキー（段階リリース用） | （通常は空） |
| **name.ja** | String | ✅ | 降臨バトル名（日本語） | `夏の試練！灼熱の竜` |
| **boss_description.ja** | String | ✅ | ボス説明文（日本語） | `灼熱の炎を纏う伝説の竜が降臨！` |

#### 設定例

```csv
ENABLE,id,mst_event_id,mst_in_game_id,asset_key,advent_battle_type,time_limit_seconds,initial_battle_point,score_addition_type,score_additional_coef,score_addition_target_mst_enemy_stage_parameter_id,mst_stage_rule_group_id,event_bonus_group_id,challengeable_count,ad_challengeable_count,display_mst_unit_id1,display_mst_unit_id2,display_mst_unit_id3,exp,coin,start_at,end_at,release_key,name.ja,boss_description.ja
TRUE,advent_battle_summer_2025,event_summer_2025,advent_summer_stage,advent_summer_bg,ScoreChallenge,180,3,AllEnemies,1.0,,,advent_summer_bonus,5,3,enemy_boss_dragon,enemy_boss_knight,,100,500,2025-07-01 15:00:00,2025-07-15 14:59:59,,夏の試練！灼熱の竜,灼熱の炎を纏う伝説の竜が降臨！
```

---

### 2. MstAdventBattleI18n（多言語対応テーブル）

降臨バトル名と説明文を多言語で定義します。

#### スキーマ定義

```csv
ENABLE, id, mst_advent_battle_id, language, name, boss_description
```

#### フィールド説明

| フィールド | 型 | 必須 | 説明 | 設定例 |
|-----------|-----|-----|------|--------|
| **ENABLE** | Boolean | ✅ | 有効フラグ | `TRUE` |
| **id** | String | ✅ | レコードID（一意キー） | `advent_battle_summer_2025_ja` |
| **mst_advent_battle_id** | String | ✅ | 降臨バトルID（外部キー） | `advent_battle_summer_2025` |
| **language** | Enum | ✅ | 言語コード | `Ja`, `En`, `ZhCn`, `ZhTw`, `Ko` |
| **name** | String | ✅ | 降臨バトル名 | `夏の試練！灼熱の竜` |
| **boss_description** | String | ✅ | ボス説明文 | `灼熱の炎を纏う伝説の竜が降臨！` |

#### 設定例

```csv
ENABLE,id,mst_advent_battle_id,language,name,boss_description
TRUE,advent_battle_summer_2025_ja,advent_battle_summer_2025,Ja,夏の試練！灼熱の竜,灼熱の炎を纏う伝説の竜が降臨！
TRUE,advent_battle_summer_2025_en,advent_battle_summer_2025,En,Summer Trial! Scorching Dragon,The legendary dragon of blazing flames descends!
```

**注意**: MstAdventBattleの`name.ja`, `boss_description.ja`フィールドとこのテーブルは併用可能です。このテーブルがある場合はこちらが優先されます。

---

### 3. MstAdventBattleRank（スコアランク定義）

プレイヤーの累積スコアに応じて昇格するランク体系を定義します。

#### スキーマ定義

```csv
ENABLE, id, mst_advent_battle_id, rank_type, rank_level, required_lower_score, asset_key, release_key
```

#### フィールド説明

| フィールド | 型 | 必須 | 説明 | 設定例 |
|-----------|-----|-----|------|--------|
| **ENABLE** | Boolean | ✅ | 有効フラグ | `TRUE` |
| **id** | String | ✅ | ランクID（一意キー） | `advent_summer_rank_bronze_1` |
| **mst_advent_battle_id** | String | ✅ | 降臨バトルID（外部キー） | `advent_battle_summer_2025` |
| **rank_type** | Enum | ✅ | ランクタイプ | `Bronze`, `Silver`, `Gold`, `Master` |
| **rank_level** | Integer | ✅ | ランクレベル（1以上） | `1`, `2`, `3`, `4` |
| **required_lower_score** | Integer | ✅ | このランクに到達するための最低累積スコア | `5000` |
| **asset_key** | String |  | ランク表示用のアセットキー | `rank_bronze_1` |
| **release_key** | String |  | リリースキー | （通常は空） |

#### ランク体系の設計ガイドライン

1. **4段階のランク**: Bronze → Silver → Gold → Master
2. **各ランクに複数レベル**: 通常は各ランク3〜5レベル程度
3. **スコアの昇順**: `required_lower_score` は昇順に設定
4. **最初のランク**: Bronze Lv1 の `required_lower_score` は `0` 以上の値

#### 設定例

```csv
ENABLE,id,mst_advent_battle_id,rank_type,rank_level,required_lower_score,asset_key,release_key
TRUE,advent_summer_rank_bronze_1,advent_battle_summer_2025,Bronze,1,5000,rank_bronze_1,
TRUE,advent_summer_rank_bronze_2,advent_battle_summer_2025,Bronze,2,10000,rank_bronze_2,
TRUE,advent_summer_rank_bronze_3,advent_battle_summer_2025,Bronze,3,15000,rank_bronze_3,
TRUE,advent_summer_rank_bronze_4,advent_battle_summer_2025,Bronze,4,20000,rank_bronze_4,
TRUE,advent_summer_rank_silver_1,advent_battle_summer_2025,Silver,1,30000,rank_silver_1,
TRUE,advent_summer_rank_silver_2,advent_battle_summer_2025,Silver,2,50000,rank_silver_2,
TRUE,advent_summer_rank_silver_3,advent_battle_summer_2025,Silver,3,80000,rank_silver_3,
TRUE,advent_summer_rank_silver_4,advent_battle_summer_2025,Silver,4,120000,rank_silver_4,
TRUE,advent_summer_rank_gold_1,advent_battle_summer_2025,Gold,1,200000,rank_gold_1,
TRUE,advent_summer_rank_gold_2,advent_battle_summer_2025,Gold,2,300000,rank_gold_2,
TRUE,advent_summer_rank_gold_3,advent_battle_summer_2025,Gold,3,400000,rank_gold_3,
TRUE,advent_summer_rank_gold_4,advent_battle_summer_2025,Gold,4,500000,rank_gold_4,
TRUE,advent_summer_rank_master_1,advent_battle_summer_2025,Master,1,600000,rank_master_1,
TRUE,advent_summer_rank_master_2,advent_battle_summer_2025,Master,2,700000,rank_master_2,
TRUE,advent_summer_rank_master_3,advent_battle_summer_2025,Master,3,800000,rank_master_3,
TRUE,advent_summer_rank_master_4,advent_battle_summer_2025,Master,4,1000000,rank_master_4,
```

**スコア範囲の例**:
- Bronze Lv1: 5,000 〜 9,999
- Bronze Lv2: 10,000 〜 14,999
- Bronze Lv3: 15,000 〜 19,999
- Bronze Lv4: 20,000 〜 29,999
- Silver Lv1: 30,000 〜 49,999
- ...
- Master Lv4: 1,000,000 以上

---

### 4. MstAdventBattleRewardGroup（報酬グループ定義）

報酬のグループ（条件）を定義します。

#### スキーマ定義

```csv
ENABLE, id, mst_advent_battle_id, reward_category, condition_value, release_key
```

#### フィールド説明

| フィールド | 型 | 必須 | 説明 | 設定例 |
|-----------|-----|-----|------|--------|
| **ENABLE** | Boolean | ✅ | 有効フラグ | `TRUE` |
| **id** | String | ✅ | 報酬グループID（一意キー） | `advent_summer_maxscore_3000` |
| **mst_advent_battle_id** | String | ✅ | 降臨バトルID（外部キー） | `advent_battle_summer_2025` |
| **reward_category** | Enum | ✅ | 報酬カテゴリー | `MaxScore`, `Ranking`, `Rank`, `RaidTotalScore`, `Drop` |
| **condition_value** | Integer |  | 報酬条件値（カテゴリーにより意味が異なる） | `3000` |
| **release_key** | String |  | リリースキー | （通常は空） |

#### 報酬カテゴリーの詳細

| カテゴリー | 説明 | condition_value の意味 | 受取タイミング |
|-----------|------|---------------------|-------------|
| **MaxScore** | ハイスコア報酬 | 必要スコア（例: `3000`） | スコア更新時に自動受取 |
| **Ranking** | ランキング報酬 | 未使用（空） | 開催期間終了後の集計完了時 |
| **Rank** | ランク到達報酬 | 未使用（空） | ランク到達時に自動受取 |
| **RaidTotalScore** | 協力スコア報酬 | 全ユーザー合計スコア（例: `50000`） | スコア到達時に自動受取 |
| **Drop** | ドロップ報酬 | 未使用（空） | バトル終了時に毎回 |

#### 設定例

##### MaxScore報酬グループ（ハイスコア報酬）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,condition_value,release_key
TRUE,advent_summer_maxscore_3000,advent_battle_summer_2025,MaxScore,3000,
TRUE,advent_summer_maxscore_6000,advent_battle_summer_2025,MaxScore,6000,
TRUE,advent_summer_maxscore_12000,advent_battle_summer_2025,MaxScore,12000,
TRUE,advent_summer_maxscore_24000,advent_battle_summer_2025,MaxScore,24000,
TRUE,advent_summer_maxscore_48000,advent_battle_summer_2025,MaxScore,48000,
TRUE,advent_summer_maxscore_100000,advent_battle_summer_2025,MaxScore,100000,
TRUE,advent_summer_maxscore_200000,advent_battle_summer_2025,MaxScore,200000,
TRUE,advent_summer_maxscore_500000,advent_battle_summer_2025,MaxScore,500000,
```

##### Rank報酬グループ（ランク到達報酬）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,condition_value,release_key
TRUE,advent_summer_rank_bronze_1_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_bronze_2_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_bronze_3_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_bronze_4_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_silver_1_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_silver_2_reward,advent_battle_summer_2025,Rank,,
```

**注意**: Rank報酬の場合、報酬グループIDとMstAdventBattleRankのIDを紐付ける必要があります（命名規則で対応）。

##### RaidTotalScore報酬グループ（協力スコア報酬、Raidのみ）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,condition_value,release_key
TRUE,advent_summer_raid_50000,advent_battle_summer_2025,RaidTotalScore,50000,
TRUE,advent_summer_raid_100000,advent_battle_summer_2025,RaidTotalScore,100000,
TRUE,advent_summer_raid_150000,advent_battle_summer_2025,RaidTotalScore,150000,
TRUE,advent_summer_raid_200000,advent_battle_summer_2025,RaidTotalScore,200000,
```

##### Drop報酬グループ（ドロップ報酬）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,condition_value,release_key
TRUE,advent_summer_drop,advent_battle_summer_2025,Drop,,
```

---

### 5. MstAdventBattleReward（報酬内容詳細）

MstAdventBattleRewardGroup で定義した報酬グループに含まれる具体的な報酬を定義します。

#### スキーマ定義

```csv
ENABLE, id, mst_advent_battle_reward_group_id, resource_type, resource_id, resource_amount, release_key
```

#### フィールド説明

| フィールド | 型 | 必須 | 説明 | 設定例 |
|-----------|-----|-----|------|--------|
| **ENABLE** | Boolean | ✅ | 有効フラグ | `TRUE` |
| **id** | String | ✅ | 報酬ID（一意キー） | `advent_summer_maxscore_3000_reward_1` |
| **mst_advent_battle_reward_group_id** | String | ✅ | 報酬グループID（外部キー） | `advent_summer_maxscore_3000` |
| **resource_type** | Enum | ✅ | 資源タイプ | `Coin`, `FreeDiamond`, `Item`, `Emblem`, `Unit` |
| **resource_id** | String |  | 資源ID（`resource_type`が`Item`, `Emblem`, `Unit`の場合は必須） | `item_summon_ticket` |
| **resource_amount** | Integer | ✅ | 資源の数量 | `10` |
| **release_key** | String |  | リリースキー | （通常は空） |

#### 資源タイプの詳細

| resource_type | 説明 | resource_id の指定 |
|--------------|------|------------------|
| **Coin** | コイン | 不要（空） |
| **FreeDiamond** | 無料ダイヤ | 不要（空） |
| **Item** | アイテム | アイテムID（例: `item_summon_ticket`） |
| **Emblem** | エンブレム | エンブレムID（例: `emblem_advent_summer`） |
| **Unit** | ユニット（キャラ） | ユニットID（例: `unit_dragon`） |

#### 設定例

##### MaxScore報酬の例（ハイスコア3,000達成報酬）

```csv
ENABLE,id,mst_advent_battle_reward_group_id,resource_type,resource_id,resource_amount,release_key
TRUE,advent_summer_maxscore_3000_reward_1,advent_summer_maxscore_3000,Coin,,5000,
TRUE,advent_summer_maxscore_3000_reward_2,advent_summer_maxscore_3000,Item,item_summon_ticket,1,
```

→ 「コイン5,000 + 召喚チケット1枚」

##### MaxScore報酬の例（ハイスコア100,000達成報酬）

```csv
ENABLE,id,mst_advent_battle_reward_group_id,resource_type,resource_id,resource_amount,release_key
TRUE,advent_summer_maxscore_100000_reward_1,advent_summer_maxscore_100000,FreeDiamond,,100,
TRUE,advent_summer_maxscore_100000_reward_2,advent_summer_maxscore_100000,Item,item_summon_ticket,5,
TRUE,advent_summer_maxscore_100000_reward_3,advent_summer_maxscore_100000,Emblem,emblem_advent_summer_gold,1,
```

→ 「無料ダイヤ100 + 召喚チケット5枚 + エンブレム1個」

##### Rank報酬の例（Bronze Lv1到達報酬）

```csv
ENABLE,id,mst_advent_battle_reward_group_id,resource_type,resource_id,resource_amount,release_key
TRUE,advent_summer_rank_bronze_1_reward_1,advent_summer_rank_bronze_1_reward,Coin,,1000,
TRUE,advent_summer_rank_bronze_1_reward_2,advent_summer_rank_bronze_1_reward,Item,item_exp_potion_small,3,
```

→ 「コイン1,000 + 経験値ポーション（小）3個」

##### RaidTotalScore報酬の例（全ユーザー合計50,000達成報酬）

```csv
ENABLE,id,mst_advent_battle_reward_group_id,resource_type,resource_id,resource_amount,release_key
TRUE,advent_summer_raid_50000_reward_1,advent_summer_raid_50000,FreeDiamond,,50,
TRUE,advent_summer_raid_50000_reward_2,advent_summer_raid_50000,Item,item_summon_ticket,1,
```

→ 「無料ダイヤ50 + 召喚チケット1枚」

##### Drop報酬の例（バトル終了時のドロップ報酬）

```csv
ENABLE,id,mst_advent_battle_reward_group_id,resource_type,resource_id,resource_amount,release_key
TRUE,advent_summer_drop_reward_1,advent_summer_drop,Coin,,500,
TRUE,advent_summer_drop_reward_2,advent_summer_drop,Item,item_exp_potion_small,1,
```

→ 「コイン500 + 経験値ポーション（小）1個」を毎回ドロップ

---

### 6. MstAdventBattleClearReward（クリア報酬）

バトルクリア時に獲得できる報酬を定義します。ランダムドロップ報酬も設定可能です。

#### スキーマ定義

```csv
ENABLE, id, mst_advent_battle_id, reward_category, resource_type, resource_id, resource_amount, percentage, sort_order, release_key
```

#### フィールド説明

| フィールド | 型 | 必須 | 説明 | 設定例 |
|-----------|-----|-----|------|--------|
| **ENABLE** | Boolean | ✅ | 有効フラグ | `TRUE` |
| **id** | String | ✅ | クリア報酬ID（一意キー） | `advent_summer_clear_always_1` |
| **mst_advent_battle_id** | String | ✅ | 降臨バトルID（外部キー） | `advent_battle_summer_2025` |
| **reward_category** | Enum | ✅ | 報酬カテゴリー | `Always`, `FirstClear`, `Random` |
| **resource_type** | Enum | ✅ | 資源タイプ | `Coin`, `FreeDiamond`, `Item`, `Emblem`, `Unit` |
| **resource_id** | String |  | 資源ID（`resource_type`が`Item`, `Emblem`, `Unit`の場合は必須） | `item_exp_potion_small` |
| **resource_amount** | Integer | ✅ | 資源の数量 | `1` |
| **percentage** | Integer |  | ドロップ確率（%）（`Random`の場合のみ使用） | `30` |
| **sort_order** | Integer | ✅ | 表示順序 | `1`, `2`, `3` |
| **release_key** | String |  | リリースキー | （通常は空） |

#### 報酬カテゴリーの詳細

| カテゴリー | 説明 | percentage の使用 |
|-----------|------|--------------------|
| **Always** | 毎回必ず獲得できる報酬 | 不要（空） |
| **FirstClear** | 初回クリア時のみ獲得できる報酬 | 不要（空） |
| **Random** | ランダムでドロップする報酬 | ✅ 必須（例: `30` = 30%の確率） |

#### 設定例

##### Always報酬（毎回獲得）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,resource_type,resource_id,resource_amount,percentage,sort_order,release_key
TRUE,advent_summer_clear_always_1,advent_battle_summer_2025,Always,Coin,,500,,1,
TRUE,advent_summer_clear_always_2,advent_battle_summer_2025,Always,Item,item_exp_potion_small,1,,2,
```

##### FirstClear報酬（初回クリアのみ）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,resource_type,resource_id,resource_amount,percentage,sort_order,release_key
TRUE,advent_summer_clear_first_1,advent_battle_summer_2025,FirstClear,FreeDiamond,,50,,1,
TRUE,advent_summer_clear_first_2,advent_battle_summer_2025,FirstClear,Item,item_summon_ticket,1,,2,
```

##### Random報酬（ランダムドロップ）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,resource_type,resource_id,resource_amount,percentage,sort_order,release_key
TRUE,advent_summer_clear_random_1,advent_battle_summer_2025,Random,Item,item_rare_material_1,1,30,1,
TRUE,advent_summer_clear_random_2,advent_battle_summer_2025,Random,Item,item_rare_material_2,1,20,2,
TRUE,advent_summer_clear_random_3,advent_battle_summer_2025,Random,Item,item_rare_material_3,1,10,3,
```

→ レアマテリアル1: 30%、レアマテリアル2: 20%、レアマテリアル3: 10%の確率でドロップ

---

## 設定例

ここでは、実際の降臨バトルを想定した完全な設定例を示します。

### 設定内容

- **降臨バトル名**: 夏の試練！灼熱の竜
- **ID**: `advent_battle_summer_2025`
- **バトルタイプ**: ScoreChallenge
- **開催期間**: 2025年7月1日 15:00 〜 7月15日 14:59
- **挑戦可能回数**: 通常5回/日、広告3回/日
- **バトル時間制限**: 180秒（3分）
- **ランク体系**: Bronze〜Master各4レベル（合計16ランク）
- **報酬体系**:
  - ハイスコア報酬: 8段階（3,000点〜500,000点）
  - ランク到達報酬: 全16ランク
  - ドロップ報酬: 毎回コイン500
  - クリア報酬: 初回クリアで無料ダイヤ50

### MstAdventBattle.csv

```csv
ENABLE,id,mst_event_id,mst_in_game_id,asset_key,advent_battle_type,time_limit_seconds,initial_battle_point,score_addition_type,score_additional_coef,score_addition_target_mst_enemy_stage_parameter_id,mst_stage_rule_group_id,event_bonus_group_id,challengeable_count,ad_challengeable_count,display_mst_unit_id1,display_mst_unit_id2,display_mst_unit_id3,exp,coin,start_at,end_at,release_key,name.ja,boss_description.ja
TRUE,advent_battle_summer_2025,event_summer_2025,advent_summer_stage,advent_summer_bg,ScoreChallenge,180,3,AllEnemies,1.0,,,advent_summer_bonus,5,3,enemy_boss_dragon,enemy_boss_knight,,100,500,2025-07-01 15:00:00,2025-07-15 14:59:59,,夏の試練！灼熱の竜,灼熱の炎を纏う伝説の竜が降臨！
```

### MstAdventBattleRank.csv（一部抜粋）

```csv
ENABLE,id,mst_advent_battle_id,rank_type,rank_level,required_lower_score,asset_key,release_key
TRUE,advent_summer_rank_bronze_1,advent_battle_summer_2025,Bronze,1,5000,rank_bronze_1,
TRUE,advent_summer_rank_bronze_2,advent_battle_summer_2025,Bronze,2,10000,rank_bronze_2,
TRUE,advent_summer_rank_bronze_3,advent_battle_summer_2025,Bronze,3,15000,rank_bronze_3,
TRUE,advent_summer_rank_bronze_4,advent_battle_summer_2025,Bronze,4,20000,rank_bronze_4,
TRUE,advent_summer_rank_silver_1,advent_battle_summer_2025,Silver,1,30000,rank_silver_1,
TRUE,advent_summer_rank_silver_2,advent_battle_summer_2025,Silver,2,50000,rank_silver_2,
TRUE,advent_summer_rank_silver_3,advent_battle_summer_2025,Silver,3,80000,rank_silver_3,
TRUE,advent_summer_rank_silver_4,advent_battle_summer_2025,Silver,4,120000,rank_silver_4,
TRUE,advent_summer_rank_gold_1,advent_battle_summer_2025,Gold,1,200000,rank_gold_1,
TRUE,advent_summer_rank_gold_2,advent_battle_summer_2025,Gold,2,300000,rank_gold_2,
TRUE,advent_summer_rank_gold_3,advent_battle_summer_2025,Gold,3,400000,rank_gold_3,
TRUE,advent_summer_rank_gold_4,advent_battle_summer_2025,Gold,4,500000,rank_gold_4,
TRUE,advent_summer_rank_master_1,advent_battle_summer_2025,Master,1,600000,rank_master_1,
TRUE,advent_summer_rank_master_2,advent_battle_summer_2025,Master,2,700000,rank_master_2,
TRUE,advent_summer_rank_master_3,advent_battle_summer_2025,Master,3,800000,rank_master_3,
TRUE,advent_summer_rank_master_4,advent_battle_summer_2025,Master,4,1000000,rank_master_4,
```

### MstAdventBattleRewardGroup.csv（一部抜粋）

```csv
ENABLE,id,mst_advent_battle_id,reward_category,condition_value,release_key
TRUE,advent_summer_maxscore_3000,advent_battle_summer_2025,MaxScore,3000,
TRUE,advent_summer_maxscore_6000,advent_battle_summer_2025,MaxScore,6000,
TRUE,advent_summer_maxscore_12000,advent_battle_summer_2025,MaxScore,12000,
TRUE,advent_summer_maxscore_24000,advent_battle_summer_2025,MaxScore,24000,
TRUE,advent_summer_maxscore_48000,advent_battle_summer_2025,MaxScore,48000,
TRUE,advent_summer_maxscore_100000,advent_battle_summer_2025,MaxScore,100000,
TRUE,advent_summer_maxscore_200000,advent_battle_summer_2025,MaxScore,200000,
TRUE,advent_summer_maxscore_500000,advent_battle_summer_2025,MaxScore,500000,
TRUE,advent_summer_rank_bronze_1_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_bronze_2_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_bronze_3_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_rank_bronze_4_reward,advent_battle_summer_2025,Rank,,
TRUE,advent_summer_drop,advent_battle_summer_2025,Drop,,
```

### MstAdventBattleReward.csv（一部抜粋）

```csv
ENABLE,id,mst_advent_battle_reward_group_id,resource_type,resource_id,resource_amount,release_key
TRUE,advent_summer_maxscore_3000_reward_1,advent_summer_maxscore_3000,Coin,,5000,
TRUE,advent_summer_maxscore_3000_reward_2,advent_summer_maxscore_3000,Item,item_summon_ticket,1,
TRUE,advent_summer_maxscore_6000_reward_1,advent_summer_maxscore_6000,Coin,,10000,
TRUE,advent_summer_maxscore_6000_reward_2,advent_summer_maxscore_6000,Item,item_summon_ticket,2,
TRUE,advent_summer_maxscore_12000_reward_1,advent_summer_maxscore_12000,FreeDiamond,,30,
TRUE,advent_summer_maxscore_12000_reward_2,advent_summer_maxscore_12000,Item,item_summon_ticket,3,
TRUE,advent_summer_rank_bronze_1_reward_1,advent_summer_rank_bronze_1_reward,Coin,,1000,
TRUE,advent_summer_rank_bronze_1_reward_2,advent_summer_rank_bronze_1_reward,Item,item_exp_potion_small,3,
TRUE,advent_summer_rank_bronze_2_reward_1,advent_summer_rank_bronze_2_reward,Coin,,2000,
TRUE,advent_summer_rank_bronze_2_reward_2,advent_summer_rank_bronze_2_reward,Item,item_exp_potion_small,5,
TRUE,advent_summer_drop_reward_1,advent_summer_drop,Coin,,500,
```

### MstAdventBattleClearReward.csv

```csv
ENABLE,id,mst_advent_battle_id,reward_category,resource_type,resource_id,resource_amount,percentage,sort_order,release_key
TRUE,advent_summer_clear_always_1,advent_battle_summer_2025,Always,Coin,,500,,1,
TRUE,advent_summer_clear_first_1,advent_battle_summer_2025,FirstClear,FreeDiamond,,50,,1,
TRUE,advent_summer_clear_first_2,advent_battle_summer_2025,FirstClear,Item,item_summon_ticket,1,,2,
TRUE,advent_summer_clear_random_1,advent_battle_summer_2025,Random,Item,item_rare_material_1,1,30,1,
TRUE,advent_summer_clear_random_2,advent_battle_summer_2025,Random,Item,item_rare_material_2,1,20,2,
```

---

## 注意事項とチェックポイント

### 必須確認事項

#### 1. ID の一意性

- [ ] すべてのテーブルで `id` フィールドは一意であること
- [ ] 降臨バトルIDは他のイベントと重複しないこと

#### 2. 外部キーの整合性

- [ ] `mst_advent_battle_id` が MstAdventBattle の `id` と一致すること
- [ ] `mst_advent_battle_reward_group_id` が MstAdventBattleRewardGroup の `id` と一致すること
- [ ] `mst_event_id`, `mst_in_game_id` など外部参照するIDが存在すること

#### 3. 開催期間の設定

- [ ] `start_at` < `end_at` であること
- [ ] 日時フォーマットは `YYYY-MM-DD HH:MM:SS` （JSTタイムゾーン）
- [ ] 他のイベントと期間が重複していないか確認

#### 4. ランク設定の確認

- [ ] `required_lower_score` が昇順になっていること
- [ ] Bronze Lv1 から Master 最上位レベルまで連続していること
- [ ] 各ランクタイプ（Bronze, Silver, Gold, Master）が少なくとも1レベル以上あること

#### 5. 報酬設定の確認

- [ ] MaxScore報酬の `condition_value` が昇順になっていること
- [ ] RaidTotalScore報酬の `condition_value` が昇順になっていること
- [ ] Rank報酬グループIDとMstAdventBattleRankのIDが紐づいていること
- [ ] すべての報酬グループに少なくとも1つの報酬が設定されていること

#### 6. 資源IDの存在確認

- [ ] `resource_type` が `Item` の場合、`resource_id` がMstItemに存在すること
- [ ] `resource_type` が `Emblem` の場合、`resource_id` がMstEmblemに存在すること
- [ ] `resource_type` が `Unit` の場合、`resource_id` がMstUnitに存在すること

#### 7. ドロップ確率の確認

- [ ] Random報酬の `percentage` が 0 < percentage ≤ 100 であること
- [ ] percentage の合計が100%を超えても良い（複数同時ドロップ可能）

#### 8. バトル設定の妥当性

- [ ] `time_limit_seconds` が適切な値であること（推奨: 60〜300秒）
- [ ] `challengeable_count` が適切な値であること（推奨: 3〜10回）
- [ ] `ad_challengeable_count` が適切な値であること（推奨: 1〜5回）

### バランス調整のポイント

#### スコア設計

- **ハイスコア報酬の段階**: 通常8〜12段階程度
- **最高ハイスコア報酬**: 上位10%程度のプレイヤーが達成できる難易度
- **最低ハイスコア報酬**: 初心者でも達成できる難易度

#### ランク設計

- **Bronze**: 初心者でも到達可能（累積スコア5,000〜20,000程度）
- **Silver**: 中級者向け（累積スコア30,000〜120,000程度）
- **Gold**: 上級者向け（累積スコア200,000〜500,000程度）
- **Master**: 最上位プレイヤー向け（累積スコア600,000以上）

#### 報酬バランス

- **ランク報酬**: 達成感を得られる魅力的な報酬（エンブレム、レアアイテムなど）
- **ハイスコア報酬**: 段階的に豪華になる（召喚チケット、ダイヤなど）
- **ドロップ報酬**: 毎回のモチベーション（コイン、経験値ポーション）
- **初回クリア報酬**: 初めての挑戦を促す報酬（ダイヤ、召喚チケット）

### トラブルシューティング

#### 降臨バトルが表示されない

- `start_at` と `end_at` の期間が現在時刻を含んでいるか確認
- `ENABLE` フラグが `TRUE` になっているか確認
- `mst_event_id` が有効なイベントIDか確認

#### スコアが正しく計算されない

- `score_addition_type` の設定を確認
- `score_additional_coef` が適切な値か確認
- インゲーム側のバトルログが正しく送信されているか確認

#### 報酬が受け取れない

- 報酬グループIDが正しく設定されているか確認
- 報酬の `resource_id` が存在するか確認
- `reward_category` と `condition_value` が正しいか確認

#### ランクが昇格しない

- `required_lower_score` の値が昇順になっているか確認
- プレイヤーの累積スコア（TotalScore）が条件を満たしているか確認

---

## まとめ

降臨バトルのマスタデータ設定には、6つのCSVテーブルを正しく設定する必要があります。

1. **MstAdventBattle**: 基本情報を設定
2. **MstAdventBattleI18n**: 多言語テキストを設定
3. **MstAdventBattleRank**: ランク体系を設計
4. **MstAdventBattleRewardGroup**: 報酬グループを定義
5. **MstAdventBattleReward**: 具体的な報酬内容を設定
6. **MstAdventBattleClearReward**: クリア報酬を設定

設定時は、ID の一意性、外部キーの整合性、スコア・報酬の昇順設定、資源IDの存在確認を必ず行ってください。

バランス調整では、初心者から上級者まで楽しめるスコア設計とランク体系、魅力的な報酬設定を心がけましょう。

---

**参考実装パス**:
- マスターデータ: `glow-masterdata/MstAdventBattle*.csv`
- スキーマ定義: `glow-masterdata/sheet_schema/MstAdventBattle*.csv`
- サーバー実装: `glow-server/api/app/Domain/AdventBattle/`
- クライアント実装: `glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated/`
