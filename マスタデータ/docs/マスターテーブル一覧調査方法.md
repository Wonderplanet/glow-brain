# glow-clientで使用されているマスターテーブル一覧の調査方法

## 概要

glow-clientで実際に使用されているマスターテーブルを調査する方法をまとめたドキュメントです。

---

## 📊 調査結果サマリー

- **全マスターデータクラス数**: 143個
- **アクティブなテーブル（Repository定義あり）**: 64個
- **I18nテーブル**: 多数（国際化対応）

---

## 🔍 調査方法

### 方法1: 自動生成されたマスターデータクラスから全テーブルを取得

#### コマンド
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated \
  -name "Mst*.cs" -type f \
  -exec basename {} .cs \; | sed 's/Data$//' | sort
```

#### 説明
- `AutoGenerated` ディレクトリ内の全ての `Mst*.cs` ファイルを検索
- ファイル名から `.cs` と末尾の `Data` を削除してテーブル名を抽出
- 結果をソートして一覧化

#### 結果
143個のマスターテーブルが見つかります（例: `MstAbility`, `MstInGameGimmickObject`, `MstQuest` など）

#### 結果のカウント
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated \
  -name "Mst*.cs" -type f | wc -l
```

---

### 方法2: Repositoryインターフェースからアクティブなテーブルを特定

#### コマンド
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Definitions/Repositories/MasterData \
  -name "IMst*.cs" -type f \
  -exec basename {} .cs \; | sed 's/^IMst//' | sed 's/Repository$//' | sed 's/DataRepository$//' | sort
```

#### 説明
- Repository定義ディレクトリ内の `IMst*.cs` ファイルを検索
- ファイル名から `IMst`, `Repository`, `DataRepository` を削除
- 実際にコードで使用されているテーブルのみが抽出される

#### 結果
64個のアクティブなマスターテーブルが見つかります

#### 使用例の確認
特定のRepositoryがどこで使われているかを調査：
```bash
# 例: InGameGimmickObjectRepositoryの使用箇所を検索
grep -r "IMstInGameGimmickObjectDataRepository" \
  projects/glow-client/Assets/GLOW/Scripts/
```

---

### 方法3: Translatorからデータ変換が実装されているテーブルを特定

#### コマンド
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Translators \
  -name "*Translator.cs" -type f \
  -exec basename {} Translator.cs \;
```

#### 説明
- `Translators` ディレクトリ内の全ての `*Translator.cs` ファイルを検索
- `MstXxxData` → `MstXxxModel` への変換が実装されているテーブルを特定
- 実際にドメインモデルとして使われているテーブルがわかる

---

### 方法4: ドメインモデルから逆引き

#### コマンド
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Models/MasterData \
  -name "Mst*.cs" -type f \
  -exec basename {} Model.cs \;
```

#### 説明
- ドメインモデルディレクトリから `Mst*Model.cs` ファイルを検索
- ドメイン層で実際に使用されているマスターデータを特定

---

## 📋 主要なマスターテーブル一覧（カテゴリ別）

### バトル・インゲーム系
- `MstInGame` - インゲーム基本設定
- `MstInGameGimmickObject` - ギミックオブジェクト
- `MstInGameSpecialRule` - 特殊ルール
- `MstAutoPlayerSequence` - 敵AIシーケンス
- `MstPage` - フィールド構成
- `MstDefenseTarget` - 防衛目標
- `MstEnemyOutpost` - 敵陣地

### クエスト・ステージ系
- `MstQuest` - クエスト
- `MstStage` - ステージ
- `MstStageReward` - ステージ報酬
- `MstStageEndCondition` - ステージ終了条件
- `MstStageEventSetting` - ステージイベント設定
- `MstAdventBattle` - 降臨バトル

### ユニット・キャラクター系
- `MstUnit` - ユニット基本情報
- `MstUnitLevelUp` - レベルアップ
- `MstUnitRankUp` - ランクアップ
- `MstUnitGradeUp` - グレードアップ
- `MstUnitAbility` - アビリティ
- `MstEnemyCharacter` - 敵キャラクター
- `MstEnemyStageParameter` - 敵ステージパラメータ

### アビリティ・攻撃系
- `MstAbility` - アビリティ定義
- `MstAttack` - 攻撃定義
- `MstAttackHitEffect` - 攻撃ヒットエフェクト

### アイテム・報酬系
- `MstItem` - アイテム
- `MstItemTransition` - アイテム変換
- `MstItemRarityTrade` - レアリティ交換
- `MstExchange` - 交換ショップ
- `MstFragmentBox` - フラグメントボックス

### ミッション系
- `MstMissionDaily` - デイリーミッション
- `MstMissionWeekly` - ウィークリーミッション
- `MstMissionAchievement` - アチーブメント
- `MstMissionEvent` - イベントミッション
- `MstMissionBeginner` - 初心者ミッション
- `MstMissionReward` - ミッション報酬

### イベント系
- `MstEvent` - イベント
- `MstEventBonusUnit` - イベントボーナスユニット
- `MstEventDisplayReward` - イベント表示報酬

### PvP系
- `MstPvp` - PvP設定
- `MstPvpRank` - PvPランク
- `MstPvpReward` - PvP報酬

### 拠点強化系
- `MstOutpost` - 拠点
- `MstOutpostEnhancement` - 拠点強化
- `MstOutpostEnhancementLevel` - 拠点強化レベル

### ショップ・課金系
- `MstShopItem` - ショップアイテム
- `MstShopPass` - パス商品
- `MstPack` - パック商品
- `MstStoreProduct` - ストア商品

### UI・演出系
- `MstHomeBanner` - ホームバナー
- `MstMangaAnimation` - マンガアニメーション
- `MstTutorial` - チュートリアル

### システム系
- `MstConfig` - 設定
- `MstI18n` - 国際化
- `MstUserLevel` - ユーザーレベル
- `MstNgWord` - NGワード

---

## 🎯 特定のテーブルの詳細調査方法

### ステップ1: Dataクラスを確認
```bash
# テーブルのカラム定義を確認
cat projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated/Mst<TableName>Data.cs
```

### ステップ2: Repositoryインターフェースを確認
```bash
# Repositoryメソッドを確認
cat projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Definitions/Repositories/MasterData/IMst<TableName>DataRepository.cs
```

### ステップ3: Translatorを確認
```bash
# Data → Model 変換処理を確認
cat projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Translators/<TableName>DataTranslator.cs
```

### ステップ4: Modelを確認
```bash
# ドメインモデルの構造を確認
cat projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Models/MasterData/Mst<TableName>Model.cs
```

### ステップ5: 使用箇所を検索
```bash
# テーブルが実際に使われている箇所を検索
grep -r "Mst<TableName>" projects/glow-client/Assets/GLOW/Scripts/ --include="*.cs"
```

---

## 🔧 便利なワンライナーコマンド集

### 全マスターテーブルをCSV形式で出力
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated \
  -name "Mst*.cs" -type f \
  -exec basename {} .cs \; | sed 's/Data$//' | awk '{print NR","$0}' > master_tables.csv
```

### I18nテーブルのみ抽出
```bash
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated \
  -name "Mst*I18n*.cs" -type f \
  -exec basename {} .cs \; | sed 's/Data$//'
```

### アクティブなテーブルと全テーブルの差分（未使用テーブル）を確認
```bash
# 全テーブル
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated \
  -name "Mst*.cs" -type f \
  -exec basename {} .cs \; | sed 's/Data$//' | sort > /tmp/all_tables.txt

# アクティブなテーブル
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Domain/Definitions/Repositories/MasterData \
  -name "IMst*.cs" -type f \
  -exec basename {} .cs \; | sed 's/^IMst/Mst/' | sed 's/Repository$//' | sed 's/DataRepository$//' | sort > /tmp/active_tables.txt

# 差分
comm -23 /tmp/all_tables.txt /tmp/active_tables.txt
```

### 特定カテゴリのテーブルを検索
```bash
# 例: Mission系テーブルのみ
find projects/glow-client/Assets/GLOW/Scripts/Runtime/Core/Data/Data/AutoGenerated \
  -name "MstMission*.cs" -type f \
  -exec basename {} .cs \; | sed 's/Data$//'
```

---

## 📝 Claude Codeでの調査プロンプト例

### 全マスターテーブル一覧を取得
```
glow-clientで使用されている全てのマスターテーブルをリストアップしてください。
AutoGeneratedディレクトリ内のMst*.csファイルから抽出してください。
```

### アクティブなテーブルのみ取得
```
glow-clientで実際に使用されている（Repositoryインターフェースが定義されている）
マスターテーブルをリストアップしてください。
```

### 特定カテゴリのテーブルを調査
```
glow-clientで使用されているミッション系のマスターテーブル（MstMission*）を
全てリストアップし、それぞれの用途を簡潔に説明してください。
```

### テーブル間の関連を調査
```
[テーブル名]がどのマスターテーブルと関連しているか、
外部キー的な関係を全て洗い出してください。
```

---

## 🎓 調査のベストプラクティス

### 1. 階層的に調査する
```
1. AutoGenerated (全テーブル)
   ↓
2. Repository (アクティブなテーブル)
   ↓
3. Translator (変換処理あり)
   ↓
4. Model (ドメインで使用)
   ↓
5. 実装箇所（実際の使用例）
```

### 2. 関連テーブルをまとめて調査
- 例: `MstQuest` → `MstStage` → `MstInGame` → `MstAutoPlayerSequence`
- 例: `MstUnit` → `MstUnitLevelUp` → `MstUnitRankUp` → `MstUnitGradeUp`

### 3. I18nテーブルは対応する本体テーブルとセットで見る
- `MstAbility` ⇔ `MstAbilityI18n`
- `MstQuest` ⇔ `MstQuestI18n`

### 4. 命名規則を理解する
- `Mst*Data`: データクラス（自動生成）
- `Mst*Model`: ドメインモデル
- `IMst*Repository`: リポジトリインターフェース
- `*Translator`: Data → Model 変換

---

## 🚀 実践例

### ケース1: 新しいマスターテーブルを追加したい
```bash
# 1. 既存の類似テーブルを探す
grep -r "similar_feature" projects/glow-client/Assets/GLOW/Scripts/

# 2. そのテーブルの実装を参照
# - Data, Model, Repository, Translator の4点セットを確認

# 3. 同じパターンで新しいテーブルを実装
```

### ケース2: 使われていないテーブルを特定したい
```bash
# 差分コマンド（上記参照）を実行して未使用テーブルを洗い出す
comm -23 /tmp/all_tables.txt /tmp/active_tables.txt
```

### ケース3: テーブルのリファクタリング影響範囲を調査
```bash
# 1. テーブル名で全ファイル検索
grep -r "MstTableName" projects/glow-client/ --include="*.cs"

# 2. Repositoryメソッドの呼び出し元を特定
grep -r "GetMstTableNameModel" projects/glow-client/ --include="*.cs"

# 3. 影響範囲をリストアップ
```

---

## 📚 関連ドキュメント

- `マスターデータテーブル調査プロンプト.md` - 詳細調査用のプロンプトテンプレート
- `施策マスタデータ作成ガイド.md` - マスターデータ作成ガイド
- `CLAUDE.md` - プロジェクト全体の概要

---

## 🔄 更新履歴

- 2025-12-29: 初版作成
