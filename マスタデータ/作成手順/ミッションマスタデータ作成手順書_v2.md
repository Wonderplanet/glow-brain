# ミッションマスタデータ作成手順書

## 概要

このドキュメントは、運営仕様書（CSV形式）からミッション関連のマスタデータCSVを作成する手順をまとめたものです。

**対象設計書**: `04_ミッション.csv`（イベント仕様書内）

**作成するマスタデータ**:
- MstMissionEvent.csv - イベントミッション本体
- MstMissionEventI18n.csv - イベントミッション説明文（多言語）
- MstMissionEventDependency.csv - ミッション連鎖アンロック設定
- MstMissionEventDailyBonus.csv - イベントログインボーナス各日
- MstMissionEventDailyBonusSchedule.csv - イベントログインボーナス期間設定
- MstMissionReward.csv - ミッション報酬定義
- MstMissionLimitedTerm.csv - 期間限定ミッション本体
- MstMissionLimitedTermI18n.csv - 期間限定ミッション説明文
- MstMissionAchievement.csv - アチーブメントミッション本体

---

## 前提知識

### 設計書CSVの構造

設計書CSVは以下のようなセクション構造になっています：

```
◆いいジャン祭ミッション
  施策名称、開催期間
  ミッション内容と報酬

◆ぴえヨンミッション
  施策名称、開催期間
  ミッション内容と報酬

降臨バトルミッション
  （HTMLに詳細記載）

◆年始ミッション
  施策名称、開催期間
  ミッション内容と報酬

◆メインクエスト追加の恒常ミッション
  施策名称、開催期間
  ミッション内容と報酬
```

### ミッション種別の判定

設計書のミッションは以下のように分類されます：

| セクション名 | 開催期間 | 作成するテーブル |
|------------|---------|----------------|
| 「◆〜ミッション」で開催期間が有期限 | 期間指定あり | MstMissionEvent + MstMissionEventI18n |
| 「降臨バトルミッション」 | 短期間 | MstMissionLimitedTerm + MstMissionLimitedTermI18n |
| 「恒常ミッション」 | 無期限 | MstMissionAchievement |

### ミッション内容からcriterion_typeへのマッピング

| ミッション内容の文言 | criterion_type | criterion_value | 補足 |
|-------------------|----------------|-----------------|------|
| ステージを〜回クリアしよう | StageClearCount | (空) | 全ステージ合計 |
| 〜ガシャを〜回引こう | SpecificGachaDrawCount | ガシャID | 例: gasho_001 |
| 〜を編成に入れて「〜」を〜回クリア | SpecificUnitStageClearCount | ユニットID.ステージID | 例: chara_osh_00601.event_osh1_1day_00001 |
| 〜を編成に入れて「〜」を〜回挑戦 | SpecificUnitStageChallengeCount | ユニットID.ステージID | クリア不要 |
| クエスト「〜」をクリアしよう | SpecificQuestClear | クエストID | 例: quest_event_osh1_charaget01 |
| デイリークエスト「〜」を〜回クリア | SpecificStageClearCount | ステージID | 例: event_glo1_1day_00001 |
| 降臨バトル「〜」に〜回挑戦 | AdventBattleChallengeCount | (空) | 期間限定ミッション用 |

### criterion_type詳細リファレンス

**サーバー実装情報の参照先**:
- `projects/glow-server/api/app/Domain/Mission/Enums/MissionCriterionType.php` - criterion_typeのEnum定義
- `projects/glow-server/api/app/Domain/Mission/Entities/Criteria/` - 各criterion_typeの実装クラス（PHPDocに詳細説明あり）
- `projects/glow-server/admin/app/Constants/MissionCriterionType.php` - 日本語での説明あり

#### よく使用するcriterion_type

| criterion_type | 日本語説明 | criterion_value | criterion_count | 実装クラス |
|---------------|-----------|-----------------|----------------|----------|
| **StageClearCount** | 通算ステージクリア回数がY回に到達 | null（空） | Y回 | StageClearCountCriterion |
| **SpecificStageClearCount** | 指定ステージXをY回クリア | `mst_stages.id` | Y回 | SpecificStageClearCountCriterion |
| **SpecificStageChallengeCount** | 指定ステージXにY回挑戦する | `mst_stages.id` | Y回 | SpecificStageChallengeCountCriterion |
| **SpecificQuestClear** | 指定クエストXをクリアする | `mst_quests.id` | 1（固定） | SpecificQuestClearCriterion |
| **QuestClearCount** | 通算クエストクリア回数がY回に到達 | null（空） | Y回 | QuestClearCountCriterion |
| **SpecificUnitStageClearCount** | 指定したユニットを編成して指定したステージをY回クリア | `<mst_units.id>.<mst_stages.id>` | Y回 | SpecificUnitStageClearCountCriterion |
| **SpecificUnitStageChallengeCount** | 指定したユニットを編成して指定したステージにY回挑戦 | `<mst_units.id>.<mst_stages.id>` | Y回 | SpecificUnitStageChallengeCountCriterion |
| **SpecificGachaDrawCount** | 指定ガシャXをY回引く | `opr_gachas.id` | Y回 | SpecificGachaDrawCountCriterion |
| **GachaDrawCount** | 通算でガチャをY回引く | null（空） | Y回 | GachaDrawCountCriterion |
| **AdventBattleChallengeCount** | 降臨バトルをX回挑戦する | null（空） | X回 | AdventBattleChallengeCountCriterion |
| **LoginCount** | 通算ログインがY日に到達 | null（空） | Y日 | LoginCountCriterion |
| **LoginContinueCount** | 連続ログインがY日目に到達 | null（空） | Y日 | LoginContinueCountCriterion |
| **UserLevel** | 全ユニットの内でいずれかがLv.Yに到達 | null（空） | Lv.Y | UserLevelCriterion |
| **SpecificUnitLevel** | 指定ユニットがLv.Yに到達 | `mst_units.id` | Lv.Y | SpecificUnitLevelCriterion |
| **SpecificUnitRankUpCount** | 指定したユニットのランクアップ回数がY回以上 | `mst_units.id` | Y回 | SpecificUnitRankUpCountCriterion |
| **SpecificUnitGradeUpCount** | 指定したユニットのグレードアップ回数がY回以上 | `mst_units.id` | Y回 | SpecificUnitGradeUpCountCriterion |
| **UnitAcquiredCount** | ユニットをY体入手しよう | null（空） | Y体 | UnitAcquiredCountCriterion |
| **SpecificUnitAcquiredCount** | 指定ユニットを入手 | `mst_units.id` | 1（固定） | SpecificUnitAcquiredCountCriterion |
| **SpecificItemCollect** | 指定アイテムをX個集める | `mst_items.id` | X個 | SpecificItemCollectCriterion |
| **CoinCollect** | コインをX枚集める | null（空） | X枚 | CoinCollectCriterion |
| **CoinUsedCount** | コインをX枚使用した | null（空） | X枚 | CoinUsedCountCriterion |
| **OutpostEnhanceCount** | ゲートをX回以上強化 | null（空） | X回 | OutpostEnhanceCountCriterion |
| **SpecificOutpostEnhanceLevel** | 指定したゲート強化項目がLvYに到達する | ゲート項目ID | Lv.Y | SpecificOutpostEnhanceLevelCriterion |
| **EmblemAcquiredCount** | エンブレムをY個入手 | null（空） | Y個 | EmblemAcquiredCountCriterion |
| **SpecificEmblemAcquiredCount** | 指定エンブレムを入手 | `mst_emblems.id` | 1（固定） | SpecificEmblemAcquiredCountCriterion |
| **ArtworkCompletedCount** | アートワークをY個コンプリート | null（空） | Y個 | ArtworkCompletedCountCriterion |
| **SpecificArtworkCompletedCount** | 指定アートワークをコンプリート | `mst_artworks.id` | 1（固定） | SpecificArtworkCompletedCountCriterion |
| **ReviewCompleted** | ストアレビューを記載 | null（空） | 1（固定） | ReviewCompletedCriterion |
| **FollowCompleted** | 公式X（エックス）をフォローする | null（空） | 1（固定） | FollowCompletedCriterion |
| **AccountCompleted** | アカウント連携を行う | null（空） | 1（固定） | AccountCompletedCriterion |
| **IaaCount** | 広告視聴をY回する | null（空） | Y回 | IaaCountCriterion |
| **AccessWeb** | Webアクセスでミッションクリア | URL等 | 1（固定） | AccessWebCriterion |

**criterion_valueの形式に関する注意**:
- `null（空）`: CSV上では空欄、またはDBスキーマによっては`__NULL__`と記載
- `<A>.<B>`: 2つのIDをドット（`.`）で連結した文字列（例: `chara_osh_00601.event_osh1_1day_00001`）
- テーブル参照: 参照先テーブルの`id`カラムの値を使用

---

## 作成手順

### 手順0: 設計書の読み込みと理解

#### 0-1. 設計書CSVを開く

`04_ミッション.csv`を開き、以下を確認します：

- [ ] ミッションセクションの数（◆マークで始まる見出し）
- [ ] 各セクションの施策名称と開催期間
- [ ] ミッション内容と報酬の列構成

#### 0-2. イベントIDの確認

設計書にはイベントIDが明記されていない場合があります。
以下の情報から特定します：

1. **イベント仕様書の他のセクション**（01_概要.html等）でイベントIDを確認
2. **MstEvent.csv**を参照し、該当するイベントのIDを特定

例: `event_osh_00001`, `event_glo_00001`

#### 0-3. リリースキーの確認

リリースキーは全テーブルで統一して使用します。
通常は `202512020` のような形式です。

---

### 手順1: イベントログインボーナスの作成

イベントログインボーナスは設計書に明示されていない場合がありますが、イベント施策に含まれることが一般的です。HTMLの設計書を確認して、ログインボーナスの有無を判断します。

#### 1-1. MstMissionEventDailyBonusSchedule.csv の作成

**役割**: イベントログインボーナスの期間設定

**CSV形式**:
```csv
ENABLE,id,release_key,mst_event_id,start_at,end_at
e,event_osh_00001_daily_bonus,202512020,event_osh_00001,"2026-01-01 00:00:00","2026-01-16 03:59:59"
```

**作成ルール**:
1. `id`は`{イベントID}_daily_bonus`の形式
2. `mst_event_id`はイベントIDを指定
3. `start_at`, `end_at`は設計書の開催期間から決定（ダブルクォートで囲む）

#### 1-2. MstMissionEventDailyBonus.csv の作成

**役割**: イベントログインボーナス各日の報酬設定

**CSV形式**:
```csv
ENABLE,id,release_key,mst_mission_event_daily_bonus_schedule_id,login_day_count,mst_mission_reward_group_id,sort_order,備考
e,event_osh_00001_daily_bonus_01,202512020,event_osh_00001_daily_bonus,1,event_osh_00001_daily_bonus_01,1,【推しの子】SSR確定ガシャ
e,event_osh_00001_daily_bonus_02,202512020,event_osh_00001_daily_bonus,2,event_osh_00001_daily_bonus_02,1,プリズム
```

**作成ルール**:
1. `id`は`{スケジュールID}_{日数ゼロ埋め2桁}`の形式
2. `mst_mission_event_daily_bonus_schedule_id`は手順1-1で作成したID
3. `login_day_count`は1から開始（連番）
4. `mst_mission_reward_group_id`は報酬グループID（後で作成）
5. `備考`列に報酬内容を記載（管理用）

#### 1-3. ログボ報酬の MstMissionReward.csv への追加

**CSV形式**:
```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_441,202512020,event_osh_00001_daily_bonus_01,Item,ticket_osh_10000,1,1,【推しの子】SSR確定ガシャ
e,mission_reward_442,202512020,event_osh_00001_daily_bonus_02,FreeDiamond,,150,1,プリズム
```

**resource_typeの種類**:
- `FreeDiamond`: 無償プリズム（resource_idは空）
- `Coin`: コイン（resource_idは空）
- `Item`: アイテム（resource_idにアイテムIDを指定）
- `Emblem`: エンブレム（resource_idにエンブレムIDを指定）

---

### 手順2: イベントミッションの作成

設計書の「◆〜ミッション」セクション（開催期間が有期限）を処理します。

#### 2-1. ミッション内容の分類

各ミッション行を以下のように分類します：

1. **連鎖ミッション**: 同じ条件で回数が増えていくもの
   - 例: 「ステージを5回」「ステージを10回」「ステージを15回」...
   - → MstMissionEventDependencyで連鎖設定が必要

2. **単独ミッション**: 他のミッションと連鎖しないもの
   - → MstMissionEventDependencyは不要

#### 2-2. MstMissionEvent.csv の作成

**役割**: イベントミッション本体の設定

**CSV形式**:
```csv
ENABLE,id,release_key,mst_event_id,criterion_type,criterion_value,criterion_count,unlock_criterion_type,unlock_criterion_value,unlock_criterion_count,group_key,mst_mission_reward_group_id,sort_order,destination_scene
e,event_osh_00001_1,202512020,event_osh_00001,StageClearCount,,5,__NULL__,,0,,osh_00001_event_reward_1,1,Event
e,event_osh_00001_28,202512020,event_osh_00001,SpecificGachaDrawCount,gasho_001,10,__NULL__,,0,,osh_00001_event_reward_28,28,Gacha
e,event_osh_00001_33,202512020,event_osh_00001,SpecificUnitStageClearCount,chara_osh_00601.event_osh1_1day_00001,1,__NULL__,,0,,osh_00001_event_reward_33,33,Event
```

**作成ルール**:

1. **id**: `{イベントID}_{連番}`の形式
2. **criterion_type**: 「前提知識」セクションのマッピング表を参照
3. **criterion_value**: criterion_typeに応じて設定（不要な場合は空）
4. **criterion_count**: 設計書の「〜回」の数値
5. **unlock_criterion_type**: 連鎖ミッション以外は`__NULL__`
6. **unlock_criterion_count**: 連鎖ミッション以外は`0`
7. **mst_mission_reward_group_id**: `{イベント識別子}_event_reward_{連番}`の形式
8. **sort_order**: 設計書の出現順（連番）
9. **destination_scene**: 遷移先シーン
   - `Event`: イベント画面
   - `Gacha`: ガシャ画面
   - `QuestSelect`: クエスト選択画面

**destination_sceneの決定ルール**:
- ステージクリア系 → `Event`
- ガシャ系 → `Gacha`
- クエストクリア系 → `Event` または `QuestSelect`
- ユニット編成系 → `Event`

#### 2-3. MstMissionEventI18n.csv の作成

**役割**: イベントミッションの説明文（多言語対応）

**CSV形式**:
```csv
ENABLE,release_key,id,mst_mission_event_id,language,description
e,202512020,event_osh_00001_1_ja,event_osh_00001_1,ja,ステージを5回クリアしよう
e,202512020,event_osh_00001_28_ja,event_osh_00001_28,ja,賀正ガシャ2026を10回引こう
```

**作成ルール**:
1. `id`は`{mst_mission_event_id}_ja`の形式
2. `mst_mission_event_id`は手順2-2で作成したMstMissionEvent.id
3. `language`は現在`ja`のみ
4. `description`は設計書のミッション内容をそのままコピー

#### 2-4. MstMissionEventDependency.csv の作成

**役割**: ミッション同士の連鎖アンロック設定

**対象**: 連鎖ミッションのみ（手順2-1で分類したもの）

**CSV形式**:
```csv
ENABLE,id,release_key,group_id,mst_mission_event_id,unlock_order,備考
e,190,202512020,event_osh_00001_1,event_osh_00001_1,1,
e,191,202512020,event_osh_00001_1,event_osh_00001_2,2,
e,192,202512020,event_osh_00001_1,event_osh_00001_3,3,
```

**作成ルール**:
1. **group_id**: 連鎖グループを識別するID
   - 最初のミッションのIDを使うのが一般的
   - 例: `event_osh_00001_1`（ステージクリア系）, `event_osh_00001_28`（ガシャ系）
2. **unlock_order**: 1から開始する連番
3. **同じgroup_id内で unlock_order と mst_mission_event_id は重複不可**

**連鎖グループの作り方**:
- 設計書で連続している同系統のミッションを1つのグループにする
- 例: 「ステージを5回」「ステージを10回」...「ステージを600回」→ 1グループ
- 例: 「賀正ガシャを10回」「賀正ガシャを20回」...「賀正ガシャを50回」→ 1グループ

#### 2-5. イベントミッション報酬の MstMissionReward.csv への追加

**CSV形式**:
```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_531,202512020,osh_00001_event_reward_1,Item,ticket_glo_10001,2,1,推しの子ミッション(賀正チケット)
e,mission_reward_535,202512020,osh_00001_event_reward_5,FreeDiamond,,50,1,推しの子ミッション(賀正チケット)
```

**作成ルール**:
1. `group_id`は手順2-2のMstMissionEvent.mst_mission_reward_group_idと一致
2. 設計書の報酬列（プリズム、チケット等）から`resource_type`と`resource_amount`を決定
3. 複数種類の報酬がある場合は、複数行作成（同じgroup_idで）

**設計書の報酬列からの変換**:
| 設計書の列名 | resource_type | resource_id | 備考 |
|------------|---------------|-------------|------|
| プリズム | FreeDiamond | (空) | resource_amountは列の値 |
| 賀正ガシャチケット | Item | ticket_glo_10001 | resource_amountは列の値 |
| スペシャルガシャチケット | Item | ticket_glo_00002 | resource_amountは列の値 |
| コイン | Coin | (空) | resource_amountは列の値 |
| エンブレム | Emblem | emblem_event_osh_00008 | アイテムIDは別途確認 |

---

### 手順3: 期間限定ミッションの作成

設計書の「降臨バトルミッション」セクション、またはHTMLの降臨バトル詳細を処理します。

#### 3-1. MstMissionLimitedTerm.csv の作成

**役割**: 期間限定ミッション本体の設定

**CSV形式**:
```csv
ENABLE,id,release_key,progress_group_key,criterion_type,criterion_value,criterion_count,mission_category,mst_mission_reward_group_id,sort_order,destination_scene,start_at,end_at
e,limited_term_33,202512020,group9,AdventBattleChallengeCount,,5,AdventBattle,osh_00001_limited_term_1,1,AdventBattle,"2026-01-09 15:00:00","2026-01-13 14:59:59"
e,limited_term_34,202512020,group9,AdventBattleChallengeCount,,10,AdventBattle,osh_00001_limited_term_2,2,AdventBattle,"2026-01-09 15:00:00","2026-01-13 14:59:59"
```

**作成ルール**:
1. **id**: `limited_term_{連番}`の形式
2. **progress_group_key**: 進捗を共有するグループID（例: `group9`）
   - 同じイベントの降臨バトルミッションは同じグループにする
3. **criterion_type**: 通常は`AdventBattleChallengeCount`
4. **mission_category**: 通常は`AdventBattle`
5. **start_at, end_at**: 降臨バトルの開催期間（ダブルクォートで囲む）

#### 3-2. MstMissionLimitedTermI18n.csv の作成

**役割**: 期間限定ミッションの説明文（多言語対応）

**CSV形式**:
```csv
ENABLE,release_key,id,mst_mission_limited_term_id,language,description
e,202512020,limited_term_33_ja,limited_term_33,ja,降臨バトル「ファーストライブ」に5回挑戦しよう！
e,202512020,limited_term_34_ja,limited_term_34,ja,降臨バトル「ファーストライブ」に10回挑戦しよう！
```

**作成ルール**:
1. `id`は`{mst_mission_limited_term_id}_ja`の形式
2. `description`は設計書またはHTMLから取得

#### 3-3. 期間限定ミッション報酬の MstMissionReward.csv への追加

**CSV形式**:
```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_527,202512020,osh_00001_limited_term_1,Coin,,2000,1,降臨バトル「ファーストライブ」に5回挑戦しよう！
e,mission_reward_528,202512020,osh_00001_limited_term_2,FreeDiamond,,20,1,降臨バトル「ファーストライブ」に10回挑戦しよう！
```

---

### 手順4: アチーブメントミッションの作成

設計書の「恒常ミッション」または「無期限」セクションを処理します。

#### 4-1. MstMissionAchievement.csv の作成

**役割**: アチーブメントミッション本体の設定

**CSV形式**:
```csv
ENABLE,id,release_key,criterion_type,criterion_value,criterion_count,unlock_criterion_type,unlock_criterion_value,unlock_criterion_count,group_key,mst_mission_reward_group_id,sort_order,destination_scene
e,achievement_2_101,202512020,SpecificQuestClear,quest_main_osh_normal_17,1,__NULL__,,0,,achievement_2_101,101,QuestSelect
e,achievement_2_102,202512020,SpecificQuestClear,quest_main_osh_hard_17,1,__NULL__,,0,,achievement_2_102,102,QuestSelect
```

**作成ルール**:
1. **id**: `achievement_{分類番号}_{連番}`の形式
2. **criterion_type, criterion_value, criterion_count**: イベントミッションと同じルール
3. **mst_mission_reward_group_id**: `achievement_{分類番号}_{連番}`の形式
4. アチーブメントミッションは期限なし（永続的）

#### 4-2. アチーブメント報酬の MstMissionReward.csv への追加

**CSV形式**:
```csv
ENABLE,id,release_key,group_id,resource_type,resource_id,resource_amount,sort_order,備考
e,mission_reward_460,202512020,achievement_2_101,FreeDiamond,,50,1,アチーブメントミッション
e,mission_reward_461,202512020,achievement_2_102,FreeDiamond,,50,1,アチーブメントミッション
```

---

## 最終チェックリスト

### IDの一意性チェック

各テーブルで`id`が重複していないか確認：
- [ ] MstMissionEvent.id
- [ ] MstMissionEventI18n.id
- [ ] MstMissionEventDependency.id
- [ ] MstMissionEventDailyBonus.id
- [ ] MstMissionEventDailyBonusSchedule.id
- [ ] MstMissionReward.id
- [ ] MstMissionLimitedTerm.id
- [ ] MstMissionLimitedTermI18n.id
- [ ] MstMissionAchievement.id

### 参照整合性チェック

以下の関連付けが正しいか確認：

| 参照元テーブル | 参照元カラム | 参照先テーブル | 参照先カラム |
|--------------|-------------|--------------|-------------|
| MstMissionEventI18n | mst_mission_event_id | MstMissionEvent | id |
| MstMissionEventDependency | mst_mission_event_id | MstMissionEvent | id |
| MstMissionEventDailyBonus | mst_mission_event_daily_bonus_schedule_id | MstMissionEventDailyBonusSchedule | id |
| MstMissionEventDailyBonusSchedule | mst_event_id | MstEvent | id |
| MstMissionEvent | mst_event_id | MstEvent | id |
| MstMissionEvent | mst_mission_reward_group_id | MstMissionReward | group_id |
| MstMissionEventDailyBonus | mst_mission_reward_group_id | MstMissionReward | group_id |
| MstMissionLimitedTerm | mst_mission_reward_group_id | MstMissionReward | group_id |
| MstMissionLimitedTermI18n | mst_mission_limited_term_id | MstMissionLimitedTerm | id |
| MstMissionAchievement | mst_mission_reward_group_id | MstMissionReward | group_id |

### データ内容チェック

- [ ] release_keyが全て統一されているか
- [ ] 日時フォーマットが正しいか（"YYYY-MM-DD HH:MM:SS"でダブルクォート囲み）
- [ ] criterion_typeに対応するcriterion_valueが正しく設定されているか
- [ ] 報酬のresource_typeとresource_idの組み合わせが正しいか
- [ ] sort_orderが適切に設定されているか（表示順）
- [ ] destination_sceneが適切なシーンを指しているか

### 連鎖ミッションの整合性チェック

MstMissionEventDependencyを使用している場合：
- [ ] 同じgroup_id内でunlock_orderが重複していないか
- [ ] 同じgroup_id内でmst_mission_event_idが重複していないか
- [ ] unlock_orderが1から連番で設定されているか

---

## トラブルシューティング

### Q1: 設計書のミッション内容からcriterion_typeを判断できない

A: 以下の手順で判断します：
1. 「前提知識」セクションのマッピング表を参照
2. 類似する過去のミッションを`MstMissionEvent.csv`から検索
3. それでも不明な場合は、設計書HTMLの詳細説明を確認

### Q2: criterion_valueに何を入れるべきかわからない

A: 以下の手順で確認できます：

**1. 「前提知識」セクションのcriterion_type詳細リファレンスを参照**

リファレンス表で該当するcriterion_typeを探し、criterion_valueの形式を確認します。

**2. サーバー実装のPHPDocを確認**

`projects/glow-server/api/app/Domain/Mission/Entities/Criteria/`ディレクトリ内の該当Criterionクラスを開きます。

例: `SpecificGachaDrawCount`の場合
```php
/**
 * 指定ガシャXをY回引く
 * criterion_type = SpecificGachaDrawCount
 * criterion_value = opr_gachas.id
 * criterion_count = Y
 */
class SpecificGachaDrawCountCriterion extends MissionCriterion
```

**3. よく使用するパターン**

- **null（空）が必要な場合**: `StageClearCount`, `GachaDrawCount`, `LoginCount`等の集計系
- **単一IDが必要な場合**: `SpecificStageClearCount`（→ `mst_stages.id`）, `SpecificGachaDrawCount`（→ `opr_gachas.id`）
- **複合ID（ドット連結）が必要な場合**:
  - `SpecificUnitStageClearCount` → `<mst_units.id>.<mst_stages.id>`
  - 例: `chara_osh_00601.event_osh1_1day_00001`

**4. 参照先テーブルの確認方法**

criterion_valueにIDを指定する場合、参照先テーブルは以下で確認できます：
- DBスキーマ: `projects/glow-server/api/database/schema/exports/master_tables_schema.json`
- 既存のマスタデータCSVファイル: `マスタデータ/リリース/*/tables/`

### Q3: 報酬グループIDの命名規則は？

A: 以下の形式を推奨：
- イベントミッション: `{イベント識別子}_event_reward_{連番}`
  - 例: `osh_00001_event_reward_1`
- ログインボーナス: `{イベントID}_daily_bonus_{ゼロ埋め2桁}`
  - 例: `event_osh_00001_daily_bonus_01`
- 期間限定ミッション: `{イベント識別子}_limited_term_{連番}`
  - 例: `osh_00001_limited_term_1`
- アチーブメント: `achievement_{分類番号}_{連番}`
  - 例: `achievement_2_101`

### Q4: 連鎖ミッションと単独ミッションの判断基準は？

A: 以下の条件を満たす場合は連鎖ミッション：
1. 同じ条件（criterion_type）で回数（criterion_count）だけが異なる
2. 設計書で連続して記載されている
3. 回数が段階的に増加している

例:
- 連鎖: 「ステージを5回」「ステージを10回」「ステージを15回」
- 単独: 「ステージを5回」と「ガシャを10回」（条件が異なる）

### Q5: 複数の報酬を1つのミッションに設定したい

A: 同じ`group_id`を持つ複数の`MstMissionReward`レコードを作成します。
`sort_order`で報酬の表示順を制御できます。

---

## 参考資料

- DBスキーマ: `projects/glow-server/api/database/schema/exports/master_tables_schema.json`
- 実データ例: `マスタデータ/リリース/202512020/tables/*.csv`
- マスタデータ検証スキル: `.claude/skills/masterdata-csv-validator/`

---

## 改訂履歴

| 日付 | 版 | 変更内容 |
|------|---|---------|
| 2026-01-16 | 1.0 | 初版作成（202512020リリースキーの実データから逆算して作成） |
| 2026-01-16 | 1.1 | サーバー実装情報の参照セクションを追加（criterion_type詳細リファレンス、PHPDoc参照方法） |
