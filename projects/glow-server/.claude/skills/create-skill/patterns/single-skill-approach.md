# 単一スキルアプローチ

1つのスキルとして統合して作成する場合のパターンとガイドラインを説明します。

## このアプローチを選択すべき場合

以下の条件に当てはまる場合、単一スキルアプローチが適しています：

### 1. 責務が密接に関連している

- 各機能が独立して使われることがほとんどない
- フェーズが明確に分かれていない
- 常に一連の流れで使用される

**例:**
- マイグレーション作成（調査→実装→実行が一体）
- レスポンス実装（データ整形→JSON生成が一体）

### 2. スコープが適度に収まっている

- 対象ファイルが10個未満
- 実装パターンが3-4個程度
- SKILL.mdが50-80行程度で収まる
- 参照ファイルが5-7個程度

### 3. 技術スタックが統一されている

- 使用するツール・ライブラリが1-2個
- 同じ技術領域に限定されている
- アーキテクチャ層が同一

**例:**
- Laravel Eloquent の操作
- Filament Resource の実装
- API レスポンス形式の統一

### 4. ユーザーの要望

- ユーザーが分割を望まない
- シンプルな構成を優先したい
- 将来的な拡張の予定がない

## 単一スキルとして設計する際のポイント

### 1. ディレクトリ構造で責務を分離

たとえ1つのスキルでも、内部構造で責務を明確に分けます。

```
.claude/skills/{skill-name}/
├── SKILL.md (40-80行)
├── common-rules.md (必要に応じて)
├── guides/
│   ├── concept.md          # コンセプト解説
│   ├── tools.md            # ツールの使い方
│   └── architecture.md     # アーキテクチャ概要
├── patterns/
│   ├── basic-pattern.md    # 基本パターン
│   ├── advanced-pattern.md # 応用パターン
│   └── edge-cases.md       # エッジケース対応
└── examples/
    ├── simple-example.md   # シンプルな例
    ├── complex-example.md  # 複雑な例
    └── real-world.md       # 実際のプロジェクトでの使用例
```

### 2. SKILL.mdで各セクションを明確に区切る

フェーズや責務ごとにセクションを明確に分けます。

**例:**

```markdown
## Instructions

### フェーズ1: 調査・分析

既存実装を調査し、依存関係を特定します。
参照: **[調査ガイド](guides/research.md)**

### フェーズ2: 設計

実装方針を決定し、ファイル構成を設計します。
参照: **[設計パターン](patterns/design-patterns.md)**

### フェーズ3: 実装

設計に基づいて実装を行います。
参照リスト:
- **[基本実装](patterns/basic-implementation.md)**
- **[応用実装](patterns/advanced-implementation.md)**

### フェーズ4: テスト・検証

実装をテストし、動作を検証します。
参照: **[テストガイド](guides/testing.md)**
```

### 3. 参照ファイルは200行以下を目安に分割

1つのファイルが長くなりすぎる場合は、以下のように分割します。

**悪い例（分割されていない）:**

```
patterns/implementation.md (450行)
├── 基本実装 (150行)
├── 応用実装 (180行)
└── エッジケース (120行)
```

**良い例（適切に分割）:**

```
patterns/
├── basic-implementation.md (150行)
├── advanced-implementation.md (180行)
└── edge-cases.md (120行)
```

### 4. 目次を活用する

100行を超えるファイルには目次を追加して、ナビゲーションを容易にします。

**例:**

```markdown
# API実装パターン

## 目次

- [基本構造](#基本構造)
- [リクエストバリデーション](#リクエストバリデーション)
- [ビジネスロジック](#ビジネスロジック)
- [レスポンス生成](#レスポンス生成)
- [エラーハンドリング](#エラーハンドリング)
- [チェックリスト](#チェックリスト)

## 基本構造
...
```

## 具体例：migration スキル

### 概要

migrationスキルは、複数のデータベース（mst/mng/usr/log/sys/admin）に対するマイグレーション実装を1つのスキルで扱っています。

### ファイル構成

```
.claude/skills/migration/
├── SKILL.md (40行)
├── common-rules.md (390行)
├── naming-conventions.md (300行)
├── commands.md (305行)
├── examples-mst-mng.md (278行)
├── examples-usr-log-sys.md (352行)
├── examples-admin.md (365行)
└── reference.md (528行)
```

### 単一スキルとして成功している理由

1. **共通の実行フロー**: 全てのマイグレーションが同じフローで実行される
2. **統一されたルール**: common-rules.mdで全体共通のルールを定義
3. **DB別の実装例**: examples-{db}.mdで各データベースの特性に対応
4. **明確な参照構造**: 各ファイルの役割が明確で、必要な情報にすぐアクセスできる

### 改善の余地（推奨構造）

現在はフラット構造ですが、以下のようにディレクトリで整理するとより良くなります：

```
.claude/skills/migration/
├── SKILL.md (40行)
├── common-rules.md (390行)
├── naming-conventions.md (300行)
├── guides/
│   └── commands.md (305行)
└── examples/
    ├── mst-mng.md (278行)
    ├── usr-log-sys.md (352行)
    └── admin.md (365行)
```

## 具体例：api-response スキル

### 概要

api-responseスキルは、APIレスポンス実装に特化した小規模スキルです。

### ファイル構成（推奨）

```
.claude/skills/api-response/
├── SKILL.md (35行)
├── common-rules.md (85行)
├── response-factory-guide.md (120行)
├── response-data-factory-guide.md (115行)
└── examples.md (95行)
```

### 単一スキルとして適している理由

1. **スコープが小さい**: レスポンス実装のみに特化
2. **技術スタックが統一**: ResponseFactory/ResponseDataFactoryのみ
3. **フェーズが単純**: 設計→実装の2ステップのみ
4. **ファイル数が少ない**: 5ファイルのみ、ディレクトリ分割不要

## 注意点

### 将来的な拡張を考慮する

単一スキルとして作成しても、将来的に以下のような変化があれば分割を検討します：

- 対象範囲が大幅に拡大した
- 異なる使用タイミングが明確になった
- 参照ファイルが10個を超えた
- SKILL.mdが100行を超えそう

### 分割への移行パス

単一スキルから複数スキルへの移行は以下の手順で行います：

1. 現在のスキルを`{skill-name}-core`にリネーム
2. 新しいスキル（例: `{skill-name}-advanced`）を作成
3. 元のスキルから該当する参照ファイルを移動
4. 各SKILL.mdに「関連スキル」セクションを追加
5. 元のスキル名でラッパースキル（両方を案内）を作成（オプション）

## まとめ

単一スキルアプローチは以下の場合に最適です：

✅ **適している場合:**
- 責務が密接に関連
- スコープが適度（ファイル10個未満）
- 技術スタックが統一
- 常に一連の流れで使用

❌ **適していない場合:**
- 異なる使用タイミングが明確
- 対象ファイルが15個以上
- 複数の技術領域にまたがる
- SKILL.mdが100行を超える

迷った場合は、まず単一スキルとして作成し、必要に応じて分割を検討するのが良いアプローチです。
