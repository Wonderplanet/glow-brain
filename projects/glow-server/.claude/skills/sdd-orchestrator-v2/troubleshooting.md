# SDD v2 トラブルシューティング

## よくある問題と解決方法

### 1. PDFが読み込めない

**症状**:
```
Error: ゲーム体験仕様書.pdf が見つかりません
```

**原因**:
- PDFファイルが配置されていない
- ファイル名が異なる
- パスが間違っている

**解決方法**:
```bash
# パスを確認
ls docs/sdd-v2/features/{機能名}/

# 正しいファイル名で配置
cp /path/to/spec.pdf docs/sdd-v2/features/{機能名}/ゲーム体験仕様書.pdf
```

---

### 2. Stage 1 でコード調査が不完全

**症状**:
- 既存実装との関連が少ない
- 追加要件が抽出されていない

**原因**:
- PDF内の用語とコードベースの用語が一致しない
- 関連コードが別ドメインにある

**解決方法**:
1. 機能に関連するキーワードを手動で追加
2. 関連するドメインを明示的に指定
3. Stage 1 を再実行

```bash
# 追加のコンテキストを提供して再実行
/sdd-v2:requirements {機能名}

# 実行時に「以下のキーワードも調査してください: xxx, yyy」と追加指示
```

---

### 3. Stage 2 の確認項目が多すぎる

**症状**:
- 確認項目が10個以上ある
- プランナーへの負担が大きい

**原因**:
- PDF仕様書の記述が曖昧
- サーバーチームで決定可能な事項も含まれている

**解決方法**:
1. 確認項目を優先度でフィルタリング
2. サーバーチームで決定可能な項目は除外
3. 関連する項目をグループ化

`02_仕様確認.md` を編集して、本当に必要な項目のみを残す：

```markdown
## 5. プランナーへ確認が必要な項目（質問リスト）

### 最優先（ゲーム体験に直接影響）
- Q1: ...
- Q2: ...

### 任意（実装の詳細に影響）
- Q3: ...
```

---

### 4. プランナー確認結果の入力形式がわからない

**症状**:
- Phase B で何を入力すればよいかわからない

**解決方法**:
以下の形式で回答を整理して入力：

```markdown
## プランナー確認結果

### Q1: 交換回数上限のリセットタイミング
- **回答**: A案（日次リセット）
- **補足**: 毎日午前4時にリセット。イベント専用交換は例外。

### Q2: 複数個交換時の報酬付与
- **回答**: B案（5回ループ）
- **補足**: 特殊報酬（確率ドロップ）も5回抽選される。
```

---

### 5. Stage 3 のAPI設計が既存パターンと異なる

**症状**:
- 生成されたAPI設計が既存実装と一貫性がない
- 命名規則が異なる

**原因**:
- 既存パターンの参照が不足
- glow-schemaの確認が不十分

**解決方法**:
1. 類似機能のAPI実装を確認
2. Stage 3 を再実行し、参照先を明示

```bash
# 参照すべき既存実装を指定して再実行
/sdd-v2:api-design {機能名}

# 実行時に「ExchangeController/ExchangeServiceを参考に設計してください」と追加指示
```

---

### 6. 出力ファイルが上書きされてしまう

**症状**:
- 再実行時に前回の出力が消える

**解決方法**:
再実行前にバックアップを作成：

```bash
# バックアップ作成
cp docs/sdd-v2/features/{機能名}/03_API設計書.md \
   docs/sdd-v2/features/{機能名}/03_API設計書_v1.md

# 再実行
/sdd-v2:api-design {機能名}
```

---

### 7. glow-schemaリポジトリが見つからない

**症状**:
```
Error: ../glow-schema が見つかりません
```

**原因**:
- glow-schemaがクローンされていない
- 相対パスが異なる

**解決方法**:
```bash
# glow-serverの親ディレクトリで確認
ls ../glow-schema

# クローンされていない場合
cd ..
git clone git@github.com:Wonderplanet/glow-schema.git
```

---

### 8. エージェントがタイムアウトする

**症状**:
- 長時間実行後にエラー
- 途中で停止

**原因**:
- PDFが大きすぎる
- コードベースの調査範囲が広すぎる

**解決方法**:
1. 段階別に実行してタイムアウトを回避
2. 大きな機能は複数のSDDに分割

```bash
# フルフローではなく段階別に実行
/sdd-v2:requirements {機能名}
# 完了を待つ

/sdd-v2:spec-confirm {機能名}
# 完了を待つ

/sdd-v2:api-design {機能名}
```

---

## エラーメッセージ一覧

| エラーメッセージ | 原因 | 対処 |
|-----------------|------|------|
| `ゲーム体験仕様書.pdf が見つかりません` | PDFが配置されていない | 正しいパスにPDFを配置 |
| `01_要件調査.md が見つかりません` | Stage 1 が未実行 | Stage 1 を先に実行 |
| `02_仕様確認.md が見つかりません` | Stage 2 Phase A が未実行 | Stage 2 を先に実行 |
| `glow-schema が見つかりません` | リポジトリがクローンされていない | glow-schemaをクローン |
| `タイムアウト` | 処理時間超過 | 段階別に実行 |

---

## サポート

問題が解決しない場合:

1. 各段階の出力ファイルを確認
2. エラーメッセージを記録
3. チームに相談

関連ドキュメント:
- [stage-details.md](stage-details.md) - 各段階の詳細
- [orchestration-patterns.md](orchestration-patterns.md) - 実行フロー
- [examples.md](examples.md) - 使用例
