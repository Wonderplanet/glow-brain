# SDD v2 使用例

## 例1: 交換所機能のSDD作成

### 準備

```bash
# 機能ディレクトリを作成
mkdir -p docs/sdd-v2/features/交換所

# ゲーム体験仕様書PDFを配置
cp /path/to/交換所_ゲーム体験仕様書.pdf docs/sdd-v2/features/交換所/ゲーム体験仕様書.pdf
```

### フルフロー実行

```bash
/sdd-v2:run-full 交換所
```

### 実行結果

#### Stage 1 完了後

```
docs/sdd-v2/features/交換所/
├── ゲーム体験仕様書.pdf
└── 01_要件調査.md
```

`01_要件調査.md` の内容例：

```markdown
# 要件調査

## 1. ドキュメント情報

- **対象機能**: 交換所
- **作成日**: 2025-01-15
- **入力ソース**:
  - ゲーム体験仕様書.pdf
  - glow-server コードベース

## 2. 機能概要

ユーザーが特定のアイテムを消費して別のアイテムに交換できる機能。
期間限定イベントと連携し、イベント専用アイテムの交換も可能。

---

## 3. PDF からの要件抽出

### 要件 P-1: 交換実行
- **元ページ**: Page 3, 「交換処理」のセクション
- **抜粋**:
  > ユーザーが交換ボタンをタップすると、指定した個数分の交換が実行される
- **サーバー観点での補足**:
  - 交換に必要なアイテムの所持数検証
  - 交換回数上限の管理
  - 報酬アイテムの付与

...
```

#### Stage 2 Phase A 完了後

```
docs/sdd-v2/features/交換所/
├── ゲーム体験仕様書.pdf
├── 01_要件調査.md
└── 02_仕様確認.md
```

`02_仕様確認.md` の確認項目例：

```markdown
## 5. プランナーへ確認が必要な項目（質問リスト）

### Q1: 交換回数上限のリセットタイミング

- **背景**: 仕様書では「交換回数に上限あり」とあるが、リセット条件が不明
- **質問内容**: 交換回数上限は「日次リセット」「イベント期間中固定」「永続」のどれですか？
- **選択肢**:
  - A案: 日次リセット（毎日午前4時にリセット）
  - B案: イベント期間中固定（イベント終了までリセットなし）
  - C案: 永続（一度交換したら二度と交換不可）
- **影響範囲**: REQ-A-2

### Q2: 複数個交換時の報酬付与

- **背景**: 一度に複数個交換する場合の報酬計算方法が不明
- **質問内容**: 5個同時交換の場合、報酬は「5倍」「5回ループ」のどちらですか？
- **選択肢**:
  - A案: 報酬を5倍（効率的だが特殊報酬の扱いが曖昧）
  - B案: 交換処理を5回ループ（確実だが処理時間増）
- **影響範囲**: REQ-A-1
```

#### ⚠️ プランナー確認

上記の質問をプランナーへ連絡し、回答を受け取ります。

回答例：
- Q1: A案（日次リセット）
- Q2: B案（5回ループ）

#### Stage 2 Phase B 完了後

```
docs/sdd-v2/features/交換所/
├── ゲーム体験仕様書.pdf
├── 01_要件調査.md
├── 02_仕様確認.md
└── 02_2_プランナー確認結果.md
```

#### Stage 3 完了後

```
docs/sdd-v2/features/交換所/
├── ゲーム体験仕様書.pdf
├── 01_要件調査.md
├── 02_仕様確認.md
├── 02_2_プランナー確認結果.md
└── 03_API設計書.md
```

`03_API設計書.md` の主要セクション例：

```markdown
## 3. API全体像

### 3.1 APIエンドポイント一覧

| エンドポイント | メソッド | 種別 | 関連要件 | 概要 |
|---------------|----------|------|----------|------|
| /api/exchange/trade | POST | 新規 | REQ-A-1 | 交換実行 |

## 4. DB設計

### 4.2 ユーザー

#### usr_exchange_lineups（新規）

| 列名 | index | データ型/制約 | 説明 |
|------|-------|---------------|------|
| usr_user_id | PK | varchar(255) | usr_users.id |
| mst_exchange_lineup_id | PK | varchar(255) | mst_exchange_lineups.id |
| trade_count | | int unsigned | 交換回数 |
| created_at | | timestamp | 作成日時 |
| updated_at | | timestamp | 更新日時 |

## 5. API詳細仕様

### 5.1 POST /api/exchange/trade

#### Request

```json
{
  "mstExchangeId": "exchange_001",
  "mstExchangeLineupId": "lineup_001",
  "tradeCount": 5
}
```

#### Response

```json
{
  "usrParameter": { ... },
  "usrExchangeLineups": [
    {
      "mstExchangeLineupId": "lineup_001",
      "tradeCount": 10
    }
  ],
  "rewards": [ ... ]
}
```
```

---

## 例2: 段階別実行（途中からの再開）

### Stage 2 から再開する場合

前提: Stage 1 は完了しており、`01_要件調査.md` が存在

```bash
# Stage 2 を実行
/sdd-v2:spec-confirm 交換所

# → 02_仕様確認.md が生成される
# → プランナーへ確認項目を連絡

# プランナーから回答を受け取った後、再度実行
/sdd-v2:spec-confirm 交換所
# → 回答を入力するよう求められる
# → 02_2_プランナー確認結果.md が生成される

# Stage 3 を実行
/sdd-v2:api-design 交換所
# → 03_API設計書.md が生成される
```

---

## 例3: 既存機能の改修SDD

新規機能だけでなく、既存機能の改修にも使用できます。

```bash
# ガチャ機能に新しい演出を追加
/sdd-v2:run-full ガチャ天井追加

# ミッション機能に新しい条件を追加
/sdd-v2:run-full ミッション条件拡張
```

改修の場合、Stage 1 のコード調査で既存実装が詳しく分析され、
Stage 3 では「既存API改修」として設計されます。
