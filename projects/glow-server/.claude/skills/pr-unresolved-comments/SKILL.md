---
name: PR未解決コメント対応
description: GitHub PRの未解決レビューコメントを取得し、ローカルで順次修正するワークフローを支援。「PRの指摘を修正」「レビューコメントを対応」などの発話で自動起動。
---

# PR未解決コメント対応

GitHub PRの未解決レビューコメントを取得し、効率的に修正するためのスキルです。

## トリガー条件

以下のような発話で自動起動します：
- 「PRの指摘を修正して」
- 「レビューコメントを対応」
- 「未解決のコメントを確認」
- 「PR #番号 の指摘対応」

## Instructions

### Step 1: 未解決コメント取得

同梱のシェルスクリプトを実行して未解決コメントを取得します。

```bash
# PR番号が指定されている場合
bash .claude/skills/pr-unresolved-comments/get-unresolved-comments.sh [PR番号]

# PR番号が指定されていない場合（現在ブランチのPRを自動検出）
bash .claude/skills/pr-unresolved-comments/get-unresolved-comments.sh
```

### Step 2: コメント一覧表示

取得した未解決コメントを以下の形式で表示します（スレッド内の対話を全て含む）：

```text
=== PR #番号 未解決コメント ===
タイトル: PRタイトル

📁 ファイルパス (L行番号)
  [指摘者 日付]
    最初のコメント内容

  [返信者 日付]
    返信内容（あれば）

  [指摘者 日付]
    追加コメント（あれば）
---

合計: N件の未解決スレッド
```

**対話の流れを把握することで、指摘の意図や追加の文脈を理解できます。**

### Step 3: 修正実行

ユーザーに確認後、以下の順序で修正を実施します：

1. 各スレッドについて、**対話全体**を読み、指摘の最終的な意図を理解する
   - 最初のコメントだけでなく、返信での追加説明や合意事項も考慮
   - 既に自己解決済みや「対応不要」の合意があれば、それも把握
2. 該当ファイルの該当行を `Read` ツールで読み込む
3. 対話の文脈を踏まえた修正案を提示
4. ユーザー承認後、`Edit` ツールで修正を適用
5. 全スレッド対応完了後、変更内容をサマリ表示
6. コミット提案（任意、ユーザー承認が必要）

## Examples

### 例1: 現在ブランチのPR指摘を修正（対話あり）

```text
ユーザー: PRの指摘を修正して

Claude: シェルスクリプトを実行して未解決コメントを取得します...

=== PR #1234 未解決コメント ===
タイトル: ユーザー認証機能の改善

📁 api/app/Http/Controllers/AuthController.php (L45)
  [reviewer 2025-11-28]
    このメソッドの戻り値の型を明示してください

  [author 2025-11-28]
    ResponseかJsonResponseのどちらが良いでしょうか？

  [reviewer 2025-11-28]
    JsonResponseで統一してください
---

合計: 1件の未解決スレッド

対話を確認しました。reviewerはJsonResponseでの型宣言を求めています。
該当ファイルを読み込んで修正案を提示します...
```

### 例2: 特定PRの指摘を確認

```text
ユーザー: PR #2000 の指摘対応

Claude: PR #2000 の未解決コメントを取得します...
```

## 注意事項

- PR番号省略時は現在ブランチのPRを自動検出します
- 修正前に必ずユーザー確認を行います
- コミットは自動では行いません（ユーザー承認が必要）

## 必要条件

- GitHub CLI (`gh`) がインストールされ、認証済みであること
- `jq` がインストールされていること

## 関連ファイル

- **シェルスクリプト**: `get-unresolved-comments.sh` - GraphQL APIで未解決コメントを取得
- **コマンド**: `/api:fix-pr-comments` - 明示的にスキルを呼び出すコマンド
