---
name: api-sdd-v2-requirements-investigation
description: |
  SDD v2プロセスの第1段階:ゲーム体験仕様書PDFとコードベース調査から包括的な要件抽出を行う。以下の場合に使用:(1) 新機能SDD作成開始時、サーバー側実装要件の特定、(2) PDF仕様からのサーバー要件抽出(ページ番号、抜粋、補足付き)、(3) コードベース内の関連実装調査(API層、ドメイン層、DB、設定)、(4) 既存パターンと技術的制約の把握、(5) 要件の出典別分類(PDF確定/コード推定/技術制約)。出力:(1) 完全なトレーサビリティを持つ統合要件リスト、(2) プランナー確認用に整理された曖昧点と不明点、(3) 明確化が必要な項目、(4) 既存実装との関係分析。重要ルール:PDF未確認仕様は不明点として扱う、既存コードは参考であり仕様ではない、実装アプローチを断定しない、発見事項を確定/推定/制約に分類する。新機能開発開始時、仕様からのサーバー要件抽出時、PDFとコードベースの統合調査時、プランナー確認が必要な項目の特定時に使用する。入力:ゲーム体験仕様書.pdf、コードベース。出力:01_要件調査.md。
---

# SDD v2 要件調査スキル

ゲーム体験仕様書（PDF）とコードベースを同時に調査し、サーバー側で考慮すべき要件を包括的に抽出するスキルです。

## 使用タイミング

- 新機能のSDD作成時、最初のフェーズとして実行
- `/sdd-v2:requirements {機能名}` コマンドから起動
- `sdd-orchestrator-v2` スキルから直接呼び出し

## 基本原則

1. **実装非依存**: 「何を実現するか」のみ記述。「どう実装するか」には言及しない
2. **中立性**: 実装方式を断定しない（「APIが必要」「DB更新が必須」等は禁止）
3. **トレーサビリティ**: 各要件の出典（PDFページ or コードファイル）を明記
4. **網羅性**: PDFとコード両方から要件を抽出
5. **API要件のみ**: 管理ツール(admin)の要件は対象外

## コードベース調査の重要ルール

**⚠️ これらのルールを厳守してください:**

1. **PDF記載なしの仕様は全て「不明点」として扱う**
   - 既存コードがそうしているからといって、新機能でも同じとは限らない
   - 特に既存にない新しいゲームメカニクスでは必ず確認

2. **既存コードは参考情報であり、確定仕様ではない**
   - 既存実装は特定のユースケースに対する実装にすぎない
   - 新機能では異なる仕様が必要な可能性を常に検討

3. **実装方式の断定禁止**
   - 「〜すべき」「〜が正しい」といった断定表現は使用しない
   - 「〜と推測される（要確認）」と記述

4. **コードベース調査結果を3段階で分類**
   - **確定要件**: PDF記載あり、既存実装と一致
   - **推定要件（要確認）**: PDF記載なし、既存実装から推測可能 → **必ずプランナー確認項目に含める**
   - **技術的制約**: 実装上の制約で、プランナー確認不要

## 入力

- **ゲーム体験仕様書**: `docs/sdd-v2/features/{機能名}/ゲーム体験仕様書.pdf`
- **コードベース**: glow-server リポジトリ全体（API層、ドメイン層、DB、設定等）

## 出力

- **ファイル名**: `docs/sdd-v2/features/{機能名}/01_要件調査.md`
- **内容**: PDF要件抽出、コード調査、統合要件一覧、不明点・曖昧点

## 作業フロー

詳細な作業手順とフォーマットは以下を参照：

@docs/sdd-v2/prompts/01_要件調査_テンプレート.md

**簡潔なステップ:**

1. **PDF要件抽出**: ゲーム体験仕様書からサーバー関与項目を特定（ページ・抜粋・補足を記録）
2. **コードベース調査**: API層、ドメイン層、DB等を網羅的に調査し追加要件を発見
3. **統合と整理**: PDF要件とコード要件を統合、カテゴリ別に分類、重複排除
4. **不明点洗い出し**: 次ステップ（仕様確認）で解決すべき項目をリスト化

## 調査対象領域

- API層: Controller、Request、Response、ルーティング
- ドメイン層: Entity、Model、Repository、Service、UseCase
- データベース: Migration、既存テーブル構造
- 設定: Config、Constants、Enum

## 次のステップ

出力された `01_要件調査.md` を確認後、`api-sdd-v2-spec-confirmation` スキルで仕様確認を実行。
