---
name: api-sdd-v2-api-design
description: |
  仕様確認完了後、標準テンプレート形式に従って実装可能なAPI設計書を作成する。以下の場合に使用:(1) シーケンス図、エラー処理、API仕様、DB設計を含む詳細設計書の作成、(2) 要件と確認結果を統合した仕様サマリーの整理、(3) Mermaid形式のシーケンス図による処理フロー可視化、(4) エラー設計(エラーコード、発生条件、クライアント挙動)、(5) API仕様(リクエスト/レスポンス/バリデーション詳細)、(6) DB設計(mst/usr/logテーブル)、(7) テスト観点(単体/機能/シナリオ)。仕様から実装フェーズへ移行する際、API設計書を作成する際、新規エンドポイントを設計する際、シーケンス図を含む詳細設計が必要な際に使用する。入力:01_要件調査.md、02_仕様確認.md、02_2_プランナー確認結果.md。出力:03_API設計書.md。
---

# SDD v2 API設計書作成スキル

仕様確認結果を基に、実装可能な具体的なAPI設計書を作成するスキルです。
**交換所のAPI設計書フォーマットに厳密に従い**、それ以上増やさず、それ以下に減らさずに作成します。

## 使用タイミング

- 仕様確認完了後、実装設計の段階
- `/sdd-v2:api-design {機能名}` コマンドから起動
- `sdd-orchestrator-v2` スキルから直接呼び出し

## 基本原則

1. **フォーマット厳守**: 参照テンプレートのセクション構成を厳密に守る
2. **番号なし**: 見出しに番号を付けない（「## 1. xxx」ではなく「## xxx」）
3. **一貫性**: 既存実装パターンを踏襲し、アーキテクチャの一貫性を保つ
4. **具体性**: 実装者が迷わず実装できるレベルの詳細度
5. **API要件のみ**: 管理ツール(admin)の設計は対象外

## 入力

- `docs/sdd-v2/features/{機能名}/01_要件調査.md`
- `docs/sdd-v2/features/{機能名}/02_仕様確認.md`
- `docs/sdd-v2/features/{機能名}/02_2_プランナー確認結果.md`
- glow-schema: 既存API定義（YAML）
- コードベース: 既存実装パターン

## 出力

**ファイル名**: `docs/sdd-v2/features/{機能名}/03_API設計書.md`

## 参照テンプレート

**必ず以下のテンプレートを参照し、セクション構成・記載形式を完全に踏襲:**

@docs/sdd-v2/templates/API設計書_参考フォーマット.md

詳細な作業フローはプロンプトテンプレートを参照：

@docs/sdd-v2/prompts/03_API設計書_テンプレート.md

## 必須セクション（この順序で）

1. **仕様書** - 要点まとめ、仕様確認
2. **シーケンス図** - Mermaid形式で処理フローを可視化
3. **エラー設計** - エラーコード、発生条件、クライアント挙動
4. **API仕様** - リクエスト/レスポンス/バリデーション
5. **DB設計** - マスター/ユーザー/ログテーブル
6. **テーブル一覧** - 全テーブルのサマリー
7. **実装上の注意点** - トランザクション制御等
8. **テスト観点** - 単体/機能/シナリオテスト

## 含めないセクション

以下のセクションは含めないでください：
- ドキュメント情報
- 機能概要（仕様書に統合）
- API全体像（API仕様に統合）
- 実装ガイド
- 実装チェックリスト

## DB設計ガイドライン

### usrテーブル（TiDB最適化）
- PRIMARY KEYには必ずusr_user_idを含める
- 1ユーザー1レコード: PK = usr_user_id
- 1ユーザー複数レコード: 複合PK = (usr_user_id, domain_id)

### logテーブル
- PRIMARY KEY: AUTO_INCREMENTのid
- usr_user_idとcreated_atの複合インデックス必須

## シーケンス図ガイドライン

**使用可能なparticipant**: Client, Server, DB, Memento（必要時）, ExternalAPI（必要時）

**使用禁止**: 具体的なサービス名（StageService等）、クラス名（StageController等）

## 次のステップ

出力された `03_API設計書.md` を確認後、`api-sdd-v2-api-design-review` スキルで品質レビューを実行。
