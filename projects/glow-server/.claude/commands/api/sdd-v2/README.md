# SDD v2 コマンド

SDD（Spec-Driven Development）v2は、ゲーム体験仕様書からAPI設計書を生成するための効率化されたワークフローです。

## 概要

```
【要件定義フェーズ】
Stage 1: 要件調査 (PDF抽出 + コード調査を統合)
    ↓
Stage 2: 仕様確認 (レビュー + プランナー確認を統合)
    ↓ ⚠️ 人間確認
【設計フェーズ】
Stage 3: API設計書 (概要 + 詳細 + DB + 実装設計を統合)
    ↓
【FB・修正調整フェーズ】 ← オプション
Stage 4: API設計書の修正調整 (対話・別案作成・ドキュメント更新)
```

## コマンド一覧

| コマンド | 説明 |
|----------|------|
| `/sdd-v2:run-full {機能名}` | 全3段階を自動実行 |
| `/sdd-v2:requirements {機能名}` | Stage 1: 要件調査 |
| `/sdd-v2:spec-confirm {機能名}` | Stage 2: 仕様確認 |
| `/sdd-v2:api-design {機能名}` | Stage 3: API設計書作成 |
| `/sdd-v2:refine {機能名}` | Stage 4: FB・修正調整（対話・別案・ドキュメント更新） |

## クイックスタート

### 1. 準備

```bash
# 機能ディレクトリを作成
mkdir -p docs/sdd-v2/features/{機能名}

# ゲーム体験仕様書PDFを配置
cp /path/to/spec.pdf docs/sdd-v2/features/{機能名}/ゲーム体験仕様書.pdf
```

### 2. 全フロー実行

```bash
/api:sdd-v2:00-run-full {機能名}
```

または段階的に実行:

```bash
# Stage 1: 要件調査
/api:sdd-v2:01-requirements {機能名}

# Stage 2: 仕様確認（プランナー確認含む）
/api:sdd-v2:02-spec-confirm {機能名}

# Stage 3: API設計書作成
/api:sdd-v2:03-api-design {機能名}
```

## 出力ファイル

```
docs/sdd-v2/features/{機能名}/
├── ゲーム体験仕様書.pdf              # 入力（事前配置）
├── 01_要件調査.md                    # Stage 1出力
├── 02_仕様確認.md                    # Stage 2出力（確認前）
├── 02_2_プランナー確認結果.md         # Stage 2出力（確認後）
├── 03_API設計書.md                   # Stage 3出力（最終成果物）
├── 03_API設計書_別案_*.md            # Stage 4出力（別案がある場合）
└── 04_API設計_比較評価レポート.md     # Stage 4出力（複数案の比較評価）
```

## 各段階の詳細

### Stage 1: 要件調査

**実行内容**:
1. PDFからサーバー関与が必要な項目を抽出
2. コードベースを調査し、暗黙の前提・制約を特定
3. 両者を統合して要件一覧を作成

**出力**: `01_要件調査.md`

### Stage 2: 仕様確認

**実行内容**:

**Phase A（確認前）**:
1. 要件調査結果をレビューし、曖昧さを評価
2. プランナー確認が必要な項目を質問形式で整理
3. `02_仕様確認.md` を出力

**⚠️ 人間の確認**:
- プランナーへ確認項目を連絡
- 回答を受け取る

**Phase B（確認後）**:
1. プランナー確認結果を統合
2. 確定仕様を整理
3. `02_2_プランナー確認結果.md` を出力

### Stage 3: API設計書作成

**実行内容**:
1. 確定仕様をもとにAPI全体像を設計
2. DB設計（mst_*/usr_*/log_*）を定義
3. API詳細仕様（リクエスト/レスポンス/エラー）を設計
4. シーケンス図で処理フローを可視化
5. 実装ガイドとテスト観点を追加

**出力**: `03_API設計書.md`（完全なAPI設計書）

### Stage 4: FB・修正調整（オプション）

API設計書の初稿完成後、フィードバックを受けて修正調整を行うフェーズです。

**実行内容**:

**対話フェーズ**:
1. ユーザーのFBを受けて設計意図を説明
2. 改善案を提案、トレードオフを分析
3. 修正方針を固める

**別案作成フェーズ**（必要な場合）:
1. 代替案の設計書を作成
2. 複数案がある場合は比較評価レポートを作成
3. ユーザーが採用案を決定

**反映フェーズ**:
1. ユーザーに確認を取る
2. 全ドキュメントを一括更新
3. 整合性を確保

**出力**:
- `03_API設計書.md`（更新）
- `03_API設計書_別案_*.md`（必要に応じて）
- `04_API設計_比較評価レポート.md`（複数案ある場合）

## 関連ファイル

### エージェント
- `.claude/agents/api/sdd-v2/01-requirements-investigation.md`
- `.claude/agents/api/sdd-v2/02-spec-confirmation.md`
- `.claude/agents/api/sdd-v2/03-api-design.md`
- `.claude/agents/api/sdd-v2/03-2-api-design-review.md`
- `.claude/agents/api/sdd-v2/04-api-design-refiner.md`

### プロンプトテンプレート
- `docs/sdd-v2/prompts/01_要件調査_テンプレート.md`
- `docs/sdd-v2/prompts/02_仕様確認_テンプレート.md`
- `docs/sdd-v2/prompts/03_API設計書_テンプレート.md`

### スキル
- `.claude/skills/sdd-orchestrator-v2/` - オーケストレータースキル

## トラブルシューティング

### よくある問題

**Q: PDFが読み込めない**
A: `docs/sdd-v2/features/{機能名}/ゲーム体験仕様書.pdf` のパスを確認してください。

**Q: Stage 2で止まる**
A: プランナー確認が必要です。確認項目をプランナーへ連絡し、回答を待ってください。

**Q: 途中で失敗した**
A: 該当段階のコマンドを個別に再実行できます。前段階の出力ファイルがあれば続行可能です。

**Q: API設計書へのFBを反映したい**
A: `/sdd-v2:refine {機能名}` を実行してください。対話的にFBを受けつけ、別案作成や比較評価、ドキュメント一括更新まで対応します。

**Q: 別案を比較検討したい**
A: `/sdd-v2:refine {機能名}` で別案の作成を依頼できます。複数案がある場合は比較評価レポートが自動生成されます。
