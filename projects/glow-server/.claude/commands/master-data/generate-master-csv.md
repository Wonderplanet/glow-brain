---
description: マスタデータ(mst,opr,mng)をプロンプトに基づいて設計・CSV出力する。テーブル構造とコードを調査し、設定値の挙動をレポートにまとめる。
---

# マスタデータCSV生成コマンド

プロンプトの要件を解析し、必要なマスタテーブルのデータをCSVファイルとして生成します。

## 使用方法

```
/master-data:generate-master-csv [要件の説明]
```

例:
- `/master-data:generate-master-csv 新しいイベントステージを5つ追加したい。難易度は初級・中級・上級で報酬はゴールドとアイテム`
- `/master-data:generate-master-csv ガチャに新ユニット3体を追加。レアリティはSSR、排出率は各1%`

## 実行内容

引数: $ARGUMENTS

---

## 処理フロー

### 1. 要件分析

ユーザーのプロンプトから以下を特定します：

- **対象機能**: 何を追加・変更したいのか
- **必要なテーブル**: どのマスタテーブルが関係するか
- **データの関連性**: テーブル間のリレーション

### 2. テーブル調査

#### 対象データベース
- **mst**: マスタデータ（ゲーム設定、ユニット、ステージ等）
- **opr**: 運用データ（ガチャ、キャンペーン、リリース管理等）
- **mng**: 管理データ（メッセージ、お知らせ、バージョン管理等）

#### 調査手順

**優先順位1: glow-server-local-db MCP**
1. `glow-server-local-db` MCPを使用してテーブル一覧を取得
2. 関連テーブルの構造（カラム、型、制約）を確認
3. 既存データのサンプルを取得してフォーマットを把握

**優先順位2: DDLファイル（MCPが利用不可の場合）**
MCPが利用できない場合は、以下のDDLファイルを参照してテーブル構造を確認：
```
api/database/schema/master_tables_ddl.sql  # mst, mng DB
api/database/schema/user_tables_ddl.sql    # usr, log, sys DB
```
これらのファイルには各DBのCREATE TABLE文が含まれています。
- テーブルコメントから用途を把握
- カラムコメントから設定値の意味を理解
- enum型の定義から有効な値を特定

### 3. コード調査

必要に応じて以下を調査：

- **Entityクラス**: `api/app/Domain/*/Entities/` 配下
- **Modelクラス**: `api/app/Domain/*/Models/` 配下
- **定数・Enum**: 設定値の意味を特定
- **UseCase/Service**: データがどのように使われるか

調査結果から：
- 各カラムの意味と設定可能な値
- 設定値ごとの挙動の違い
- 必須項目とオプション項目
- 外部キーの関連性

### 4. CSV生成

#### 出力先ディレクトリ
```
.claude/tmp/master_data_csvs/{タイムスタンプ}_{要約}/
```

タイムスタンプ形式: `YYYYMMDD_HHMMSS`

#### 出力ファイル
- 各テーブルごとに `{テーブル名}.csv`
- レポートファイル `README.md`

#### CSVフォーマット
- エンコーディング: UTF-8（BOMなし）
- 区切り文字: カンマ
- 改行コード: LF
- ヘッダー行: カラム名をそのまま使用
- NULL値: 空文字として出力

### 5. レポート作成

`README.md` に以下を記載：

```markdown
# マスタデータ生成レポート

## 概要
- 生成日時: {タイムスタンプ}
- 要件: {ユーザーのプロンプト要約}

## 生成ファイル一覧
| ファイル名 | テーブル名 | レコード数 | 説明 |
|------------|------------|------------|------|
| xxx.csv    | mst_xxx    | 5          | xxx  |

## テーブル設計

### {テーブル名}

#### カラム定義
| カラム名 | 型 | 必須 | 説明 | 設定値の挙動 |
|----------|----|----|------|--------------|

#### 設定値の詳細
- `{カラム名}`:
  - `値1`: {この値にするとこうなる}
  - `値2`: {この値にするとこうなる}

### 関連テーブル
- {テーブルA} → {テーブルB}: {関連の説明}

## 投入手順

1. CSVファイルを確認
2. 必要に応じてIDや日時を調整
3. 以下のコマンドでインポート（例）

## 注意事項
- {特記事項があれば記載}
```

---

## 実行開始

以下の手順で進めます：

1. **要件確認**: プロンプトの内容を解析
2. **テーブル特定**: 必要なマスタテーブルを洗い出し
3. **構造調査**: テーブル構造とコードを調査
4. **データ設計**: CSVに出力するデータを設計
5. **ファイル生成**: CSV + レポートを出力
6. **結果報告**: 生成したファイルの概要を説明

---

それでは、引数で指定された要件に基づいてマスタデータのCSV生成を開始します。
