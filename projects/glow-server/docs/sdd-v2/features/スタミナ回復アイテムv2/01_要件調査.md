# 要件調査

## 1. ドキュメント情報

- **対象機能**: スタミナ回復アイテムv2
- **作成日**: 2025-12-17
- **入力ソース**:
  - ゲーム体験仕様書.pdf
  - ゲーム体験仕様書_追加確認事項.md
  - glow-server コードベース（既存実装: スタミナ回復アイテム v1）

## 2. 機能概要

本機能は、既存のスタミナ回復アイテム機能（割合回復: StaminaRecoveryPercent）に、**固定値回復仕様を追加**するアップデートです。

**従来の仕様（v1）:**
- スタミナ上限値の指定パーセンテージ分を回復（例: 50%回復 = スタミナドリンク50）
- プリズム30個で全回復
- 広告視聴でスタミナ上限値の50%回復

**新規追加要件（v2）:**
- **固定値回復アイテムの追加**: スタミナドリンク10、スタミナドリンク100 など、固定量を回復するアイテム
- **システム上限999への統一**: プリズム回復・広告回復も含め、すべてのスタミナ回復方法でシステム上限999まで回復可能に
- **部分回復の許容**: 回復後に999を超える場合でも、一部でも回復できる場合は回復を許可（超過分は切り捨て）

**ユーザー体験の改善ポイント:**
- ARPU向上（確実にプレイ時間を買える）
- イベント時のブースト効果（時間を金で買う需要）
- プレイ時間の自由化（溜めて使える）

---

## 3. PDF からの要件抽出

### 要件 P-1: スタミナ回復アイテムの種類と名称
- **元ページ**: Page 3, 「基本仕様_スタミナ回復アイテム」セクション
- **抜粋**:
  > アイテム名称：スタミナドリンク（右記で制作⇨10、50）/スタミナボトル（50%割合回復）
- **サーバー観点での補足**:
  - 固定値回復（10、50、100など）と割合回復（50%）の2種類のアイテムが必要
  - アイテム種別の識別とeffect_valueによる回復量の管理

### 要件 P-2: 回復計算式（固定値回復）
- **元ページ**: Page 3, 「回復計算式」セクション
- **抜粋**:
  > 計算式: 回復量 = スタミナドリンクの回復量
  > ※現在所持しているスタミナが999の場合や、回復量に対して切り捨てになるパターンでは、確認ダイアログを表示するようにする。
- **サーバー観点での補足**:
  - 固定値をそのまま加算する単純な計算式
  - システム上限999を超える場合の切り捨て処理
  - 切り捨て発生時の事前確認（クライアント側）と、サーバー側での検証

### 要件 P-3: オーバーフロー（上限突破）仕様
- **元ページ**: Page 3, 「オーバーフロー（上限突破）仕様」セクション
- **抜粋**:
  > スタミナがスタミナ最大所持値の状態で回復アイテムを使用した際、最大値を超えてスタミナを加算（オーバーフロー）する。
  > 例）スタミナ最大値が100、現在スタミナが80の場合にスタミナ100回復するスタミナドリンクを1個使用すると、使用後のスタミナは、180 （80 + 100）/100になる。
- **サーバー観点での補足**:
  - ユーザーのスタミナ上限値を超えてスタミナを保持できる
  - ただしシステム上限999は超えられない
  - 上限突破状態の管理とデータ永続化

### 要件 P-4: 使用制限の挙動
- **元ページ**: Page 3, 「使用制限となる挙動」セクション
- **抜粋**:
  > ・アイテム所持数が0個の場合。
  > ・スタミナがシステム上の絶対上限値（999）に達している場合。
  > ⇨使用不可の場合は、回復しようとすると実装済みのスタミナ回復不可のダイアログが表示される。
  > ダイアログ文言は新しく左図の文言形式に変更する。
- **サーバー観点での補足**:
  - アイテム所持数が0の場合はエラー
  - スタミナが999の場合もエラー（既存のUSER_STAMINA_FULL相当）
  - エラー時のエラーコード返却とクライアント側でのダイアログ表示

### 要件 P-5: ダイアログ文言とシステム上限999の明示
- **元ページ**: Page 3, 「使用制限となる挙動」セクションのダイアログ画像
- **抜粋**:
  > スタミナの所持上限は 999となっているため、これ以上回復できません。
- **サーバー観点での補足**:
  - システム上限値999の管理と検証
  - エラー時にクライアント側で適切なメッセージを表示できるよう、エラーコードを返却

### 要件 P-6: スタミナ回復ダイアログの統一
- **元ページ**: Page 4, 「基本仕様_ダイアログに関して」セクション
- **抜粋**:
  > ヘッダーのスタミナ+をタップで表示するダイアログもこのダイアログ形式に統一する。
  > 既存のダイアログの構成を見直し、スタミナ回復可能なアイテム、方法（広告視聴）など回復方法と所持リソースを全て表示する。
- **サーバー観点での補足**:
  - スタミナ回復可能なアイテム一覧の取得APIが必要（要確認）
  - 各回復方法の実行可否判定（残り回数、所持数など）

### 要件 P-7: 確認ダイアログでの複数個使用
- **元ページ**: Page 4, 「確認ダイアログ（3種-左図のように文言調整含め行う）」セクション
- **抜粋**:
  > スタミナドリンクでスタミナ回復を行う場合、確認ダイアログを表示し、使用可能な個数まで選択して使用することができる。
  > 交換選択数は±1と最大、最小ボタンから選択できる。
  > デフォルトは常に1が表示される。
- **サーバー観点での補足**:
  - 1回のAPI呼び出しで複数個のアイテムを同時に使用
  - 使用個数のバリデーション（所持数以下、かつシステム上限999を超えない範囲）

### 要件 P-8: システム上限999までの回復可能範囲
- **元ページ**: Page 4, 「確認ダイアログ」セクション
- **抜粋**:
  > スタミナ所持上限値以上のスタミナ回復は、999まで可能とする。
  > 例）10/500の場合
  > スタミナドリンク100を5本使用で500スタミナ回復できる。
  > この時点で、このユーザーのスタミナ所持上限値超えているが、スタミナドリンク100をまだ5本以上所持していれば、その後追加で500回復し、999まで回復できる。ただし、999を超える合計になる場合は、超えた分の回復スタミナは、切り捨てになる。
- **サーバー観点での補足**:
  - ユーザーのスタミナ上限値（レベル依存）とシステム上限999の区別
  - ユーザー上限を超えても999まで回復可能
  - 999を超える分は切り捨て

### 要件 P-9: 使用可能個数の計算とボタン制御
- **元ページ**: Page 4, 「確認ダイアログ」セクション
- **抜粋**:
  > 確認ダイアログでは、所持しているスタミナドリンクが0になるまでかつスタミナ最大所持上限の999まで+1、+10、最大ボタンをそれぞれ押すことができる。これを満たさなくなった場合に+1、+10、最大ボタンはグレーアウトし、タップできない。
- **サーバー観点での補足**:
  - 使用可能な最大個数の計算ロジック
  - クライアント側でボタン制御するための情報提供（または事前計算API）

### 要件 P-10: アイテム詳細ダイアログの獲得先表示
- **元ページ**: Page 4, 「その他」セクション
- **抜粋**:
  > スタミナドリンクのアイコンをタップして表示されるアイテム詳細ダイアログには獲得先として「ショップ」を必ず表示するように設定する。
- **サーバー観点での補足**:
  - マスタデータ設定（destination_opr_product_id）での獲得先情報管理
  - クライアント側での表示用データ提供

### 要件 P-11: 特許侵害リスクの考慮
- **元ページ**: Page 5, 「特許侵害リスクについて」セクション
- **抜粋**:
  > 「回復アイテムや通貨を使用した際に、スタミナが上限値を超えて加算される（切り捨てられない）」という仕様に関して、過去にいくつかの重要な特許が出願・成立しています。
  > 特に有名なのが、コナミデジタルエンタテインメント社などが保有していた特許群です。
- **サーバー観点での補足**:
  - オーバーフロー仕様の実装における法的リスクの認識
  - 特許期間満了等の確認が必要（企画・法務部門での対応事項）

### 要件 P-12: プリズムと広告視聴の上限変更（追加確認事項）
- **元ページ**: ゲーム体験仕様書_追加確認事項.md
- **抜粋**:
  > プリズム、広告視聴のスタミナ回復の上限もシステム上限999に変更
- **サーバー観点での補足**:
  - 既存のプリズム購入（全回復）と広告視聴（50%回復）の上限チェックロジックを変更
  - ユーザー上限ではなくシステム上限999でチェック

### 要件 P-13: 部分回復の許容（追加確認事項）
- **元ページ**: ゲーム体験仕様書_追加確認事項.md
- **抜粋**:
  > 一部回復できて、一部切り捨てのケースでは、回復はできる
  > 例：901 + 100 の回復はできるが、999になる。2は切り捨て。
  > 全て切り捨てのケースでは、回復不可。サーバーエラーを出して、エラーダイアログ出す。
- **サーバー観点での補足**:
  - 部分回復可能なケースと完全拒否のケースの判定ロジック
  - 999の場合は全て切り捨てなのでエラー
  - 901 + 100の場合は98回復するので許可

### 要件 P-14: 既存実装（割合回復）の保持（追加確認事項）
- **元ページ**: ゲーム体験仕様書_追加確認事項.md
- **抜粋**:
  > サーバー実装済みの割合回復(StaminaRecoveryPercent)の実装は残しておく
- **サーバー観点での補足**:
  - 既存のStaminaRecoveryPercentアイテム種別は削除せず継続サポート
  - 固定値回復と割合回復の両方をサポートする設計

---

## 4. コード調査からの追加要件

### 4.1 既存実装との関連

| 発見箇所 | 既存実装 | 新機能との関連 |
|----------|----------|----------------|
| api/app/Domain/Item/Enums/ItemType.php:32 | ItemType::STAMINA_RECOVERY_PERCENT | 割合回復アイテム。新たに固定値回復アイテム種別が必要 |
| api/app/Domain/Item/Services/ItemStaminaRecoveryService.php | applyStaminaRecoveryPercent() | 割合回復専用サービス。固定値回復用の新メソッドが必要 |
| api/app/Domain/User/Services/UserBuyStaminaService.php:98-133 | calcAndValidateAddStamina() | プリズム・広告のスタミナ回復検証ロジック。上限チェックをシステム上限999に変更 |
| api/app/Domain/User/Constants/UserConstant.php:24 | MAX_STAMINA = 999 | システム上限の定数定義 |
| api/app/Domain/Common/Constants/ErrorCode.php:211,214 | USER_STAMINA_FULL, USER_STAMINA_EXCEEDS_LIMIT | 既存エラーコード。新仕様での再利用 |

### 4.2 確定要件（PDF記載あり）

#### 要件 C-1: システム上限値999の定数管理
- **分類**: 確定要件
- **発見箇所**: `api/app/Domain/User/Constants/UserConstant.php:24`
- **PDF出典**: Page 3（要件 P-5 に対応）
- **コード内容**:
  ```php
  /** @var int スタミナのシステム上限 */
  public const MAX_STAMINA = 999;
  ```
- **追加要件の説明**:
  - システム上限999は既に定数として定義済み
  - この値を超える回復は許可されない

#### 要件 C-2: エラーコードの定義
- **分類**: 確定要件
- **発見箇所**: `api/app/Domain/Common/Constants/ErrorCode.php:211,214`
- **PDF出典**: Page 3（要件 P-4 に対応）
- **コード内容**:
  ```php
  public const USER_STAMINA_FULL = 4003;
  public const USER_STAMINA_EXCEEDS_LIMIT = 4004;
  ```
- **追加要件の説明**:
  - USER_STAMINA_FULL: スタミナが上限に達している場合のエラー
  - USER_STAMINA_EXCEEDS_LIMIT: システム上限を超える場合のエラー
  - 新仕様でも同じエラーコードを使用可能

#### 要件 C-3: 既存の割合回復実装
- **分類**: 確定要件
- **発見箇所**: `api/app/Domain/Item/Services/ItemStaminaRecoveryService.php:29-54`
- **PDF出典**: 追加確認事項（要件 P-14 に対応）
- **コード内容**:
  ```php
  public function applyStaminaRecoveryPercent(
      string $usrUserId,
      MstItemEntity $mstItem,
      int $amount,
      CarbonImmutable $now
  ): void {
      $userLimitStaminaPercent = (int) $mstItem->getEffectValue();
      $userStaminaRecoverySummary = $this->userDelegator->recoverStaminaByParam(
          $usrUserId,
          $now,
          $userLimitStaminaPercent,
          $amount,
      );
      // 使用可能個数検証
      $this->validateUsingStaminaRecoveryPercentItem($userStaminaRecoverySummary, $amount);
      // アイテム消費
      $this->usrItemService->consumeItem(...);
  }
  ```
- **追加要件の説明**:
  - 既存の割合回復機能はそのまま維持
  - 固定値回復は別メソッドとして実装

#### 要件 C-4: 自然回復の適用
- **分類**: 確定要件
- **発見箇所**: `api/app/Domain/User/Services/UserBuyStaminaService.php:98`
- **PDF出典**: Page 3（暗黙の前提、既存実装と同様）
- **コード内容**:
  ```php
  $usrUserParameter = $this->userService->recoveryStamina($usrUserId, $now);
  $beforeStamina = $usrUserParameter->getStamina();
  ```
- **追加要件の説明**:
  - アイテム使用前に自然回復を適用
  - 自然回復後のスタミナ値を基準に回復処理を実行

### 4.3 推定要件（要確認）

#### 要件 C-5: 固定値回復アイテムの種別定義【要確認】
- **分類**: 推定要件（要確認）
- **発見箇所**: `api/app/Domain/Item/Enums/ItemType.php`
- **既存実装**: StaminaRecoveryPercent が割合回復用に定義されている
- **不明点**: 固定値回復用の新しいItemTypeをどう定義するか
  - A案: `StaminaRecoveryFixed` という新しい種別を追加
  - B案: `StaminaRecoveryPercent` を汎用的な `StaminaRecovery` にリネームし、effect_value の値で判定
  - C案: 既存の `Etc` 種別を使用し、別の識別方法を導入
- **影響**: アイテム使用時の処理分岐、マスタデータ設計、glow-schema定義
- **推奨**: プランナー確認項目に追加（A案が妥当と思われるが、命名やマスタ設計を確認）

#### 要件 C-6: プリズム・広告回復の上限変更範囲【要確認】
- **分類**: 推定要件（要確認）
- **発見箇所**: `api/app/Domain/User/Services/UserBuyStaminaService.php:108-114`
- **既存実装**:
  ```php
  if ($userLimitStamina <= $beforeStamina) {
      // スタミナ購入前の時点で最大値を超えている場合はエラー(最大値とイコールの場合は購入不可)
      throw new GameException(ErrorCode::USER_STAMINA_FULL, ...);
  }
  ```
- **不明点**: 上限チェックをシステム上限999に変更するのは、どの回復方法か
  - 現状: ユーザー上限（レベル依存）でチェック
  - 新仕様: システム上限999でチェック
  - 対象: プリズム購入、広告視聴、固定値アイテム、割合アイテム すべて？
- **影響**: UserBuyStaminaService の calcAndValidateAddStamina() の修正範囲
- **推奨**: プランナー確認項目に追加（追加確認事項には「プリズム、広告視聴」とあるが、既存の割合回復アイテムも含むか確認）

#### 要件 C-7: 部分回復時のエラーハンドリング【要確認】
- **分類**: 推定要件（要確認）
- **発見箇所**: `api/app/Domain/User/Services/UserBuyStaminaService.php:119-125`
- **既存実装**:
  ```php
  if ($this->mstConfigService->getUserStaminaMaxAmount() < $beforeStamina + $addStamina) {
      // 購入によってシステム上限を超える場合はエラー
      throw new GameException(ErrorCode::USER_STAMINA_EXCEEDS_LIMIT, ...);
  }
  ```
- **不明点**: 部分回復を許容する場合のロジック
  - 現状: 回復後に999を超える場合は全てエラー
  - 新仕様: 999の場合のみエラー、901+100のような場合は98回復して許可
  - 実装方針: エラーthrowせず、min(beforeStamina + addStamina, 999) で計算？
- **影響**: calcAndValidateAddStamina() と addStamina() の修正が必要
- **推奨**: プランナー確認項目に追加（部分回復のロジックと、クライアント側への通知方法を確認）

#### 要件 C-8: 複数個使用時のバリデーション【要確認】
- **分類**: 推定要件（要確認）
- **発見箇所**: `api/app/Domain/Item/Services/ItemStaminaRecoveryService.php:59-83`
- **既存実装**:
  ```php
  public function validateUsingStaminaRecoveryPercentItem(UserStaminaRecoverySummary $summary, int $amount): void
  {
      // 使用可能な最大個数を計算
      $maxUsableAmount = (int) ceil(($userLimitStamina - $beforeStamina) / $baseAddStamina);
      if ($amount > $maxUsableAmount) {
          throw new GameException(ErrorCode::INVALID_PARAMETER, ...);
      }
  }
  ```
- **不明点**: 固定値回復での使用可能個数の計算方法
  - 割合回復: ユーザー上限まで使用可能個数を計算
  - 固定値回復: システム上限999まで使用可能個数を計算？
  - 部分回復許容の場合: 999を1でも超えなければOK？ それとも999ちょうどまで？
- **影響**: 固定値回復用のバリデーションメソッドの実装
- **推奨**: プランナー確認項目に追加（クライアント側の±1ボタン、最大ボタンの制御との整合性を確認）

#### 要件 C-9: スタミナ回復一覧API【要確認】
- **分類**: 推定要件（要確認）
- **発見箇所**: PDF要件 P-6（スタミナ回復ダイアログの統一）
- **既存実装**: 現状、スタミナ回復可能なアイテム一覧を取得するAPIは存在しない
- **不明点**: クライアント側で回復ダイアログに全回復方法を表示する際、サーバー側で一覧APIを提供するか
  - A案: 各回復方法の実行可否をサーバー側で判定し、一覧APIで返却
  - B案: クライアント側でマスタデータから判定
- **影響**: 新しいAPIエンドポイントの追加が必要になる可能性
- **推奨**: プランナー確認項目に追加（クライアント側の実装方針を確認）

### 4.4 技術的制約

#### 要件 C-10: mst_itemsテーブルの構造
- **分類**: 技術的制約
- **発見箇所**: mst_items テーブル定義
- **テーブル内容**:
  ```
  type: enum(...) (MUL)
  effect_value: varchar(255)
  ```
- **追加要件の説明**:
  - 新しいItemTypeを追加する場合、glow-schemaのItem.ymlとマイグレーションが必要
  - effect_valueには固定値（"10", "100"）を文字列として格納
  - 既存のenum値にStaminaRecoveryPercentが含まれていないため、過去のマイグレーションで追加済み

#### 要件 C-11: アイテム消費のログ記録
- **分類**: 技術的制約
- **発見箇所**: `api/app/Domain/Item/Services/ItemStaminaRecoveryService.php:48-53`
- **コード内容**:
  ```php
  $this->usrItemService->consumeItem(
      $usrUserId,
      $mstItem->getId(),
      $amount,
      new StaminaRecoveryLogTrigger(),
  );
  ```
- **追加要件の説明**:
  - アイテム消費時にログを記録する仕組みは既存実装で完備
  - StaminaRecoveryLogTriggerを使用してログトリガーを記録
  - 固定値回復でも同じ仕組みを利用可能

#### 要件 C-12: スタミナ加算処理
- **分類**: 技術的制約
- **発見箇所**: `api/app/Domain/User/Services/UserService.php` (推測)
- **追加要件の説明**:
  - UserService::addStamina() でスタミナ加算処理を実行
  - usrテーブルへの書き込みとログ記録を行う
  - トランザクション制御が必要（アイテム消費とスタミナ加算は同一トランザクション内）

---

## 5. 統合要件一覧

### カテゴリ A: アイテム管理

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-A-1 | 固定値回復アイテム種別の定義 | PDF P-1, Code C-5 | StaminaRecoveryFixed（仮称）の新規ItemType定義 |
| REQ-A-2 | 割合回復アイテムの継続サポート | PDF P-14, Code C-3 | 既存のStaminaRecoveryPercentは削除せず維持 |
| REQ-A-3 | アイテム所持数管理 | Code C-11 | 既存のUsrItemServiceを利用した所持数管理 |
| REQ-A-4 | アイテム消費処理 | Code C-11 | 消費時のログ記録とトリガー情報の保存 |

### カテゴリ B: スタミナ回復計算

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-B-1 | 固定値回復量の計算 | PDF P-2 | effect_valueをそのまま加算（例: "100" → 100回復） |
| REQ-B-2 | 割合回復量の計算 | Code C-3 | ユーザー上限値 × effect_value / 100（例: "50" → 50%回復） |
| REQ-B-3 | 自然回復の事前適用 | Code C-4 | アイテム使用前に自然回復を適用 |
| REQ-B-4 | 複数個使用時の回復量計算 | PDF P-7 | 回復量 × 個数で計算 |

### カテゴリ C: 上限管理とオーバーフロー

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-C-1 | システム上限999の定義 | PDF P-5, Code C-1 | MAX_STAMINA = 999 定数を使用 |
| REQ-C-2 | ユーザー上限の超過許可 | PDF P-3, P-8 | レベル依存の上限を超えてもシステム上限999まで回復可能 |
| REQ-C-3 | システム上限999の厳守 | PDF P-2, P-8 | 999を超える回復は切り捨て |
| REQ-C-4 | 部分回復の許容 | PDF P-13, Code C-7 | 一部でも回復できる場合は許可（例: 901+100→999） |
| REQ-C-5 | 全切り捨て時のエラー | PDF P-13 | 999の状態で回復しようとした場合はエラー |

### カテゴリ D: 使用制限とバリデーション

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-D-1 | アイテム所持数チェック | PDF P-4 | 所持数0の場合はエラー |
| REQ-D-2 | スタミナ満タンチェック | PDF P-4, Code C-2 | スタミナ999の場合はUSER_STAMINA_FULLエラー |
| REQ-D-3 | 使用可能個数の計算 | PDF P-9, Code C-8 | システム上限999までの使用可能個数を計算 |
| REQ-D-4 | 複数個使用時のバリデーション | PDF P-7, Code C-8 | 指定個数が使用可能範囲内かチェック |

### カテゴリ E: プリズム・広告回復の変更

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-E-1 | プリズム回復の上限変更 | PDF P-12, Code C-6 | ユーザー上限ではなくシステム上限999でチェック |
| REQ-E-2 | 広告回復の上限変更 | PDF P-12, Code C-6 | ユーザー上限ではなくシステム上限999でチェック |
| REQ-E-3 | プリズム・広告での部分回復 | PDF P-13, Code C-7 | 固定値アイテムと同様に部分回復を許容 |

### カテゴリ F: エラーハンドリング

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-F-1 | USER_STAMINA_FULLエラー | PDF P-4, Code C-2 | スタミナ999の場合に返却 |
| REQ-F-2 | ITEM_NOT_OWNEDエラー | 既存実装 | アイテム所持数不足の場合に返却 |
| REQ-F-3 | INVALID_PARAMETERエラー | Code C-8 | 使用個数が範囲外の場合に返却 |

### カテゴリ G: UI連携（要確認）

| 要件ID | 要件タイトル | 出典 | 概要 |
|--------|-------------|------|------|
| REQ-G-1 | スタミナ回復一覧API | PDF P-6, Code C-9 | 全回復方法の実行可否を返却するAPI（要確認） |
| REQ-G-2 | 使用可能個数の事前計算 | PDF P-9 | クライアント側のボタン制御用の情報提供（要確認） |
| REQ-G-3 | 部分回復時の通知 | PDF P-13 | 切り捨てが発生することをクライアント側に通知する方法（要確認） |

---

## 6. 不明点・曖昧な点

以下の点は、次のステップ（仕様確認）でプランナーに確認が必要です。

| No | 不明点 | 影響範囲 | 想定される選択肢 |
|----|--------|----------|------------------|
| 1 | 固定値回復アイテムの種別名 | マスタデータ設計、ItemType Enum定義 | A案: `StaminaRecoveryFixed`<br/>B案: `StaminaRecovery`に統一して値で判定<br/>C案: その他の命名 |
| 2 | プリズム・広告回復での上限変更範囲 | UserBuyStaminaServiceの修正範囲 | A案: プリズム・広告のみ変更<br/>B案: 割合回復アイテムも含めて全て変更 |
| 3 | 部分回復時のクライアント通知方法 | レスポンス設計 | A案: 実際の回復量をレスポンスに含める<br/>B案: 切り捨て発生フラグを返す<br/>C案: クライアント側で計算 |
| 4 | 複数個使用時の使用可能個数計算 | バリデーションロジック | A案: システム上限999ちょうどまで<br/>B案: 999を1でも超えなければOK |
| 5 | スタミナ回復一覧APIの必要性 | 新規APIエンドポイント追加の有無 | A案: サーバー側で一覧APIを提供<br/>B案: クライアント側でマスタから判定 |
| 6 | 既存の割合回復アイテムの上限変更 | 既存機能への影響 | A案: 割合回復もシステム上限999に変更<br/>B案: 割合回復はユーザー上限のまま維持 |
| 7 | スタミナドリンクの回復量バリエーション | マスタデータ設定 | 仕様書には10, 50, 100とあるが、他の値も設定可能か？ |
| 8 | 特許侵害リスクの確認状況 | リリース可否判断 | 企画・法務部門での確認状況を確認 |

---

## 7. 次のステップ

- [ ] 不明点についてプランナー/企画担当に確認
- [ ] 確認結果をもとに仕様確認ドキュメント（02_仕様確認.md）を作成
- [ ] 技術的実装方針の決定（ItemType定義、バリデーションロジック等）
- [ ] 既存実装への影響範囲の精査（プリズム・広告回復の変更範囲）
