# ゲーム体験仕様確認結果まとめ - 交換所機能

**機能名**: 交換所の実装
**バージョン**: v.1.4.0
**確認結果まとめ作成日**: 2025-11-26

---

## 1. 確認実施概要

- **確認日時**: 2025-11-26
- **確認方法**: ドキュメントベース（プランナー確認結果）
- **確認者**: プランナー（ゲーム企画担当者）

---

## 2. 確認結果サマリー

- **確認項目総数**: 13 項目（Q1～Q13）
- **完全に解決**: 8 項目（Q2, Q3, Q4, Q6, Q7, Q9, Q11, Q12, Q13）
- **部分的に解決**: 3 項目（Q1, Q5, Q8）
- **未解決**: 0 項目
- **追加確認が必要**: 2 項目（Q1の詳細仕様、Q5のデータ構造設計）

### 総合評価

- **全体的な仕様確定度**: 約 85%
- **サーバー実装開始可否**: **条件付きで可能**
  - Q1（複数リソース消費）の詳細設計が必要
  - Q5（タブ分類）はサーバー側考慮不要と判明し、実装負荷が軽減

---

## 3. 各不明点の確認結果

### 3.1 仕様の明確化（仕様書に記載がなく判断不能だった項目）

#### 項目 Q1: 複数リソース消費の対応

- **元の不明点:**
  - 1つのラインナップで複数種類のリソース（例: コイン1000 + アイテムA×10）を同時に消費する仕様は必要ですか？
  - 工数見積もりに「複数リソース消費が必要なら+3人日」とありますが、これは実装対象ですか？

- **ゲーム体験仕様確認結果:**
  - **実装必要**

- **解決状況**: **部分的に解決**

- **確定した仕様:**
  - 複数リソース消費の機能は実装する
  - 1つのラインナップで複数種類のコスト（例: コイン + アイテム）を同時に消費できる

- **備考:**
  - **追加確認が必要**: 以下の詳細仕様が未確定
    - 複数リソース消費の最大組み合わせ数（2種類まで？ 3種類以上？）
    - 複数リソース消費時のバリデーション順序（どのリソースから先にチェックするか）
    - 複数リソース消費時のトランザクション順序（どのリソースから先に消費するか）
    - 複数リソース消費時のログ出力形式（JSON配列？複数レコード？）
  - **サーバー実装への影響:**
    - テーブル設計の変更が必要（交換コストテーブルの1:N化、または正規化）
    - バリデーションロジックの拡張が必要
    - APIレスポンス形式の拡張が必要
    - 工数見積もり: +3人日

---

#### 項目 Q2: 通算交換回数の用途

- **元の不明点:**
  - `trade_total_count`（通算交換回数）は、ログ分析専用ですか？それともゲーム仕様として使用しますか？
  - ゲーム仕様として使用する場合、どのような場面で使用しますか？（例: 「通算100回交換でバッジ獲得」等）
  - ミッションシステムと連携する必要はありますか？

- **ゲーム体験仕様確認結果:**
  - **使うので記録しておく**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - `trade_total_count`はゲーム仕様として使用する
  - 通算交換回数を記録し続ける必要がある
  - リセット対象外（永続カウンタ）

- **備考:**
  - 具体的な使用場面（バッジ、ミッション連携等）の言及はないが、「使う」と明言されたため、実装する
  - クライアントへのレスポンスに`trade_total_count`を含める必要がある
  - ミッション連携の有無は不明だが、将来的に連携する可能性を考慮し、拡張可能な設計にする

---

#### 項目 Q3: リセット処理の実行方式

- **元の不明点:**
  - 通常交換所の「毎月初日04:00リセット」は、バッチ処理で一括リセットしますか？それともユーザーのアクセス時に判定してリセットしますか？
  - 既存のShop機能はアクセス時判定ですが、交換所も同様で良いですか？
  - 大量のユーザーが同時にアクセスした際のパフォーマンスは考慮する必要がありますか？

- **ゲーム体験仕様確認結果:**
  - **バッチはしない。ユーザーのアクセス時に判定してリセットする。ショップアイテムの既存実装を参考にする。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - リセット処理はバッチ処理ではなく、ユーザーのアクセス時に判定して実行する
  - 既存のShop機能と同様の実装パターンを採用する
  - `Clock::isFirstMonth(last_reset_at)`メソッドを使用してリセット判定を行う
  - リセットが必要な場合、`trade_count`を0にリセットする

- **備考:**
  - 既存実装を参考にすることが明示されたため、実装方針が明確
  - バッチ処理基盤の整備が不要となり、実装が簡素化される
  - パフォーマンス懸念は、既存Shop機能で問題が発生していないことから、交換所でも問題ないと判断

---

#### 項目 Q4: 原画アイテムの実装方法

- **元の不明点:**
  - 原画を交換した際の「16ピース分の演出」は、サーバー側で16個のアイテムとして付与しますか？それとも1個のアイテムを付与してクライアント側で16ピース演出しますか？
  - 原画アイテムを識別するための専用フラグやタイプは定義されていますか？
  - 原画の交換に必要なコスト（リソース）の設定はどのようにしますか？

- **ゲーム体験仕様確認結果:**
  - **原画のかけらも原画も付与して、完全に完成した状態でユーザーデータに記録する**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - 原画を交換した際、サーバーは以下を付与する：
    1. 原画アイテム（完成品）
    2. 原画のかけら16個（全てのピース）
  - 付与後のユーザーデータは「完全に完成した状態」として記録される
  - クライアント側で16ピース演出を実行するために必要なデータ（かけら16個）をサーバーが提供する

- **備考:**
  - 実装方式が明確になった
  - RewardDelegatorで以下の2つの報酬を登録する：
    1. 原画アイテム（Item、数量1）
    2. 原画のかけら（Item、数量16）
  - 原画の交換コスト設定については明示的な回答がないため、マスタデータでの設定に委ねられる

---

#### 項目 Q5: アイテムBOXのタブ分類方法

- **元の不明点:**
  - アイテムBOXの3タブ（消費・強化・かけら）の分類は、既存のItemGroupTypeを拡張しますか？それとも新しいenum（ItemTabType等）を定義しますか？
  - 既存のItemGroupTypeは2種類（Consumable, Etc）のみですが、3タブ分類とどのように対応させますか？
  - 各アイテムのタブ分類は、マスタデータでどのように管理しますか？

- **ゲーム体験仕様確認結果:**
  - **考慮不要**

- **解決状況**: **部分的に解決**

- **確定した仕様:**
  - アイテムBOXのタブ分類はクライアント側で行う
  - サーバー側でタブ分類のためのenum追加やマスタデータ拡張は不要
  - サーバーは既存のItemGroupTypeやItemTypeをそのまま返却すれば良い

- **備考:**
  - サーバー側の実装負荷が大幅に軽減された
  - 売却可否の判定ロジックが不要になったことで、法務的リスクの実装も不要に
  - **追加確認が必要**: クライアント側でタブ分類を行う場合、どの項目（ItemType、ItemGroupType、その他）を使用して判定するかをクライアント側と合意が必要

---

### 3.2 境界条件の明確化

#### 項目 Q6: まとめて交換時の初期個数とデフォルト値

- **元の不明点:**
  - 交換確認ダイアログを開いた際の初期交換個数は何個ですか？
  - 1個固定、最大個数、前回値のいずれですか？
  - ±ボタンで個数を減らした際の最小値は1個（0個にはならない）で良いですか？

- **ゲーム体験仕様確認結果:**
  - **画面仕様なのでサーバー考慮不要。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - 初期交換個数の設定はクライアント側の画面仕様
  - サーバー側では特別な対応は不要
  - サーバーは交換個数のバリデーション（1個以上、上限以下、所持リソース十分）のみを実施

- **備考:**
  - サーバー側の実装負荷が軽減された
  - 既存の交換個数バリデーションロジックをそのまま使用可能

---

#### 項目 Q7: リソース不足時の表示形式

- **元の不明点:**
  - リソース不足時の表示形式を全画面で統一したい（Page 13記載）ですが、どの形式に統一しますか？
  - 「-10」（不足量を赤字で表示）
  - 「90/100」（所持数/必要数を赤字で表示）
  - その他の形式
  - サーバーが返却するデータ形式は？（不足量、所持数、必要数、全て）

- **ゲーム体験仕様確認結果:**
  - **UIなのでサーバー考慮不要。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - リソース不足時の表示形式はクライアント側のUI仕様
  - サーバー側では特別な対応は不要
  - サーバーは既存のエラーレスポンス（`LACK_OF_RESOURCES`エラーコード）を返却すれば良い

- **備考:**
  - サーバー側の実装負荷が軽減された
  - 既存のエラーハンドリングロジックをそのまま使用可能

---

#### 項目 Q8: 復刻イベント時の交換履歴の扱い

- **元の不明点:**
  - イベント交換所を復刻する際、ユーザーの過去の交換履歴は引き継ぎますか？それともリセット（新規）しますか？
  - 例: 初回開催時に交換上限10回のうち5回交換済みの場合、復刻時は残り5回か、リセットして10回か？
  - 復刻時は「交換所IDを新規で切り直す」（Page 6記載）とありますが、交換履歴は完全に別管理で良いですか?

- **ゲーム体験仕様確認結果:**
  - **リセットとかはしない。実装で対応するのではなく、ラインナップはそのままで、交換所IDを切り替えることで復刻データを作る想定。**

- **解決状況**: **部分的に解決**

- **確定した仕様:**
  - 復刻時、実装でリセット処理を行う必要はない
  - マスタデータ運用で対応する：
    - 復刻時は新しい交換所IDを発行する
    - ラインナップは同じ内容を再設定する
  - 新しい交換所IDに対応するユーザー交換履歴は新規作成される（自動的に交換回数0からスタート）

- **備考:**
  - マスタデータ運用によって実装負荷が軽減された
  - 交換所IDと交換履歴の紐付けは既存のShop機能と同様の実装で対応可能
  - **曖昧な点**: 「ラインナップはそのまま」という表現が、「既存のラインナップIDを再利用する」のか「同じ内容の新しいラインナップIDを作成する」のかが不明
    - 実装上は、新しい交換所IDに紐付く新しいラインナップIDを作成する方が安全（データの独立性が保たれる）
    - 追加確認が望ましいが、新規ラインナップIDを作成する前提で実装すれば問題ない

---

### 3.3 UI/UX関連の確認

#### 項目 Q9: 交換上限到達後の表示

- **元の不明点:**
  - 交換上限到達後のボタン表示は「交換済み」（Page 7記載）ですが、リセット後に再び交換可能になる場合、ユーザーが誤解しませんか？
  - 「今月は交換済み」「残り0回」等の表示の方が分かりやすいのでは？
  - リセット日時の表示は必要ですか？（例: 「次回リセット: 12/1 04:00」）

- **ゲーム体験仕様確認結果:**
  - **UIなのでサーバー考慮不要。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - 交換上限到達後の表示はクライアント側のUI仕様
  - サーバー側では特別な対応は不要
  - サーバーは現在の交換回数（`trade_count`）と交換上限（`tradable_count`）を返却すれば良い

- **備考:**
  - サーバー側の実装負荷が軽減された
  - リセット日時の計算が必要な場合は、クライアント側で`last_reset_at`と現在時刻から算出可能

---

#### 項目 Q10: イベント交換所の期限切れ後の猶予期間

- **元の不明点:**
  - イベント交換所は、イベント終了後すぐに非表示になりますか？それとも猶予期間（例: 1日）がありますか？
  - イベント報酬を交換し損ねたユーザーへの配慮として、猶予期間を設ける必要はありますか？
  - イベント終了とメンテナンス開始が重なった場合の対応は？

- **ゲーム体験仕様確認結果:**
  - **すぐ非表示になる。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - イベント交換所は、イベント終了（`end_date`）後すぐに非表示になる
  - 猶予期間は設けない
  - サーバー側で`end_date < 現在時刻`の交換所をフィルタリングして除外する

- **備考:**
  - 実装はシンプル（既存の開催期間フィルタリングロジックをそのまま使用）
  - ユーザー体験への配慮（交換し損ね）は、プランナー側で承知の上での仕様と判断

---

### 3.4 実装優先度の確認

#### 項目 Q11: 売却機能の実装タイミング

- **元の不明点:**
  - アイテムBOXの売却機能は、交換所機能と同時に実装しますか？それとも別タイミングですか？
  - 同時実装の場合、売却価格の設定方法は？（アイテムごとに個別設定 or レアリティごとの一律価格）
  - 売却時のコイン換算レートはどのように管理しますか？

- **ゲーム体験仕様確認結果:**
  - **売却なんてないので考慮不要。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - 売却機能は実装しない
  - 交換所機能にアイテム売却は含まれない

- **備考:**
  - 仕様書の記載（Page 9, 10）に売却機能の言及があったが、実装不要と確定
  - サーバー側の実装負荷が大幅に軽減された
  - 法務的制約（消費タブの売却禁止）の実装も不要に

---

#### 項目 Q12: キャラのかけら表示順序のカスタマイズ

- **元の不明点:**
  - 「表示順をキャラ一覧のデフォルトの表示順に合わせて表示する（できたら）」（Page 9記載）の優先度はどのくらいですか？
  - 必須要件か、Nice to Haveか？
  - 実装しない場合のデフォルト表示順（キャラID順、レアリティ順等）はどうしますか？

- **ゲーム体験仕様確認結果:**
  - **サーバー考慮不要。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - キャラのかけら表示順序はクライアント側で制御する
  - サーバー側では特別なソート処理は不要
  - サーバーはアイテムをそのまま返却すれば良い（既存のアイテム取得APIと同様）

- **備考:**
  - サーバー側の実装負荷が軽減された
  - クライアント側でソート処理を実装することで、柔軟な表示順変更が可能に

---

#### 項目 Q13: 初回無料フラグの実装有無

- **元の不明点:**
  - 交換所機能で「初回無料」の仕組みを実装する予定はありますか？
  - 既存のShop機能には`is_first_time_free`フラグがありますが、交換所でも同様のフラグを実装しますか？
  - 実装する場合、どのようなラインナップで使用する想定ですか？

- **ゲーム体験仕様確認結果:**
  - **交換所では不要。**

- **解決状況**: **完全に解決**

- **確定した仕様:**
  - 初回無料フラグは実装しない
  - マスタテーブルから`is_first_time_free`カラムを除外可能

- **備考:**
  - テーブル設計が簡素化された
  - 交換処理のロジックも簡素化された（初回無料判定の分岐が不要）

---

### 3.5 仕様書とコードの不一致（該当項目なし）

サーバー仕様レビューでは「B. 仕様書とコードの不一致」として以下の項目が挙げられていましたが、プランナー確認結果に直接的な言及がないため、コード実装時に対応します。

#### 参考: B-1 交換コストのタイプ定義

- **問題点**: 仕様書では「アイテム、リソース、専用通貨」が交換コストと記載されているが、既存のShopItemCostTypeには`ITEM`タイプの実装例がない
- **対応方針**: Q1で「複数リソース消費が必要」と確定したため、実装時にShopItemCostTypeに`ITEM`を追加し、ItemService経由で消費処理を実装する

#### 参考: B-2 初回無料フラグの有無

- **問題点**: 既存のShop機能には初回無料フラグがあるが、交換所機能でも実装するかが不明
- **対応方針**: Q13で「交換所では不要」と確定したため、実装しない

---

## 4. 残存する不明点・追加確認が必要な項目

### 4.1 まだ不明な点

#### 不明点1: 複数リソース消費の詳細仕様（Q1関連）

- **何が不明なのか:**
  - 複数リソース消費の最大組み合わせ数（2種類まで？ 3種類以上？ 無制限？）
  - 複数リソース消費時のバリデーション順序（どのリソースから先にチェックするか）
  - 複数リソース消費時のトランザクション順序（どのリソースから先に消費するか）
  - 複数リソース消費時のログ出力形式（JSON配列？複数レコード？）

- **追加で確認すべき内容:**
  - プランナーに以下を確認：
    - 複数リソース消費の具体的なユースケース（例: コイン1000 + アイテムA×10）
    - 最大何種類のリソースを同時消費する想定か
  - テーブル設計への影響を評価：
    - 交換コストテーブルを正規化（1:N）するか
    - 1レコードに複数カラム（cost_type_1, cost_id_1, cost_amount_1, cost_type_2, ...）を持たせるか

- **実装への影響:**
  - テーブル設計、バリデーションロジック、APIレスポンス形式に影響
  - 工数見積もり: +3人日

- **対応方針:**
  - 次のStageで詳細設計時に再確認
  - 暫定的には「2種類まで」の複数リソース消費を想定して設計を進める

---

#### 不明点2: アイテムタブ分類のクライアント側実装方針（Q5関連）

- **何が不明なのか:**
  - クライアント側でタブ分類を行う際、どの項目（ItemType、ItemGroupType、その他）を使用して判定するか
  - サーバー側が返却するデータ形式に追加が必要か

- **追加で確認すべき内容:**
  - クライアント側の実装担当者に確認：
    - タブ分類の判定に使用するマスタデータ項目
    - サーバー側から追加で返却してほしいデータ項目があるか

- **実装への影響:**
  - サーバー側のAPIレスポンス形式に影響する可能性
  - ただし、Q5で「サーバー考慮不要」と確定したため、影響は最小限

- **対応方針:**
  - API設計時にクライアント側と仕様を合意する
  - 既存のItemマスタデータで判定可能と想定し、実装を進める

---

#### 不明点3: 復刻時のラインナップID運用（Q8関連）

- **何が不明なのか:**
  - 復刻時に「ラインナップはそのまま」という表現が、既存ラインナップIDを再利用するのか、同じ内容の新しいラインナップIDを作成するのか

- **追加で確認すべき内容:**
  - マスタデータ運用担当者（プランナー）に確認：
    - 復刻時のラインナップID運用方針
    - 既存ラインナップIDを再利用するか、新規作成するか

- **実装への影響:**
  - データの独立性、マスタデータ管理方式に影響
  - 実装上は新規ラインナップIDを作成する方が安全

- **対応方針:**
  - 暫定的には新規ラインナップIDを作成する前提で実装を進める
  - マスタデータ設計時に再確認

---

### 4.2 新たに発生した疑問点

#### 疑問点1: 原画のコスト設定

- **問題点:**
  - Q4の回答で原画の付与方法（原画 + かけら16個）は明確になったが、原画を交換するために必要なコストの設定方法については言及がない
  - 原画は高価値アイテムと推測されるが、交換コストの設定方針（例: 特別に高いコスト、通常のかけら交換と同等など）が不明

- **追加で確認すべき内容:**
  - プランナーに確認：
    - 原画の交換コストはどのように設定するか
    - 通常のかけら交換と比べて、原画のコスト設定に特別な考慮が必要か

- **実装への影響:**
  - マスタデータ設計、ゲームバランスに影響
  - ただし、実装上はマスタデータで設定可能なため、サーバー実装への直接的な影響は小さい

- **対応方針:**
  - マスタデータ設計時にプランナーと合意する
  - 暫定的には、マスタデータで柔軟にコスト設定できる実装とする

---

## 5. サーバー実装への影響評価

### 5.1 仕様確定度の評価

- **全体的な仕様確定度**: 約 85%
- **サーバー実装に必要な仕様が全て揃っているか**: **条件付きでYes**
  - **条件**: Q1（複数リソース消費）の詳細設計が完了していること
  - Q5（タブ分類）、Q11（売却機能）、Q13（初回無料）が実装不要と確定し、実装負荷が軽減された

- **揃っていない場合、何が足りないか:**
  - 複数リソース消費の詳細仕様（最大組み合わせ数、バリデーション順序、ログ形式等）
  - 上記が確定すれば、サーバー実装開始が可能

---

### 5.2 実装への影響

#### ゲーム体験仕様確認によって変更が必要になった箇所

1. **複数リソース消費の実装追加（Q1）**
   - テーブル設計: 交換コストテーブルの1:N化、または正規化
   - バリデーションロジック: 複数リソース所持数チェックの追加
   - トランザクション処理: 複数リソース消費処理の追加
   - APIレスポンス: 複数コスト情報の返却形式拡張
   - 工数見積もり: +3人日

2. **原画の付与方法の明確化（Q4）**
   - RewardDelegatorで以下の2つの報酬を登録：
     1. 原画アイテム（Item、数量1）
     2. 原画のかけら（Item、数量16）
   - 工数への影響: 既存のRewardDelegator実装で対応可能（追加工数なし）

3. **リセット処理の実装方式確定（Q3）**
   - 既存のShop機能と同様、アクセス時判定でリセット処理を実行
   - バッチ処理基盤の整備が不要に
   - 工数への影響: なし（既存実装を再利用）

#### 新たに追加実装が必要になった箇所

1. **複数リソース消費のサポート（Q1）**
   - 新規機能として実装が必要
   - 工数見積もり: +3人日

2. **原画の特別処理（Q4）**
   - 原画 + かけら16個の同時付与処理
   - ただし、既存のRewardDelegatorで対応可能
   - 工数への影響: なし

#### 実装不要になった箇所

1. **アイテムタブ分類（Q5）**
   - ItemGroupTypeの拡張、新enumの定義が不要に
   - 工数削減: 約1人日

2. **売却機能（Q11）**
   - アイテム売却機能全体が実装不要に
   - 法務的制約（消費タブの売却禁止）の実装も不要に
   - 工数削減: 約3〜5人日

3. **初回無料フラグ（Q13）**
   - `is_first_time_free`フラグの実装が不要に
   - テーブル設計が簡素化
   - 工数削減: 約0.5人日

4. **リセット処理のバッチ基盤整備（Q3）**
   - バッチ処理ではなくアクセス時判定で実装
   - バッチ基盤（cron、AWS EventBridge等）の整備が不要に
   - 工数削減: 約1〜2人日

#### 工数への総合的な影響

- **追加工数**: 複数リソース消費のサポート +3人日
- **削減工数**: タブ分類1人日 + 売却機能3〜5人日 + 初回無料0.5人日 + バッチ基盤1〜2人日 = **合計 5.5〜8.5人日削減**
- **正味の工数削減**: 約 2.5〜5.5人日削減

---

### 5.3 スケジュール・リスクへの影響

#### ゲーム体験仕様確認前の想定からの変更点

1. **複数リソース消費の追加**: 当初「仕様として必要かどうかの確認が必要」としていたが、実装必要と確定
2. **売却機能の削除**: 当初「実装タイミングの確認が必要」としていたが、実装不要と確定
3. **タブ分類の簡素化**: 当初「ItemGroupTypeの拡張が必要」としていたが、サーバー側考慮不要と確定

#### スケジュールへの影響

- **正味の工数削減**: 約 2.5〜5.5人日
- **スケジュール短縮**: 実装不要機能（売却、タブ分類）が削減されたことで、全体的に実装期間が短縮される見込み
- **リスク軽減**: 売却機能の法務的制約への対応が不要になったことで、リスクが軽減

#### 残存リスク

1. **複数リソース消費の詳細仕様が未確定**
   - リスク内容: 詳細仕様（最大組み合わせ数、バリデーション順序等）が不明
   - 影響: テーブル設計、実装方針に影響
   - 対策: 次のStage（API設計、テーブル設計）で詳細を確定する
   - 影響度: 中（実装開始後に変更が必要になる可能性あり）

2. **原画のコスト設定方針が未確定**
   - リスク内容: 原画を交換するために必要なコストの設定方針が不明
   - 影響: ゲームバランス、マスタデータ設計に影響
   - 対策: マスタデータ設計時にプランナーと合意
   - 影響度: 低（マスタデータで設定可能）

3. **クライアント側とのタブ分類仕様の合意が未完了**
   - リスク内容: クライアント側でタブ分類を行う際の判定項目が未確定
   - 影響: APIレスポンス形式に影響する可能性
   - 対策: API設計時にクライアント側と仕様を合意
   - 影響度: 低（既存データで対応可能と想定）

---

## 6. 次のアクションアイテム

### 6.1 実装進行可否の判断

- **判断**: **条件付きで実装開始可能**
  - **条件**: 複数リソース消費の詳細設計を完了すること
  - 不明点が残存しているが、実装開始に致命的な影響はない

---

### 6.2 次に実施すべき事項

- [x] ゲーム体験仕様確認結果まとめの作成（本ドキュメント）
- [ ] **優先度: 高** 複数リソース消費の詳細設計（最大組み合わせ数、バリデーション順序、ログ形式等）
- [ ] **優先度: 高** テーブル設計（複数リソース消費対応のテーブル構造設計）
- [ ] **優先度: 高** API設計（交換所一覧取得、交換実行、交換履歴取得等のエンドポイント設計）
- [ ] **優先度: 中** マスタデータ設計（原画のコスト設定方針の確認を含む）
- [ ] **優先度: 中** クライアント側とのAPI仕様合意（タブ分類判定項目、レスポンス形式等）
- [ ] **優先度: 低** 復刻時のラインナップID運用方針の再確認

---

### 6.3 プランナーへの追加確認事項

#### 追加確認1: 複数リソース消費の詳細仕様

- **確認内容:**
  - 複数リソース消費の具体的なユースケース（例: コイン1000 + アイテムA×10）
  - 最大何種類のリソースを同時消費する想定か（2種類？ 3種類以上？）
  - 複数リソース消費時のバリデーション順序の希望があるか（例: コインを先にチェック）

- **確認タイミング**: 次のStage（API設計、テーブル設計）の開始前（1週間以内）

---

#### 追加確認2: 原画のコスト設定方針

- **確認内容:**
  - 原画の交換コストはどのように設定するか
  - 通常のかけら交換と比べて、原画のコスト設定に特別な考慮が必要か

- **確認タイミング**: マスタデータ設計時（API設計と並行可能）

---

#### 追加確認3: 復刻時のラインナップID運用

- **確認内容:**
  - 復刻時に「ラインナップはそのまま」という表現が、既存ラインナップIDを再利用するのか、同じ内容の新しいラインナップIDを作成するのか

- **確認タイミング**: マスタデータ設計時

---

### 6.4 クライアント側への確認事項

#### 確認1: タブ分類の判定項目

- **確認内容:**
  - アイテムBOXの3タブ（消費・強化・かけら）の分類を行う際、どの項目（ItemType、ItemGroupType、その他）を使用して判定するか
  - サーバー側から追加で返却してほしいデータ項目があるか

- **確認タイミング**: API設計時

---

## 7. まとめ

### 7.1 確認結果の総評

プランナー確認により、交換所機能の仕様が大幅に明確化されました。特に以下の点が重要な成果です：

1. **実装負荷の大幅軽減**
   - 売却機能、タブ分類、初回無料フラグ、バッチ基盤整備が実装不要と確定
   - 正味の工数削減: 約 2.5〜5.5人日

2. **実装方針の明確化**
   - リセット処理はアクセス時判定（既存Shop機能と同様）
   - 原画の付与方法（原画 + かけら16個）
   - イベント交換所は終了後すぐ非表示

3. **残存する課題の特定**
   - 複数リソース消費の詳細設計が必要（追加工数+3人日）
   - 原画のコスト設定、復刻時のラインナップID運用の確認が必要

### 7.2 実装開始可否の最終判断

**結論**: **条件付きで実装開始可能**

- **条件**: 複数リソース消費の詳細設計（最大組み合わせ数、バリデーション順序、ログ形式等）を完了すること
- **推奨**: 次のStage（API設計、テーブル設計）で詳細を確定してから実装を開始する

### 7.3 次のStageへの引き継ぎ事項

次のStage（API設計、テーブル設計）では、以下の点を重点的に設計してください：

1. **複数リソース消費のテーブル設計**
   - 交換コストテーブルの正規化（1:N）
   - または、1レコードに複数カラムを持たせる設計

2. **API設計**
   - 交換所一覧取得（開催期間フィルタリング）
   - 交換ラインナップ取得（交換期間フィルタリング、交換可能回数計算）
   - 交換実行（複数リソース消費、原画の特別処理対応）
   - 交換履歴取得

3. **マスタデータ設計**
   - 交換所マスタ、交換所ラインナップマスタ、交換所コストマスタ（複数リソース対応）
   - 原画のコスト設定方針の反映

---

**作成日**: 2025-11-26
**作成者**: サーバー開発チーム
**次のステップ**: API設計、テーブル設計の開始
