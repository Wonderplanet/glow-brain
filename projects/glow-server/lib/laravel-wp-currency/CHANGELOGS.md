# CHANGELOGS

本ディレクトリ以下の修正について記載します。
マージ後に、関連するPRを記載してきます。

## 2025/06/12
- [改善] ReflectionTraitをcommonライブラリに作る #1318

## 2025/06/11
- [task] OprProductRepositoryの最適化 #1312
- [課金基盤]log_close_store_transactionsのマイグレーションを課金基盤ライブラリで管理するように修正 #1314

## 2025/06/05
- [通貨基盤] 無償と有償通貨の上限チェックを別々にする #1297

## 2025/05/08
- [bugfix][課金基盤] 課金基盤ライブラリのRequestIdをoctane向けに修正する  #1259

## 2025/04/25
- [task] Laravel11, 12アップグレードで必要な変更点再調査 #1254

## 2025/04/24
- [課金基盤] 課金基盤ライブラリのgetNginxRequestIdがoctaneで取得できない #1252

## 2025/04/22
- [task] phpunitの対応 #1248

## 2025/04/17
- [feature]Laravel12へのアップデート #1247

## 2025/04/15
- [課金基盤] 接続先DBの設定を環境変数から取る(wp_commonに合わせる)  #1246

## 2025/04/09
- [課金基盤][管理ツール]一次通貨を一部補填できるようにする #1238

## 2025/03/31
- [一次通貨返却(一括)] 一次通貨返却処理をジョブで実行する #1232

## 2025/03/07
- [task][課金基盤] 為替レート取得よりTWD、MRYの取得を外す #1214

## 2025/02/27
- マスターアセットクライアントバージョン後方互換対応のfeatureをdevelopにマージ #1204

## 2025/02/25
- developの最新を取り込み #1198
- [改善] deptracのyamlにUtilなどを追加 #1202
- [一次通貨返却(一括)]該当ログの検索を行い結果をダウンロードできるようにする #1190

## 2025/02/21
- 通貨基盤ライブラリのREADME更新 #1196

## 2025/02/07
- [課金基盤][管理ツール]1ユーザーへの一次通貨返却機能対応をdevelopへマージ #1150

## 2025/02/05
- [通貨基盤]コラボ集計処理で返却ログを除外する処理を修正し一部返却に対応する #1142

## 2025/01/31
- [通貨基盤]1ユーザーの指定した消費ログのうち、指定個数の補填を実行できるように修正する #1125

## 2024/12/04
-  [DIの改善] 課金基盤のDelegatorをscopedに変更、Facade追加 #988

## 2024/11/21
- [feature] 外貨為替レート登録入力フォームの修正 #957
- [bug] 外貨取得時にper 100 unitになっているものもそのまま変換されず取り込まれている #955

## 2024/11/18
- merge Feature/sprint37_api_master_import_v2 to develop #944

## 2024/11/15
- 最新のdevelopをfeatureに取り込む対応 #942

## 2024/11/12
- MngMaster/MngAsset系のDB接続をapiと同じに修正 #927

## 2024/11/11
- 外貨取得スクレイピング処理にTWD, MYRを取得できるように修正する #848

## 2024/10/04
- Merge develop to feature/sprint34_86eqbxup4_debug_mode #870

## 2024/09/24
- [feature] 取得できなかった通貨がある場合、どこかに警告を表記したい #840

## 2024/09/19
- [feature] 管理ツールより、現在登録されている外貨為替情報の一覧を表示、編集したい #833

## 2024/07/30
- [課金基盤][管理ツール]無償一次通貨のみ返却した場合にCurrencySummaryが更新されないバグを修正 #703

## 2024/07/17
- [課金基盤][管理ツール]課金ログレポートのproduct_idをplatform_product_idから取得するように修正 #675

## 2024/07/11
- [課金基盤] usr_store_infosの年齢と再通知日時情報のみ更新するメソッドを追加 #656

## 2024/07/01
- [課金基盤]TiDb向け対応 ユニットテストの修正 #613

## 2024/06/19
- [課金基盤][管理ツール] 一次通貨返却の完了ボタンで一覧に遷移しない #563

## 2024/06/11
- [課金基盤] request_idの接頭辞をrequest_id_typeに分離する #538
- [課金基盤][管理ツール] 日時の表示でUTCになっている箇所をJSTに修正 #536
- [課金基盤] 失敗していたテストの修正 20240611 #540

## 2024/06/10
- [課金基盤][管理ツール]集計ツールのサンドボックスデータ使用可否をenvから設定するように対応 #535

## 2024/06/07
- [課金基盤][管理ツール]課金履歴詳細画面のUI修正 #531
- [課金基盤][管理ツール] 一次通貨返却を行ったときのログに、before_amountに合計所持数が記録されていない #533

## 2024/06/04
- [課金基盤]allowanceの関数でtriggerDetailを引数で渡せるように修正 #523
- [課金基盤] Factoryクラス呼び出しのユニットテスト用のクラスを用意する #525

## 2024/06/03
- [課金基盤] factoryクラスをプロダクト側で指定したものを使えるようにする #517

## 2024/05/28
- [課金基盤] 二次通貨の管理を課金基盤から削除する #485
- [課金基盤] コメントにあった不要な空白を削除 #489
- [課金基盤] 二次通貨の管理を課金基盤から削除した際のテスト修正漏れ対応 #494

## 2024/05/27
- [課金基盤] 環境変数から読み込むGooglePlayのpubkeyの改行を解釈する #475

## 2024/05/22
- [課金基盤] created_at_logging_no_indexをdownで削除する #464

## 2024/05/21
- 【課金基盤】usr_store_product_historiesの主キー変更マイグレーションを調整する (0.4.0向け) #459

## 2024/05/16
- 【課金基盤】無償通貨の複数付与時の効率化を行う #449

## 2024/05/15
- 【課金基盤】マイグレーションファイルのテーブル名をCurrencyDBUtilityから取得する #446

## 2024/05/14
- developから0.4.0へ通貨所持数取得メソッドのバックポート #443

## 2024/05/07
- [課金基盤][管理ツール]通貨残高集計ツールのプラットフォーム別集計対応 #421

## 2024/04/05
- [課金基盤]opr_productsにrelease_keyカラムを追加と各ログテーブルにnginxのリクエストIDを保持するように対応 #356

## 2024/04/03
- [課金基盤] mst_store_productsのproduct_idをvarchar(255)に拡張する #352
- [課金基盤][管理ツール]一次残高集計とコラボ集計のファイル生成をキュー管理に統一する #346

## 2024/03/25
- [課金基盤][管理ツール]課金ログレポートのパフォーマンス改善2 - バックグラウンド処理でファイルを生成するところまで実装 #317

## 2024/03/14
- [課金基盤] 有償一次通貨所持情報にusr_store_product_historiesを含める #321

## 2024/03/05
- [課金基盤][管理ツール]一次残高集計ツールで集計結果がマイナスになる場合は「0」と表記するように修正 #301

## 2024/02/29
- [課金基盤][管理ツール]課金ログレポートツールのパフォーマンス改善2 - クエリのlimit句を調整 #299

## 2024/02/27
- [課金基盤][管理ツール]集計処理のパフォーマンス改善 - コラボ集計と一次通貨残高集計処理の修正 #293
- [課金基盤] リクエストIDの取得ヘッダキーを設定する #296

## 2024/02/21
- [課金基盤][管理ツール]課金ログレポートツールのパフォーマンス改善1 - 集計時のmemoli_limitを緩和、created_atにindex付与 #283

## 2024/02/19
- [課金基盤]インシデント対応:復元・回収対応の機能のDelegatorを作成 #273
- [課金基盤][管理ツール]コラボ集計から有償一次通貨返却分を除外する修正 #279

## 2024/02/14
- seed基盤で課金基盤対応するところの置き換え #266
- [課金基盤][管理ツール]返金対応：CSが手動で有償一次通貨を回収するツールを実装 #262

## 2024/02/06
- [課金基盤] hasStoreProductHistoryを追加 #261

## 2024/01/30
- [管理ツール]CS対応：有償通貨付与ツールの実装 #245

## 2024/01/29
- [課金基盤][管理ツール] 返金対応：CSが手動で無償一次通貨を回収するツール #244

## 2024/01/23
- [管理ツール]デバッグ:一次通貨消費画面の実装 #234

## 2024/01/22
- [管理ツール] usr_store_product_historiesを表示する画面つくる #232
  - ※マイグレーション時にusr_store_product_histories行へのupdateが実行されます。実行されるクエリに注意してください

## 2024/01/19
- [管理ツール] 集計をするときにサンドボックスレコードを含めるかどうか選択できるようにする #227

## 2024/01/18
- [課金・通貨基盤] 一次通貨の所持上限を設ける #222

## 2024/01/17
- [管理ツール]コラボ通貨消費集計を年月ごとに集計するように修正 #219
- [管理ツール] 集計：外貨為替定期収集ツール実装 #195
  - ※admin側でのマイグレーションと設定ファイルのコピーが必要になります。`php artisan vendor:publish --tag wp-admin` を実行してください。
  

## 2024/01/10
- [課金・通貨基盤] 有償一次通貨の付与が0の場合でもcurrency_paidを残すようにする #199

## 2024/01/09
- [課金・通貨基盤] VIPポイントの付与実装 #196

## 2023/12/27
- [課金・通貨基盤] Excel作成クラスをdelegatorから返す #191

## 2023/12/26
- [管理ツール] 集計：コラボ通貨消費集計ツール実装 #183
- [管理ツール] コラボ消費集計の終了期間を+3日する #188
- [課金・通貨基盤] 有償通貨の付与数が0の商品でエラーが出る #189

## 2023/12/25
- [管理ツール]集計:課金ログレポートの指定月が前月まで指定になっていないので修正 #182
- [管理ツール] 集計：有償一次通貨残高集計ツールの日時指定を日本時間で明確に取得するように修正 #176

## 2023/12/22
- [管理ツール] 集計：課金ログレポートツール実装 #172

## 2023/12/20
- [課金・通貨基盤] usr_store_product_historiesにageを記録しておく #173

## 2023/12/19
- [課金・通貨基盤] 課金基盤ライブラリのuser_idをusr_user_idにリネーム #170

## 2023/12/15
- [管理ツール] 有償一次通貨返却機能 #164

## 2023/12/14
- [管理ツール] 集計：有償一次通貨残高集計ツール実装 #155

## 2023/11/30
- [管理ツール] CS：ユーザー入手ログ、消費ログ表示 #150

## 2023/11/27
- [管理ツール] allowance手動登録画面で登録処理のトランザクションを改修 #139
- [管理ツール]デバッグ機能：有償一次通貨付与でix_sandboxを常にtrueで登録とメソッド名を修正 #140

## 2023/11/24
- [課金・通貨基盤][管理ツール] デバッグ：デバッグ機能（有償一次通貨付与）実装 #135

## 2023/11/17
- [課金・通貨基盤][管理ツール] ユーザー所持通貨内訳の画面細かい修正 #131

## 2023/11/16
- [課金・通貨基盤][管理ツール]allowance手動登録画面実装 #129

## 2023/11/14
- [課金・通貨基盤][管理ツール] CS：ユーザー所持通貨内訳の画面実装 #119

## 2023/11/09
- [課金・通貨基盤]product_idカラムのコメント名を修正 #108
- [課金・通貨基盤] 課金・通貨基盤関連のレコードを論理削除する #110

## 2023/11/08
- [課金・通貨基盤]テストのリファクタ対応 テストの依存性注入をapp->makeに修正 #106

## 2023/11/07
- [課金・通貨基盤]CurrencyUtilityをCurrencyドメインに移動 #104

## 2023/11/06
- [課金・通貨基盤] ログなどにis_sandboxを追加する #95

## 2023/11/01
- [課金・通貨基盤] マイグレーションファイルの先頭に改行が入っていた点を修正 #93

## 2023/10/31
- [課金・通貨基盤] 秘密鍵の内容などをシークレットマネージャの環境変数から取得する #87
- [課金・通貨基盤] phpcbfでの補正 (2023/10/31) #88
- [課金・通貨基盤] phpcsの警告などに対応 (2023/10/31) #89
- [課金・通貨基盤] phpstanの警告などに対応 (2023/10/31) #90
- [課金・通貨基盤] deptracに課金・通貨基盤ライブラリを追加 #91

## 2023/10/30
- [課金・通貨基盤] allowedToPurchaseのときにallowance削除ログを残す #82
- [課金・通貨基盤] マイグレーションのテーブル名参照をメソッド経由に修正 #84
- [課金・通貨基盤] ユーザーのデバイスIDをallowaneやログに追加する #85

## 2023/10/27
- [課金・通貨基盤] Delegatorから返すモデルをEntityにする #80

## 2023/10/26
- [課金・通貨基盤] デバッグ用に有償一次通貨を追加できるdelegatorをつくる #78

## 2023/10/25
- [課金・通貨基盤] 通貨購入のログ実装 #75
- [課金・通貨基盤] curlのエラー情報をエラーメッセージに追加 #76

## 2023/10/24
- [課金・通貨基盤] opr_product_idの名称をproduct_sub_idに変更する #67
- [課金・通貨基盤] 通貨消費のログ実装 #70
- [課金・通貨基盤] 通貨追加のログ実装 #73

## 2023/10/23
- [課金・通貨基盤] iOS/Androidのプラットフォームを課金ストア後は別の扱いにする #65

## 2023/10/20
- [課金・通貨基盤] 通貨購入の予約機能エラーハンドリング実装 #52
- [課金・通貨基盤] 所持有償一次通貨の内訳を取得する #55
- [デモアプリ] ショップの商品情報を返す #57
- [改善] テスト時のDBデータ初期化をRefreshDatabaseに統一した #58
- [課金・通貨基盤] 課金基盤関連のテーブル名を複数形にする #63

## 2023/10/18
- [課金・通貨基盤] マイグレーションファイルでのカラム追加を別々のクエリになるよう分割 #50

## 2023/10/16
- [課金・通貨基盤] 通貨購入のバリデーション実装 #41
- [課金・通貨基盤] ストア接続するテストをグループで除外するようにした #44
- [課金・通貨基盤] ユニットテスト向けレシートを削除した #45
- [課金・通貨管理] 無償一次通貨の消費でbonusを後にする #47
- [課金・通貨基盤] 通貨消費のエラーハンドリング実装 #49

## 2023/10/13
- [課金・通貨基盤] マイグレーションファイルからafterを取り除く #43

## 2023/10/12
- [課金・通貨基盤] 通貨購入のサンドボックスレシート対応実装 #37
- [課金・通貨基盤] FakeStoreのトランザクションIDをユニークIDとして取得するようにした #39

## 2023/10/06
- [課金・通貨基盤] 通貨消費の機能実装 #32
- [課金・通貨基盤] 年齢確認の機能実装 #34
- [課金・通過基盤] マイグレーション適用時にseq_noを割り当てた #36

## 2023/09/28
- [課金・通貨基盤] 通貨購入の検証なし購入処理機能実装 #22
- [課金・通過基盤] 通貨追加の機能実装 #23

## 2023/09/27
- [課金・通過基盤] マイグレーションのスキーマでデフォルトコネクションを使用する #26

## 2023/09/20
- [課金・通貨基盤] 通貨購入の許可機能実装 #14
- [デモ]保持通貨を表示できるようにする #16

## 2023/09/15
- [課金・通過基盤] billing/buyのレスポンスにproduct_sub_idを含める #9

## 2023/09/14
- [課金・通貨基盤] フレームワーク疎通向けAPIのモックとDelegator作成 Delegatorと buyのモック実装 #6
- [課金・通貨基盤] 保持通貨管理の機能実装 #3
